<div class="container mt-4">
  @if (!accion && !guardado) {
  <div class="text-center">
    <h4 class="mb-4">¬øQu√© desea hacer?</h4>
    <button
      class="btn btn-outline-primary me-3"
      (click)="seleccionarAccion('crear')"
    >
      A√±adir nuevo taller
    </button>
    <button
      class="btn btn-outline-secondary"
      (click)="seleccionarAccion('editar')"
    >
      Modificar taller existente
    </button>
  </div>
  } @if (procesando) {
  <div class="progress my-3" style="height: 20px">
    <div
      class="progress-bar progress-bar-striped progress-bar-animated"
      role="progressbar"
      [style.width.%]="progreso"
    >
      {{ progreso }}%
    </div>
  </div>
  } @if (accion && !guardado) {
  <div class="mb-3">
    <button class="btn btn-outline-secondary" (click)="volverAlInicio()">
      ‚Üê Volver
    </button>
  </div>
  } @if (accion === 'editar' && !guardado && talleres.length) {
  <div class="mb-3">
    <label class="form-label">Seleccione el taller a modificar:</label>
    <select
      class="form-select"
      [(ngModel)]="tallerSeleccionadoNombre"
      (change)="cargarTaller()"
    >
      <option [ngValue]="null" disabled selected>-- Seleccionar --</option>
      @for (t of talleres; track t) {
      <option [ngValue]="t.nombre">{{ t.nombre }}</option>
      }
    </select>
  </div>
  } @if (accion && !guardado) {
  <form
    #form="ngForm"
    (ngSubmit)="form.valid && guardarTaller()"
    class="card p-4 shadow-sm mt-3"
    novalidate
  >
    <h5 class="mb-3">
      {{ accion === "crear" ? "Nuevo Taller" : "Editar Taller" }}
    </h5>

    @for ( campo of [
    'nombre','direccion','poblacion','provincia','registroIndustrial',
    'registroEspecial','responsable','telefono','especialidad' ]; track campo )
    {
    <div class="mb-3">
      <label class="form-label">{{ formatLabel(campo) }}</label>
      <input
        type="text"
        class="form-control"
        [(ngModel)]="formularioTaller[campo]"
        [name]="campo"
        required
        #ctrl="ngModel"
      />
      @if (ctrl.invalid && ctrl.touched) {
      <div class="text-danger small">Este campo es obligatorio.</div>
      }
    </div>
    } @if (accion === 'editar') {
    <div class="d-flex gap-2 mt-4">
      <button type="submit" class="btn btn-success flex-grow-1">
        Guardar cambios
      </button>
      <button
        type="button"
        class="btn btn-danger"
        (click)="confirmarEliminacion(formularioTaller.nombre)"
      >
        üóëÔ∏è Borrar
      </button>
    </div>
    } @if (accion === 'crear') {
    <div class="mt-4">
      <button type="submit" class="btn btn-success w-100">
        Guardar taller
      </button>
    </div>
    }
  </form>
  }
</div>

<!-- MODAL √âXITO -->
<div class="modal fade" id="modalExito" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-success">
      <div class="modal-header border-0">
        <h5 class="modal-title text-success">‚úÖ √âxito</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body"><p>Operaci√≥n completada correctamente.</p></div>
      <div class="modal-footer border-0">
        <button class="btn btn-success w-100" data-bs-dismiss="modal">
          Aceptar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL ERROR -->
<div class="modal fade" id="modalError" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-danger">
      <div class="modal-header border-0">
        <h5 class="modal-title text-danger">‚ùå Error</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body"><p>Ha ocurrido un error.</p></div>
      <div class="modal-footer border-0">
        <button class="btn btn-outline-danger w-100" data-bs-dismiss="modal">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- MODAL CONFIRMACI√ìN DE BORRADO -->
<div class="modal fade" id="modalConfirmacion" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-warning">
      <div class="modal-header border-0">
        <h5 class="modal-title text-warning">‚ö†Ô∏è Confirmar eliminaci√≥n</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <p>
          ¬øEst√° seguro de que desea eliminar este taller? Esta acci√≥n no se
          puede deshacer.
        </p>
      </div>
      <div class="modal-footer border-0 d-flex gap-2">
        <button class="btn btn-secondary flex-grow-1" data-bs-dismiss="modal">
          Cancelar
        </button>
        <button
          class="btn btn-danger flex-grow-1"
          data-bs-dismiss="modal"
          (click)="eliminarTallerConfirmado()"
        >
          S√≠, eliminar
        </button>
      </div>
    </div>
  </div>
</div>
