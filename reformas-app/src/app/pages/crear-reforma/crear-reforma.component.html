<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nueva Reforma</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&family=JetBrains+Mono:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --sys-primary: #000000;
        --sys-text: #374151;
      }

      body {
        font-family: "Roboto", sans-serif;
        color: var(--sys-text);
        background-color: #ffffff;
      }

      h2 {
        font-weight: 300;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--sys-primary);
      }

      p {
        color: #666;
      }

      .container,
      .btn {
        border-radius: 0 !important;
      }

      /* FUERZA BRUTA PARA EL BOTÓN ROJO */
      .btn-danger {
        background-color: #dc3545 !important; /* Rojo Hexadecimal Directo */
        border-color: #dc3545 !important;
        color: #ffffff !important;
        opacity: 1 !important;

        /* Asegurar visibilidad */
        display: inline-flex !important;
        align-items: center;
        justify-content: center;

        /* Estilo */
        text-transform: uppercase;
        font-family: "JetBrains Mono", monospace;
        font-weight: 700;
        gap: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15); /* Sombra ligera para separarlo del fondo */
      }

      .btn-danger:hover {
        background-color: #b02a37 !important;
        border-color: #a52834 !important;
      }

      .header-border {
        border-bottom: 1px solid #e0e0e0;
      }
    </style>
  </head>
  <body>
    <div class="container mt-3">
      <div class="row align-items-center mb-3 header-border pb-4">
        <div class="col-md-9">
          <h2 class="mb-1">Nueva Reforma</h2>
          <p class="mb-0">
            Rellene toda la información para poder proceder a realizar el
            proyecto para su vehículo.
          </p>
        </div>

        <div class="col-md-3 text-md-end mt-3 mt-md-0">
          <button
            class="btn btn-danger btn-lg fw-bold w-100 w-md-auto"
            (click)="resetReforma()"
          >
            <i class="bi bi-trash3-fill"></i> Reiniciar
          </button>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>

<!-- BLOQUEO DE RENDER HASTA CARGAR PROYECTO -->
@if (!proyectoCargado) {
<div class="text-center py-5">
  <div class="spinner-border" role="status"></div>
  <p class="mt-3">Cargando proyecto...</p>
</div>
}

<!-- CUERPO DEL WIZARD (solo se renderiza cuando proyectoCargado = true) -->
@if (proyectoCargado) {
<div class="container mt-4">
  <!-- 1) TIPO DE VEHÍCULO -->
  @if (mostrarTipoVehiculo) {
  <app-tipo-vehiculo
    [datosPrevios]="datosParaTipoVehiculo"
    (autosave)="onAutosaveTipoVehiculo($event)"
    (continuar)="onContinuarTipoVehiculo($event)"
    (volver)="onVolverDesdeTipoVehiculo($event)"
  >
  </app-tipo-vehiculo>
  }

  <!-- 2) RESUMEN DE MODIFICACIONES -->
  @if (mostrarResumenModificaciones && !cargandoResumen) {
  <app-resumen-modificaciones
    [datosEntrada]="payloadResumen"
    (volver)="onVolverDesdeResumenModificaciones($event)"
    (continuar)="onContinuarDesdeResumenModificaciones($event)"
  >
  </app-resumen-modificaciones>
  }

  <!-- 3) SELECCIÓN DE SECCIONES -->
  @if (mostrarSeleccion) {
  <app-seleccion-secciones
    [seccionesPreseleccionadas]="codigosPreseleccionados || []"
    (continuar)="onContinuar($event)"
    (volver)="onVolverDesdeSeleccion($event)"
  >
  </app-seleccion-secciones>
  }

  <!-- 4) SUBSELECCIÓN -->
  @if (mostrarSubSelecciones) {
  <app-mostrar-secciones
    [secciones]="seccionesSeleccionadas || []"
    [respuestas]="respuestasGuardadas || {}"
    [desdePosterior]="vieneDePosterior"
    (volverASeleccion)="volverASeleccionDesdeSubseleccion()"
    (finalizarRecoleccion)="onFinalizarRecoleccion($event)"
  >
  </app-mostrar-secciones>
  }

  <!-- 5) FORMULARIO -->
  @if (mostrarFormularioProyecto) {
  <app-formulario-proyecto
    [datosIniciales]="datosFormularioGuardados"
    [respuestas]="respuestasGuardadas"
    [esEdicion]="editMode"
    (autosave)="onAutosaveFormulario($event)"
    (volverAReforma)="onVolverDesdeFormulario($event)"
    (finalizarFormulario)="onFinalizarFormulario($event)"
  >
  </app-formulario-proyecto>
  }

  <!-- 6) REFORMAS PREVIAS -->
  @if (mostrarReformasPrevias) {
  <app-reformas-previas
    [datos]="datosGenerales || {}"
    (autosave)="onAutosaveReformasPrevias($event)"
    (continuar)="onContinuarDesdeReformasPrevias($event)"
    (volverAlFormulario)="onVolverDesdeReformasPrevias($event)"
  >
  </app-reformas-previas>
  }

  <!-- 7) ¿COCHE O NO? -->
  @if (mostrarCocheOno) {
  <app-cocheono
    [datosEntrada]="payloadResumen"
    (volver)="onVolverDesdeCocheONo($event)"
    (continuar)="onContinuarDesdeCocheONo($event)"
  >
  </app-cocheono>
  }

  <!-- 8) CANVA -->
  @if (mostrarCanva) {
  <app-canva
    [datosEntrada]="payloadResumen"
    (autosave)="onAutosaveCanva($event)"
    (volver)="onVolverDesdeCanva($event)"
    (continuar)="onContinuarDesdeCanva($event)"
  >
  </app-canva>
  }

  <!-- 9) IMÁGENES -->
  @if (mostrarImagenes) {
  <app-imagenes
    [datosEntrada]="payloadResumen"
    [origen]="origenImagenes"
    (autosave)="onAutosaveImagenes($event)"
    (volver)="onVolverDesdeImagenes($event)"
    (continuar)="onContinuarDesdeImagenes($event)"
  >
  </app-imagenes>
  }

  <!-- 10) GENERADOR -->
  @if (mostrarGenerador) {
  <app-generador-documentos
    [reformaData]="datosGenerales || {}"
    (volverAlFormulario)="onVolverDesdeGenerador($event)"
  >
  </app-generador-documentos>
  }
</div>
}
