<div class="container mt-3">
  <form #form="ngForm" (ngSubmit)="onContinuar(form)" novalidate>
    @for (mod of modificacionesSeleccionadas; track mod; let i = $index) {
    <div>
      <!-- COCHES -->
      <!-- Homologado en emplazamiento no homologado -->
      @if ( mod.nombre === 'REMOLQUE HOMOLOGADO EN EMPLAZAMIENTO NO HOMOLOGADO'
      && mod.seleccionado ) {
      <div class="mb-3">
        <h3>Homologado en Emplazamiento No Homologado</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaHomologado{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Tipo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.tipo"
            name="tipoHomologado{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.tipo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Clase:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.clase"
            name="claseHomologado{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.clase"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">MMR eje central:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.mmrEjeCentral"
            name="mmrEjeCentral{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.mmrEjeCentral"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">MMR barra de tracción:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.mmrBarraTraccion"
            name="mmrBarraTraccion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.mmrBarraTraccion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- Homologado en emplazamiento también homologado -->
      @if (mod.nombre === REMOLQUE_TAMBIEN_HOMOLOGADO && mod.seleccionado) {
      <div class="mb-3">
        <h3>Homologado en Emplazamiento También Homologado</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca de la barra:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBarra"
            name="marcaBarra{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaBarra"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Tipo de la barra:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.tipoBarra"
            name="tipoBarra{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.tipoBarra"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Clase de la barra:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.claseBarra"
            name="claseBarra{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.claseBarra"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña homologación barra:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionBarra"
            name="homologacionBarra{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionBarra"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca de la bola:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBola"
            name="marcaBola{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaBola"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Clase de la bola:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.claseBola"
            name="claseBola{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.claseBola"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña homologación bola:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionBola"
            name="homologacionBola{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionBola"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">MMR eje central:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.mmrEjeCentral"
            name="mmrEjeCentral2_{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.mmrEjeCentral"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">MMR barra de tracción:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.mmrBarraTraccion"
            name="mmrBarraTraccion2_{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.mmrBarraTraccion"
          />
        </div>
      </div>
      }
      <!-- Reducción de plazas -->
      @if (mod.nombre === 'REDUCCIÓN DE PLAZAS' && mod.seleccionado) {
      <div class="mb-3">
        <h3>Reducción de Plazas</h3>
        <div class="mb-2">
          <label class="form-label"
            >Que plaza se elimina? (Se eliminará...)</label
          >
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.enclaje"
            name="enclajePlaza{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.enclaje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Número de plazas antes:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasAntes"
            name="plazasAntes{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasAntes"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Plazas después de la reforma:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasDespues"
            name="plazasDespues{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasDespues"
          />
        </div>
      </div>
      }
      <!-- NEUMÁTICOS -->
      @if (mod.nombre === 'NEUMÁTICOS' && mod.seleccionado) {
      <div class="mb-3">
        <h3>Neumáticos</h3>
        <div class="mb-2">
          <label class="form-label">Medida de las llantas:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidas"
            name="medidasNeumaticos{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidas"
          />
        </div>
        <!-- Campos adicionales solo si anotacion está presente y es "2" -->
        @if (mod.anotacion2) {
        <div class="mt-3">
          <div class="mb-2">
            <label class="form-label">Velocidad máxima del vehiculo:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.velocidadMaximaAntes"
              name="velMaxAntes{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.velocidadMaximaAntes"
            />
          </div>
          <div class="mb-2">
            <label class="form-label"
              >Velocidad máxima de los nuemáticos instalados:</label
            >
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.velocidadMaximaDespues"
              name="velMaxDespues{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.velocidadMaximaDespues"
            />
          </div>
        </div>
        }
      </div>
      }
      <!-- ALETINES Y SOBREALETINES -->
      @if (mod.nombre === 'ALETINES Y SOBREALETINES' && mod.seleccionado) {
      <div class="mb-3">
        <h3>Aletines y Sobrealetines</h3>
        <!-- Aletines -->
        @if (mod.detalle?.aletines) {
        <section class="mod-card aletines">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Aletines</h4>
            <span class="mod-card__hint"
              >Datos de pieza y parámetros de cálculo</span
            >
          </div>

          <!-- Bloque inicial (2 por fila) -->
          <div class="row g-3">
            <!-- Tipo de acción -->

            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaAletines-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaAletines"
                  name="marcaAletines{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaAletines"
                />
                <label for="marcaAletines-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="referenciaAletines-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaAletines"
                  name="referenciaAletines{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referenciaAletines"
                />
                <label for="referenciaAletines-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Ancho (mm) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="anchoAletines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.anchoAletines"
                  name="anchoAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.anchoAletines == null
                  "
                />
                <label for="anchoAletines-{{ i }}">Ancho (mm)</label>
              </div>
            </div>

            <!-- Métrica tornillos -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="metricaAletines-{{ i }}"
                  [(ngModel)]="mod.metricaAletines"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaAletines == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="metricaAletines-{{ i }}"
                  >Métrica de tornillos</label
                >
              </div>
            </div>
          </div>

          <!-- Separador visual -->
          <hr class="mod-sep" />

          <!-- A partir de aquí: 3 por fila -->
          <div class="row g-3">
            <!-- Número de tornillos -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numTornillosAletines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numTornillosAletines"
                  name="numTornillosAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.numTornillosAletines == null
                  "
                />
                <label for="numTornillosAletines-{{ i }}"
                  >Número de tornillos</label
                >
              </div>
            </div>

            <!-- Peso pieza (Kg) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="pesoPiezaKgAletines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  min="0"
                  [(ngModel)]="mod.pesoPiezaKgAletines"
                  name="pesoPiezaKgAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.pesoPiezaKgAletines == null
                  "
                />
                <label for="pesoPiezaKgAletines-{{ i }}"
                  >Peso de la pieza (Kg)</label
                >
              </div>
            </div>

            <!-- Superficie frontal (m²) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="superficieFrontalM2Aletines-{{ i }}"
                  placeholder="0"
                  step="0.0001"
                  min="0"
                  [(ngModel)]="mod.superficieFrontalM2Aletines"
                  name="superficieFrontalM2Aletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.superficieFrontalM2Aletines == null
                  "
                />
                <label for="superficieFrontalM2Aletines-{{ i }}"
                  >Superficie frontal (m²)</label
                >
              </div>
            </div>

            <!-- Cw -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="coefAerodinamicoCwAletines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  min="0"
                  [(ngModel)]="mod.coefAerodinamicoCwAletines"
                  name="coefAerodinamicoCwAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.coefAerodinamicoCwAletines == null
                  "
                />
                <label for="coefAerodinamicoCwAletines-{{ i }}"
                  >Cw (coef. aerodinámico)</label
                >
              </div>
            </div>

            <!-- V₂ (m/s) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="velocidadAireV2msAletines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  min="0"
                  [(ngModel)]="mod.velocidadAireV2msAletines"
                  name="velocidadAireV2msAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.velocidadAireV2msAletines == null
                  "
                />
                <label for="velocidadAireV2msAletines-{{ i }}"
                  >V₂ = 140 km/h (m/s)</label
                >
              </div>
            </div>

            <!-- p densidad aire -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="densidadAireKgM3Aletines-{{ i }}"
                  placeholder="0"
                  step="0.0001"
                  min="0"
                  [(ngModel)]="mod.densidadAireKgM3Aletines"
                  name="densidadAireKgM3Aletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.densidadAireKgM3Aletines == null
                  "
                />
                <label for="densidadAireKgM3Aletines-{{ i }}"
                  >p (densidad aire, Kg/m³)</label
                >
              </div>
            </div>

            <!-- R (m) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="radioCurvaRAletines-{{ i }}"
                  placeholder="0"
                  step="0.001"
                  min="0"
                  [(ngModel)]="mod.radioCurvaRAletines"
                  name="radioCurvaRAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.radioCurvaRAletines == null
                  "
                />
                <label for="radioCurvaRAletines-{{ i }}"
                  >R (radio de curva, m)</label
                >
              </div>
            </div>

            <!-- K -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="coefSeguridadKAletines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  min="0"
                  [(ngModel)]="mod.coefSeguridadKAletines"
                  name="coefSeguridadKAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.coefSeguridadKAletines == null
                  "
                />
                <label for="coefSeguridadKAletines-{{ i }}"
                  >K (coef. de seguridad)</label
                >
              </div>
            </div>

            <!-- Resistencia tracción (Kg/mm²) -->

            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-rest-{{ i }}"
                  [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Aletines"
                  name="resTraccionMinTornillo88Kgmm2Aletines{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option [ngValue]="80">80</option>
                  <option [ngValue]="25">25</option>
                </select>
                <label for="estr-rest-{{ i }}">
                  Res. tracción mín. (Kg/mm²)
                </label>
              </div>
            </div>

            <!-- As (mm²) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="seccionResistenteAsAletines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  min="0"
                  [(ngModel)]="mod.seccionResistenteAsAletines"
                  name="seccionResistenteAsAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.seccionResistenteAsAletines == null
                  "
                />
                <label for="seccionResistenteAsAletines-{{ i }}"
                  >As (sección resistente, mm²)</label
                >
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Sobrealetines -->
        @if (mod.detalle?.sobrealetines) {
        <section class="mod-card sobrealetines">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sobrealetines</h4>
            <span class="mod-card__hint"
              >Datos de pieza y parámetros de cálculo</span
            >
          </div>

          <!-- Bloque inicial (2 por fila) -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marca-sobrealetines-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaSobreletines"
                  name="marcaSobreletines{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaSobreletines"
                />
                <label for="marca-sobrealetines-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="ref-sobrealetines-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaSobreletines"
                  name="referenciaSobreletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaSobreletines
                  "
                />
                <label for="ref-sobrealetines-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Ancho (mm) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="ancho-sobrealetines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.anchoSobrealetines"
                  name="anchoSobrealetines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.anchoSobrealetines == null
                  "
                />
                <label for="ancho-sobrealetines-{{ i }}">Ancho (mm)</label>
              </div>
            </div>

            <!-- Ratio curvatura mín. -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="curv-sobrealetines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  [(ngModel)]="mod.curvaturaSobrealetines"
                  name="curvaturaSobrealetines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.curvaturaSobrealetines == null
                  "
                />
                <label for="curv-sobrealetines-{{ i }}"
                  >Ratio curvatura mín.</label
                >
              </div>
            </div>

            <!-- Métrica tornillos -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="metrica-sobrealetines-{{ i }}"
                  [(ngModel)]="mod.metricaSobrealetines"
                  name="metricaSobrealetines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaSobrealetines == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="metrica-sobrealetines-{{ i }}"
                  >Métrica de tornillos</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 3 por fila -->
          <div class="row g-3">
            <!-- Nº de tornillos -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="ntornillos-sobrealetines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.nTornillos == null"
                />
                <label for="ntornillos-sobrealetines-{{ i }}"
                  >Nº de tornillos</label
                >
              </div>
            </div>
            <!-- deja libres las otras dos columnas si no añades más campos ahora -->
          </div>
        </section>
        }
      </div>
      }
      <!-- SEPARADORES DE RUEDA -->
      @if (mod.nombre === 'SEPARADORES DE RUEDA' && mod.seleccionado) {
      <div class="mb-3">
        <h3>Separadores de Rueda</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaSeparadores"
            name="marcaSeparadores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaSeparadores"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaSeparadores"
            name="referenciaSeparadores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaSeparadores"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Grosor:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.grosorSeparadores"
            name="grosorSeparadores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.grosorSeparadores"
          />
        </div>
      </div>
      }
      <!-- SNORKEL -->
      @if (mod.nombre === 'SNORKEL' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card snorkel">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Snorkel</h4>
            <span class="mod-card__hint">Datos generales y de cálculo</span>
          </div>

          <!-- Datos generales -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Material -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="snk-material-{{ i }}"
                  [(ngModel)]="mod.materialSnorkel"
                  name="materialSnorkel{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.materialSnorkel"
                >
                  <option [ngValue]="null" disabled>
                    Seleccione una opción
                  </option>
                  <option value="goma">Goma</option>
                  <option value="plástico ABS">Plástico ABS</option>
                </select>
                <label for="snk-material-{{ i }}">Material</label>
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="snk-marca-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaSnorkel"
                  name="marcaSnorkel{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaSnorkel"
                />
                <label for="snk-marca-{{ i }}">Marca</label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="metricaSnorkel-{{ i }}"
                  [(ngModel)]="mod.metricaSnorkel"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaSnorkel == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="metricaSnorkel-{{ i }}">Métrica de tornillos</label>
              </div>
            </div>

            <!-- Medidas (mm) -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="snk-medidas-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.medidasSnorkel"
                  (ngModelChange)="
                    onDimensionesChange(
                      mod,
                      'medidasSnorkel',
                      'anchuraPiezaMSnorkel',
                      'alturaPiezaMSnorkel'
                    )
                  "
                  name="medidasSnorkel{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasSnorkel"
                />
                <label for="snk-medidas-{{ i }}">Medidas (mm)</label>
              </div>
            </div>

            <!-- Ratio de curvatura mínimo -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  id="snk-curvatura-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.curvaturaSnorkel"
                  name="curvaturaSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.curvaturaSnorkel == null
                  "
                />
                <label for="snk-curvatura-{{ i }}">Ratio curvatura mín.</label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 1) CARACTERÍSTICAS DE LA PIEZA -->
          <h6 class="text-muted fw-semibold">Características de la pieza</h6>
          <div class="row g-3">
            <!-- 1/13 Peso de la pieza en Kg -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-peso-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.pesoPiezaKgSnorkel"
                  name="pesoPiezaKgSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.pesoPiezaKgSnorkel == null
                  "
                />
                <label for="snk-peso-{{ i }}">Peso de la pieza (Kg)</label>
              </div>
            </div>

            <!-- 2/13 Anchura de la pieza en m -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-anchura-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.anchuraPiezaMSnorkel"
                  name="anchuraPiezaMSnorkel{{ i }}"
                  required
                  readonly
                  [class.is-invalid]="
                    formSubmitted && mod.anchuraPiezaMSnorkel == null
                  "
                />
                <label for="snk-anchura-{{ i }}">Anchura pieza (m)</label>
              </div>
            </div>

            <!-- 3/13 Altura de la pieza en m -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-altura-{{ i }}"
                  placeholder="0"
                  readonly
                  [(ngModel)]="mod.alturaPiezaMSnorkel"
                  name="alturaPiezaMSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.alturaPiezaMSnorkel == null
                  "
                />
                <label for="snk-altura-{{ i }}">Altura pieza (m)</label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 2) SUJECIÓN -->
          <h6 class="text-muted fw-semibold">Sujeción</h6>
          <div class="row g-3">
            <!-- 5/13 Nº tornillos -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="snk-nTornillosSnorkel-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.nTornillosSnorkel"
                  name="nTornillosSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.nTornillosSnorkel == null
                  "
                />
                <label for="snk-nTornillosSnorkel-{{ i }}"
                  >Nº de tornillos</label
                >
              </div>
            </div>

            <!-- 6/13 Calidad (p.ej., 8.8) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="snk-calidad-{{ i }}"
                  placeholder="8.8"
                  [(ngModel)]="mod.calidadTornilloSnorkel"
                  name="calidadTornilloSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.calidadTornilloSnorkel
                  "
                />
                <label for="snk-calidad-{{ i }}">Calidad</label>
              </div>
            </div>

            <!-- 7/13 As (Sección resistente) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-as-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.seccionResistenteAsSnorkel"
                  name="seccionResistenteAsSnorkel{{ i }}"
                  required
                  readonly
                  [class.is-invalid]="
                    formSubmitted && mod.seccionResistenteAsSnorkel == null
                  "
                />
                <label for="snk-as-{{ i }}">As (sección resistente)</label>
              </div>
            </div>

            <!-- 8/13 Res. Tracción mín tornillo 8,8 (Kg/mm²) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-rest-{{ i }}"
                  [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Snorkel"
                  name="resTraccionMinTornillo88Kgmm2Snorkel{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option [ngValue]="80">80</option>
                  <option [ngValue]="25">25</option>
                </select>
                <label for="estr-rest-{{ i }}">
                  Res. tracción mín. (Kg/mm²)
                </label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 3) CARACTERÍSTICAS PARA FUERZA POR PRESIÓN DEL AIRE -->
          <h6 class="text-muted fw-semibold">
            Características para fuerza por presión del aire
          </h6>
          <div class="row g-3">
            <!-- 9/13 Cw = Coef. Aerodinámico -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-cw-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.cwCoefAerodinamicoSnorkel"
                  name="cwCoefAerodinamicoSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.cwCoefAerodinamicoSnorkel == null
                  "
                />
                <label for="snk-cw-{{ i }}">Cw (coef. aerodinámico)</label>
              </div>
            </div>

            <!-- 10/13 p (densidad del aire, Kg/m³) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.0001"
                  min="0"
                  class="form-control"
                  id="snk-densidad-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.densidadAireKgM3Snorkel"
                  name="densidadAireKgM3Snorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.densidadAireKgM3Snorkel == null
                  "
                />
                <label for="snk-densidad-{{ i }}"
                  >p (densidad aire, Kg/m³)</label
                >
              </div>
            </div>

            <!-- 11/13 v² = velocidad del aire 140Km/h (m/s) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-v2-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.velocidadAireV2msSnorkel"
                  name="velocidadAireV2msSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.velocidadAireV2msSnorkel == null
                  "
                />
                <label for="snk-v2-{{ i }}">v² = vel. aire 140Km/h (m/s)</label>
              </div>
            </div>

            <!-- 12/12 K (coeficiente de seguridad) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="snk-k-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.coefSeguridadKSnorkel"
                  name="coefSeguridadKSnorkel{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.coefSeguridadKSnorkel == null
                  "
                />
                <label for="snk-k-{{ i }}">K (coef. de seguridad)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- PARAGOLPES DELANTERO -->
      @if (mod.nombre === 'PARAGOLPES DELANTERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card paragolpes-delantero">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Paragolpes delantero</h4>
            <span class="mod-card__hint">Datos generales y de cálculo</span>
          </div>

          <!-- Datos generales -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Tipo de fabricación -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="pgd-tipo-{{ i }}"
                  [(ngModel)]="mod.tipoFabricacionParagolpesDelantero"
                  name="tipoFabricacionParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.tipoFabricacionParagolpesDelantero
                  "
                >
                  <option [ngValue]="null" disabled>
                    Seleccione una opción
                  </option>
                  <option value="comercial">Marca y Referencia</option>
                  <option value="artesanal">
                    Fabricado en acero de forma artesanal
                  </option>
                </select>
                <label for="pgd-tipo-{{ i }}">Tipo de fabricación</label>
              </div>
            </div>
          </div>

          <!-- Marca / Referencia sólo si es comercial -->
          @if (mod.tipoFabricacionParagolpesDelantero === 'comercial') {
          <div class="row g-3 mt-0">
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgd-marca-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaParagolpes"
                  name="marcaParagolpes{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaParagolpes"
                />
                <label for="pgd-marca-{{ i }}">Marca</label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgd-ref-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaParagolpes"
                  name="referenciaParagolpes{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaParagolpes
                  "
                />
                <label for="pgd-ref-{{ i }}">Referencia</label>
              </div>
            </div>
          </div>
          }

          <!-- Medidas y curvatura -->
          <div class="row g-3 mt-0">
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgd-medidas-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.medidasParagolpesDelantero"
                  name="medidasParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.medidasParagolpesDelantero
                  "
                />
                <label for="pgd-medidas-{{ i }}">Medidas (mm)</label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Sujeción -->
          <h6 class="text-muted fw-semibold">Sujeción</h6>
          <div class="row g-3">
            <!-- Métrica -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="pgd-metricaParaDelantero-{{ i }}"
                  [(ngModel)]="mod.metricaParaDelantero"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaParaDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaParaDelantero == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="pgd-metricaParaDelantero-{{ i }}"
                  >Métrica de los tornillos</label
                >
              </div>
            </div>

            <!-- Nº de tornillos -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="pgd-ntornillosParaDelantero-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.ntornillosParaDelantero"
                  name="ntornillosParaDelantero"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.ntornillosParaDelantero
                  "
                />
                <label for="pgd-ntornillosParaDelantero-{{ i }}"
                  >Nº de tornillos</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Características de la pieza -->
          <h6 class="text-muted fw-semibold">Características de la pieza</h6>
          <div class="row g-3">
            <!-- Peso de la pieza (Kg) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgd-peso-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.pesoPiezaKgParagolpesDelantero"
                  name="pesoPiezaKgParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.pesoPiezaKgParagolpesDelantero == null
                  "
                />
                <label for="pgd-peso-{{ i }}">Peso de la pieza (Kg)</label>
              </div>
            </div>

            <!-- Superficie frontal (m²) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.0001"
                  min="0"
                  class="form-control"
                  id="pgd-superficie-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.superficieFrontalM2ParagolpesDelantero"
                  name="superficieFrontalM2ParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.superficieFrontalM2ParagolpesDelantero == null
                  "
                />
                <label for="pgd-superficie-{{ i }}"
                  >Superficie frontal (m²)</label
                >
              </div>
            </div>

            <!-- As (sección resistente, mm²) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgd-as-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.seccionResistenteAsParagolpesDelantero"
                  name="seccionResistenteAsParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.seccionResistenteAsParagolpesDelantero == null
                  "
                />
                <label for="pgd-as-{{ i }}">As (sección resistente, mm²)</label>
              </div>
            </div>

            <!-- Res. tracción mín. 8,8 (Kg/mm²) -->

            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-rest-{{ i }}"
                  [(ngModel)]="
                    mod.resTraccionMinTornillo88Kgmm2ParagolpesDelantero
                  "
                  name="resTraccionMinTornillo88Kgmm2ParagolpesDelantero{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option [ngValue]="80">80</option>
                  <option [ngValue]="25">25</option>
                </select>
                <label for="estr-rest-{{ i }}">
                  Res. tracción mín. (Kg/mm²)
                </label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Características para fuerza producida por presión del aire -->
          <h6 class="text-muted fw-semibold">
            Características para fuerza producida por presión del aire
          </h6>
          <div class="row g-3">
            <!-- Cw = Coef. Aerodinámico -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgd-cw-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.cwCoefAerodinamicoParagolpesDelantero"
                  name="cwCoefAerodinamicoParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.cwCoefAerodinamicoParagolpesDelantero == null
                  "
                />
                <label for="pgd-cw-{{ i }}">Cw (coef. aerodinámico)</label>
              </div>
            </div>

            <!-- p (densidad del aire, Kg/m³) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.0001"
                  min="0"
                  class="form-control"
                  id="pgd-densidad-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.densidadAireKgM3ParagolpesDelantero"
                  name="densidadAireKgM3ParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.densidadAireKgM3ParagolpesDelantero == null
                  "
                />
                <label for="pgd-densidad-{{ i }}"
                  >p (densidad aire, Kg/m³)</label
                >
              </div>
            </div>

            <!-- v² = velocidad del aire 140Km/h (m/s) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgd-v2-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.velocidadAireV2msParagolpesDelantero"
                  name="velocidadAireV2msParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.velocidadAireV2msParagolpesDelantero == null
                  "
                />
                <label for="pgd-v2-{{ i }}">v² = vel. aire 140Km/h (m/s)</label>
              </div>
            </div>

            <!-- R (radio de curva, m) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="pgd-r-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.radioCurvaRParagolpesDelantero"
                  name="radioCurvaRParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.radioCurvaRParagolpesDelantero == null
                  "
                />
                <label for="pgd-r-{{ i }}">R (radio de curva, m)</label>
              </div>
            </div>

            <!-- K (coeficiente de seguridad) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgd-k-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.coefSeguridadKParagolpesDelantero"
                  name="coefSeguridadKParagolpesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.coefSeguridadKParagolpesDelantero == null
                  "
                />
                <label for="pgd-k-{{ i }}">K (coef. de seguridad)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- PARAGOLPES TRASERO -->
      @if (mod.nombre === 'PARAGOLPES TRASERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card paragolpes-trasero">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Paragolpes trasero</h4>
            <span class="mod-card__hint">Datos generales y de cálculo</span>
          </div>

          <!-- Datos generales -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Tipo de fabricación -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="pgt-fab-{{ i }}"
                  [(ngModel)]="mod.tipoFabricacionParagolpesTrasero"
                  name="tipoFabricacionParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.tipoFabricacionParagolpesTrasero
                  "
                >
                  <option value="" disabled>Seleccione una opción</option>
                  <option value="comercial">Marca y Referencia</option>
                  <option value="artesanal">
                    Fabricado en acero de forma artesanal
                  </option>
                </select>
                <label for="pgt-fab-{{ i }}">Tipo de fabricación</label>
              </div>
            </div>

            <!-- Marca / Referencia (solo si comercial) -->
            @if (mod.tipoFabricacionParagolpesTrasero === 'comercial') {
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgt-marca-{{ i }}"
                  [(ngModel)]="mod.marcaParagolpesTrasero"
                  name="marcaParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.marcaParagolpesTrasero
                  "
                  placeholder="Marca"
                />
                <label for="pgt-marca-{{ i }}">Marca</label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgt-ref-{{ i }}"
                  [(ngModel)]="mod.referenciaParagolpesTrasero"
                  name="referenciaParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaParagolpesTrasero
                  "
                  placeholder="Referencia"
                />
                <label for="pgt-ref-{{ i }}">Referencia</label>
              </div>
            </div>
            }

            <!-- Medidas y curvatura -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgt-medidas-{{ i }}"
                  placeholder="Ej.: 1200×180×80 mm"
                  [(ngModel)]="mod.medidasParagolpesTrasero"
                  (ngModelChange)="
                    onDimensionesChange(
                      mod,
                      'medidasParagolpesTrasero',
                      'anchuraMParagolpesTrasero',
                      'alturaMParagolpesTrasero'
                    )
                  "
                  name="medidasParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.medidasParagolpesTrasero
                  "
                />
                <label for="pgt-medidas-{{ i }}">Medidas (mm)</label>
              </div>
            </div>
          </div>

          <!-- Características de la pieza -->
          <div class="mod-card__header mt-3">
            <h5 class="mod-card__title mb-0">Características de la pieza</h5>
          </div>

          <div class="row g-3">
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgt-peso-{{ i }}"
                  [(ngModel)]="mod.pesoPiezaKgParagolpesTrasero"
                  name="pesoPiezaKgParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.pesoPiezaKgParagolpesTrasero
                  "
                  placeholder="Peso (kg)"
                />
                <label for="pgt-peso-{{ i }}">Peso (kg)</label>
              </div>
            </div>

            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="pgt-ancho-{{ i }}"
                  [(ngModel)]="mod.anchuraMParagolpesTrasero"
                  name="anchuraMParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.anchuraMParagolpesTrasero
                  "
                  placeholder="Anchura (m)"
                />
                <label for="pgt-ancho-{{ i }}">Anchura (m)</label>
              </div>
            </div>

            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="pgt-alto-{{ i }}"
                  [(ngModel)]="mod.alturaMParagolpesTrasero"
                  name="alturaMParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.alturaMParagolpesTrasero
                  "
                  placeholder="Altura (m)"
                />
                <label for="pgt-alto-{{ i }}">Altura (m)</label>
              </div>
            </div>

            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  max="2"
                  class="form-control"
                  id="pgt-cw-{{ i }}"
                  [(ngModel)]="mod.coefAerodinamicoParagolpesTrasero"
                  name="coefAerodinamicoParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.coefAerodinamicoParagolpesTrasero == null
                  "
                  placeholder="Coef. aerodinámico (Cw)"
                />
                <label for="pgt-cw-{{ i }}">Coef. aerodinámico (Cw)</label>
              </div>
            </div>
          </div>

          <!-- Sujeción -->
          <div class="mod-card__header mt-3">
            <h5 class="mod-card__title mb-0">Sujeción</h5>
          </div>

          <div class="row g-3">
            <!-- Nº de tornillos -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="pgt-ntorn-{{ i }}"
                  [(ngModel)]="mod.nTornillosParagolpesTrasero"
                  name="nTornillosParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.nTornillosParagolpesTrasero
                  "
                  placeholder="Nº de tornillos"
                />
                <label for="pgt-ntorn-{{ i }}">Nº de tornillos</label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="pgd-metricaParaTrasero-{{ i }}"
                  [(ngModel)]="mod.metricaParaTrasero"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaParaTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaParaTrasero == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="pgd-metricaParaTrasero-{{ i }}"
                  >Métrica de los tornillos</label
                >
              </div>
            </div>

            <!-- Calidad -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="pgt-calidad-{{ i }}"
                  [(ngModel)]="mod.calidadTornilloParagolpesTrasero"
                  name="calidadTornilloParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.calidadTornilloParagolpesTrasero
                  "
                  placeholder="Calidad (ej.: 8.8)"
                />
                <label for="pgt-calidad-{{ i }}">Calidad (ej.: 8.8)</label>
              </div>
            </div>

            <!-- As (sección resistente) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgt-as-{{ i }}"
                  [(ngModel)]="mod.seccionResistenteAsParagolpesTrasero"
                  name="seccionResistenteAsParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.seccionResistenteAsParagolpesTrasero == null
                  "
                  placeholder="As (mm²)"
                  readonly
                />
                <label for="pgt-as-{{ i }}">As (sección resistente, mm²)</label>
              </div>
            </div>

            <!-- Res. tracción mín. tornillo 8,8 (Kg/mm²) -->

            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-rest-{{ i }}"
                  [(ngModel)]="
                    mod.resTraccionMinTornillo88Kgmm2ParagolpesTrasero
                  "
                  name="resTraccionMinTornillo88Kgmm2ParagolpesTrasero{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option [ngValue]="80">80</option>
                  <option [ngValue]="25">25</option>
                </select>
                <label for="estr-rest-{{ i }}">
                  Res. tracción mín. (Kg/mm²)
                </label>
              </div>
            </div>
          </div>

          <!-- Parámetros para presión del aire -->
          <div class="mod-card__header mt-3">
            <h5 class="mod-card__title mb-0">Parámetros de presión del aire</h5>
          </div>

          <div class="row g-3">
            <!-- p (densidad aire) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgt-dens-{{ i }}"
                  [(ngModel)]="mod.densidadAireKgM3ParagolpesTrasero"
                  name="densidadAireKgM3ParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.densidadAireKgM3ParagolpesTrasero
                  "
                  placeholder="Densidad aire ρ (kg/m³)"
                />
                <label for="pgt-dens-{{ i }}">p (densidad aire, Kg/m³)</label>
              </div>
            </div>

            <!-- v² = 140 Km/h (m/s) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="pgt-v2-{{ i }}"
                  [(ngModel)]="mod.velocidadAireV2msParagolpesTrasero"
                  name="velocidadAireV2msParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.velocidadAireV2msParagolpesTrasero == null
                  "
                  placeholder="v² (m/s)"
                />
                <label for="pgt-v2-{{ i }}">v² = vel. aire 140Km/h (m/s)</label>
              </div>
            </div>

            <!-- R (radio de curva) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="1"
                  min="0"
                  class="form-control"
                  id="pgt-radio-{{ i }}"
                  [(ngModel)]="mod.radioCurvaRParagolpesTrasero"
                  name="radioCurvaRParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.radioCurvaRParagolpesTrasero
                  "
                  placeholder="R (m)"
                />
                <label for="pgt-radio-{{ i }}">R (radio de curva, m)</label>
              </div>
            </div>

            <!-- K (coef. de seguridad) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.1"
                  min="1"
                  class="form-control"
                  id="pgt-k-{{ i }}"
                  [(ngModel)]="mod.coefSeguridadKParagolpesTrasero"
                  name="coefSeguridadKParagolpesTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.coefSeguridadKParagolpesTrasero
                  "
                  placeholder="K"
                />
                <label for="pgt-k-{{ i }}">K (coef. de seguridad)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- CABRESTANTE -->
      @if (mod.nombre === 'CABRESTANTE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card cabrestante">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Cabrestante</h4>
            <span class="mod-card__hint">Datos generales y de cálculo</span>
          </div>

          <!-- Datos generales (reusa exactamente tus bindings) -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="cbr-marca-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaCabrestante"
                  name="marcaCabrestante{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaCabrestante"
                />
                <label for="cbr-marca-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Capacidad (LB) -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="cbr-caplb-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.capacidadCabrestanteLb"
                  name="capacidadCabrestanteLb{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.capacidadCabrestanteLb == null
                  "
                />
                <label for="cbr-caplb-{{ i }}"
                  >Capacidad de arrastre (LB)</label
                >
              </div>
            </div>

            <!-- Capacidad (Kg) -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="cbr-capkg-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.capacidadCabrestanteKg"
                  name="capacidadCabrestanteKg{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.capacidadCabrestanteKg == null
                  "
                />
                <label for="cbr-capkg-{{ i }}"
                  >Capacidad de arrastre (Kg)</label
                >
              </div>
            </div>

            <!-- Métrica de tornillos (con tus bindings) -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="cbr-metricaCabrestante-{{ i }}"
                  [(ngModel)]="mod.metricaCabrestante"
                  name="metricaCabrestante{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaCabrestante == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="cbr-metricaCabrestante-{{ i }}"
                  >Métrica de los tornillos</label
                >
              </div>
            </div>

            <!-- Nº de tornillos (reusa exactamente tu binding y name original) -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="cbr-ntornillos-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label for="cbr-ntornillos-{{ i }}">Nº de tornillos</label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 1) Características del material y elementos de unión empleados -->
          <h6 class="text-muted fw-semibold">
            Características del material y elementos de unión empleados
          </h6>
          <div class="row g-3">
            <!-- Tiro máx. del cabrestante (Kg) — si quieres, puede ser igual a capacidad (Kg) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="cbr-tiro-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.tiroMaxCabrestanteKg"
                  name="tiroMaxCabrestanteKg{{ i }}"
                />
                <label for="cbr-tiro-{{ i }}"
                  >Tiro máx. del cabrestante (Kg)</label
                >
              </div>
            </div>

            <!-- Diámetro de cada perno (cm) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="cbr-diam-perno-cm-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.diametroPernoCmCabrestante"
                  name="diametroPernoCmCabrestante{{ i }}"
                />
                <label for="cbr-diam-perno-cm-{{ i }}"
                  >Diámetro de cada perno (cm)</label
                >
              </div>
            </div>

            <!-- Material del perno -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="cbr-mat-perno-{{ i }}"
                  placeholder="Acero 8.8"
                  [(ngModel)]="mod.materialPernoCabrestante"
                  name="materialPernoCabrestante{{ i }}"
                />
                <label for="cbr-mat-perno-{{ i }}">Material del perno</label>
              </div>
            </div>

            <!-- Tensión mín., rotura cortante (Kg/cm²) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="cbr-tension-cortante-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.tensionMinCortanteKgCm2Cabrestante"
                  name="tensionMinCortanteKgCm2Cabrestante{{ i }}"
                />
                <label for="cbr-tension-cortante-{{ i }}"
                  >Tensión mín. cortante (Kg/cm²)</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 2) Tensión cortante soportada por los pernos de unión al chasis -->
          <h6 class="text-muted fw-semibold">
            Tensión cortante soportada por los pernos de unión al chasis
          </h6>
          <div class="row g-3">
            <!-- Número de pernos (puedes reutilizar nTornillos si te interesa que coincidan) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="cbr-npernos-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.nPernosChasisCabrestante"
                  name="nPernosChasisCabrestante{{ i }}"
                />
                <label for="cbr-npernos-{{ i }}">Número de pernos</label>
              </div>
            </div>

            <!-- Diámetro de cada perno (mm) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="cbr-diam-perno-mm-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.diametroPernoChasisMmCabrestante"
                  name="diametroPernoChasisMmCabrestante{{ i }}"
                />
                <label for="cbr-diam-perno-mm-{{ i }}"
                  >Diámetro de cada perno (mm)</label
                >
              </div>
            </div>

            <!-- Material del perno (chasis) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="cbr-mat-perno-chasis-{{ i }}"
                  placeholder="Acero 8.8"
                  [(ngModel)]="mod.materialPernoChasisCabrestante"
                  name="materialPernoChasisCabrestante{{ i }}"
                />
                <label for="cbr-mat-perno-chasis-{{ i }}"
                  >Material del perno</label
                >
              </div>
            </div>

            <!-- Tensión mín., rotura cortante (Kg/cm²) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="cbr-tension-cortante-chasis-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.tensionMinCortanteChasisKgCm2Cabrestante"
                  name="tensionMinCortanteChasisKgCm2Cabrestante{{ i }}"
                />
                <label for="cbr-tension-cortante-chasis-{{ i }}"
                  >Tensión mín. cortante (Kg/cm²)</label
                >
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- ANTIEMPOTRAMIENTO -->
      @if (mod.nombre === 'ANTIEMPOTRAMIENTO' && mod.seleccionado) {
      <div class="mb-3">
        <h3>Antiempotramiento</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas (mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasAntiempotramiento"
            name="medidasAntiempotramiento{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasAntiempotramiento"
          />
        </div>

        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- SOPORTES PARA LUCES DE USO ESPECÍFICO -->
      @if (mod.nombre === 'SOPORTES PARA LUCES DE USO ESPECÍFICO' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luces-especificas">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Soportes para luces de uso específico
            </h4>
            <span class="mod-card__hint">Datos generales y de cálculo</span>
          </div>

          <!-- Datos generales -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Ubicación -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="luces-ubicacion-{{ i }}"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.ubicacionLucesEspecificas"
                  name="ubicacionLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.ubicacionLucesEspecificas
                  "
                />
                <label for="luces-ubicacion-{{ i }}">Ubicación</label>
              </div>
            </div>

            <!-- Medidas -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="luces-medidas-{{ i }}"
                  placeholder="XXX x XXX mm"
                  [(ngModel)]="mod.medidasLucesEspecificas"
                  name="medidasLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.medidasLucesEspecificas
                  "
                  (ngModelChange)="
                    onDimensionesChange(
                      mod,
                      'medidasLucesEspecificas',
                      'anchuraPiezaMLucesEspecificas',
                      'alturaPiezaMLucesEspecificas'
                    )
                  "
                />
                <label for="luces-medidas-{{ i }}"
                  >Medidas (ej: XXX x XXX mm)</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 1) CARACTERÍSTICAS DE LA PIEZA -->
          <h6 class="text-muted fw-semibold">Características de la pieza</h6>
          <div class="row g-3">
            <!-- 1/13 Peso de la pieza en Kg -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="luces-peso-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.pesoPiezaKgLucesEspecificas"
                  name="pesoPiezaKgLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.pesoPiezaKgLucesEspecificas == null
                  "
                />
                <label for="luces-peso-{{ i }}">Peso de la pieza (Kg)</label>
              </div>
            </div>

            <!-- 2/13 Anchura de la pieza en m -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="luces-anchura-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.anchuraPiezaMLucesEspecificas"
                  name="anchuraPiezaMLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.anchuraPiezaMLucesEspecificas == null
                  "
                  readonly
                />
                <label for="luces-anchura-{{ i }}"
                  >Anchura de la pieza (m)</label
                >
              </div>
            </div>

            <!-- 3/13 Altura de la pieza en m -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="luces-altura-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.alturaPiezaMLucesEspecificas"
                  name="alturaPiezaMLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.alturaPiezaMLucesEspecificas == null
                  "
                  readonly
                />
                <label for="luces-altura-{{ i }}">Altura de la pieza (m)</label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 2) SUJECIÓN -->
          <h6 class="text-muted fw-semibold">Sujeción</h6>
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="pgd-metricaLucesEspecificas-{{ i }}"
                  [(ngModel)]="mod.metricaLucesEspecificas"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaLucesEspecificas == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="pgd-metricaLucesEspecificas-{{ i }}"
                  >Métrica de los tornillos</label
                >
              </div>
            </div>

            <!-- 5/13 Nº de tornillos -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="luces-nTornillosLucesEspecificas-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.nTornillosLucesEspecificas"
                  name="nTornillosLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.nTornillosLucesEspecificas == null
                  "
                />
                <label for="luces-nTornillosLucesEspecificas-{{ i }}"
                  >Nº de tornillos</label
                >
              </div>
            </div>

            <!-- 6/13 Calidad -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="luces-calidad-{{ i }}"
                  placeholder="8.8"
                  [(ngModel)]="mod.calidadTornilloLucesEspecificas"
                  name="calidadTornilloLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.calidadTornilloLucesEspecificas
                  "
                />
                <label for="luces-calidad-{{ i }}">Calidad</label>
              </div>
            </div>

            <!-- 7/13 As (Sección resistente) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="luces-as-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.seccionResistenteAsLucesEspecificas"
                  name="seccionResistenteAsLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.seccionResistenteAsLucesEspecificas == null
                  "
                />
                <label for="luces-as-{{ i }}">As (sección resistente)</label>
              </div>
            </div>

            <!-- 8/13 Res. Tracción mín tornillo 8,8 (Kg/mm²) -->

            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-rest-{{ i }}"
                  [(ngModel)]="
                    mod.resTraccionMinTornillo88Kgmm2LucesEspecificas
                  "
                  name="resTraccionMinTornillo88Kgmm2LucesEspecificas{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option [ngValue]="80">80</option>
                  <option [ngValue]="25">25</option>
                </select>
                <label for="estr-rest-{{ i }}">
                  Res. tracción mín. (Kg/mm²)
                </label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 3) CARACTERÍSTICAS PARA FUERZA PRODUCIDA POR PRESIÓN DEL AIRE -->
          <h6 class="text-muted fw-semibold">
            Características para fuerza producida por presión del aire
          </h6>
          <div class="row g-3">
            <!-- 9/13 Cw = Coef. Aerodinámico -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="luces-cw-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.cwCoefAerodinamicoLucesEspecificas"
                  name="cwCoefAerodinamicoLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.cwCoefAerodinamicoLucesEspecificas == null
                  "
                />
                <label for="luces-cw-{{ i }}">Cw (coef. aerodinámico)</label>
              </div>
            </div>

            <!-- 10/13 p (densidad del aire, Kg/m³) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.0001"
                  min="0"
                  class="form-control"
                  id="luces-densidad-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.densidadAireKgM3LucesEspecificas"
                  name="densidadAireKgM3LucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.densidadAireKgM3LucesEspecificas == null
                  "
                />
                <label for="luces-densidad-{{ i }}"
                  >p (densidad aire, Kg/m³)</label
                >
              </div>
            </div>

            <!-- 11/13 v² = velocidad del aire 140Km/h (m/s) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="luces-v2-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.velocidadAireV2msLucesEspecificas"
                  name="velocidadAireV2msLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted &&
                    mod.velocidadAireV2msLucesEspecificas == null
                  "
                />
                <label for="luces-v2-{{ i }}"
                  >v² = vel. aire 140Km/h (m/s)</label
                >
              </div>
            </div>

            <!-- 12/13 R (radio de curva) m -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="luces-radio-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.radioCurvaRLucesEspecificas"
                  name="radioCurvaRLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.radioCurvaRLucesEspecificas == null
                  "
                />
                <label for="luces-radio-{{ i }}">R (radio de curva, m)</label>
              </div>
            </div>

            <!-- 13/13 K (coeficiente de seguridad) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="luces-k-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.coefSeguridadKLucesEspecificas"
                  name="coefSeguridadKLucesEspecificas{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.coefSeguridadKLucesEspecificas == null
                  "
                />
                <label for="luces-k-{{ i }}">K (coef. de seguridad)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- SOPORTE PARA RUEDA DE REPUESTO -->
      @if ( mod.nombre === 'SOPORTE PARA RUEDA DE REPUESTO' && mod.seleccionado
      ) {
      <div class="mb-3">
        <h3>Soporte para rueda de repuesto</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Tipo de fabricación:</label>
          <select
            class="form-select"
            [(ngModel)]="mod.tipoFabricacionRuedaRepuesto"
            name="tipoFabricacionRuedaRepuesto{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.tipoFabricacionRuedaRepuesto
            "
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option value="comercial">Marca y Referencia</option>
            <option value="artesanal">
              Fabricado en acero de forma artesanal
            </option>
          </select>
        </div>
        @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaRuedaRepuesto"
            name="marcaRuedaRepuesto{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaRuedaRepuesto"
          />
        </div>
        } @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaRuedaRepuesto"
            name="referenciaRuedaRepuesto{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaRuedaRepuesto"
          />
        </div>
        }
        <div class="mb-2">
          <label class="form-label">Medidas (ej: XXX x XXX mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasRuedaRepuesto"
            name="medidasRuedaRepuesto{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasRuedaRepuesto"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ratio de curvatura mínimo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.curvaturaSoporteRuedaRepuesto"
            name="curvaturaSoporteRuedaRepuesto{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.curvaturaSoporteRuedaRepuesto
            "
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- MUELLES, BALLESTAS Y AMORTIGUADORES -->
      @if ( mod.nombre === 'TODA LA CASUÍSTICA DE MUELLES, BALLESTAS Y ' +
      'AMORTIGUADORES QUE SE PUEDEN DAR' && mod.seleccionado ) {
      <div class="mb-3">
        <h3>Casuística de Muelles, Ballestas y Amortiguadores</h3>
        <!-- Muelle delantero con referencia -->
        @if (mod.detallesMuelles?.muelleDelanteroConRef) {
        <section class="mod-card muelle-delantero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle delantero con referencia</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>

          <div class="row g-3">
            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaMuelleDelanteroConRef-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroConRef"
                  name="marcaMuelleDelanteroConRef{{ i }}"
                  required
                />
                <label for="marcaMuelleDelanteroConRef-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="refMuelleDelanteroConRef-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleDelanteroConRef"
                  name="referenciaMuelleDelanteroConRef{{ i }}"
                  required
                />
                <label for="refMuelleDelanteroConRef-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Diámetro exterior -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamExteriorDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroExteriorDelanteroRef"
                  name="diametroExteriorDelanteroRef{{ i }}"
                  required
                />
                <label for="diamExteriorDelanteroRef-{{ i }}"
                  >Diámetro exterior (mm)</label
                >
              </div>
            </div>

            <!-- Longitud libre -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="longLibreDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.longitudLibreDelanteroRef"
                  name="longitudLibreDelanteroRef{{ i }}"
                  required
                />
                <label for="longLibreDelanteroRef-{{ i }}"
                  >Longitud libre (mm)</label
                >
              </div>
            </div>

            <!-- Diámetro de espira -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamEspiraDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroEspiraDelanteroRef"
                  name="diametroEspiraDelanteroRef{{ i }}"
                  required
                />
                <label for="diamEspiraDelanteroRef-{{ i }}"
                  >Diámetro de espira (mm)</label
                >
              </div>
            </div>

            <!-- Número de espiras -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numEspirasDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numeroEspirasDelanteroRef"
                  name="numeroEspirasDelanteroRef{{ i }}"
                  required
                />
                <label for="numEspirasDelanteroRef-{{ i }}"
                  >Nº de espiras</label
                >
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Muelle delantero sin referencia -->
        @if (mod.detallesMuelles?.muelleDelanteroSinRef) {
        <section class="mod-card muelle-delantero-sinref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle delantero sin referencia</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>

          <div class="row g-3">
            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaMuelleDelanteroSinRef-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroSinRef"
                  name="marcaMuelleDelanteroSinRef{{ i }}"
                  required
                />
                <label for="marcaMuelleDelanteroSinRef-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Diámetro exterior -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamExteriorDelanteroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroExteriorDelanteroSinRef"
                  name="diametroExteriorDelanteroSinRef{{ i }}"
                  required
                />
                <label for="diamExteriorDelanteroSinRef-{{ i }}"
                  >Diámetro exterior (mm)</label
                >
              </div>
            </div>

            <!-- Longitud libre -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="longLibreDelanteroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.longitudLibreDelanteroSinRef"
                  name="longitudLibreDelanteroSinRef{{ i }}"
                  required
                />
                <label for="longLibreDelanteroSinRef-{{ i }}"
                  >Longitud libre (mm)</label
                >
              </div>
            </div>

            <!-- Diámetro de espira -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamEspiraDelanteroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroEspiraDelanteroSinRef"
                  name="diametroEspiraDelanteroSinRef{{ i }}"
                  required
                />
                <label for="diamEspiraDelanteroSinRef-{{ i }}"
                  >Diámetro de espira (mm)</label
                >
              </div>
            </div>

            <!-- Número de espiras -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numEspirasDelanteroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numeroEspirasDelanteroSinRef"
                  name="numeroEspirasDelanteroSinRef{{ i }}"
                  required
                />
                <label for="numEspirasDelanteroSinRef-{{ i }}"
                  >Nº de espiras</label
                >
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Muelle trasero con referencia -->
        @if (mod.detallesMuelles?.muelleTraseroConRef) {
        <section class="mod-card muelle-trasero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle trasero con referencia</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>

          <div class="row g-3">
            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaMuelleTraseroConRef-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroConRef"
                  name="marcaMuelleTraseroConRef{{ i }}"
                  required
                />
                <label for="marcaMuelleTraseroConRef-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="refMuelleTraseroConRef-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleTraseroConRef"
                  name="referenciaMuelleTraseroConRef{{ i }}"
                  required
                />
                <label for="refMuelleTraseroConRef-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Diámetro exterior -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamExteriorTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroExteriorTraseroRef"
                  name="diametroExteriorTraseroRef{{ i }}"
                  required
                />
                <label for="diamExteriorTraseroRef-{{ i }}"
                  >Diámetro exterior (mm)</label
                >
              </div>
            </div>

            <!-- Longitud libre -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="longLibreTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.longitudLibreTraseroRef"
                  name="longitudLibreTraseroRef{{ i }}"
                  required
                />
                <label for="longLibreTraseroRef-{{ i }}"
                  >Longitud libre (mm)</label
                >
              </div>
            </div>

            <!-- Diámetro de espira -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamEspiraTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroEspiraTraseroRef"
                  name="diametroEspiraTraseroRef{{ i }}"
                  required
                />
                <label for="diamEspiraTraseroRef-{{ i }}"
                  >Diámetro de espira (mm)</label
                >
              </div>
            </div>

            <!-- Número de espiras -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numEspirasTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numeroEspirasTraseroRef"
                  name="numeroEspirasTraseroRef{{ i }}"
                  required
                />
                <label for="numEspirasTraseroRef-{{ i }}">Nº de espiras</label>
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Muelle trasero sin referencia -->
        @if (mod.detallesMuelles?.muelleTraseroSinRef) {
        <section class="mod-card muelle-trasero-sinref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle trasero sin referencia</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>

          <div class="row g-3">
            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaMuelleTraseroSinRef-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroSinRef"
                  name="marcaMuelleTraseroSinRef{{ i }}"
                  required
                />
                <label for="marcaMuelleTraseroSinRef-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Diámetro exterior -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamExteriorTraseroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroExteriorTraseroSinRef"
                  name="diametroExteriorTraseroSinRef{{ i }}"
                  required
                />
                <label for="diamExteriorTraseroSinRef-{{ i }}"
                  >Diámetro exterior (mm)</label
                >
              </div>
            </div>

            <!-- Longitud libre -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="longLibreTraseroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.longitudLibreTraseroSinRef"
                  name="longitudLibreTraseroSinRef{{ i }}"
                  required
                />
                <label for="longLibreTraseroSinRef-{{ i }}"
                  >Longitud libre (mm)</label
                >
              </div>
            </div>

            <!-- Diámetro de espira -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamEspiraTraseroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroEspiraTraseroSinRef"
                  name="diametroEspiraTraseroSinRef{{ i }}"
                  required
                />
                <label for="diamEspiraTraseroSinRef-{{ i }}"
                  >Diámetro de espira (mm)</label
                >
              </div>
            </div>

            <!-- Número de espiras -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numEspirasTraseroSinRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numeroEspirasTraseroSinRef"
                  name="numeroEspirasTraseroSinRef{{ i }}"
                  required
                />
                <label for="numEspirasTraseroSinRef-{{ i }}"
                  >Nº de espiras</label
                >
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Ballesta delantera -->
        @if (mod.detallesMuelles?.ballestaDelantera) {
        <div class="mb-3">
          <section class="mod-card ballesta-delantera">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Ballesta Delantera</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <div class="row g-3">
              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="marcaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.marcaBallestaDelantera"
                    name="marcaBallestaDelantera{{ i }}"
                    placeholder="Marca"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.marcaBallestaDelantera
                    "
                  />
                  <label for="marcaBallestaDelantera-{{ i }}">Marca</label>
                </div>
              </div>

              <!-- Referencia -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="referenciaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.referenciaBallestaDelantera"
                    name="referenciaBallestaDelantera{{ i }}"
                    placeholder="Referencia"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.referenciaBallestaDelantera
                    "
                  />
                  <label for="referenciaBallestaDelantera-{{ i }}"
                    >Referencia</label
                  >
                </div>
              </div>

              <!-- Número de hojas -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="1"
                    class="form-control"
                    id="numHojasBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.numHojasBallestaDelantera"
                    name="numHojasBallestaDelantera{{ i }}"
                    placeholder="Número de hojas"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.numHojasBallestaDelantera
                    "
                  />
                  <label for="numHojasBallestaDelantera-{{ i }}"
                    >Nº de hojas</label
                  >
                </div>
              </div>

              <!-- Ancho de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="anchoHojaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.anchoHojaBallestaDelantera"
                    name="anchoHojaBallestaDelantera{{ i }}"
                    placeholder="Ancho (mm)"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.anchoHojaBallestaDelantera
                    "
                  />
                  <label for="anchoHojaBallestaDelantera-{{ i }}"
                    >Ancho hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Espesor de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="espesorHojaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.espesorHojaBallestaDelantera"
                    name="espesorHojaBallestaDelantera{{ i }}"
                    placeholder="Espesor (mm)"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.espesorHojaBallestaDelantera
                    "
                  />
                  <label for="espesorHojaBallestaDelantera-{{ i }}"
                    >Espesor hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Longitud total -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="longitudBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.longitudBallestaDelantera"
                    name="longitudBallestaDelantera{{ i }}"
                    placeholder="Longitud total (mm)"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.longitudBallestaDelantera
                    "
                  />
                  <label for="longitudBallestaDelantera-{{ i }}"
                    >Longitud total (2L) (mm)</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- Ballesta trasera -->
        @if (mod.detallesMuelles?.ballestaTrasera) {
        <div class="mb-3">
          <section class="mod-card ballesta-trasera">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Ballesta Trasera</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <div class="row g-3">
              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="marcaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.marcaBallestaTrasera"
                    name="marcaBallestaTrasera{{ i }}"
                    placeholder="Marca"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.marcaBallestaTrasera
                    "
                  />
                  <label for="marcaBallestaTrasera-{{ i }}">Marca</label>
                </div>
              </div>

              <!-- Referencia -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="referenciaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.referenciaBallestaTrasera"
                    name="referenciaBallestaTrasera{{ i }}"
                    placeholder="Referencia"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.referenciaBallestaTrasera
                    "
                  />
                  <label for="referenciaBallestaTrasera-{{ i }}"
                    >Referencia</label
                  >
                </div>
              </div>

              <!-- Número de hojas -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="1"
                    class="form-control"
                    id="numHojasBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.numHojasBallestaTrasera"
                    name="numHojasBallestaTrasera{{ i }}"
                    placeholder="Número de hojas"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.numHojasBallestaTrasera
                    "
                  />
                  <label for="numHojasBallestaTrasera-{{ i }}"
                    >Nº de hojas</label
                  >
                </div>
              </div>

              <!-- Ancho de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="anchoHojaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.anchoHojaBallestaTrasera"
                    name="anchoHojaBallestaTrasera{{ i }}"
                    placeholder="Ancho (mm)"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.anchoHojaBallestaTrasera
                    "
                  />
                  <label for="anchoHojaBallestaTrasera-{{ i }}"
                    >Ancho hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Espesor de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="espesorHojaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.espesorHojaBallestaTrasera"
                    name="espesorHojaBallestaTrasera{{ i }}"
                    placeholder="Espesor (mm)"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.espesorHojaBallestaTrasera
                    "
                  />
                  <label for="espesorHojaBallestaTrasera-{{ i }}"
                    >Espesor hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Longitud total -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="longitudBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.longitudBallestaTrasera"
                    name="longitudBallestaTrasera{{ i }}"
                    placeholder="Longitud total (mm)"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.longitudBallestaTrasera
                    "
                  />
                  <label for="longitudBallestaTrasera-{{ i }}"
                    >Longitud total (2L) (mm)</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- Amortiguador delantero -->
        @if (mod.detallesMuelles?.amortiguadorDelantero) {
        <div>
          <h4>Amortiguador Delantero</h4>
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaAmortiguadorDelantero"
              name="marcaAmortiguadorDelantero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.marcaAmortiguadorDelantero
              "
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaAmortiguadorDelantero"
              name="referenciaAmortiguadorDelantero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaAmortiguadorDelantero
              "
            />
          </div>
        </div>
        }
        <!-- Amortiguador trasero -->
        @if (mod.detallesMuelles?.amortiguadorTrasero) {
        <div>
          <h4>Amortiguador Trasero</h4>
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaAmortiguadorTrasero"
              name="marcaAmortiguadorTrasero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.marcaAmortiguadorTrasero
              "
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaAmortiguadorTrasero"
              name="referenciaAmortiguadorTrasero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaAmortiguadorTrasero
              "
            />
          </div>
        </div>

        }

        <!-- Tacos de goma (delanteros y traseros) -->
        @if (mod.detallesMuelles?.tacosDeGoma) {
        <div class="mb-3">
          <section class="mod-card tacos-goma">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Instalación de Tacos de Goma</h4>
              <span class="mod-card__hint"
                >Opciones de montaje y parámetros</span
              >
            </div>

            <!-- Checkboxes -->
            <div class="row g-3 mb-2">
              <div class="col-12 col-md-6">
                <div class="form-check">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="tacosDelantero{{ i }}"
                    [(ngModel)]="mod.tacosDelantero"
                    name="tacosDelantero{{ i }}"
                  />
                  <label class="form-check-label" for="tacosDelantero{{ i }}">
                    Tacos delanteros
                  </label>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-check">
                  <input
                    type="checkbox"
                    class="form-check-input"
                    id="tacosTrasero{{ i }}"
                    [(ngModel)]="mod.tacosTrasero"
                    name="tacosTrasero{{ i }}"
                  />
                  <label class="form-check-label" for="tacosTrasero{{ i }}">
                    Tacos traseros
                  </label>
                </div>
              </div>
            </div>

            @if (formSubmitted && !mod.tacosTrasero && !mod.tacosDelantero) {
            <div class="invalid-feedback d-block">
              Debe seleccionar al menos una opción.
            </div>
            }

            <hr class="mod-sep" />

            <div class="row g-3">
              <!-- Campos Delanteros a la izquierda -->
              @if (mod.tacosDelantero) {
              <div class="col-12 col-md-6">
                <div class="form-floating mb-2">
                  <input
                    type="number"
                    class="form-control"
                    id="diametroTacoDelantero-{{ i }}"
                    [(ngModel)]="mod.diametroTacoDelantero"
                    name="diametroTacoDelantero{{ i }}"
                    placeholder="Diámetro del eje delantero"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.diametroTacoDelantero
                    "
                  />
                  <label for="diametroTacoDelantero-{{ i }}">
                    Diámetro del eje delantero (mm)
                  </label>
                </div>

                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    id="espesorTacoDelantero-{{ i }}"
                    [(ngModel)]="mod.espesorTacoDelantero"
                    name="espesorTacoDelantero{{ i }}"
                    placeholder="Espesor del eje delantero"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.espesorTacoDelantero
                    "
                  />
                  <label for="espesorTacoDelantero-{{ i }}">
                    Espesor del eje delantero (mm)
                  </label>
                </div>
              </div>
              }

              <!-- Campos Traseros a la derecha -->
              @if (mod.tacosTrasero) {
              <div class="col-12 col-md-6">
                <div class="form-floating mb-2">
                  <input
                    type="number"
                    class="form-control"
                    id="diametroTacoTrasero-{{ i }}"
                    [(ngModel)]="mod.diametroTacoTrasero"
                    name="diametroTacoTrasero{{ i }}"
                    placeholder="Diámetro del eje trasero"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.diametroTacoTrasero
                    "
                  />
                  <label for="diametroTacoTrasero-{{ i }}">
                    Diámetro del eje trasero (mm)
                  </label>
                </div>

                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    id="espesorTacoTrasero-{{ i }}"
                    [(ngModel)]="mod.espesorTacoTrasero"
                    name="espesorTacoTrasero{{ i }}"
                    placeholder="Espesor del eje trasero"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.espesorTacoTrasero
                    "
                  />
                  <label for="espesorTacoTrasero-{{ i }}">
                    Espesor del eje trasero (mm)
                  </label>
                </div>
              </div>
              }
            </div>
          </section>
        </div>
        }

        <!-- Kit de elevación -->
        @if (mod.detallesMuelles?.kitElevacion) {
        <div>
          <h4>Kit de Elevación</h4>
          <div class="form-check">
            <input
              type="checkbox"
              class="form-check-input"
              id="kitElevacionDelantero{{ i }}"
              [(ngModel)]="mod.detallesMuelles.kitElevacionDelantero"
              name="kitElevacionDelantero{{ i }}"
            />
            <label class="form-check-label" for="kitElevacionDelantero{{ i }}">
              Muelles delanteros
            </label>
          </div>
          <div class="form-check">
            <input
              type="checkbox"
              class="form-check-input"
              id="kitElevacionTrasero{{ i }}"
              [(ngModel)]="mod.detallesMuelles.kitElevacionTrasero"
              name="kitElevacionTrasero{{ i }}"
            />
            <label class="form-check-label" for="kitElevacionTrasero{{ i }}">
              Ballestas traseras
            </label>
          </div>
          @if ( formSubmitted && !mod.detallesMuelles.kitElevacionDelantero &&
          !mod.detallesMuelles.kitElevacionTrasero ) {
          <div class="invalid-feedback d-block">
            Debe seleccionar al menos una opción.
          </div>
          }
          <!-- SOLO SI: muelles delanteros -->
          @if (mod.detallesMuelles.kitElevacionDelantero) {
          <div>
            <h4 class="mt-3">Eje Delantero</h4>
            <div class="mb-2">
              <label class="form-label">Marca:</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="mod.marcaKitElevacionDelantera"
                name="marcaKitElevacion{{ i }}"
                required
              />
            </div>
            <div class="mb-2">
              <label class="form-label">Tipo de suspensión:</label>
              <select
                class="form-select"
                [(ngModel)]="mod.tipoSuspensionDelantera"
                name="tipoSuspensionDelantera{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && !mod.tipoSuspensionDelantera
                "
              >
                <option value="" disabled selected>
                  Seleccione una opción
                </option>
                <option value="muelles">Muelles</option>
                <option value="ballestas">Ballestas</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Tipo de taco:</label>
              <select
                class="form-select"
                [(ngModel)]="mod.tipoTacoDelantero"
                name="tipoTacoDelantero{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.tipoTacoDelantero"
              >
                <option value="" disabled selected>
                  Seleccione una opción
                </option>
                <option value="circular">Circular</option>
                <option value="rectangular">Rectangular</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Diámetro (mm):</label>
              <input
                type="number"
                min="0"
                min="0"
                class="form-control"
                [(ngModel)]="mod.diametroTacoDelantero"
                name="diametroTacoDelantero{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.diametroTacoDelantero"
              />
            </div>
            <div class="mb-2">
              <label class="form-label">Espesor (mm):</label>
              <input
                type="number"
                min="0"
                min="0"
                class="form-control"
                [(ngModel)]="mod.espesorTacoDelantero"
                name="espesorTacoDelantero{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.espesorTacoDelantero"
              />
            </div>
          </div>
          }
          <!-- SOLO SI: ballestas traseras -->
          @if (mod.detallesMuelles.kitElevacionTrasero) {
          <div>
            <h4 class="mt-3">Eje Trasero</h4>
            <div class="mb-2">
              <label class="form-label">Marca:</label>
              <input
                type="text"
                class="form-control"
                [(ngModel)]="mod.marcaKitElevacionTrasera"
                name="marcaKitElevacion{{ i }}"
                required
              />
            </div>
            <div class="mb-2">
              <label class="form-label">Tipo de suspensión:</label>
              <select
                class="form-select"
                [(ngModel)]="mod.tipoSuspensionTrasera"
                name="tipoSuspensionTrasera{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.tipoSuspensionTrasera"
              >
                <option value="" disabled selected>
                  Seleccione una opción
                </option>
                <option value="muelles">Muelles</option>
                <option value="ballestas">Ballestas</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Tipo de taco:</label>
              <select
                class="form-select"
                [(ngModel)]="mod.tipoTacoTrasero"
                name="tipoTacoTrasero{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.tipoTacoTrasero"
              >
                <option value="" disabled selected>
                  Seleccione una opción
                </option>
                <option value="circular">Circular</option>
                <option value="rectangular">Rectangular</option>
              </select>
            </div>
            <div class="mb-2">
              <label class="form-label">Diámetro (mm):</label>
              <input
                type="number"
                min="0"
                min="0"
                class="form-control"
                [(ngModel)]="mod.diametroTacoTrasero"
                name="diametroTacoTrasero{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.diametroTacoTrasero"
              />
            </div>
            <div class="mb-2">
              <label class="form-label">Espesor (mm):</label>
              <input
                type="number"
                min="0"
                min="0"
                class="form-control"
                [(ngModel)]="mod.espesorTacoTrasero"
                name="espesorTacoTrasero{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.espesorTacoTrasero"
              />
            </div>
          </div>
          }
        </div>
        }
      </div>
      }
      <!-- Matrícula y Portamatrícula -->
      @if (mod.nombre === 'MATRÍCULA Y PORTAMATRÍCULA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Matrícula y Portamatrícula</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <!-- OPCIÓN 1 -->
        @if (mod.detalle.instalacionPorta) {
        <div>
          <div class="mb-2">
            <label>Ubicación del portamatrícula:</label>
            <select
              class="form-select"
              [(ngModel)]="mod.ubicacionPorta1"
              name="ubicacionPorta1{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.ubicacionPorta1 === undefined
              "
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="trasero">Trasero</option>
              <option value="delantero">Delantero</option>
            </select>
          </div>
          <div class="mb-2">
            <label>Lado:</label>
            <select
              [(ngModel)]="mod.ladoPorta1"
              name="ladoPorta1{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="formSubmitted && mod.ladoPorta1 === undefined"
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="derecho">Derecho</option>
              <option value="izquierdo">Izquierdo</option>
              <option value="centro">Centro</option>
            </select>
          </div>
          <div class="mb-2">
            <label>Material:</label>
            <select
              [(ngModel)]="mod.materialPorta1"
              name="materialPorta1{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="
                formSubmitted && mod.materialPorta1 === undefined
              "
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="acero">Acero</option>
              <option value="plástico">Plástico</option>
            </select>
          </div>
          <div class="mb-2">
            <label>Fabricación:</label>
            <select
              [(ngModel)]="mod.fabricacionPorta1"
              name="fabricacionPorta1{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="
                formSubmitted && mod.fabricacionPorta1 === undefined
              "
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="artesanal">Artesanal</option>
              <option value="comprado">Comprado</option>
            </select>
          </div>
          @if (mod.fabricacionPorta1 === 'comprado') {
          <div class="mb-2">
            <label>Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaPorta1"
              name="marcaPorta1{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.marcaPorta1 === undefined
              "
            />
          </div>
          } @if (mod.fabricacionPorta1 === 'comprado') {
          <div class="mb-2">
            <label>Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaPorta1"
              name="referenciaPorta1{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.referenciaPorta1 === undefined
              "
            />
          </div>
          }
        </div>
        } @if (mod.detalle.reubicacionTrasera) {
        <!-- OPCIÓN 2 -->
        <h4 class="mt-3">Reubicación</h4>
        <div>
          <div class="mb-2">
            <label>Portamatrícula:</label>
            <select
              [(ngModel)]="mod.portamatr2"
              name="portamatr2{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="formSubmitted && mod.portamatr2 === undefined"
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="delantero">Delantero</option>
              <option value="trasero">Trasero</option>
            </select>
          </div>
          <div class="form-check mt-2">
            <input
              type="checkbox"
              class="form-check-input"
              [(ngModel)]="mod.paragolpesNuevo2"
              name="paragolpesNuevo2{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.paragolpesNuevo2 === undefined
              "
            />
            <label class="form-check-label">¿Es nuevo paragolpes?</label>
          </div>
        </div>
        } @if (mod.detalle.cambioUbicacionDelantera) {
        <!-- OPCIÓN 3 -->
        <h4 class="mt-3">Cambio de ubicación</h4>
        <div>
          <div class="mb-2">
            <label>Matrícula:</label>
            <select
              [(ngModel)]="mod.ubicacionMat3"
              name="ubicacionMat3{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="
                formSubmitted && mod.ubicacionMat3 === undefined
              "
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="delantera">Delantera</option>
              <option value="trasera">Trasera</option>
            </select>
          </div>
          <div class="mb-2">
            <label>Material:</label>
            <select
              [(ngModel)]="mod.materialMat3"
              name="materialMat3{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="
                formSubmitted && mod.materialMat3 === undefined
              "
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="Acrílica">Acrílica</option>
              <option value="Metálica">Metálica</option>
            </select>
          </div>
          <div class="mb-2">
            <label>Medidas:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.medidasMat3"
              name="medidasMat3{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.medidasMat3 === undefined
              "
            />
          </div>
          <div class="mb-2">
            <label>Ubicación en paragolpes:</label>
            <select
              [(ngModel)]="mod.ubicacionBumper3"
              name="ubicacionBumper3{{ i }}"
              class="form-select"
              required
              [class.is-invalid]="
                formSubmitted && mod.ubicacionBumper3 === undefined
              "
            >
              <option value="" disabled selected>Seleccione...</option>
              <option value="derecho">Derecho</option>
              <option value="izquierdo">Izquierdo</option>
              <option value="centro">Centro</option>
            </select>
          </div>
          <div class="form-check mt-2">
            <input
              type="checkbox"
              class="form-check-input"
              [(ngModel)]="mod.paragolpesNuevo3"
              name="paragolpesNuevo3{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.paragolpesNuevo3 === undefined
              "
            />
            <label class="form-check-label">¿Es nuevo paragolpes?</label>
          </div>
        </div>
        }
      </div>
      }
      <!-- Defensa Delantera -->
      @if (mod.nombre === 'DEFENSA DELANTERA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Defensa Delantera</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaDefensa"
            name="marcaDefensa{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaDefensa"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloDefensa"
            name="modeloDefensa{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloDefensa"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Grosor del tubo (mm):</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.grosorTuboDefensa"
            name="grosorTuboDefensa{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.grosorTuboDefensa"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas (ej: XXX x XXX mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasDefensa"
            name="medidasDefensa{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasDefensa"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ratio de curvatura mínimo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.curvaturaDefensaDelantera"
            name="curvaturaDefensaDelantera{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.curvaturaDefensaDelantera"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- Amortiguador de Dirección -->
      @if (mod.nombre === 'AMORTIGUADOR DE DIRECCIÓN' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Amortiguador de Dirección</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaAmortiguador"
            name="marcaAmortiguador{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaAmortiguador"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaAmortiguador"
            name="referenciaAmortiguador{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaAmortiguador"
          />
        </div>
      </div>
      }
      <!-- Barra de Dirección -->
      @if (mod.nombre === 'BARRA DE DIRECCIÓN' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Barra de Dirección</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBarraDireccion"
            name="marcaBarraDireccion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaBarraDireccion"
          />
        </div>
      </div>
      }
      <!-- Barra para Regular la Convergencia (simple) -->
      @if ( mod.nombre === BARRA_ALINEAMIENTO && mod.seleccionado &&
      !mod.regulable ) {
      <div class="mb-4">
        <h3>Barra para Regular la Convergencia</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaConvergencia"
            name="marcaConvergencia{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaConvergencia"
          />
        </div>
      </div>
      }
      <!-- Barra para Regular la Convergencia (regulable) -->
      @if ( mod.nombre === BARRA_MOV_LATERAL && mod.seleccionado ) {
      <div class="mb-4">
        <h3>Barra para Regular la Convergencia (Regulable o No)</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaConvergenciaReg"
            name="marcaConvergenciaReg{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaConvergenciaReg"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">¿Es regulable?:</label>
          <select
            class="form-select"
            [(ngModel)]="mod.regulable"
            name="regulable{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.regulable === undefined"
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option [ngValue]="true">Sí</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaConvergenciaReg"
            name="referenciaConvergenciaReg{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaConvergenciaReg"
          />
        </div>
      </div>
      }
      <!-- FAROS DELANTEROS PRINCIPALES -->
      @if ( mod.nombre === 'FAROS DELANTEROS PRINCIPALES' && mod.seleccionado )
      {
      <div class="mb-4">
        <h3>Faros Delanteros Principales</h3>
        <div class="mb-2">
          <label class="form-label">¿Es LED?</label>
          <select
            class="form-select"
            [(ngModel)]="mod.esLed"
            name="esLedFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.esLed === undefined"
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option [ngValue]="true">Sí</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacionFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcado luz de posición:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcadoPosicion"
            name="marcadoPosicionFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcadoPosicion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcado luz de cruce/carretera:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcadoCruce"
            name="marcadoCruceFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcadoCruce"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Índice de referencia (pdl/ud):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.pdlFaro"
            name="pdlFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.pdlFaro"
          />
        </div>
      </div>
      }
      <!-- LUZ DE CRUCE -->
      @if (mod.nombre === 'LUZ DE CRUCE' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Luz de Cruce</h3>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaje"
            name="marcajeCruce{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacionCruce{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Índice de referencia (pdl/ud):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.pdlFaroCruce"
            name="pdlFaroCruce{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.pdlFaroCruce"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >¿La luz de carretera queda desactivada?</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.carreteraDesactivada"
            name="carreteraDesactivada{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.carreteraDesactivada === undefined
            "
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option [ngValue]="true">Sí</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
      </div>
      }
      <!-- LUCES DE LARGO ALCANCE -->
      @if (mod.nombre === 'LUCES DE LARGO ALCANCE' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Luces de Largo Alcance</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaLargoAlcance{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencia"
            name="referenciaLargoAlcance{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referencia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaje"
            name="marcajeLargoAlcance{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacionLargoAlcance{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Índice de referencia (pdl/ud):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.indiceReferencia"
            name="indiceLargoAlcance{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.indiceReferencia"
          />
        </div>
      </div>
      }
      <!-- LUZ DE POSICIÓN -->
      @if (mod.nombre === 'LUZ DE POSICIÓN' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Luz de Posición</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">¿Es LED?</label>
          <select
            class="form-select"
            [(ngModel)]="mod.esLedPosicion"
            name="esLedPosicion{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.esLedPosicion === undefined
            "
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option [ngValue]="true">Sí</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaPosicion"
            name="marcaPosicion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaPosicion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajePosicion"
            name="marcajePosicion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcajePosicion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionPosicion"
            name="homologacionPosicion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionPosicion"
          />
        </div>
      </div>
      }
      <!-- 3ª LUZ DE FRENO -->
      @if (mod.nombre === '3ª LUZ DE FRENO' && mod.seleccionado) {
      <div class="mb-4">
        <h3>3ª Luz de Freno</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca3Freno"
            name="marca3Freno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaje3Freno"
            name="marcaje3Freno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaje3Freno"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion3Freno"
            name="homologacion3Freno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion3Freno"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Donde está situado?</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.situado3Freno"
            name="situado3Freno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.situado3Freno"
          />
        </div>
      </div>
      }
      <!-- DIURNAS -->
      @if (mod.nombre === 'DIURNAS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Luces Diurnas</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">¿Es LED?</label>
          <select
            class="form-select"
            [(ngModel)]="mod.esLed"
            name="esLedFaro{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.esLed === undefined"
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option [ngValue]="true">Sí</option>
            <option [ngValue]="false">No</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaDiurnas"
            name="marcaDiurnas{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaDiurnas"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionDiurnas"
            name="homologacionDiurnas{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionDiurnas"
          />
        </div>
      </div>
      }
      <!-- ANTINIEBLA -->
      @if (mod.nombre === 'ANTINIEBLA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Luces Antiniebla</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaAntiniebla"
            name="marcaAntiniebla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaAntiniebla"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionAntiniebla"
            name="homologacionAntiniebla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionAntiniebla"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- PILOTO TRASERO -->
      @if (mod.nombre === 'PILOTO TRASERO' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Piloto Trasero</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaPilotoTrasero"
            name="marcaPilotoTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaPilotoTrasero"
          />
        </div>
        @if (mod.detalle.luzPosicionFreno) {
        <div class="mb-2">
          <label class="form-label">Referencia posición/freno:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaLuzPosicionFreno"
            name="referenciaLuzPosicionFreno{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.referenciaLuzPosicionFreno
            "
          />
        </div>
        } @if (mod.detalle.intermitente) {
        <div class="mb-2">
          <label class="form-label">Referencia intermitente:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaIntermitente"
            name="referenciaIntermitente{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaIntermitente"
          />
        </div>
        } @if (mod.detalle.marchaAtras) {
        <div class="mb-2">
          <label class="form-label">Referencia marcha atrás:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaMarchaAtras"
            name="referenciaMarchaAtras{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaMarchaAtras"
          />
        </div>
        } @if (mod.detalle.catadioptrico) {
        <div class="mb-2">
          <label class="form-label">Referencia catadióptrico:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaCatadioptrico"
            name="referenciaCatadioptrico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaCatadioptrico"
          />
        </div>
        }
      </div>
      }
      <!-- INTERMITENTES -->
      @if (mod.nombre === 'INTERMITENTES' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Intermitentes</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>

          <div
            class="invalid-feedback d-block"
            *ngIf="
              formSubmitted && (!mod.acciones || mod.acciones.length === 0)
            "
          >
            Debe seleccionar al menos una acción.
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajeIntermitentes"
            name="marcajeIntermitentes{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcajeIntermitentes"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionIntermitentes"
            name="homologacionIntermitentes{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionIntermitentes"
          />
        </div>
      </div>
      }
      <!-- SUSTITUCIÓN DE EJES -->
      @if (mod.nombre === 'SUSTITUCIÓN DE EJES' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Sustitución de ejes</h3>
        <div class="mb-2">
          <label class="form-label">Marca procedente:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaEje"
            name="marcaEje{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaEje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Denominación comercial procedente:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.denominacionEje"
            name="denominacionEje{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.denominacionEje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.contrasenaHomologacionEje"
            name="contrasenaHomologacionEje{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.contrasenaHomologacionEje"
          />
        </div>
      </div>
      }
      <!-- ESTRIBOS LATERALES O TALONERAS -->
      @if (mod.nombre === 'ESTRIBOS LATERALES O TALONERAS' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card estribos-laterales">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Estribos laterales o taloneras</h4>
            <span class="mod-card__hint">Datos generales y de cálculo</span>
          </div>

          <!-- Datos generales -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>

              <div
                class="invalid-feedback d-block"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="estr-marca-{{ i }}"
                  [(ngModel)]="mod.marcataloneras"
                  name="marcataloneras{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcataloneras"
                  placeholder="Marca"
                />
                <label for="estr-marca-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Material -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-material-{{ i }}"
                  [(ngModel)]="mod.materialEstribos"
                  name="materialEstribos{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.materialEstribos"
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option value="acero">Acero</option>
                  <option value="plástico">Plástico</option>
                </select>
                <label for="estr-material-{{ i }}">Material</label>
              </div>
            </div>

            <!-- Dimensiones -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="estr-dimensiones-{{ i }}"
                  [(ngModel)]="mod.dimensionesTaloneras"
                  name="dimensionesTaloneras{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.dimensionesTaloneras
                  "
                  (ngModelChange)="
                    onDimensionesChange(
                      mod,
                      'dimensionesTaloneras',
                      'anchuraMEstribos',
                      'alturaMEstribos'
                    )
                  "
                  placeholder="Dimensiones"
                />
                <label for="estr-dimensiones-{{ i }}"
                  >Dimensiones (ej: 150x600mm)</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Características de la pieza -->
          <h6 class="text-muted fw-semibold">Características de la pieza</h6>
          <div class="row g-3">
            <!-- Peso -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="estr-peso-{{ i }}"
                  [(ngModel)]="mod.pesoPiezaKgEstribos"
                  name="pesoPiezaKgEstribos{{ i }}"
                  placeholder="Curvatura mín."
                />
                <label for="estr-peso-{{ i }}">Peso de la pieza (Kg)</label>
              </div>
            </div>

            <!-- Anchura -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="estr-ancho-{{ i }}"
                  [(ngModel)]="mod.anchuraMEstribos"
                  name="anchuraMEstribos{{ i }}"
                  placeholder="Anchura (m)"
                  readonly
                />
                <label for="estr-ancho-{{ i }}">Anchura (m)</label>
              </div>
            </div>

            <!-- Altura -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="estr-altura-{{ i }}"
                  [(ngModel)]="mod.alturaMEstribos"
                  name="alturaMEstribos{{ i }}"
                  placeholder="Altura (m)"
                  readonly
                />
                <label for="estr-altura-{{ i }}">Altura (m)</label>
              </div>
            </div>

            <!-- Coef. aerodinámico -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="estr-cw-{{ i }}"
                  [(ngModel)]="mod.coefAerodinamicoEstribos"
                  name="coefAerodinamicoEstribos{{ i }}"
                  placeholder="Cw (coef. aerodinámico)"
                />
                <label for="estr-cw-{{ i }}">Cw (coef. aerodinámico)</label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Sujeción -->
          <h6 class="text-muted fw-semibold">Sujeción</h6>
          <div class="row g-3">
            <!-- Métrica -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-metricaTalonera-{{ i }}"
                  [(ngModel)]="mod.metricaTalonera"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaTalonera{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaTalonera == null
                  "
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="estr-metricaTalonera-{{ i }}"
                  >Métrica de los tornillos</label
                >
              </div>
            </div>

            <!-- Nº de tornillos -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="estr-nTornillosEstribos-{{ i }}"
                  [(ngModel)]="mod.nTornillosEstribos"
                  name="nTornillosEstribos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillosEstribos"
                  placeholder="Nº tornillos"
                />
                <label for="estr-nTornillosEstribos-{{ i }}"
                  >Nº de tornillos</label
                >
              </div>
            </div>

            <!-- Calidad -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="estr-calidad-{{ i }}"
                  [(ngModel)]="mod.calidadTornilloEstribos"
                  name="calidadTornilloEstribos{{ i }}"
                  placeholder="Calidad"
                  readonly
                />
                <label for="estr-calidad-{{ i }}">Calidad</label>
              </div>
            </div>

            <!-- As sección resistente -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="estr-as-{{ i }}"
                  [(ngModel)]="mod.seccionResistenteAsEstribos"
                  name="seccionResistenteAsEstribos{{ i }}"
                  placeholder="As (sección resistente, mm²)"
                />
                <label for="estr-as-{{ i }}"
                  >As (sección resistente, mm²)</label
                >
              </div>
            </div>

            <!-- Res. tracción mín. 8,8 -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="estr-rest-{{ i }}"
                  [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Estribos"
                  name="resTraccionMinTornillo88Kgmm2Estribos{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  <option [ngValue]="80">80</option>
                  <option [ngValue]="25">25</option>
                </select>
                <label for="estr-rest-{{ i }}">
                  Res. tracción mín. (Kg/mm²)
                </label>
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Parámetros para presión del aire -->
          <h6 class="text-muted fw-semibold">
            Parámetros para presión del aire
          </h6>
          <div class="row g-3">
            <!-- p densidad -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="estr-dens-{{ i }}"
                  [(ngModel)]="mod.densidadAireKgM3Estribos"
                  name="densidadAireKgM3Estribos{{ i }}"
                  placeholder="p (densidad aire, Kg/m³)"
                />
                <label for="estr-dens-{{ i }}">p (densidad aire, Kg/m³)</label>
              </div>
            </div>

            <!-- v² -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  min="0"
                  class="form-control"
                  id="estr-v2-{{ i }}"
                  [(ngModel)]="mod.velocidadAireV2msEstribos"
                  name="velocidadAireV2msEstribos{{ i }}"
                  placeholder="v² = vel. aire 140Km/h (m/s)"
                />
                <label for="estr-v2-{{ i }}"
                  >v² = vel. aire 140Km/h (m/s)</label
                >
              </div>
            </div>

            <!-- R -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="1"
                  min="0"
                  class="form-control"
                  id="estr-r-{{ i }}"
                  [(ngModel)]="mod.radioCurvaREstribos"
                  name="radioCurvaREstribos{{ i }}"
                  placeholder="R (radio de curva, m)"
                />
                <label for="estr-r-{{ i }}">R (radio de curva, mínimo)</label>
              </div>
            </div>

            <!-- K -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.1"
                  min="0"
                  class="form-control"
                  id="estr-k-{{ i }}"
                  [(ngModel)]="mod.coefSeguridadKEstribos"
                  name="coefSeguridadKEstribos{{ i }}"
                  placeholder="K (coef. de seguridad)"
                />
                <label for="estr-k-{{ i }}">K (coef. de seguridad)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- MOTOS -->
      <!-- REDUCCIÓN MMA Y MMTA -->
      @if (mod.nombre === 'REDUCCIÓN MMA Y MMTA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Reducción MMA y MMTA</h3>
        @if (mod.ejeDelantero) {
        <div>
          <h4>Reducción en eje delantero</h4>
          <label class="form-label">Kg totales:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.kgReduccionEjeDelantero"
            name="kgReduccionEjeDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.kgReduccionEjeDelantero"
          />
        </div>
        } @if (mod.ejeTotal) {
        <div>
          <h4>Reducción total</h4>
          <label class="form-label">Kg totales:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.kgReduccionTotal"
            name="kgReduccionTotal{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.kgReduccionTotal"
          />
        </div>
        }
      </div>
      }
      <!-- LLANTAS Y NEUMÁTICOS -->
      @if (mod.nombre === 'LLANTAS Y NEUMÁTICOS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Llantas y Neumáticos</h3>
        <div class="mb-2">
          <label>Cual de los dos neumaticos?:</label>
          <select
            class="form-select"
            [(ngModel)]="mod.neumaticosMoto"
            name="neumaticosMoto{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticosMoto"
          >
            <option value="delantero">Delantero</option>
            <option value="trasero">Trasero</option>
            <option value="delantero y trasero">Delantero y trasero</option>
          </select>
        </div>
        @if ( mod.neumaticosMoto === 'delantero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label">Neumático delantero:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.neumaticoDelantero"
            name="neumaticoDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticoDelantero"
          />
        </div>
        } @if ( mod.neumaticosMoto === 'delantero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label"
            >Medidas de llanta neumático delantero:</label
          >
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasLlantaDelantero"
            name="medidasLlantaDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasLlantaDelantero"
          />
        </div>
        } @if ( mod.neumaticosMoto === 'trasero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label">Neumático trasero:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.neumaticoTrasero"
            name="neumaticoTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticoTrasero"
          />
        </div>
        } @if ( mod.neumaticosMoto === 'trasero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label">Medidas de llanta neumático trasero:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasLlantaTrasero"
            name="medidasLlantaTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasLlantaTrasero"
          />
        </div>
        }
      </div>
      }
      <!-- SUSPENSIÓN -->
      @if ( mod.nombre === 'SUSPENSIÓN' && mod.seleccionado &&
      datosEntrada.tipoVehiculo === 'moto' ) {
      <div class="mb-4">
        <h3>Suspensión</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaSuspension{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencia"
            name="referenciaSuspension{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referencia"
          />
        </div>
      </div>
      }
      <!-- SUSTITUCIÓN GUARDABARROS -->
      @if (mod.nombre === 'SUSTITUCIÓN GUARDABARROS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Sustitución de Guardabarros</h3>
        @if (mod.guardabarrosDelantero) {
        <div>
          <h4>Guardabarros delantero</h4>
          <div class="mb-2">
            <label class="form-label">Tipo de fabricación:</label>
            <select
              class="form-select"
              [(ngModel)]="mod.tipoFabricacionGuardabarrosDelantero"
              name="tipoFabricacionGuardabarrosDelantero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.tipoFabricacionGuardabarrosDelantero
              "
            >
              <option value="" disabled selected>Seleccione una opción</option>
              <option value="comercial">Marca y Referencia</option>
              <option value="artesanal">
                Fabricado en acero de forma artesanal
              </option>
            </select>
          </div>
          <!-- Solo mostrar marca y referencia si la opción es 'comercial' -->
          @if (mod.tipoFabricacionGuardabarrosDelantero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaDelantero"
              name="marcaDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaDelantero"
            />
          </div>
          } @if (mod.tipoFabricacionGuardabarrosDelantero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaDelantero"
              name="referenciaDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.referenciaDelantero"
            />
          </div>
          }
          <label class="form-label mt-2">Dimensiones (ej: 150x600mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesDelantero"
            name="dimensionesDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.dimensionesDelantero"
          />
          <div class="mb-2">
            <label class="form-label"
              >Selecciona valor de la metrica de los tornillos:</label
            >
            <select
              class="form-select"
              [(ngModel)]="mod.metrica"
              name="metrica{{ i }}"
              required
              [class.is-invalid]="formSubmitted && mod.metrica == null"
            >
              <option [value]="null" disabled selected>Seleccione...</option>
              @for (num of metricasTornillos; track num) {
              <option [value]="num">
                {{ num }}
              </option>
              }
            </select>
            <input
              type="number"
              class="form-control"
              id="curv-guardaDelanteroMoto-{{ i }}"
              placeholder="0"
              step="0.01"
              [(ngModel)]="mod.curvaturaGuardaDelantMoto"
              name="curvaturaGuardaDelantMoto{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.curvaturaGuardaDelantMoto == null
              "
            />
            <label for="curv-guardaDelanteroMoto-{{ i }}"
              >Ratio curvatura mín.</label
            >
          </div>
        </div>
        } @if (mod.guardabarrosTrasero) {
        <div>
          <h4>Guardabarros trasero</h4>
          <div class="mb-2">
            <label class="form-label">Tipo de fabricación:</label>
            <select
              class="form-select"
              [(ngModel)]="mod.tipoFabricacionGuardabarrosTrasero"
              name="tipoFabricacionGuardabarrosTrasero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.tipoFabricacionGuardabarrosTrasero
              "
            >
              <option value="" disabled selected>Seleccione una opción</option>
              <option value="comercial">Marca y Referencia</option>
              <option value="artesanal">
                Fabricado en acero de forma artesanal
              </option>
            </select>
          </div>
          <!-- Solo mostrar marca y referencia si la opción es 'comercial' -->
          @if (mod.tipoFabricacionGuardabarrosTrasero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcatRasero"
              name="marcatRasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcatRasero"
            />
          </div>
          } @if (mod.tipoFabricacionGuardabarrosTrasero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaTrasero"
              name="referenciaTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.referenciaTrasero"
            />
          </div>
          }
          <label class="form-label">Dimensiones (ej: 150x600mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesTrasero"
            name="dimensionesTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.dimensionesTrasero"
          />
          <div class="mb-2">
            <label class="form-label"
              >Selecciona valor de la metrica de los tornillos:</label
            >
            <select
              class="form-select"
              [(ngModel)]="mod.metrica"
              name="metrica{{ i }}"
              required
              [class.is-invalid]="formSubmitted && mod.metrica == null"
            >
              <option [value]="null" disabled selected>Seleccione...</option>
              @for (num of metricasTornillos; track num) {
              <option [value]="num">
                {{ num }}
              </option>
              }
            </select>
            <input
              type="number"
              class="form-control"
              id="curv-guardaTraseroMoto-{{ i }}"
              placeholder="0"
              step="0.01"
              [(ngModel)]="mod.curvaturaGuardaTrasMoto"
              name="curvaturaGuardaTrasMoto{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && mod.curvaturaGuardaTrasMoto == null
              "
            />
            <label for="curv-guardaTraseroMoto-{{ i }}"
              >Ratio curvatura mín.</label
            >
          </div>
        </div>
        }
      </div>
      }
      <!-- MANILLAR -->
      @if (mod.nombre === 'MANILLAR' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Manillar</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaManillar{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
          <label class="form-label mt-2">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modelo"
            name="medidasManillar{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modelo"
          />
          <label class="form-label mt-2">Medidas:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasManillar"
            name="medidasManillar{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasManillar"
          />
          <input
            type="number"
            class="form-control"
            id="curv-manillar-{{ i }}"
            placeholder="0"
            step="0.01"
            [(ngModel)]="mod.curvaturaManillar"
            name="curvaturaManillar{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.curvaturaManillar == null"
          />
          <label for="curv-manillar-{{ i }}">Ratio curvatura mín.</label>
        </div>
      </div>
      }
      <!-- VELOCÍMETRO -->
      @if (mod.nombre === 'VELOCÍMETRO' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Velocímetro</h3>
        <label class="form-label">Marca:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="mod.marca"
          name="marcaVelocimetro{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.marca"
        />
        <label class="form-label mt-2">Referencia:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="mod.referencia"
          name="referenciaVelocimetro{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.referencia"
        />
        <label class="form-label mt-2">Contraseña de homologación:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="mod.homologacion"
          name="homologacionVelocimetro{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.homologacion"
        />
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- LATIGUILLOS -->
      @if (mod.nombre === 'LATIGUILLOS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Latiguillos</h3>
        <div class="mb-2">
          <label class="form-label">Marca delanteros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaDelanteros"
            name="marcaDelanteros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaDelanteros"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia delanteros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaDelanteros"
            name="referenciaDelanteros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaDelanteros"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca traseros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaTraseros"
            name="marcaTraseros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaTraseros"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia traseros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaTraseros"
            name="referenciaTraseros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaTraseros"
          />
        </div>
      </div>
      }
      <!-- RETROVISORES -->
      @if (mod.nombre === 'RETROVISORES' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Retrovisores</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modelo"
            name="modeloRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modelo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaje"
            name="marcajeRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacionRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
      </div>
      }
      <!-- HORQUILLA DELANTERA -->
      @if (mod.nombre === 'HORQUILLA DELANTERA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Horquilla Delantera</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Tipo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.tipo"
            name="tipoHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.tipo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Variante:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.variante"
            name="varianteHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.variante"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Denominación comercial:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.denominacion"
            name="denominacionHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.denominacion"
          />
        </div>
      </div>
      }
      <!-- DISCO DE FRENO Y PINZA DE FRENO -->
      @if ( mod.nombre === 'DISCO DE FRENO Y PINZA DE FRENO' && mod.seleccionado
      ) {
      <div class="mb-4">
        <h3>Disco de Freno y Pinza de Freno</h3>
        <!-- Disco de freno -->
        <div class="mb-3">
          <label class="form-label fw-bold"
            >¿Qué componente de freno se ha modificado?</label
          >
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.tieneDisco"
              id="tieneDisco{{ i }}"
              name="tieneDisco{{ i }}"
            />
            <label class="form-check-label" for="tieneDisco{{ i }}"
              >Disco de freno</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.tienePastilla"
              id="tienePastilla{{ i }}"
              name="tienePastilla{{ i }}"
            />
            <label class="form-check-label" for="tienePastilla{{ i }}"
              >Pinza de freno</label
            >
          </div>
          @if (formSubmitted && !mod.tieneDisco && !mod.tienePastilla) {
          <div class="text-danger mt-1">
            Debes seleccionar al menos una opción: disco o pastilla de freno.
          </div>
          }
        </div>
        <!-- Disco de freno -->
        @if (mod.tieneDisco) {
        <div>
          <h4>Disco de Freno</h4>
          <label class="form-label">¿Qué frenos se han modificado?</label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.discoDelantero"
              id="discoDelantero{{ i }}"
              name="discoDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.discoDelantero"
            />
            <label class="form-check-label" for="discoDelantero{{ i }}"
              >Delantero</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.discoTrasero"
              id="discoTrasero{{ i }}"
              name="discoTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.discoTrasero"
            />
            <label class="form-check-label" for="discoTrasero{{ i }}"
              >Trasero</label
            >
          </div>
          <!-- Campos Disco Delantero -->
          @if (mod.discoDelantero) {
          <div class="mt-2">
            <label class="form-label">Marca freno delantero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaDiscoDelantero"
              name="marcaDiscoDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaDiscoDelantero"
            />
            <label class="form-label mt-2">Referencia freno delantero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaDiscoDelantero"
              name="referenciaDiscoDelantero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaDiscoDelantero
              "
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor de la metrica de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
          <!-- Campos Disco Trasero -->
          @if (mod.discoTrasero) {
          <div class="mt-2">
            <label class="form-label">Marca freno trasero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaDiscoTrasero"
              name="marcaDiscoTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaDiscoTrasero"
            />
            <label class="form-label mt-2">Referencia freno trasero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaDiscoTrasero"
              name="referenciaDiscoTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.referenciaDiscoTrasero"
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor de la metrica de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
        </div>
        }
        <!-- Pastilla de freno -->
        @if (mod.tienePastilla) {
        <div class="mt-4">
          <h4>Pinza de Freno</h4>
          <label class="form-label">¿Qué frenos se han modificado?</label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.pastillaDelantera"
              id="pastillaDelantera{{ i }}"
              name="pastillaDelantera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.pastillaDelantera"
            />
            <label class="form-check-label" for="pastillaDelantera{{ i }}"
              >Delantero</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.pastillaTrasera"
              id="pastillaTrasera{{ i }}"
              name="pastillaTrasera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.pastillaTrasera"
            />
            <label class="form-check-label" for="pastillaTrasera{{ i }}"
              >Trasero</label
            >
          </div>
          <!-- Campos Pastilla Delantera -->
          @if (mod.pastillaDelantera) {
          <div class="mt-2">
            <label class="form-label">Marca pinza delantera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaPastillaDelantera"
              name="marcaPastillaDelantera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaPastillaDelantera"
            />
            <label class="form-label mt-2">Referencia pinza delantera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaPastillaDelantera"
              name="referenciaPastillaDelantera{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaPastillaDelantera
              "
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor de la metrica de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
          <!-- Campos Pastilla Trasera -->
          @if (mod.pastillaTrasera) {
          <div class="mt-2">
            <label class="form-label">Marca pinza trasera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaPastillaTrasera"
              name="marcaPastillaTrasera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaPastillaTrasera"
            />
            <label class="form-label mt-2">Referencia pinza trasera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaPastillaTrasera"
              name="referenciaPastillaTrasera{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaPastillaTrasera
              "
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor de la metrica de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
        </div>
        }
      </div>
      }
      <!-- LUCES -->
      @if (mod.nombre === 'LUCES' && mod.seleccionado) {
      @if(mod.descripcionLuces.luzGrupoOptico){
      <div class="mb-4">
        <h3>Grupo óptico delantero</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaluzGrupoOptico"
            name="marcaluzGrupoOptico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaluzGrupoOptico"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloluzGrupoOptico"
            name="modeloluzGrupoOptico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloluzGrupoOptico"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencialuzGrupoOptico"
            name="referencialuzGrupoOptico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referencialuzGrupoOptico"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcajes:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajesluzGrupoOptico"
            name="marcajesluzGrupoOptico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcajesluzGrupoOptico"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionluzGrupoOptico"
            name="homologacionluzGrupoOptico{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.homologacionluzGrupoOptico
            "
          />
          <input
            type="number"
            class="form-control"
            id="curv-luzGrupoOptico-{{ i }}"
            placeholder="0"
            step="0.01"
            [(ngModel)]="mod.curvaturaluzGrupoOptico"
            name="curvaturaluzGrupoOptico{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.curvaturaluzGrupoOptico == null
            "
          />
          <label for="curv-luzGrupoOptico-{{ i }}">Ratio curvatura mín.</label>
        </div>
      </div>
      } @if(mod.descripcionLuces.intermitenteDelantero){
      <div class="mb-4">
        <h3>Intermitentes delanteros</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaintermitenteDelantero"
            name="marcaintermitenteDelantero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.marcaintermitenteDelantero
            "
          />
        </div>

        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaintermitenteDelantero"
            name="referenciaintermitenteDelantero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.referenciaintermitenteDelantero
            "
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcajes:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajesintermitenteDelantero"
            name="marcajesintermitenteDelantero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.marcajesintermitenteDelantero
            "
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionintermitenteDelantero"
            name="homologacionintermitenteDelantero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.homologacionintermitenteDelantero
            "
          />
          <input
            type="number"
            class="form-control"
            id="curv-intermitenteDelantero-{{ i }}"
            placeholder="0"
            step="0.01"
            [(ngModel)]="mod.curvaturaintermitenteDelantero"
            name="curvaturaintermitenteDelantero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.curvaturaintermitenteDelantero == null
            "
          />
          <label for="curv-intermitenteDelantero-{{ i }}"
            >Ratio curvatura mín.</label
          >
        </div>
      </div>
      } @if(mod.descripcionLuces.intermitenteTrasero){
      <div class="mb-4">
        <h3>Intermitentes traseros</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaintermitenteTrasero"
            name="marcaintermitenteTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaintermitenteTrasero"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaintermitenteTrasero"
            name="referenciaintermitenteTrasero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.referenciaintermitenteTrasero
            "
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcajes:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajesintermitenteTrasero"
            name="marcajesintermitenteTrasero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.marcajesintermitenteTrasero
            "
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionintermitenteTrasero"
            name="homologacionintermitenteTrasero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.homologacionintermitenteTrasero
            "
          />
          <input
            type="number"
            class="form-control"
            id="curv-intermitenteTrasero-{{ i }}"
            placeholder="0"
            step="0.01"
            [(ngModel)]="mod.curvaturaintermitenteTrasero"
            name="curvaturaintermitenteTrasero{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.curvaturaintermitenteTrasero == null
            "
          />
          <label for="curv-intermitenteTrasero-{{ i }}"
            >Ratio curvatura mín.</label
          >
        </div>
      </div>
      } @if(mod.descripcionLuces.catadioptrico){
      <div class="mb-4">
        <h3>Catadióptricos</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcacatadioptrico"
            name="marcacatadioptrico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcacatadioptrico"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciacatadioptrico"
            name="referenciacatadioptrico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciacatadioptrico"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacioncatadioptrico"
            name="homologacioncatadioptrico{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacioncatadioptrico"
          />
          <input
            type="number"
            class="form-control"
            id="curv-catadioptrico-{{ i }}"
            placeholder="0"
            step="0.01"
            [(ngModel)]="mod.curvaturacatadioptrico"
            name="curvaturacatadioptrico{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.curvaturacatadioptrico == null
            "
          />
          <label for="curv-catadioptrico-{{ i }}">Ratio curvatura mín.</label>
        </div>
      </div>
      } @if(mod.descripcionLuces.luzMatricula){
      <div class="mb-4">
        <h3>Luz de matrícula</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaluzMatricula"
            name="marcaluzMatricula{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaluzMatricula"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencialuzMatricula"
            name="referencialuzMatricula{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referencialuzMatricula"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionluzMatricula"
            name="homologacionluzMatricula{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionluzMatricula"
          />
        </div>
      </div>
      } @if(mod.descripcionLuces.luzAntinieblas){
      <h4>Lus antiniebla delantera</h4>
      <div class="mb-4">
        <h3>Luces</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaluzAntinieblas"
            name="marcaluzAntinieblas{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaluzAntinieblas"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcajes:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajesluzAntinieblas"
            name="marcajesluzAntinieblas{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcajesluzAntinieblas"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionluzAntinieblas"
            name="homologacionluzAntinieblas{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && !mod.homologacionluzAntinieblas
            "
          />
          <input
            type="number"
            class="form-control"
            id="curv-luzAntinieblas-{{ i }}"
            placeholder="0"
            step="0.01"
            [(ngModel)]="mod.curvaturaluzAntinieblas"
            name="curvaturaluzAntinieblas{{ i }}"
            required
            [class.is-invalid]="
              formSubmitted && mod.curvaturaluzAntinieblas == null
            "
          />
          <label for="curv-luzAntinieblas-{{ i }}">Ratio curvatura mín.</label>
        </div>
      </div>
      }@if(mod.descripcionLuces.luzFreno){
      <div class="mb-4">
        <h3>Luz de freno</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaluzFreno"
            name="marcaluzFreno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaluzFreno"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencialuzFreno"
            name="referencialuzFreno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referencialuzFreno"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionluzFreno"
            name="homologacionluzFreno{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionluzFreno"
          />
        </div>

        <div class="form-check mb-2 mt-3">
          <input
            class="form-check-input"
            type="checkbox"
            [(ngModel)]="mod.luzMatriculaIntegradaLuzFreno"
            name="luzMatriculaIntegradaLuzFreno{{ i }}"
            id="luzMatriculaIntegradaLuzFreno{{ i }}"
          />
          <label
            class="form-check-label"
            for="luzMatriculaIntegradaLuzFreno{{ i }}"
          >
            Luz de matrícula integrada
          </label>
        </div>
      </div>
      } }
      <!-- CAMPERS -->
      <!-- CAMBIO DE CLASIFICACIÓN -->
      @if (mod.nombre === 'CAMBIO DE CLASIFICACIÓN' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Cambio de Clasificación</h3>
        <p>La clasificación antes y después ya ha sido recogida.</p>
      </div>
      }
      <!-- AUMENTO O DISMINUCIÓN DE PLAZAS -->
      @if ( mod.nombre === 'AUMENTO O DISMINUCIÓN DE PLAZAS' && mod.seleccionado
      ) {
      <div class="mb-4">
        <h3>Aumento o Disminución de Plazas</h3>
        <div class="mb-2">
          <label class="form-label">Tipo de cambio:</label>
          <select
            class="form-select"
            [(ngModel)]="mod.tipoCambio"
            name="tipoCambio{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.tipoCambio"
          >
            <option value="" disabled selected>Seleccione una opción</option>
            <option value="aumento">Aumento</option>
            <option value="disminucion">Disminución</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Plazas antes de la reforma:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasAntes"
            name="plazasAntes{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasAntes"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Plazas después de la reforma:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasDespues"
            name="plazasDespues{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasDespues"
          />
        </div>
      </div>
      }
      <!-- SUSTITUCIÓN DE BANQUETA DE ASIENTOS POR ASIENTO INDIVIDUAL -->
      @if ( mod.nombre === BANQUETA_INDIVIDUAL && mod.seleccionado ) {
      <div class="mb-4">
        <h3>Sustitución de Banqueta por Asiento Individual</h3>
        <div class="mb-2">
          <label class="form-label">Marca del asiento:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaAsiento"
            name="marcaAsiento{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaAsiento"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.contrasenaAsiento"
            name="contrasenaAsiento{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.contrasenaAsiento"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Plazas de la variante:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasAsiento"
            name="plazasAsiento{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasAsiento"
          />
        </div>
        <select
          class="form-select"
          [(ngModel)]="mod.posicionAsiento"
          name="posicionAsiento{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.posicionAsiento"
        >
          <option value="" disabled selected>Seleccione una opción</option>
          <option value="delanteras">Delanteras</option>
          <option value="traseras">Traseras</option>
        </select>
      </div>
      }
      <!-- INSTALACIÓN DE BASES GIRATORIAS -->
      @if ( mod.nombre === 'INSTALACIÓN DE BASES GIRATORIAS' && mod.seleccionado
      ) {
      <div class="mb-4">
        <h3>Instalación de Bases Giratorias</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBaseGiratoria"
            name="marcaBaseGiratoria{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaBaseGiratoria"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia (conductor):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaConductor"
            name="referenciaConductor{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaConductor"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia (acompañante):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaAcompanante"
            name="referenciaAcompanante{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaAcompanante"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionBase"
            name="homologacionBase{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionBase"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- CALEFACCIÓN ESTACIONARIA -->
      @if (mod.nombre === 'CALEFACCIÓN ESTACIONARIA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Calefacción Estacionaria</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaCalefaccion"
            name="marcaCalefaccion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaCalefaccion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloCalefaccion"
            name="modeloCalefaccion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloCalefaccion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionCalefaccion"
            name="homologacionCalefaccion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionCalefaccion"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Descripción:</label>
          <textarea
            class="form-control"
            rows="3"
            [(ngModel)]="mod.descripcionCalefaccion"
            name="descripcionCalefaccion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.descripcionCalefaccion"
            placeholder="Ej: El calentador se sitúa en la parte delantera izquierda, a los pies de la banqueta doble de asientos, bajo el forrado, en el interior del vehículo y el escape se instala en los bajos del vehículo en la parte delantera del lado izquierdo. El mando de la calefacción se ha ubicado detrás de la banqueta de asientos dobles"
          ></textarea>
        </div>
      </div>
      }
      <!-- MOBILIARIO INTERIOR VEHÍCULO -->
      @if (mod.nombre === 'MOBILIARIO INTERIOR VEHÍCULO' && mod.seleccionado) {
      <div class="mb-4">
        <section class="mod-card mobiliario">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Mobiliario Interior Vehículo</h4>
            <span class="mod-card__hint">Gestión de muebles y tornillería</span>
          </div>

          <!-- Selector global de tornillos -->
          <div class="row g-3 mb-3">
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="diametro-tornillo-{{ i }}"
                  [(ngModel)]="mod.diametroTornilloSeleccionado"
                  name="diametroTornilloSeleccionado{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (t of tornillosDB; track t.diametro) {
                  <option [ngValue]="t.diametro">{{ t.diametro }} mm</option>
                  }
                </select>
                <label for="diametro-tornillo-{{ i }}"
                  >Diámetro de tornillo</label
                >
              </div>
            </div>

            <!-- Info del tornillo seleccionado -->
            @if (mod.diametroTornilloSeleccionado) {
            <div class="col-12 col-md-6">
              <div class="border rounded p-2 bg-light small">
                <p class="mb-1">
                  <strong>Tensión:</strong>
                  {{ getTornilloActivo(mod)?.seccionTension }} mm²
                </p>
                <p class="mb-1">
                  <strong>Par de apriete:</strong>
                  {{ getTornilloActivo(mod)?.parAprete }} N·mm
                </p>
                <p class="mb-0">
                  <strong>Carga máxima:</strong>
                  {{ getTornilloActivo(mod)?.cargaMax }} Kg
                </p>
              </div>
            </div>
            }
          </div>

          <hr class="mod-sep" />

          <!-- Mueble Bajo -->
          @if (mod.opcionesMueble?.muebleBajo) {
          <div>
            <h4>
              Mueble Bajo
              <button
                class="btn btn-success btn-sm ms-2"
                (click)="anadirMueble(mod, 'bajo')"
              >
                + Añadir
              </button>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm ms-2"
                (click)="borrarUltimoMueble(mod, 'bajo')"
              >
                ↺ Borrar último
              </button>
            </h4>

            @for (mueble of mod.mueblesBajo; track mueble; let j = $index) {
            <div class="border rounded p-2 mb-2">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasBajo-{{ j }}"
                      [(ngModel)]="mueble.medidas"
                      name="medidas{{ j }}"
                      placeholder="Ej: 600x1420x900"
                    />
                    <label for="medidasBajo-{{ j }}">Medidas</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoBajo-{{ j }}"
                      [(ngModel)]="mueble.pesoMuebleBajo"
                      name="pesoMuebleBajo{{ j }}"
                      placeholder="Peso en Kg"
                    />
                    <label for="pesoBajo-{{ j }}">Peso en Kg</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosBajo-{{ j }}"
                      [(ngModel)]="mueble.tornillosMuebleBajo"
                      name="tornillosMuebleBajo{{ j }}"
                      placeholder="Cantidad de tornillos"
                    />
                    <label for="tornillosBajo-{{ j }}"
                      >Cantidad de tornillos</label
                    >
                  </div>
                </div>
              </div>

              <div class="form-floating mt-2">
                <select
                  class="form-select"
                  [(ngModel)]="mueble.tipoFabricacionMuebleBajo"
                  name="tipoFabricacionMuebleBajo{{ i }}"
                  required
                >
                  <option value="" disabled selected>Seleccione...</option>
                  <option value="comercial">Marca y Referencia</option>
                  <option value="aceroArtesanal">
                    Fabricado en acero artesanal
                  </option>
                  <option value="maderaArtesanal">
                    Fabricado en madera artesanal
                  </option>
                </select>
                <label>*Tipo de fabricación</label>
              </div>

              @if (mueble.tipoFabricacionMuebleBajo === 'comercial') {
              <div class="row g-3 mt-1">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="marcaBajo-{{ j }}"
                      [(ngModel)]="mueble.marcaMuebleBajo"
                      name="marcaMuebleBajo{{ i }}"
                      placeholder="Marca"
                    />
                    <label for="marcaBajo-{{ j }}">Marca</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="refBajo-{{ j }}"
                      [(ngModel)]="mueble.referenciaMuebleBajo"
                      name="referenciaMuebleBajo{{ i }}"
                      placeholder="Referencia"
                    />
                    <label for="refBajo-{{ j }}">Referencia</label>
                  </div>
                </div>
              </div>
              }
            </div>
            }
          </div>
          }

          <!-- Mueble Alto -->
          @if (mod.opcionesMueble?.muebleAlto) {
          <div>
            <h4>
              Mueble Alto
              <button
                class="btn btn-success btn-sm ms-2"
                (click)="anadirMueble(mod, 'alto')"
              >
                + Añadir
              </button>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm ms-2"
                (click)="borrarUltimoMueble(mod, 'alto')"
              >
                ↺ Borrar último
              </button>
            </h4>

            @for (mueble of mod.mueblesAlto; track mueble; let j = $index) {
            <div class="border rounded p-2 mb-2">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasAlto-{{ j }}"
                      [(ngModel)]="mueble.medidas"
                      name="medidasAlto{{ j }}"
                      placeholder="Ej: 1250x405x325"
                    />
                    <label for="medidasAlto-{{ j }}">Medidas</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoAlto-{{ j }}"
                      [(ngModel)]="mueble.pesoMuebleAlto"
                      name="pesoMuebleAlto{{ j }}"
                      placeholder="Peso en Kg"
                    />
                    <label for="pesoAlto-{{ j }}">Peso en Kg</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosAlto-{{ j }}"
                      [(ngModel)]="mueble.tornillosMuebleAlto"
                      name="tornillosMuebleAlto{{ j }}"
                      placeholder="Cantidad de tornillos"
                    />
                    <label for="tornillosAlto-{{ j }}"
                      >Cantidad de tornillos</label
                    >
                  </div>
                </div>
              </div>

              <div class="form-floating mt-2">
                <select
                  class="form-select"
                  [(ngModel)]="mueble.tipoFabricacionMuebleAlto"
                  name="tipoFabricacionMuebleAlto{{ i }}"
                  required
                >
                  <option value="" disabled selected>Seleccione...</option>
                  <option value="comercial">Marca y Referencia</option>
                  <option value="aceroArtesanal">
                    Fabricado en acero artesanal
                  </option>
                  <option value="maderaArtesanal">
                    Fabricado en madera artesanal
                  </option>
                </select>
                <label>*Tipo de fabricación</label>
              </div>

              @if (mueble.tipoFabricacionMuebleAlto === 'comercial') {
              <div class="row g-3 mt-1">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="marcaAlto-{{ j }}"
                      [(ngModel)]="mueble.marcaMuebleAlto"
                      name="marcaMuebleAlto{{ i }}"
                      placeholder="Marca"
                    />
                    <label for="marcaAlto-{{ j }}">Marca</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="refAlto-{{ j }}"
                      [(ngModel)]="mueble.referenciaMuebleAlto"
                      name="referenciaMuebleAlto{{ i }}"
                      placeholder="Referencia"
                    />
                    <label for="refAlto-{{ j }}">Referencia</label>
                  </div>
                </div>
              </div>
              }
            </div>
            }
          </div>
          }

          <!-- Aseo -->
          @if (mod.opcionesMueble?.aseo) {
          <div>
            <h4>
              Aseo
              <button
                type="button"
                class="btn btn-success btn-sm ms-2"
                (click)="anadirMueble(mod, 'aseo')"
              >
                + Añadir
              </button>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm ms-2"
                (click)="borrarUltimoMueble(mod, 'aseo')"
              >
                ↺ Borrar último
              </button>
            </h4>

            @for (aseo of mod.mueblesAseo; track aseo; let j = $index) {
            <div class="border rounded p-2 mb-2">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasAseo-{{ j }}"
                      [(ngModel)]="aseo.medidas"
                      name="medidasAseo{{ j }}"
                      placeholder="Ej: 1030x2100x590"
                      required
                    />
                    <label for="medidasAseo-{{ j }}">Medidas</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoAseo-{{ j }}"
                      [(ngModel)]="aseo.pesoMuebleAseo"
                      name="pesoMuebleAseo{{ j }}"
                      placeholder="Peso en Kg"
                    />
                    <label for="pesoAseo-{{ j }}">Peso en Kg</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosAseo-{{ j }}"
                      [(ngModel)]="aseo.tornillosMuebleAseo"
                      name="tornillosMuebleAseo{{ j }}"
                      placeholder="Cantidad de tornillos"
                    />
                    <label for="tornillosAseo-{{ j }}"
                      >Cantidad de tornillos</label
                    >
                  </div>
                </div>
              </div>

              <div class="form-floating mt-2">
                <textarea
                  class="form-control"
                  id="descripcionAseo-{{ j }}"
                  rows="3"
                  [(ngModel)]="aseo.descripcion"
                  name="descripcionAseo{{ j }}"
                  placeholder="Descripción interior"
                  required
                ></textarea>
                <label for="descripcionAseo-{{ j }}"
                  >Descripción interior</label
                >
              </div>
            </div>
            }
          </div>
          }
        </section>
      </div>
      }

      <!-- CLARABOYA -->
      @if (mod.nombre === 'CLARABOYA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Claraboya</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de claraboyas:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.cantidadClaraboya"
            name="cantidadClaraboya"
            required
            [class.is-invalid]="formSubmitted && !mod.cantidadClaraboya"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaClaraboya"
            name="marcaClaraboya"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaClaraboya"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloClaraboya"
            name="modeloClaraboya"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloClaraboya"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Descripción:</label
          ><textarea
            class="form-control"
            rows="2"
            [(ngModel)]="mod.descripcionClaraboya"
            name="descripcionClaraboya"
            required
            [class.is-invalid]="formSubmitted && !mod.descripcionClaraboya"
          ></textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionClaraboya"
            name="homologacionClaraboya"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionClaraboya"
          />
        </div>
      </div>
      }
      <!-- VENTANA -->
      @if (mod.nombre === 'VENTANA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Ventana</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de ventanas:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.cantidadVentanas"
            name="cantidadVentanas"
            required
            [class.is-invalid]="formSubmitted && !mod.cantidadVentanas"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Descripción:</label
          ><textarea
            class="form-control"
            rows="2"
            [(ngModel)]="mod.descripcionVentana"
            name="descripcionVentana"
            required
            [class.is-invalid]="formSubmitted && !mod.descripcionVentana"
          ></textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaVentana"
            name="marcaVentana"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaVentana"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloVentana"
            name="modeloVentana"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloVentana"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Dimensiones:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesVentana"
            name="dimensionesVentana"
            required
            [class.is-invalid]="formSubmitted && !mod.dimensionesVentana"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionVentana"
            name="homologacionVentana"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacionVentana"
          />
        </div>
      </div>
      }
      <!-- DEPÓSITO DE AGUA SUCIA -->
      @if (mod.nombre === 'DEPÓSITO DE AGUA SUCIA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Depósito de Agua Sucia</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de litros:</label
          ><input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.litrosAguaSucia"
            name="litrosAguaSucia"
            required
            [class.is-invalid]="formSubmitted && !mod.litrosAguaSucia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- DEPÓSITO DE AGUA LIMPIA -->
      @if (mod.nombre === 'DEPÓSITO DE AGUA LIMPIA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Depósito de Agua Limpia</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de litros:</label
          ><input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.litrosAguaLimpia"
            name="litrosAguaLimpia"
            required
            [class.is-invalid]="formSubmitted && !mod.litrosAguaLimpia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasAguaLimpia"
            name="medidasAguaLimpia"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasAguaLimpia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- BOMBA DE AGUA -->
      @if (mod.nombre === 'BOMBA DE AGUA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Bomba de Agua</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBombaAgua"
            name="marcaBombaAgua"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaBombaAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloBombaAgua"
            name="modeloBombaAgua"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloBombaAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionBombaAgua"
            name="ubicacionBombaAgua"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionBombaAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- REGISTRO DE LLENADO DE AGUA -->
      @if (mod.nombre === 'REGISTRO DE LLENADO DE AGUA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Registro de llenado de agua</h3>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionRegistroAgua"
            name="ubicacionRegistroAgua{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionRegistroAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Tamaño:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.tamanoRegistroAgua"
            name="tamanoRegistroAgua{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.tamanoRegistroAgua"
          />
        </div>
      </div>
      }
      <!-- TOMA EXTERIOR 230V -->
      @if (mod.nombre === 'TOMA EXTERIOR 230V' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Toma exterior 230V</h3>
        <div class="mb-2">
          <label class="form-label">Voltaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.voltajeTomaExterior"
            name="voltajeTomaExterior{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.voltajeTomaExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionTomaExterior"
            name="ubicacionTomaExterior{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionTomaExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasTomaExterior"
            name="medidasTomaExterior{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasTomaExterior"
          />
        </div>
      </div>
      }
      <!-- DUCHA EXTERIOR -->
      @if (mod.nombre === 'DUCHA EXTERIOR' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Ducha exterior</h3>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionDuchaExterior"
            name="ubicacionDuchaExterior{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionDuchaExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- INSTALACIÓN ELÉCTRICA -->
      @if (mod.nombre === 'INSTALACIÓN ELÉCTRICA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Instalación Eléctrica</h3>
        <!-- Placa solar -->
        <h4>Placas Solares</h4>
        <div
          *ngFor="let placa of mod.placasSolares; let j = index"
          class="border p-2 mb-2"
        >
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="placa.marca"
              name="placaMarca{{ i }}-{{ j }}"
              required
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Modelo:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="placa.modelo"
              name="placaModelo{{ i }}-{{ j }}"
              required
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Potencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="placa.potencia"
              name="placaPotencia{{ i }}-{{ j }}"
              required
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Dimensiones (mm):</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="placa.dimensiones"
              name="placaDimensiones{{ i }}-{{ j }}"
              required
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Ubicación:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="placa.ubicacion"
              name="placaUbicacion{{ i }}-{{ j }}"
              required
            />
          </div>

          <button
            type="button"
            class="btn btn-danger btn-sm"
            (click)="mod.placasSolares.splice(j, 1)"
          >
            Eliminar placa
          </button>
        </div>

        <button
          type="button"
          class="btn btn-success btn-sm"
          (click)="mod.placasSolares.push({})"
        >
          + Añadir placa solar
        </button>

        <!-- Baterías auxiliares -->
        <h4>Baterías Auxiliares</h4>
        <div class="mb-2">
          <label class="form-label">Cantidad:</label>
          <input
            type="number"
            min="0"
            class="form-control"
            [(ngModel)]="mod.cantidadBaterias"
            name="cantidadBaterias"
            required
            [class.is-invalid]="formSubmitted && !mod.cantidadBaterias"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Potencia en vatios:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaBaterias"
            name="potenciaBaterias"
            required
            [class.is-invalid]="formSubmitted && !mod.potenciaBaterias"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionBaterias"
            name="ubicacionBaterias"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionBaterias"
          />
        </div>
        <!-- Inversor -->
        <h4>Inversor</h4>
        <div class="mb-2">
          <label class="form-label">Potencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaInversor"
            name="potenciaInversor"
            required
            [class.is-invalid]="formSubmitted && !mod.potenciaInversor"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaInversor"
            name="marcaInversor"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaInversor"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionInversor"
            name="ubicacionInversor"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionInversor"
          />
        </div>
        <!-- Controlador de carga -->
        <h4>Controlador de Carga</h4>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloControlador"
            name="modeloControlador"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloControlador"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaControlador"
            name="marcaControlador"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaControlador"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionControlador"
            name="ubicacionControlador"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionControlador"
          />
        </div>
        <h4>Instalaciones Secundarias</h4>
        <div class="mb-2">
          <label class="form-label"
            >Describa otras instalaciones (una por línea):</label
          >
          <textarea
            class="form-control"
            rows="5"
            [(ngModel)]="mod.instalacionesSecundarias"
            name="instalacionesSecundarias{{ i }}"
          ></textarea>
        </div>
      </div>
      }
      <!-- TOLDO -->
      @if (mod.nombre === 'TOLDO' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Toldo</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaToldo"
            name="marcaToldo"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaToldo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasToldo"
            name="medidasToldo"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasToldo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionToldo"
            name="ubicacionToldo"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionToldo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- Añadir más bloques según las modificaciones necesarias -->
    </div>
    }

    <div class="d-flex justify-content-between mt-3">
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="onVolver()"
      >
        ← Volver
      </button>
      <button type="submit" class="btn btn-primary">Continuar →</button>
    </div>
  </form>
</div>
