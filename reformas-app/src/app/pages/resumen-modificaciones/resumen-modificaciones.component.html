<style>
  @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap");

  #ing-app-wrapper {
    font-family: "Roboto", sans-serif;
    color: #212529;
    background-color: #fff;
    --ing-border-color: #6c757d;
    --ing-focus-color: #000000;
    --ing-header-bg: #e9ecef;
  }

  #ing-app-wrapper * {
    border-radius: 0 !important;
  }

  #ing-app-wrapper h1,
  #ing-app-wrapper h2,
  #ing-app-wrapper h3,
  #ing-app-wrapper h4,
  #ing-app-wrapper h5,
  #ing-app-wrapper h6,
  #ing-app-wrapper label,
  #ing-app-wrapper .form-label,
  #ing-app-wrapper .btn,
  #ing-app-wrapper .input-group-text,
  #ing-app-wrapper select {
    font-family: "JetBrains Mono", monospace;
    letter-spacing: -0.5px;
  }

  #ing-app-wrapper h3 {
    font-weight: 700;
    text-transform: uppercase;
    border-bottom: 2px solid #000;
    padding-bottom: 10px;
    margin-bottom: 25px;
    font-size: 1.25rem;
  }

  #ing-app-wrapper .card {
    border: 1px solid var(--ing-border-color);
    margin-bottom: 20px;
    box-shadow: none;
  }

  #ing-app-wrapper .card-header {
    background-color: var(--ing-header-bg);
    border-bottom: 1px solid var(--ing-border-color);
    padding: 15px;
  }

  #ing-app-wrapper .mod-card__title {
    font-size: 1rem;
    font-weight: 700;
    text-transform: uppercase;
    margin: 0;
    color: #000;
  }

  #ing-app-wrapper .mod-card__hint {
    display: block;
    font-family: "Roboto", sans-serif;
    font-size: 0.75rem;
    color: #495057;
    margin-top: 5px;
    text-transform: uppercase;
  }

  #ing-app-wrapper .form-control,
  #ing-app-wrapper .form-select {
    border: 1px solid #adb5bd;
    font-size: 0.9rem;
    font-weight: 500;
    color: #000;
    padding: 0.6rem 0.75rem;
  }

  #ing-app-wrapper .form-control:focus,
  #ing-app-wrapper .form-select:focus {
    border-color: var(--ing-focus-color);
    box-shadow: 0 0 0 1px var(--ing-focus-color);
    outline: none;
  }

  #ing-app-wrapper .form-floating > label {
    font-family: "JetBrains Mono", monospace;
    font-size: 0.8rem;
    text-transform: uppercase;
    color: #6c757d;
    padding-top: 1rem;
  }

  #ing-app-wrapper .form-floating > .form-control:focus ~ label,
  #ing-app-wrapper
    .form-floating
    > .form-control:not(:placeholder-shown)
    ~ label {
    color: #000;
    font-weight: 700;
    opacity: 1;
  }

  #ing-app-wrapper .form-check-input {
    border: 1px solid var(--ing-border-color);
    width: 1.1em;
    height: 1.1em;
    margin-top: 0.2em;
  }

  #ing-app-wrapper .form-check-input:checked {
    background-color: #000;
    border-color: #000;
  }

  #ing-app-wrapper .btn-primary {
    background-color: #000;
    border-color: #000;
    font-weight: 700;
    text-transform: uppercase;
  }

  #ing-app-wrapper .btn-primary:hover {
    background-color: #333;
    border-color: #333;
  }

  #ing-app-wrapper .btn-outline-secondary {
    color: #000;
    border-color: #6c757d;
    font-weight: 700;
    text-transform: uppercase;
  }

  #ing-app-wrapper .btn-outline-secondary:hover {
    background-color: #e9ecef;
    color: #000;
  }

  #ing-app-wrapper .btn-success {
    background-color: #198754;
    border-color: #198754;
    font-weight: 700;
    text-transform: uppercase;
  }

  #ing-app-wrapper .btn-outline-danger {
    font-weight: 700;
    text-transform: uppercase;
  }

  #ing-app-wrapper hr.mod-sep {
    border-top: 1px solid #000;
    opacity: 0.2;
    margin: 1.5rem 0;
  }

  #ing-app-wrapper .section-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #6c757d;
    border-bottom: 1px solid #dee2e6;
    padding-bottom: 5px;
    margin-bottom: 15px;
    display: block;
    font-weight: 700;
  }

  .ing-form-footer {
    border-top: 1px solid #dee2e6;
    padding-top: 2rem;
    margin-top: 3rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Botón CONTINUAR (Estilo Imagen) */
  .btn-ing-submit {
    background-color: #0066ff !important; /* Azul vibrante de la imagen */
    border: none !important;
    color: #ffffff !important;
    font-family: "Roboto", sans-serif; /* Fuente legible y fuerte */
    font-weight: 900 !important; /* Extra negrita */
    font-size: 1rem;
    text-transform: uppercase;
    padding: 0.8rem 2.5rem;
    letter-spacing: 1px;
    border-radius: 0 !important; /* Cuadrado estilo ingeniería */
    display: inline-flex;
    align-items: center;
    gap: 10px;
    box-shadow: 0 2px 5px rgba(0, 102, 255, 0.2);
    transition: all 0.2s ease;
  }

  .btn-ing-submit:hover {
    background-color: #0052cc !important;
    box-shadow: 0 4px 8px rgba(0, 102, 255, 0.3);
    transform: translateY(-1px);
  }

  /* Botón VOLVER (Estilo secundario técnico) */
  .btn-ing-back {
    background-color: transparent !important;
    border: 1px solid #adb5bd !important;
    color: #6c757d !important;
    font-family: "JetBrains Mono", monospace;
    font-weight: 500;
    text-transform: uppercase;
    padding: 0.6rem 1.5rem;
    font-size: 0.9rem;
    border-radius: 0 !important;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s;
  }

  .btn-ing-back:hover {
    border-color: #000 !important;
    color: #000 !important;
    background-color: #f8f9fa !important;
  }
</style>
<div class="container mt-3">
  <form #form="ngForm" (ngSubmit)="onContinuar(form)" novalidate>
    @for (mod of modificacionesSeleccionadas; track mod; let i = $index) {
    <div>
      <!-- COCHES -->
      <!-- Homologado en emplazamiento no homologado -->
      @if ( mod.nombre === 'REMOLQUE HOMOLOGADO EN EMPLAZAMIENTO NO HOMOLOGADO'
      && mod.seleccionado ) {
      <div class="mb-3">
        <section class="mod-card">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Homologado en Emplazamiento No Homologado
            </h4>
            <span class="mod-card__hint"
              >Definición de parámetros de instalación y carga</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >

              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>

              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marca"
                      name="marcaHomologado{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marca"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Tipo"
                      [(ngModel)]="mod.tipo"
                      name="tipoHomologado{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.tipo"
                    />
                    <label>TIPO</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Clase"
                      [(ngModel)]="mod.clase"
                      name="claseHomologado{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.clase"
                    />
                    <label>CLASE</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación"
                      [(ngModel)]="mod.homologacion"
                      name="homologacion{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.homologacion"
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="MMR Eje"
                      [(ngModel)]="mod.mmrEjeCentral"
                      name="mmrEjeCentral{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.mmrEjeCentral"
                    />
                    <label>MMR EJE (Kg)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="MMR Barra"
                      [(ngModel)]="mod.mmrBarraTraccion"
                      name="mmrBarraTraccion{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.mmrBarraTraccion
                      "
                    />
                    <label>MMR BARRA (Kg)</label>
                  </div>
                </div>

                <div class="col-12">
                  <div class="p-3 bg-light border mt-2">
                    <h6 class="text-muted text-uppercase small mb-3 fw-bold">
                      Especificaciones de Fijación
                    </h6>
                    <div class="row g-3">
                      <div class="col-md-6">
                        <div class="form-floating">
                          <select
                            class="form-select"
                            [(ngModel)]="mod.metrica"
                            name="metrica{{ i }}"
                            required
                            [class.is-invalid]="
                              formSubmitted && mod.metrica == null
                            "
                          >
                            <option [value]="null" disabled selected>
                              -- SELECCIONAR --
                            </option>
                            @for (num of metricasTornillos; track num) {
                            <option [value]="num">{{ num }}</option>
                            }
                          </select>
                          <label>MÉTRICA TORNILLOS</label>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <div class="form-floating">
                          <input
                            type="number"
                            min="0"
                            class="form-control"
                            placeholder="Nº"
                            [(ngModel)]="mod.nTornillos"
                            name="nTornillos"
                            required
                            [class.is-invalid]="
                              formSubmitted && !mod.nTornillos
                            "
                          />
                          <label>Nº DE TORNILLOS</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Homologado en emplazamiento también homologado -->
      @if (mod.nombre === REMOLQUE_TAMBIEN_HOMOLOGADO && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Homologado en Emplazamiento También Homologado
            </h4>
            <span class="mod-card__hint"
              >Definición de parámetros de barra, bola y carga</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >

              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>

              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Datos de la Barra
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca Barra"
                      [(ngModel)]="mod.marcaBarra"
                      name="marcaBarra{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaBarra"
                    />
                    <label>MARCA BARRA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Tipo Barra"
                      [(ngModel)]="mod.tipoBarra"
                      name="tipoBarra{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.tipoBarra"
                    />
                    <label>TIPO BARRA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Clase Barra"
                      [(ngModel)]="mod.claseBarra"
                      name="claseBarra{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.claseBarra"
                    />
                    <label>CLASE BARRA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación Barra"
                      [(ngModel)]="mod.homologacionBarra"
                      name="homologacionBarra{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.homologacionBarra
                      "
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN BARRA</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Datos de la Bola
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca Bola"
                      [(ngModel)]="mod.marcaBola"
                      name="marcaBola{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaBola"
                    />
                    <label>MARCA BOLA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Clase Bola"
                      [(ngModel)]="mod.claseBola"
                      name="claseBola{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.claseBola"
                    />
                    <label>CLASE BOLA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación Bola"
                      [(ngModel)]="mod.homologacionBola"
                      name="homologacionBola{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.homologacionBola
                      "
                    />
                    <label>HOMOLOGACIÓN BOLA</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Cargas Máximas
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="MMR Eje"
                      [(ngModel)]="mod.mmrEjeCentral"
                      name="mmrEjeCentral2_{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.mmrEjeCentral"
                    />
                    <label>MMR EJE CENTRAL (Kg)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="MMR Barra"
                      [(ngModel)]="mod.mmrBarraTraccion"
                      name="mmrBarraTraccion2_{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.mmrBarraTraccion
                      "
                    />
                    <label>MMR BARRA TRACCIÓN (Kg)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Reducción de plazas -->
      @if (mod.nombre === 'REDUCCIÓN DE PLAZAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Reducción de Plazas</h4>
            <span class="mod-card__hint"
              >Configuración de asientos y variaciones de capacidad</span
            >
          </div>

          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="enclaje-{{ i }}"
                  placeholder="Descripción"
                  [(ngModel)]="mod.enclaje"
                  name="enclajePlaza{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.enclaje"
                />
                <label for="enclaje-{{ i }}"
                  >¿QUÉ PLAZA SE ELIMINA? (SE ELIMINARÁ...)</label
                >
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="plazasAntes-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.plazasAntes"
                  name="plazasAntes{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasAntes"
                />
                <label for="plazasAntes-{{ i }}">NÚMERO DE PLAZAS ANTES</label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="plazasDespues-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.plazasDespues"
                  name="plazasDespues{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasDespues"
                />
                <label for="plazasDespues-{{ i }}"
                  >PLAZAS DESPUÉS DE REFORMA</label
                >
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'AUMENTO DE PLAZAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card aumento-plazas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Aumento de Plazas</h4>
            <span class="mod-card__hint"
              >Instalación de nuevos asientos y seguridad</span
            >
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="descAumento-{{ i }}"
                    placeholder="Descripción"
                    [(ngModel)]="mod.descripcionAumento"
                    name="descripcionAumento{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.descripcionAumento
                    "
                  />
                  <label for="descAumento-{{ i }}"
                    >¿QUÉ PLAZAS SE AÑADEN? (UBICACIÓN Y TIPO)</label
                  >
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="plazasAntesAumento-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.plazasAntesAumento"
                    name="plazasAntesAumento{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.plazasAntesAumento
                    "
                  />
                  <label for="plazasAntesAumento-{{ i }}"
                    >NÚMERO DE PLAZAS ANTES</label
                  >
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="plazasDespuesAumento-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.plazasDespuesAumento"
                    name="plazasDespuesAumento{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.plazasDespuesAumento
                    "
                  />
                  <label for="plazasDespuesAumento-{{ i }}"
                    >PLAZAS DESPUÉS DE REFORMA</label
                  >
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
                <label class="form-label text-muted small"
                  >SEGURIDAD DE LAS NUEVAS PLAZAS</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="checkCinturones{{ i }}"
                    [(ngModel)]="mod.tieneCinturonesAumento"
                    name="tieneCinturonesAumento{{ i }}"
                  />
                  <label class="form-check-label" for="checkCinturones{{ i }}">
                    Disponen de cinturones de seguridad
                  </label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="checkAnclajes{{ i }}"
                    [(ngModel)]="mod.usaAnclajesOriginalesAumento"
                    name="usaAnclajesOriginalesAumento{{ i }}"
                  />
                  <label class="form-check-label" for="checkAnclajes{{ i }}">
                    Instalados sobre anclajes originales
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REDUCCIÓN DE MMA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card bajada-mma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Disminución de Masa Máxima Admisible (MMA)
            </h4>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="p-3 bg-light border d-flex align-items-center">
                <i class="bi bi-info-circle-fill text-primary me-3 fs-4"></i>
                <div>
                  <h6 class="text-uppercase fw-bold mb-1 small">
                    Nota Informativa
                  </h6>
                  <p class="mb-0 text-muted small">
                    La MMA antes y después será recogida en los siguientes pasos
                    del proceso.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REDUCCIÓN DE MMTA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card bajada-mma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Disminución de Masa Máxima Técnicamente Admisible (MMTA)
            </h4>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="p-3 bg-light border d-flex align-items-center">
                <i class="bi bi-info-circle-fill text-primary me-3 fs-4"></i>
                <div>
                  <h6 class="text-uppercase fw-bold mb-1 small">
                    Nota Informativa
                  </h6>
                  <p class="mb-0 text-muted small">
                    La MMTA antes y después será recogida en los siguientes
                    pasos del proceso.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- NEUMÁTICOS -->
      @if (mod.nombre === 'NEUMÁTICOS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card neumaticos">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Neumáticos</h4>
            <span class="mod-card__hint"
              >Especificaciones de llantas y códigos de velocidad</span
            >
          </div>

          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medida"
                  [(ngModel)]="mod.medidas"
                  name="medidasNeumaticos{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidas"
                />
                <label>MEDIDA DE LAS LLANTAS</label>
              </div>
            </div>

            @if (mod.anotacion2) {
            <div class="col-12">
              <hr class="mod-sep" />
              <h6 class="text-muted fw-bold small text-uppercase mb-3">
                Cálculo de Índices de Velocidad
              </h6>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Vel Max Antes"
                  [(ngModel)]="mod.velocidadMaximaAntes"
                  name="velMaxAntes{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.velocidadMaximaAntes
                  "
                />
                <label>VELOCIDAD MÁX. VEHÍCULO</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Vel Max Despues"
                  [(ngModel)]="mod.velocidadMaximaDespues"
                  name="velMaxDespues{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.velocidadMaximaDespues
                  "
                />
                <label>VELOCIDAD MÁX. NEUMÁTICOS</label>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      }
      <!-- ALETINES Y SOBREALETINES -->
      @if (mod.nombre === 'ALETINES Y SOBREALETINES' && mod.seleccionado) {
      <div class="mb-3">
        @if (mod.detalle?.aletines) {
        <section class="mod-card aletines">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Aletines</h4>
            <span class="mod-card__hint"
              >Parámetros de instalación y dimensiones de aletines</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaAletines"
                      name="marcaAletines{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaAletines"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaAletines"
                      name="referenciaAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaAletines
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchoAletines"
                      name="anchoAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.anchoAletines == null
                      "
                    />
                    <label>ANCHO (mm)</label>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metricaAletines"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaAletines == null
                      "
                    >
                      <option [ngValue]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.numTornillosAletines"
                      name="numTornillosAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.numTornillosAletines == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgAletines"
                      name="pesoPiezaKgAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.pesoPiezaKgAletines == null
                      "
                    />
                    <label>PESO PIEZA (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Superficie"
                      [(ngModel)]="mod.superficieFrontalM2Aletines"
                      name="superficieFrontalM2Aletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.superficieFrontalM2Aletines == null
                      "
                    />
                    <label>SUPERFICIE FRONTAL (m²)</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.coefAerodinamicoCwAletines"
                      name="coefAerodinamicoCwAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.coefAerodinamicoCwAletines == null
                      "
                    />
                    <label>Cw (COEF. AERODINÁMICO)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msAletines"
                      name="velocidadAireV2msAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.velocidadAireV2msAletines == null
                      "
                    />
                    <label>V₂ = 140 km/h (m/s)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3Aletines"
                      name="densidadAireKgM3Aletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.densidadAireKgM3Aletines == null
                      "
                    />
                    <label>p (DENSIDAD AIRE)</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRAletines"
                      name="radioCurvaRAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.radioCurvaRAletines == null
                      "
                    />
                    <label>R (RADIO CURVA, m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKAletines"
                      name="coefSeguridadKAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.coefSeguridadKAletines == null
                      "
                    />
                    <label>K (COEF. SEGURIDAD)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Aletines"
                      name="resTraccionMinTornillo88Kgmm2Aletines{{ i }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN. (Kg/mm²)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsAletines"
                      name="seccionResistenteAsAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.seccionResistenteAsAletines == null
                      "
                    />
                    <label>As (SECCIÓN RESISTENTE)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detalle?.sobrealetines) {
        <section class="mod-card sobrealetines">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sobrealetines</h4>
            <span class="mod-card__hint"
              >Parámetros de instalación y dimensiones de sobrealetines</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-sb-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-sb-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-sb-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-sb-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-sb-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-sb-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaSobreletines"
                      name="marcaSobreletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaSobreletines
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaSobreletines"
                      name="referenciaSobreletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaSobreletines
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchoSobrealetines"
                      name="anchoSobrealetines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.anchoSobrealetines == null
                      "
                    />
                    <label>ANCHO (mm)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Curvatura"
                      [(ngModel)]="mod.curvaturaSobrealetines"
                      name="curvaturaSobrealetines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.curvaturaSobrealetines == null
                      "
                    />
                    <label>RATIO CURVATURA MÍN.</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metricaSobrealetines"
                      name="metricaSobrealetines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaSobrealetines == null
                      "
                    >
                      <option [ngValue]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.nTornillos == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        }
      </div>
      }
      <!-- SEPARADORES DE RUEDA -->
      @if (mod.nombre === 'SEPARADORES DE RUEDA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Separadores de Rueda</h4>
            <span class="mod-card__hint"
              >Especificaciones de ensanchamiento de vías</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaSeparadores"
                      name="marcaSeparadores{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaSeparadores
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaSeparadores"
                      name="referenciaSeparadores{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaSeparadores
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Grosor"
                      [(ngModel)]="mod.grosorSeparadores"
                      name="grosorSeparadores{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.grosorSeparadores
                      "
                    />
                    <label>GROSOR (mm)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- SNORKEL -->
      @if (mod.nombre === 'SNORKEL' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card snorkel">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Snorkel</h4>
            <span class="mod-card__hint"
              >Toma de aire elevada - Cálculos de resistencia</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaSnorkel"
                      name="marcaSnorkel{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaSnorkel"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.materialSnorkel"
                      name="materialSnorkel{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.materialSnorkel"
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option value="goma">Goma</option>
                      <option value="plástico ABS">Plástico ABS</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasSnorkel"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'medidasSnorkel',
                          'anchuraPiezaMSnorkel',
                          'alturaPiezaMSnorkel'
                        )
                      "
                      name="medidasSnorkel{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.medidasSnorkel"
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metricaSnorkel"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaSnorkel == null
                      "
                    >
                      <option [ngValue]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgSnorkel"
                      name="pesoPiezaKgSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.pesoPiezaKgSnorkel == null
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraPiezaMSnorkel"
                      name="anchuraPiezaMSnorkel{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted && mod.anchuraPiezaMSnorkel == null
                      "
                    />
                    <label>ANCHO (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaPiezaMSnorkel"
                      name="alturaPiezaMSnorkel{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted && mod.alturaPiezaMSnorkel == null
                      "
                    />
                    <label>ALTO (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Curvatura"
                      [(ngModel)]="mod.curvaturaSnorkel"
                      name="curvaturaSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.curvaturaSnorkel == null
                      "
                    />
                    <label>RATIO CURVATURA</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Cálculo Resistencia (Presión Aire)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.cwCoefAerodinamicoSnorkel"
                      name="cwCoefAerodinamicoSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.cwCoefAerodinamicoSnorkel == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3Snorkel"
                      name="densidadAireKgM3Snorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.densidadAireKgM3Snorkel == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msSnorkel"
                      name="velocidadAireV2msSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.velocidadAireV2msSnorkel == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKSnorkel"
                      name="coefSeguridadKSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.coefSeguridadKSnorkel == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Datos de Sujeción
                  </h6>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosSnorkel"
                      name="nTornillosSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.nTornillosSnorkel == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloSnorkel"
                      name="calidadTornilloSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.calidadTornilloSnorkel
                      "
                    />
                    <label>CALIDAD TORNILLO</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsSnorkel"
                      name="seccionResistenteAsSnorkel{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted && mod.seccionResistenteAsSnorkel == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Snorkel"
                      name="resTraccionMinTornillo88Kgmm2Snorkel{{ i }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RESISTENCIA TRACCIÓN MÍN. (Kg/mm²)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- PARAGOLPES DELANTERO -->
      @if (mod.nombre === 'PARAGOLPES DELANTERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card paragolpes-delantero">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Paragolpes Delantero</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-tipo-{{ i }}"
                      [(ngModel)]="mod.tipoFabricacionParagolpesDelantero"
                      name="tipoFabricacionParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.tipoFabricacionParagolpesDelantero
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="artesanal">
                        Fabricado en acero de forma artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.tipoFabricacionParagolpesDelantero === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaParagolpes"
                      name="marcaParagolpes{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaParagolpes"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaParagolpes"
                      name="referenciaParagolpes{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaParagolpes
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                }

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasParagolpesDelantero"
                      name="medidasParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasParagolpesDelantero
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-metricaParaDelantero-{{ i }}"
                      [(ngModel)]="mod.metricaParaDelantero"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaParaDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaParaDelantero == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.ntornillosParaDelantero"
                      name="ntornillosParaDelantero"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.ntornillosParaDelantero
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgParagolpesDelantero"
                      name="pesoPiezaKgParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.pesoPiezaKgParagolpesDelantero == null
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Superficie"
                      [(ngModel)]="mod.superficieFrontalM2ParagolpesDelantero"
                      name="superficieFrontalM2ParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.superficieFrontalM2ParagolpesDelantero == null
                      "
                    />
                    <label>SUPERFICIE (m²)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsParagolpesDelantero"
                      name="seccionResistenteAsParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.seccionResistenteAsParagolpesDelantero == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="
                        mod.resTraccionMinTornillo88Kgmm2ParagolpesDelantero
                      "
                      name="resTraccionMinTornillo88Kgmm2ParagolpesDelantero{{
                        i
                      }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN. (Kg/mm²)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.cwCoefAerodinamicoParagolpesDelantero"
                      name="cwCoefAerodinamicoParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.cwCoefAerodinamicoParagolpesDelantero == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3ParagolpesDelantero"
                      name="densidadAireKgM3ParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.densidadAireKgM3ParagolpesDelantero == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msParagolpesDelantero"
                      name="velocidadAireV2msParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.velocidadAireV2msParagolpesDelantero == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRParagolpesDelantero"
                      name="radioCurvaRParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.radioCurvaRParagolpesDelantero == null
                      "
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKParagolpesDelantero"
                      name="coefSeguridadKParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefSeguridadKParagolpesDelantero == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- PARAGOLPES TRASERO -->
      @if (mod.nombre === 'PARAGOLPES TRASERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card paragolpes-trasero">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Paragolpes Trasero</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgt-fab-{{ i }}"
                      [(ngModel)]="mod.tipoFabricacionParagolpesTrasero"
                      name="tipoFabricacionParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.tipoFabricacionParagolpesTrasero
                      "
                    >
                      <option value="" disabled selected>
                        Seleccione una opción
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="artesanal">
                        Fabricado en acero de forma artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.tipoFabricacionParagolpesTrasero === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaParagolpesTrasero"
                      name="marcaParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaParagolpesTrasero
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaParagolpesTrasero"
                      name="referenciaParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaParagolpesTrasero
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                }

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasParagolpesTrasero"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'medidasParagolpesTrasero',
                          'anchuraMParagolpesTrasero',
                          'alturaMParagolpesTrasero'
                        )
                      "
                      name="medidasParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasParagolpesTrasero
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-metricaParaTrasero-{{ i }}"
                      [(ngModel)]="mod.metricaParaTrasero"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaParaTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaParaTrasero == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosParagolpesTrasero"
                      name="nTornillosParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.nTornillosParagolpesTrasero
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloParagolpesTrasero"
                      name="calidadTornilloParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.calidadTornilloParagolpesTrasero
                      "
                    />
                    <label>CALIDAD TORNILLO</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgParagolpesTrasero"
                      name="pesoPiezaKgParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.pesoPiezaKgParagolpesTrasero
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraMParagolpesTrasero"
                      name="anchuraMParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.anchuraMParagolpesTrasero
                      "
                    />
                    <label>ANCHURA (m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaMParagolpesTrasero"
                      name="alturaMParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.alturaMParagolpesTrasero
                      "
                    />
                    <label>ALTURA (m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsParagolpesTrasero"
                      name="seccionResistenteAsParagolpesTrasero{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.seccionResistenteAsParagolpesTrasero == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="
                        mod.resTraccionMinTornillo88Kgmm2ParagolpesTrasero
                      "
                      name="resTraccionMinTornillo88Kgmm2ParagolpesTrasero{{
                        i
                      }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      max="2"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.coefAerodinamicoParagolpesTrasero"
                      name="coefAerodinamicoParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefAerodinamicoParagolpesTrasero == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3ParagolpesTrasero"
                      name="densidadAireKgM3ParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.densidadAireKgM3ParagolpesTrasero == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msParagolpesTrasero"
                      name="velocidadAireV2msParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.velocidadAireV2msParagolpesTrasero == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="1"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRParagolpesTrasero"
                      name="radioCurvaRParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.radioCurvaRParagolpesTrasero == null
                      "
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.1"
                      min="1"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKParagolpesTrasero"
                      name="coefSeguridadKParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefSeguridadKParagolpesTrasero == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'PROTECTORES PARAGOLPES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-protectores">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Instalación de Protectores de Paragolpes
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label text-muted small">UBICACIÓN</label>
                <div class="d-flex gap-4 mb-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionProtector{{ i }}"
                      id="ubiDelantero{{ i }}"
                      value="delantero"
                      [(ngModel)]="mod.ubicacionPROTECTORES"
                    />
                    <label class="form-check-label" for="ubiDelantero{{ i }}">
                      Paragolpes Delantero
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionProtector{{ i }}"
                      id="ubiTrasero{{ i }}"
                      value="trasero"
                      [(ngModel)]="mod.ubicacionPROTECTORES"
                    />
                    <label class="form-check-label" for="ubiTrasero{{ i }}">
                      Paragolpes Trasero
                    </label>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Plástico ABS)"
                    [(ngModel)]="mod.materialProtectorPROTECTORES"
                    name="materialProtector{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.materialProtectorPROTECTORES
                    "
                  />
                  <label>MATERIAL (ej. Plástico ABS)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.medidaLargoPROTECTORES"
                    name="medidaLargo{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaLargoPROTECTORES
                    "
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto/Ancho (mm)"
                    [(ngModel)]="mod.medidaAltoPROTECTORES"
                    name="medidaAlto{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaAltoPROTECTORES
                    "
                  />
                  <label>ALTO / ANCHO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'PLANCHA CAPÓ' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-plancha">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Plancha en Capó</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Aluminio)"
                    [(ngModel)]="mod.materialPlancha"
                    name="materialPlancha{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.materialPlancha"
                  />
                  <label>MATERIAL (ej. Aluminio)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ubicación (ej. Centro del capó)"
                    [(ngModel)]="mod.ubicacionPlancha"
                    name="ubicacionPlancha{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.ubicacionPlancha"
                  />
                  <label>UBICACIÓN (ej. Centro del capó)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
                <label class="form-label text-muted small"
                  >DIMENSIONES DE LA PLANCHA</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.medidaLargoPLANCHA"
                    name="medidaLargo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaLargo"
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Ancho (mm)"
                    [(ngModel)]="mod.medidaAnchoPLANCHA"
                    name="medidaAncho{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaAncho"
                  />
                  <label>ANCHO (mm)</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div
                  class="alert alert-info d-flex align-items-center p-2"
                  role="alert"
                >
                  <small>
                    <i class="bi bi-info-circle me-2"></i>
                    Asegurarse de que la instalación no presenta aristas vivas
                    ni cortantes que sean peligrosas para peatones.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'CALANDRA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-calandra">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Calandra Delantera</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaCalandra"
                    name="marcaCalandra{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaCalandra"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaCalandra"
                    name="referenciaCalandra{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.referenciaCalandra
                    "
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Plástico ABS)"
                    [(ngModel)]="mod.materialCalandra"
                    name="materialCalandra{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.materialCalandra"
                  />
                  <label>MATERIAL</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Ancho / Largo total (mm)"
                    [(ngModel)]="mod.medidaLargoCALANDRA"
                    name="medidaLargo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaLargo"
                  />
                  <label>ANCHO / LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto (mm)"
                    [(ngModel)]="mod.medidaAltoCALANDRA"
                    name="medidaAlto{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaAlto"
                  />
                  <label>ALTO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'INTERCOOLER' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-intercooler">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Intercooler</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaIntercooler"
                    name="marcaIntercooler{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaIntercooler"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.refIntercooler"
                    name="refIntercooler{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.refIntercooler"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES DEL NÚCLEO (mm)</label
                >
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo"
                    [(ngModel)]="mod.medidaLargoINTERCOOLER"
                    name="medidaLargo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaLargo"
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto"
                    [(ngModel)]="mod.medidaAltoINTERCOOLER"
                    name="medidaAlto{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaAlto"
                  />
                  <label>ALTO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Espesor/Fondo"
                    [(ngModel)]="mod.medidaEspesorINTERCOOLER"
                    name="medidaEspesor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.medidaEspesor"
                  />
                  <label>ESPESOR (mm)</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body p-3">
                    <div class="form-check form-switch mb-3">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="anclajesOriginales{{ i }}"
                        [(ngModel)]="mod.usAnclajesOriginalesINTERCOOLER"
                        name="usAnclajesOriginales{{ i }}"
                      />
                      <label
                        class="form-check-label"
                        for="anclajesOriginales{{ i }}"
                      >
                        Se sujeta sobre los anclajes originales
                      </label>
                    </div>

                    @if (!mod.usAnclajesOriginales) {
                    <div class="form-floating mb-3 bg-white">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Descripción soportes"
                        [(ngModel)]="mod.descSoportesINTERCOOLER"
                        name="descSoportes{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted &&
                          !mod.usAnclajesOriginales &&
                          !mod.descSoportes
                        "
                      />
                      <label
                        >DESCRIPCIÓN DE LA FIJACIÓN (ej. Soportes
                        artesanales)</label
                      >
                    </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'PANEL RELOJES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-relojes">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Instalación de Panel de Relojes / Manómetros
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-8">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ubicación (ej. Parte central salpicadero)"
                    [(ngModel)]="mod.ubicacionPanelRelojes"
                    name="ubicacionPanel{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.ubicacionPanel"
                  />
                  <label>UBICACIÓN EN EL VEHÍCULO</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Nº de relojes"
                    [(ngModel)]="mod.numeroRelojes"
                    name="numeroRelojes{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="formSubmitted && !mod.numeroRelojes"
                  />
                  <label>Nº DE RELOJES</label>
                </div>
              </div>

              <div class="col-12">
                <label class="form-label text-muted small"
                  >DIMENSIONES DEL SOPORTE (mm)</label
                >
                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="number"
                        class="form-control"
                        placeholder="Ancho (mm)"
                        [(ngModel)]="mod.medidaAnchoRelojes"
                        name="medidaAncho{{ i }}"
                        required
                        [class.is-invalid]="formSubmitted && !mod.medidaAncho"
                      />
                      <label>ANCHO (mm)</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="number"
                        class="form-control"
                        placeholder="Alto (mm)"
                        [(ngModel)]="mod.medidaAltoRelojes"
                        name="medidaAlto{{ i }}"
                        required
                        [class.is-invalid]="formSubmitted && !mod.medidaAlto"
                      />
                      <label>ALTO (mm)</label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Descripción de los relojes"
                    style="height: 100px"
                    [(ngModel)]="mod.descripcionRelojes"
                    name="descripcionRelojes{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.descripcionRelojes
                    "
                  ></textarea>
                  <label
                    >DESCRIPCIÓN DE LOS RELOJES (ej. Presión turbo,
                    Aceite...)</label
                  >
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REFUERZO PARAGOLPES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-refuerzo">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Instalación de Refuerzo de Paragolpes
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label text-muted small"
                  >UBICACIÓN DEL REFUERZO</label
                >
                <div class="d-flex gap-4 mb-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionRefuerzo{{ i }}"
                      id="ubiRefuerzoTras{{ i }}"
                      value="trasero"
                      [(ngModel)]="mod.ubicacionRefuerzo"
                    />
                    <label
                      class="form-check-label"
                      for="ubiRefuerzoTras{{ i }}"
                    >
                      Paragolpes Trasero
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionRefuerzo{{ i }}"
                      id="ubiRefuerzoDel{{ i }}"
                      value="delantero"
                      [(ngModel)]="mod.ubicacionRefuerzo"
                    />
                    <label class="form-check-label" for="ubiRefuerzoDel{{ i }}">
                      Paragolpes Delantero
                    </label>
                  </div>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaRefuerzo"
                    name="marcaRefuerzo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaRefuerzo"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaRefuerzo"
                    name="referenciaRefuerzo{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.referenciaRefuerzo
                    "
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Acero)"
                    [(ngModel)]="mod.materialRefuerzo"
                    name="materialRefuerzo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.materialRefuerzo"
                  />
                  <label>MATERIAL</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.largoRefuerzo"
                    name="largoRefuerzo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.largoRefuerzo"
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto (mm)"
                    [(ngModel)]="mod.altoRefuerzo"
                    name="altoRefuerzo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.altoRefuerzo"
                  />
                  <label>ALTO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Fondo/Profundidad (mm)"
                    [(ngModel)]="mod.fondoRefuerzo"
                    name="fondoRefuerzo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.fondoRefuerzo"
                  />
                  <label>FONDO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'DIFUSOR TRASERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-difusor">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Difusor Trasero</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaDifusor"
                    name="marcaDifusor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaDifusor"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloDifusor"
                    name="modeloDifusor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloDifusor"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Plástico ABS)"
                    [(ngModel)]="mod.materialDifusor"
                    name="materialDifusor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.materialDifusor"
                  />
                  <label>MATERIAL</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.largoDifusor"
                    name="largoDifusor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.largoDifusor"
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto/Ancho (mm)"
                    [(ngModel)]="mod.altoDifusor"
                    name="altoDifusor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.altoDifusor"
                  />
                  <label>ALTO / ANCHO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'VENTANA LATERAL' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-ventana">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Instalación de Ventana Lateral Abatible
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label text-muted small"
                  >UBICACIÓN EN EL VEHÍCULO</label
                >
                <div class="d-flex gap-4 mb-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionVentana{{ i }}"
                      id="ubiVentanaIzq{{ i }}"
                      value="izquierdo"
                      [(ngModel)]="mod.ubicacionVentana"
                    />
                    <label class="form-check-label" for="ubiVentanaIzq{{ i }}">
                      Lateral Izquierdo
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionVentana{{ i }}"
                      id="ubiVentanaDer{{ i }}"
                      value="derecho"
                      [(ngModel)]="mod.ubicacionVentana"
                    />
                    <label class="form-check-label" for="ubiVentanaDer{{ i }}">
                      Lateral Derecho
                    </label>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaVentana"
                    name="marcaVentana{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaVentana"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Acero / Vidrio)"
                    [(ngModel)]="mod.materialVentana"
                    name="materialVentana{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.materialVentana"
                  />
                  <label>MATERIAL</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.largoVentana"
                    name="largoVentana{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.largoVentana"
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto (mm)"
                    [(ngModel)]="mod.altoVentana"
                    name="altoVentana{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.altoVentana"
                  />
                  <label>ALTO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- CABRESTANTE -->
      @if (mod.nombre === 'CABRESTANTE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card cabrestante">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Cabrestante</h4>
            <span class="mod-card__hint"
              >Datos de capacidad, material y unión al chasis</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaCabrestante"
                      name="marcaCabrestante{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaCabrestante
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="LB"
                      [(ngModel)]="mod.capacidadCabrestanteLb"
                      name="capacidadCabrestanteLb{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.capacidadCabrestanteLb == null
                      "
                    />
                    <label>CAPACIDAD ARRASTRE (LB)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Kg"
                      [(ngModel)]="mod.capacidadCabrestanteKg"
                      name="capacidadCabrestanteKg{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.capacidadCabrestanteKg == null
                      "
                    />
                    <label>CAPACIDAD ARRASTRE (Kg)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Elementos de Unión
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="cbr-metricaCabrestante-{{ i }}"
                      [(ngModel)]="mod.metricaCabrestante"
                      name="metricaCabrestante{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaCabrestante == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos"
                      required
                      [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Tiro Max"
                      [(ngModel)]="mod.tiroMaxCabrestanteKg"
                      name="tiroMaxCabrestanteKg{{ i }}"
                    />
                    <label>TIRO MÁX. (Kg)</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroPernoCmCabrestante"
                      name="diametroPernoCmCabrestante{{ i }}"
                    />
                    <label>DIÁMETRO PERNO (cm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Material"
                      [(ngModel)]="mod.materialPernoCabrestante"
                      name="materialPernoCabrestante{{ i }}"
                    />
                    <label>MATERIAL PERNO</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Tension"
                      [(ngModel)]="mod.tensionMinCortanteKgCm2Cabrestante"
                      name="tensionMinCortanteKgCm2Cabrestante{{ i }}"
                    />
                    <label>TENSIÓN CORTANTE (Kg/cm²)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Unión al Chasis (Pernos)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº Pernos"
                      [(ngModel)]="mod.nPernosChasisCabrestante"
                      name="nPernosChasisCabrestante{{ i }}"
                    />
                    <label>Nº PERNOS</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroPernoChasisMmCabrestante"
                      name="diametroPernoChasisMmCabrestante{{ i }}"
                    />
                    <label>DIÁMETRO (mm)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Material"
                      [(ngModel)]="mod.materialPernoChasisCabrestante"
                      name="materialPernoChasisCabrestante{{ i }}"
                    />
                    <label>MATERIAL</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Tension"
                      [(ngModel)]="mod.tensionMinCortanteChasisKgCm2Cabrestante"
                      name="tensionMinCortanteChasisKgCm2Cabrestante{{ i }}"
                    />
                    <label>TENSIÓN (Kg/cm²)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- ANTIEMPOTRAMIENTO -->
      @if (mod.nombre === 'ANTIEMPOTRAMIENTO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card antiempotramiento">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Antiempotramiento</h4>
            <span class="mod-card__hint">Barra de protección trasera</span>
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-8">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasAntiempotramiento"
                      name="medidasAntiempotramiento{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasAntiempotramiento
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos"
                      required
                      [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- SOPORTES PARA LUCES DE USO ESPECÍFICO -->
      @if (mod.nombre === 'SOPORTES PARA LUCES DE USO ESPECÍFICO' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luces-especificas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Soportes para Luces de Uso Específico
            </h4>
            <span class="mod-card__hint"
              >Cálculos de resistencia para soportes de iluminación
              adicional</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Ubicación"
                      [(ngModel)]="mod.ubicacionLucesEspecificas"
                      name="ubicacionLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.ubicacionLucesEspecificas
                      "
                    />
                    <label>UBICACIÓN</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasLucesEspecificas"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'medidasLucesEspecificas',
                          'anchuraPiezaMLucesEspecificas',
                          'alturaPiezaMLucesEspecificas'
                        )
                      "
                      name="medidasLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasLucesEspecificas
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgLucesEspecificas"
                      name="pesoPiezaKgLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.pesoPiezaKgLucesEspecificas == null
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraPiezaMLucesEspecificas"
                      name="anchuraPiezaMLucesEspecificas{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.anchuraPiezaMLucesEspecificas == null
                      "
                    />
                    <label>ANCHO (m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaPiezaMLucesEspecificas"
                      name="alturaPiezaMLucesEspecificas{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.alturaPiezaMLucesEspecificas == null
                      "
                    />
                    <label>ALTO (m)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-metricaLucesEspecificas-{{ i }}"
                      [(ngModel)]="mod.metricaLucesEspecificas"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaLucesEspecificas == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosLucesEspecificas"
                      name="nTornillosLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.nTornillosLucesEspecificas == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloLucesEspecificas"
                      name="calidadTornilloLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.calidadTornilloLucesEspecificas
                      "
                    />
                    <label>CALIDAD</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsLucesEspecificas"
                      name="seccionResistenteAsLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.seccionResistenteAsLucesEspecificas == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="
                        mod.resTraccionMinTornillo88Kgmm2LucesEspecificas
                      "
                      name="resTraccionMinTornillo88Kgmm2LucesEspecificas{{
                        i
                      }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Cálculo Resistencia (Presión Aire)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.cwCoefAerodinamicoLucesEspecificas"
                      name="cwCoefAerodinamicoLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.cwCoefAerodinamicoLucesEspecificas == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3LucesEspecificas"
                      name="densidadAireKgM3LucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.densidadAireKgM3LucesEspecificas == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msLucesEspecificas"
                      name="velocidadAireV2msLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.velocidadAireV2msLucesEspecificas == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRLucesEspecificas"
                      name="radioCurvaRLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.radioCurvaRLucesEspecificas == null
                      "
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKLucesEspecificas"
                      name="coefSeguridadKLucesEspecificas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefSeguridadKLucesEspecificas == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- SOPORTE PARA RUEDA DE REPUESTO -->
      @if (mod.nombre === 'SOPORTE PARA RUEDA DE REPUESTO' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card rueda-repuesto">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Soporte para Rueda de Repuesto</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoFabricacionRuedaRepuesto"
                      name="tipoFabricacionRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.tipoFabricacionRuedaRepuesto
                      "
                    >
                      <option value="" disabled selected>
                        Seleccione una opción
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="artesanal">
                        Fabricado en acero de forma artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaRuedaRepuesto"
                      name="marcaRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaRuedaRepuesto
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaRuedaRepuesto"
                      name="referenciaRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaRuedaRepuesto
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                }

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasRuedaRepuesto"
                      name="medidasRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasRuedaRepuesto
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Ratio"
                      [(ngModel)]="mod.curvaturaSoporteRuedaRepuesto"
                      name="curvaturaSoporteRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.curvaturaSoporteRuedaRepuesto
                      "
                    />
                    <label>RATIO CURVATURA MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metrica"
                      name="metrica{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && mod.metrica == null"
                    >
                      <option [value]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos"
                      required
                      [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- MUELLES, BALLESTAS Y AMORTIGUADORES -->
      @if (mod.nombre === 'TODA LA CASUÍSTICA DE MUELLES, BALLESTAS Y ' +
      'AMORTIGUADORES QUE SE PUEDEN DAR' && mod.seleccionado) {
      <div class="mb-5">
        <h3 class="mb-4">Casuística de Suspensión</h3>

        @if (mod.detallesMuelles?.muelleDelanteroConRef) {
        <section class="mod-card muelle-delantero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Delantero (Con Referencia)</h4>
            <span class="mod-card__hint">Datos técnicos del muelle</span>
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroConRef"
                  name="marcaMuelleDelanteroConRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleDelanteroConRef"
                  name="referenciaMuelleDelanteroConRef{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-12"><hr class="mod-sep" /></div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorDelanteroRef"
                  name="diametroExteriorDelanteroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreDelanteroRef"
                  name="longitudLibreDelanteroRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraDelanteroRef"
                  name="diametroEspiraDelanteroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasDelanteroRef"
                  name="numeroEspirasDelanteroRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.muelleDelanteroSinRef) {
        <section class="mod-card muelle-delantero-sinref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Delantero (Sin Referencia)</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>
          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroSinRef"
                  name="marcaMuelleDelanteroSinRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorDelanteroSinRef"
                  name="diametroExteriorDelanteroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreDelanteroSinRef"
                  name="longitudLibreDelanteroSinRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraDelanteroSinRef"
                  name="diametroEspiraDelanteroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasDelanteroSinRef"
                  name="numeroEspirasDelanteroSinRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.muelleTraseroConRef) {
        <section class="mod-card muelle-trasero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Trasero (Con Referencia)</h4>
            <span class="mod-card__hint"
              >Datos técnicos del muelle trasero</span
            >
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroConRef"
                  name="marcaMuelleTraseroConRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleTraseroConRef"
                  name="referenciaMuelleTraseroConRef{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-12"><hr class="mod-sep" /></div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorTraseroRef"
                  name="diametroExteriorTraseroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreTraseroRef"
                  name="longitudLibreTraseroRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraTraseroRef"
                  name="diametroEspiraTraseroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasTraseroRef"
                  name="numeroEspirasTraseroRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.muelleTraseroSinRef) {
        <section class="mod-card muelle-trasero-sinref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Trasero (Sin Referencia)</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>
          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroSinRef"
                  name="marcaMuelleTraseroSinRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorTraseroSinRef"
                  name="diametroExteriorTraseroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreTraseroSinRef"
                  name="longitudLibreTraseroSinRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraTraseroSinRef"
                  name="diametroEspiraTraseroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasTraseroSinRef"
                  name="numeroEspirasTraseroSinRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.ballestaDelantera) {
        <section class="mod-card ballesta-delantera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Ballesta Delantera</h4>
            <span class="mod-card__hint">Especificaciones de ballestas</span>
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaBallestaDelantera"
                  name="marcaBallestaDelantera{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaBallestaDelantera"
                  name="referenciaBallestaDelantera{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="1"
                  class="form-control"
                  placeholder="Nº Hojas"
                  [(ngModel)]="mod.numHojasBallestaDelantera"
                  name="numHojasBallestaDelantera{{ i }}"
                  required
                />
                <label>Nº HOJAS</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Ancho"
                  [(ngModel)]="mod.anchoHojaBallestaDelantera"
                  name="anchoHojaBallestaDelantera{{ i }}"
                  required
                />
                <label>ANCHO HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorHojaBallestaDelantera"
                  name="espesorHojaBallestaDelantera{{ i }}"
                  required
                />
                <label>ESPESOR HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Longitud"
                  [(ngModel)]="mod.longitudBallestaDelantera"
                  name="longitudBallestaDelantera{{ i }}"
                  required
                />
                <label>LONGITUD TOTAL (mm)</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.ballestaTrasera) {
        <section class="mod-card ballesta-trasera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Ballesta Trasera</h4>
            <span class="mod-card__hint"
              >Especificaciones de ballestas traseras</span
            >
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaBallestaTrasera"
                  name="marcaBallestaTrasera{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaBallestaTrasera"
                  name="referenciaBallestaTrasera{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="1"
                  class="form-control"
                  placeholder="Nº Hojas"
                  [(ngModel)]="mod.numHojasBallestaTrasera"
                  name="numHojasBallestaTrasera{{ i }}"
                  required
                />
                <label>Nº HOJAS</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Ancho"
                  [(ngModel)]="mod.anchoHojaBallestaTrasera"
                  name="anchoHojaBallestaTrasera{{ i }}"
                  required
                />
                <label>ANCHO HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorHojaBallestaTrasera"
                  name="espesorHojaBallestaTrasera{{ i }}"
                  required
                />
                <label>ESPESOR HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Longitud"
                  [(ngModel)]="mod.longitudBallestaTrasera"
                  name="longitudBallestaTrasera{{ i }}"
                  required
                />
                <label>LONGITUD TOTAL (mm)</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.amortiguadorDelantero ||
        mod.detallesMuelles?.amortiguadorTrasero) {
        <section class="mod-card amortiguadores">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Amortiguadores</h4>
          </div>
          <div class="row g-4">
            @if (mod.detallesMuelles?.amortiguadorDelantero) {
            <div class="col-12 col-lg-6">
              <div class="p-3 border h-100">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Delantero
                </h6>
                <div class="form-floating mb-2">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAmortiguadorDelantero"
                    name="marcaAmortiguadorDelantero{{ i }}"
                    required
                  />
                  <label>MARCA</label>
                </div>
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaAmortiguadorDelantero"
                    name="referenciaAmortiguadorDelantero{{ i }}"
                    required
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
            </div>
            } @if (mod.detallesMuelles?.amortiguadorTrasero) {
            <div class="col-12 col-lg-6">
              <div class="p-3 border h-100">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Trasero
                </h6>
                <div class="form-floating mb-2">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAmortiguadorTrasero"
                    name="marcaAmortiguadorTrasero{{ i }}"
                    required
                  />
                  <label>MARCA</label>
                </div>
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaAmortiguadorTrasero"
                    name="referenciaAmortiguadorTrasero{{ i }}"
                    required
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
        } @if (mod.detallesMuelles?.tacosDeGoma) {
        <section class="mod-card tacos-goma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Tacos de Goma</h4>
          </div>
          <div class="row g-4">
            <div class="col-12 d-flex gap-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="tacosDelantero{{ i }}"
                  [(ngModel)]="mod.tacosDelantero"
                  name="tacosDelantero{{ i }}"
                />
                <label class="form-check-label" for="tacosDelantero{{ i }}"
                  >Tacos Delanteros</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="tacosTrasero{{ i }}"
                  [(ngModel)]="mod.tacosTrasero"
                  name="tacosTrasero{{ i }}"
                />
                <label class="form-check-label" for="tacosTrasero{{ i }}"
                  >Tacos Traseros</label
                >
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            @if (mod.tacosDelantero) {
            <div class="col-12 col-md-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Delantero
              </h6>
              <div class="form-floating mb-2">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diámetro"
                  [(ngModel)]="mod.diametroTacoDelantero"
                  name="diametroTacoDelantero{{ i }}"
                  required
                />
                <label>DIÁMETRO (mm)</label>
              </div>
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorTacoDelantero"
                  name="espesorTacoDelantero{{ i }}"
                  required
                />
                <label>ESPESOR (mm)</label>
              </div>
            </div>
            } @if (mod.tacosTrasero) {
            <div class="col-12 col-md-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Trasero
              </h6>
              <div class="form-floating mb-2">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diámetro"
                  [(ngModel)]="mod.diametroTacoTrasero"
                  name="diametroTacoTrasero{{ i }}"
                  required
                />
                <label>DIÁMETRO (mm)</label>
              </div>
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorTacoTrasero"
                  name="espesorTacoTrasero{{ i }}"
                  required
                />
                <label>ESPESOR (mm)</label>
              </div>
            </div>
            }
          </div>
        </section>
        } @if (mod.detallesMuelles?.kitElevacion) {
        <section class="mod-card kit-elevacion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Kit de Elevación</h4>
          </div>
          <div class="row g-4">
            <div class="col-12 d-flex gap-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="kitElevacionDelantero{{ i }}"
                  [(ngModel)]="mod.detallesMuelles.kitElevacionDelantero"
                  name="kitElevacionDelantero{{ i }}"
                />
                <label
                  class="form-check-label"
                  for="kitElevacionDelantero{{ i }}"
                  >Muelles Delanteros</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="kitElevacionTrasero{{ i }}"
                  [(ngModel)]="mod.detallesMuelles.kitElevacionTrasero"
                  name="kitElevacionTrasero{{ i }}"
                />
                <label class="form-check-label" for="kitElevacionTrasero{{ i }}"
                  >Ballestas Traseras</label
                >
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            @if (mod.detallesMuelles.kitElevacionDelantero) {
            <div class="col-12 col-lg-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Delantero
              </h6>
              <div class="row g-2">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaKitElevacionDelantera"
                      name="marcaKitElevacion{{ i }}"
                      required
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoSuspensionDelantera"
                      name="tipoSuspensionDelantera{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="muelles">Muelles</option>
                      <option value="ballestas">Ballestas</option>
                    </select>
                    <label>TIPO SUSPENSIÓN</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoTacoDelantero"
                      name="tipoTacoDelantero{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="circular">Circular</option>
                      <option value="rectangular">Rectangular</option>
                    </select>
                    <label>TIPO TACO</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroTacoDelantero"
                      name="diametroTacoDelantero{{ i }}"
                      required
                    />
                    <label>DIÁM. (mm)</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Espesor"
                      [(ngModel)]="mod.espesorTacoDelantero"
                      name="espesorTacoDelantero{{ i }}"
                      required
                    />
                    <label>ESPESOR (mm)</label>
                  </div>
                </div>
              </div>
            </div>
            } @if (mod.detallesMuelles.kitElevacionTrasero) {
            <div class="col-12 col-lg-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Trasero
              </h6>
              <div class="row g-2">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaKitElevacionTrasera"
                      name="marcaKitElevacionTrasera{{ i }}"
                      required
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoSuspensionTrasera"
                      name="tipoSuspensionTrasera{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="muelles">Muelles</option>
                      <option value="ballestas">Ballestas</option>
                    </select>
                    <label>TIPO SUSPENSIÓN</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoTacoTrasero"
                      name="tipoTacoTrasero{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="circular">Circular</option>
                      <option value="rectangular">Rectangular</option>
                    </select>
                    <label>TIPO TACO</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroTacoTrasero"
                      name="diametroTacoTrasero{{ i }}"
                      required
                    />
                    <label>DIÁM. (mm)</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Espesor"
                      [(ngModel)]="mod.espesorTacoTrasero"
                      name="espesorTacoTrasero{{ i }}"
                      required
                    />
                    <label>ESPESOR (mm)</label>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
        }
      </div>
      }
      <!-- Matrícula y Portamatrícula -->
      @if (mod.nombre === 'MATRÍCULA Y PORTAMATRÍCULA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card matricula">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Matrícula y Portamatrícula</h4>
            <span class="mod-card__hint"
              >Configuración de ubicación y soporte de placa</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                @if (mod.detalle.instalacionPorta) {
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Opción 1: Portamatrículas
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ubicacionPorta1"
                      name="ubicacionPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ubicacionPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="trasero">Trasero</option>
                      <option value="delantero">Delantero</option>
                    </select>
                    <label>UBICACIÓN</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ladoPorta1"
                      name="ladoPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ladoPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="derecho">Derecho</option>
                      <option value="izquierdo">Izquierdo</option>
                      <option value="centro">Centro</option>
                    </select>
                    <label>LADO</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.materialPorta1"
                      name="materialPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.materialPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="acero">Acero</option>
                      <option value="plástico">Plástico</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.fabricacionPorta1"
                      name="fabricacionPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.fabricacionPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="artesanal">Artesanal</option>
                      <option value="comprado">Comprado</option>
                    </select>
                    <label>FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.fabricacionPorta1 === 'comprado') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaPorta1"
                      name="marcaPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.marcaPorta1 === undefined
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Ref"
                      [(ngModel)]="mod.referenciaPorta1"
                      name="referenciaPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.referenciaPorta1 === undefined
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                } } @if (mod.detalle.instalacionPorta &&
                (mod.detalle.reubicacionTrasera ||
                mod.detalle.cambioUbicacionDelantera)) {
                <div class="col-12"><hr class="mod-sep" /></div>
                } @if (mod.detalle.reubicacionTrasera) {
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Opción 2: Reubicación Trasera
                  </h6>
                </div>

                <div class="col-md-8">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.portamatr2"
                      name="portamatr2{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.portamatr2 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="delantero">Delantero</option>
                      <option value="trasero">Trasero</option>
                    </select>
                    <label>PORTAMATRÍCULA</label>
                  </div>
                </div>
                <div class="col-md-4 d-flex align-items-center">
                  <div class="form-check mt-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.paragolpesNuevo2"
                      name="paragolpesNuevo2{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.paragolpesNuevo2 === undefined
                      "
                    />
                    <label class="form-check-label"
                      >¿ES NUEVO PARAGOLPES?</label
                    >
                  </div>
                </div>
                } @if ((mod.detalle.instalacionPorta ||
                mod.detalle.reubicacionTrasera) &&
                mod.detalle.cambioUbicacionDelantera) {
                <div class="col-12"><hr class="mod-sep" /></div>
                } @if (mod.detalle.cambioUbicacionDelantera) {
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Opción 3: Cambio Ubicación Delantera
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ubicacionMat3"
                      name="ubicacionMat3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ubicacionMat3 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="delantera">Delantera</option>
                      <option value="trasera">Trasera</option>
                    </select>
                    <label>MATRÍCULA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.materialMat3"
                      name="materialMat3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.materialMat3 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="Acrílica">Acrílica</option>
                      <option value="Metálica">Metálica</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasMat3"
                      name="medidasMat3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.medidasMat3 === undefined
                      "
                    />
                    <label>MEDIDAS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ubicacionBumper3"
                      name="ubicacionBumper3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ubicacionBumper3 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="derecho">Derecho</option>
                      <option value="izquierdo">Izquierdo</option>
                      <option value="centro">Centro</option>
                    </select>
                    <label>UBICACIÓN EN PARAGOLPES</label>
                  </div>
                </div>
                <div class="col-md-6 d-flex align-items-center">
                  <div class="form-check mt-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.paragolpesNuevo3"
                      name="paragolpesNuevo3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.paragolpesNuevo3 === undefined
                      "
                    />
                    <label class="form-check-label"
                      >¿ES NUEVO PARAGOLPES?</label
                    >
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Defensa Delantera -->
      @if (mod.nombre === 'DEFENSA DELANTERA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card defensa-delantera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Defensa Delantera</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Características de la Pieza
              </h6>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaDefensa"
                  name="marcaDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaDefensa"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modeloDefensa"
                  name="modeloDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloDefensa"
                />
                <label>MODELO</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Grosor"
                  [(ngModel)]="mod.grosorTuboDefensa"
                  name="grosorTuboDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.grosorTuboDefensa"
                />
                <label>GROSOR TUBO (mm)</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medidas"
                  [(ngModel)]="mod.medidasDefensa"
                  name="medidasDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasDefensa"
                />
                <label>MEDIDAS (mm)</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ratio"
                  [(ngModel)]="mod.curvaturaDefensaDelantera"
                  name="curvaturaDefensaDelantera{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.curvaturaDefensaDelantera
                  "
                />
                <label>RATIO CURVATURA MÍN.</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-12">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Sujeción
              </h6>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA TORNILLOS</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Amortiguador de Dirección -->
      @if (mod.nombre === 'AMORTIGUADOR DE DIRECCIÓN' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card amortiguador-direccion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Amortiguador de Dirección</h4>
            <span class="mod-card__hint"
              >Datos de identificación del componente</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaAmortiguador"
                  name="marcaAmortiguador{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaAmortiguador"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaAmortiguador"
                  name="referenciaAmortiguador{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaAmortiguador
                  "
                />
                <label>REFERENCIA</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Barra de Dirección -->
      @if (mod.nombre === 'BARRA DE DIRECCIÓN' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card barra-direccion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Barra de Dirección</h4>
            <span class="mod-card__hint"
              >Datos de identificación del componente</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaBarraDireccion"
                      name="marcaBarraDireccion{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaBarraDireccion
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Barra para Regular la Convergencia (simple) -->
      @if (mod.nombre === BARRA_ALINEAMIENTO && mod.seleccionado &&
      !mod.regulable) {
      <div class="mb-3">
        <section class="mod-card barra-convergencia">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Barra para Regular la Convergencia</h4>
            <span class="mod-card__hint"
              >Elemento de alineación no regulable</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaConvergencia"
                      name="marcaConvergencia{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaConvergencia
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- Barra para Regular la Convergencia (regulable) -->
      @if (mod.nombre === BARRA_MOV_LATERAL && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card barra-convergencia-reg">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Barra para Regular la Convergencia</h4>
            <span class="mod-card__hint"
              >Elemento de alineación (opción regulable)</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-8">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaConvergenciaReg"
                      name="marcaConvergenciaReg{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaConvergenciaReg
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.regulable"
                      name="regulable{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.regulable === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="true">SÍ</option>
                      <option [ngValue]="false">NO</option>
                    </select>
                    <label>¿ES REGULABLE?</label>
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaConvergenciaReg"
                      name="referenciaConvergenciaReg{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaConvergenciaReg
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- FAROS DELANTEROS PRINCIPALES -->
      @if (mod.nombre === 'FAROS DELANTEROS PRINCIPALES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card faros-principales">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Faros Delanteros Principales</h4>
            <span class="mod-card__hint"
              >Especificaciones de iluminación y homologación</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marca"
                  name="marcaFaro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.esLed"
                  name="esLedFaro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.esLed === undefined"
                >
                  <option value="" disabled selected>-- SELECCIONAR --</option>
                  <option [ngValue]="true">SÍ</option>
                  <option [ngValue]="false">NO</option>
                </select>
                <label>¿ES LED?</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacion"
                  name="homologacionFaro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacion"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-12">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Marcado y Luminosidad
              </h6>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marcado Posición"
                  [(ngModel)]="mod.marcadoPosicion"
                  name="marcadoPosicionFaro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcadoPosicion"
                />
                <label>MARCADO LUZ POSICIÓN</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marcado Cruce"
                  [(ngModel)]="mod.marcadoCruce"
                  name="marcadoCruceFaro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcadoCruce"
                />
                <label>MARCADO CRUCE/CARRETERA</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="PDL"
                  [(ngModel)]="mod.pdlFaro"
                  name="pdlFaro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.pdlFaro"
                />
                <label>ÍNDICE REF. (pdl/ud)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- LUZ DE CRUCE -->
      @if (mod.nombre === 'LUZ DE CRUCE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luz-cruce">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Luz de Cruce</h4>
            <span class="mod-card__hint"
              >Datos de homologación y funcionamiento</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marcaje"
                  [(ngModel)]="mod.marcaje"
                  name="marcajeCruce{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaje"
                />
                <label>MARCAJE</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacion"
                  name="homologacionCruce{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacion"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="PDL"
                  [(ngModel)]="mod.pdlFaroCruce"
                  name="pdlFaroCruce{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.pdlFaroCruce"
                />
                <label>ÍNDICE REF. (pdl/ud)</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.carreteraDesactivada"
                  name="carreteraDesactivada{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.carreteraDesactivada === undefined
                  "
                >
                  <option value="" disabled selected>-- SELECCIONAR --</option>
                  <option [ngValue]="true">SÍ</option>
                  <option [ngValue]="false">NO</option>
                </select>
                <label>¿LUZ CARRETERA DESACTIVADA?</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- LUCES DE LARGO ALCANCE -->
      @if (mod.nombre === 'LUCES DE LARGO ALCANCE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card largo-alcance">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Luces de Largo Alcance</h4>
            <span class="mod-card__hint">Faros adicionales de carretera</span>
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marca"
                      name="marcaLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marca"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referencia"
                      name="referenciaLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.referencia"
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marcaje"
                      [(ngModel)]="mod.marcaje"
                      name="marcajeLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaje"
                    />
                    <label>MARCAJE</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación"
                      [(ngModel)]="mod.homologacion"
                      name="homologacionLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.homologacion"
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Índice"
                      [(ngModel)]="mod.indiceReferencia"
                      name="indiceLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.indiceReferencia
                      "
                    />
                    <label>ÍNDICE REF. (pdl/ud)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- LUZ DE POSICIÓN -->
      @if (mod.nombre === 'LUZ DE POSICIÓN' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luz-posicion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Luz de Posición</h4>
            <span class="mod-card__hint"
              >Datos técnicos de luces de posición delanteras</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.esLedPosicion"
                      name="esLedPosicion{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.esLedPosicion === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="true">SÍ</option>
                      <option [ngValue]="false">NO</option>
                    </select>
                    <label>¿ES TECNOLOGÍA LED?</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaPosicion"
                      name="marcaPosicion{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaPosicion"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marcaje"
                      [(ngModel)]="mod.marcajePosicion"
                      name="marcajePosicion{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcajePosicion"
                    />
                    <label>MARCAJE</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación"
                      [(ngModel)]="mod.homologacionPosicion"
                      name="homologacionPosicion{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.homologacionPosicion
                      "
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- 3ª LUZ DE FRENO -->
      @if (mod.nombre === '3ª LUZ DE FRENO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card tercera-luz-freno">
          <div class="mod-card__header">
            <h4 class="mod-card__title">3ª Luz de Freno</h4>
            <span class="mod-card__hint"
              >Detalles de la luz de frenado central elevada</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marca3Freno"
                  name="marca3Freno{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca3Freno"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marcaje"
                  [(ngModel)]="mod.marcaje3Freno"
                  name="marcaje3Freno{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaje3Freno"
                />
                <label>MARCAJE</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacion3Freno"
                  name="homologacion3Freno{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacion3Freno"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.situado3Freno"
                  name="situado3Freno{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.situado3Freno"
                />
                <label>UBICACIÓN / SITUACIÓN</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- DIURNAS -->
      @if (mod.nombre === 'DIURNAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luces-diurnas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Luces Diurnas</h4>
            <span class="mod-card__hint"
              >Datos técnicos de luces de circulación diurna</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.esLed"
                      name="esLedFaro{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.esLed === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="true">SÍ</option>
                      <option [ngValue]="false">NO</option>
                    </select>
                    <label>¿ES TECNOLOGÍA LED?</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaDiurnas"
                      name="marcaDiurnas{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaDiurnas"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación"
                      [(ngModel)]="mod.homologacionDiurnas"
                      name="homologacionDiurnas{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.homologacionDiurnas
                      "
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- ANTINIEBLA -->
      @if (mod.nombre === 'ANTINIEBLA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luces-antiniebla">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Luces Antiniebla</h4>
            <span class="mod-card__hint"
              >Especificaciones de luces antiniebla</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <label
                    class="form-label fw-bold text-uppercase small text-muted"
                    >UBICACIÓN</label
                  >
                  <div class="d-flex gap-3">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="ubicacionAntiniebla{{ i }}"
                        id="ubiAntinieblaDel{{ i }}"
                        value="delanteros"
                        [(ngModel)]="mod.ubicacionAntiniebla"
                        required
                      />
                      <label
                        class="form-check-label"
                        for="ubiAntinieblaDel{{ i }}"
                        >Delanteros</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="ubicacionAntiniebla{{ i }}"
                        id="ubiAntinieblaTras{{ i }}"
                        value="traseros"
                        [(ngModel)]="mod.ubicacionAntiniebla"
                        required
                      />
                      <label
                        class="form-check-label"
                        for="ubiAntinieblaTras{{ i }}"
                        >Traseros</label
                      >
                    </div>
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="radio"
                        name="ubicacionAntiniebla{{ i }}"
                        id="ubiAntinieblaAmbos{{ i }}"
                        value="ambos"
                        [(ngModel)]="mod.ubicacionAntiniebla"
                        required
                      />
                      <label
                        class="form-check-label"
                        for="ubiAntinieblaAmbos{{ i }}"
                        >Ambos</label
                      >
                    </div>
                  </div>
                  @if (formSubmitted && !mod.ubicacionAntiniebla) {
                  <div class="text-danger small mt-1">
                    Seleccione una ubicación.
                  </div>
                  }
                </div>

                <div class="col-12" *ngIf="mod.ubicacionAntiniebla">
                  <hr class="mod-sep" />
                </div>

                @if (mod.ubicacionAntiniebla === 'delanteros' ||
                mod.ubicacionAntiniebla === 'ambos') {
                <div class="col-12">
                  <h6 class="text-primary border-bottom pb-2 mb-3">
                    <i class="bi bi-lightbulb me-2"></i>ANTINIEBLAS DELANTEROS
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Marca Delantera"
                          [(ngModel)]="mod.marcaAntinieblaDel"
                          name="marcaAntinieblaDel{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.marcaAntinieblaDel
                          "
                        />
                        <label>MARCA (DEL)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Homologación Delantera"
                          [(ngModel)]="mod.homologacionAntinieblaDel"
                          name="homologacionAntinieblaDel{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.homologacionAntinieblaDel
                          "
                        />
                        <label>CONTRASEÑA (DEL)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <select
                          class="form-select"
                          [(ngModel)]="mod.metricaAntinieblaDel"
                          name="metricaAntinieblaDel{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && mod.metricaAntinieblaDel == null
                          "
                        >
                          <option [ngValue]="null" disabled>
                            -- SELECCIONAR --
                          </option>
                          @for (num of metricasTornillos; track num) {
                          <option [value]="num">{{ num }}</option>
                          }
                        </select>
                        <label>MÉTRICA TORNILLOS (DEL)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="number"
                          min="0"
                          class="form-control"
                          placeholder="Nº Delanteros"
                          [(ngModel)]="mod.nTornillosAntinieblaDel"
                          name="nTornillosAntinieblaDel{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.nTornillosAntinieblaDel
                          "
                        />
                        <label>Nº TORNILLOS (DEL)</label>
                      </div>
                    </div>
                  </div>
                </div>
                } @if (mod.ubicacionAntiniebla === 'traseros' ||
                mod.ubicacionAntiniebla === 'ambos') {
                <div
                  class="col-12"
                  [class.mt-4]="mod.ubicacionAntiniebla === 'ambos'"
                >
                  <h6 class="text-primary border-bottom pb-2 mb-3">
                    <i class="bi bi-lightbulb-fill me-2"></i>ANTINIEBLAS
                    TRASEROS
                  </h6>
                  <div class="row g-3">
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Marca Trasera"
                          [(ngModel)]="mod.marcaAntinieblaTras"
                          name="marcaAntinieblaTras{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.marcaAntinieblaTras
                          "
                        />
                        <label>MARCA (TRAS)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="text"
                          class="form-control"
                          placeholder="Homologación Trasera"
                          [(ngModel)]="mod.homologacionAntinieblaTras"
                          name="homologacionAntinieblaTras{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.homologacionAntinieblaTras
                          "
                        />
                        <label>CONTRASEÑA (TRAS)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <select
                          class="form-select"
                          [(ngModel)]="mod.metricaAntinieblaTras"
                          name="metricaAntinieblaTras{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && mod.metricaAntinieblaTras == null
                          "
                        >
                          <option [ngValue]="null" disabled>
                            -- SELECCIONAR --
                          </option>
                          @for (num of metricasTornillos; track num) {
                          <option [value]="num">{{ num }}</option>
                          }
                        </select>
                        <label>MÉTRICA TORNILLOS (TRAS)</label>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="form-floating">
                        <input
                          type="number"
                          min="0"
                          class="form-control"
                          placeholder="Nº Traseros"
                          [(ngModel)]="mod.nTornillosAntinieblaTras"
                          name="nTornillosAntinieblaTras{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.nTornillosAntinieblaTras
                          "
                        />
                        <label>Nº TORNILLOS (TRAS)</label>
                      </div>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- PILOTO TRASERO -->
      @if (mod.nombre === 'PILOTO TRASERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card piloto-trasero">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Piloto Trasero</h4>
            <span class="mod-card__hint"
              >Identificación de funciones de señalización trasera</span
            >
          </div>

          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaPilotoTrasero"
                  name="marcaPilotoTrasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaPilotoTrasero"
                />
                <label>MARCA GENERAL</label>
              </div>
            </div>

            @if (mod.detalle.luzPosicionFreno || mod.detalle.intermitente ||
            mod.detalle.marchaAtras || mod.detalle.catadioptrico) {
            <div class="col-12"><hr class="mod-sep" /></div>
            <div class="col-12">
              <h6 class="text-uppercase text-muted small fw-bold mb-0">
                Referencias de componentes
              </h6>
            </div>
            } @if (mod.detalle.luzPosicionFreno) {
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ref"
                  [(ngModel)]="mod.referenciaLuzPosicionFreno"
                  name="referenciaLuzPosicionFreno{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaLuzPosicionFreno
                  "
                />
                <label>REF. POSICIÓN/FRENO</label>
              </div>
            </div>
            } @if (mod.detalle.intermitente) {
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ref"
                  [(ngModel)]="mod.referenciaIntermitente"
                  name="referenciaIntermitente{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaIntermitente
                  "
                />
                <label>REF. INTERMITENTE</label>
              </div>
            </div>
            } @if (mod.detalle.catadioptrico) {
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ref"
                  [(ngModel)]="mod.referenciaCatadioptrico"
                  name="referenciaCatadioptrico{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaCatadioptrico
                  "
                />
                <label>REF. CATADIÓPTRICO</label>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'LUZ MARCHA ATRÁS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-luz-atras">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Luz de Marcha Atrás</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaLuzMarchaAtras"
                    name="marcaLuzMarchaAtras{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.marcaLuzMarchaAtras
                    "
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaLuzMarchaAtras"
                    name="referenciaLuzMarchaAtras{{ i }}"
                  />
                  <label>REFERENCIA (Opcional)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Tecnología (ej. LED)"
                    [(ngModel)]="mod.tecnologiaLuzMarchaAtras"
                    name="tecnologiaLuzMarchaAtras{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.tecnologiaLuzMarchaAtras
                    "
                  />
                  <label>TECNOLOGÍA (ej. LED)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marcaje (ej. AR00)"
                    [(ngModel)]="mod.marcajeLuzMarchaAtras"
                    name="marcajeLuzMarchaAtras{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.marcajeLuzMarchaAtras
                    "
                  />
                  <label>MARCAJE (ej. AR00)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Contraseña Homologación"
                    [(ngModel)]="mod.contrasenaLuzMarchaAtras"
                    name="contrasenaLuzMarchaAtras{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.contrasenaLuzMarchaAtras
                    "
                  />
                  <label>CONTRASEÑA (ej. E9...)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
              </div>

              <div class="col-12">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="mandosOriginalesLuzMarchaAtras{{ i }}"
                    [(ngModel)]="mod.mandosOriginalesLuzMarchaAtras"
                    name="mandosOriginalesLuzMarchaAtras{{ i }}"
                  />
                  <label
                    class="form-check-label"
                    for="mandosOriginalesLuzMarchaAtras{{ i }}"
                  >
                    Accionada desde los mandos originales
                  </label>
                </div>

                @if (!mod.mandosOriginalesLuzMarchaAtras) {
                <div class="form-floating mt-3">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Descripción accionamiento"
                    [(ngModel)]="mod.descripcionAccionamientoLuzMarchaAtras"
                    name="descripcionAccionamientoLuzMarchaAtras{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      !mod.mandosOriginalesLuzMarchaAtras &&
                      !mod.descripcionAccionamientoLuzMarchaAtras
                    "
                  />
                  <label>DESCRIPCIÓN DEL ACCIONAMIENTO</label>
                </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'LUCES MATRÍCULA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-luces">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Luz de Matrícula</h4>
          </div>

          <div class="card-body">
            <div class="row g-3 mb-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca del piloto"
                    [(ngModel)]="mod.marcaLuz"
                    name="marcaLuz{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaLuz"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaLuz"
                    name="referenciaLuz{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaLuz"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
            </div>

            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Tecnología (ej. LED)"
                    [(ngModel)]="mod.tecnologiaLuz"
                    name="tecnologiaLuz{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.tecnologiaLuz"
                  />
                  <label>TECNOLOGÍA (ej. LED)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marcaje (ej. L)"
                    [(ngModel)]="mod.marcajeLuz"
                    name="marcajeLuz{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcajeLuz"
                  />
                  <label>MARCAJE (ej. L)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Contraseña Homologación"
                    [(ngModel)]="mod.contrasenaHomologacion"
                    name="contrasenaHomologacion{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.contrasenaHomologacion
                    "
                  />
                  <label>CONTRASEÑA (ej. E9...)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
              </div>

              <div class="col-12">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="mandosOriginales{{ i }}"
                    [(ngModel)]="mod.mandosOriginales"
                    name="mandosOriginales{{ i }}"
                  />
                  <label class="form-check-label" for="mandosOriginales{{ i }}">
                    Accionada desde los mandos originales
                  </label>
                </div>

                @if (!mod.mandosOriginales) {
                <div class="form-floating mt-3">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Descripción accionamiento"
                    [(ngModel)]="mod.descripcionAccionamiento"
                    name="descripcionAccionamiento{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      !mod.mandosOriginales &&
                      !mod.descripcionAccionamiento
                    "
                  />
                  <label>DESCRIPCIÓN DEL ACCIONAMIENTO</label>
                </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- INTERMITENTES -->
      @if (mod.nombre === 'INTERMITENTES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card intermitentes">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Intermitentes</h4>
            <span class="mod-card__hint">Luces indicadoras de dirección</span>
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marcaje"
                      [(ngModel)]="mod.marcajeIntermitentes"
                      name="marcajeIntermitentes{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcajeIntermitentes
                      "
                    />
                    <label>MARCAJE</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación"
                      [(ngModel)]="mod.homologacionIntermitentes"
                      name="homologacionIntermitentes{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.homologacionIntermitentes
                      "
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- SUSTITUCIÓN DE EJES -->
      @if (mod.nombre === 'SUSTITUCIÓN DE EJES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-ejes">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Ejes</h4>
            <span class="mod-card__hint"
              >Datos del eje procedente del vehículo donante</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaEje"
                  name="marcaEje{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaEje"
                />
                <label>MARCA PROCEDENTE</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Denominación"
                  [(ngModel)]="mod.denominacionEje"
                  name="denominacionEje{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.denominacionEje"
                />
                <label>DENOMINACIÓN COMERCIAL</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.contrasenaHomologacionEje"
                  name="contrasenaHomologacionEje{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.contrasenaHomologacionEje
                  "
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE VOLANTE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-ejes">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Volante</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaVolante"
                    name="marcaVolante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaVolante"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Diámetro (mm)"
                    [(ngModel)]="mod.diametroVolante"
                    name="diametroVolante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.diametroVolante"
                  />
                  <label>DIÁMETRO (mm)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
              </div>

              <div class="col-md-6 d-flex align-items-center">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="checkEspaciador{{ i }}"
                    [(ngModel)]="mod.llevaEspaciador"
                    name="llevaEspaciador{{ i }}"
                  />
                  <label class="form-check-label" for="checkEspaciador{{ i }}">
                    ¿Instala espaciador / piña?
                  </label>
                </div>
              </div>

              @if (mod.llevaEspaciador) {
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca espaciador"
                    [(ngModel)]="mod.marcaEspaciador"
                    name="marcaEspaciador{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.llevaEspaciador &&
                      !mod.marcaEspaciador
                    "
                  />
                  <label>MARCA ESPACIADOR</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Espesor espaciador"
                    [(ngModel)]="mod.espesorEspaciador"
                    name="espesorEspaciador{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.llevaEspaciador &&
                      !mod.espesorEspaciador
                    "
                  />
                  <label>ESPESOR ESPACIADOR (mm)</label>
                </div>
              </div>
              }

              <div class="col-12">
                <hr class="text-muted my-2" />
                <h6 class="text-muted mb-3 small">SISTEMA DE AIRBAG</h6>
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="airbagOriginal{{ i }}"
                    [(ngModel)]="mod.tieneAirbagOriginal"
                    name="tieneAirbagOriginal{{ i }}"
                  />
                  <label class="form-check-label" for="airbagOriginal{{ i }}">
                    El volante original tenía Airbag
                  </label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="airbagNuevo{{ i }}"
                    [(ngModel)]="mod.tieneAirbagNuevo"
                    name="tieneAirbagNuevo{{ i }}"
                  />
                  <label class="form-check-label" for="airbagNuevo{{ i }}">
                    El volante nuevo mantiene Airbag
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE SISTEMA DE ESCAPE' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-escape">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Sistema de Escape</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaEscape"
                    name="marcaEscape{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaEscape"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaEscape"
                    name="referenciaEscape{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaEscape"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Contraseña Homologación"
                    [(ngModel)]="mod.contrasenaHomologacionEscape"
                    name="contrasenaHomologacionEscape{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.contrasenaHomologacionEscape
                    "
                  />
                  <label>CONTRASEÑA HOMOLOGACIÓN</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="checkNumSalidas{{ i }}"
                    [(ngModel)]="mod.cambiaNumeroSalidas"
                    name="cambiaNumeroSalidas{{ i }}"
                  />
                  <label class="form-check-label" for="checkNumSalidas{{ i }}">
                    ¿Cambia el número de salidas?
                  </label>
                </div>

                @if (mod.cambiaNumeroSalidas) {
                <div class="form-floating mt-2">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Número de salidas"
                    [(ngModel)]="mod.numeroSalidasEscape"
                    name="numeroSalidasEscape{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.cambiaNumeroSalidas &&
                      !mod.numeroSalidasEscape
                    "
                  />
                  <label>NUEVO Nº DE SALIDAS</label>
                </div>
                }
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch mb-2">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="checkUbicacion{{ i }}"
                    [(ngModel)]="mod.cambiaUbicacion"
                    name="cambiaUbicacion{{ i }}"
                  />
                  <label class="form-check-label" for="checkUbicacion{{ i }}">
                    ¿Cambia la ubicación?
                  </label>
                </div>

                @if (mod.cambiaUbicacion) {
                <div class="form-floating mt-2">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Descripción ubicación"
                    [(ngModel)]="mod.descripcionUbicacionEscape"
                    name="descripcionUbicacionEscape{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.cambiaUbicacion &&
                      !mod.descripcionUbicacionEscape
                    "
                  />
                  <label>DESCRIPCIÓN UBICACIÓN</label>
                </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE DISCOS DE FRENO' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-frenos">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Discos de Freno</h4>
          </div>

          <div class="card-body">
            <div class="row mb-4">
              <div class="col-12">
                <label class="form-label fw-bold mb-2"
                  >UBICACIÓN DE LOS DISCOS A SUSTITUIR</label
                >
                <div class="d-flex gap-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionDiscos{{ i }}"
                      id="ubiDel{{ i }}"
                      value="delanteros"
                      [(ngModel)]="mod.ubicacionDiscos"
                    />
                    <label class="form-check-label" for="ubiDel{{ i }}"
                      >Delanteros</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionDiscos{{ i }}"
                      id="ubiTras{{ i }}"
                      value="traseros"
                      [(ngModel)]="mod.ubicacionDiscos"
                    />
                    <label class="form-check-label" for="ubiTras{{ i }}"
                      >Traseros</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionDiscos{{ i }}"
                      id="ubiAmbos{{ i }}"
                      value="ambos"
                      [(ngModel)]="mod.ubicacionDiscos"
                    />
                    <label class="form-check-label" for="ubiAmbos{{ i }}"
                      >Delanteros y Traseros</label
                    >
                  </div>
                </div>
              </div>

              @if (mod.ubicacionDiscos === 'ambos') {
              <div class="col-12 mt-3">
                <div class="form-check form-switch bg-light p-2 rounded">
                  <input
                    class="form-check-input ms-0 me-2"
                    type="checkbox"
                    id="discosIguales{{ i }}"
                    [(ngModel)]="mod.sonIguales"
                  />
                  <label
                    class="form-check-label fw-bold"
                    for="discosIguales{{ i }}"
                  >
                    ¿Los discos delanteros y traseros son idénticos (misma
                    marca/medidas)?
                  </label>
                </div>
              </div>
              }
            </div>

            @if (mod.ubicacionDiscos) {

            <h6 class="text-primary border-bottom pb-2 mb-3">
              @if (mod.ubicacionDiscos === 'ambos' && !mod.sonIguales) { DATOS
              EJE DELANTERO } @else if (mod.ubicacionDiscos === 'traseros') {
              DATOS EJE TRASERO } @else { DATOS GENERALES DEL DISCO }
            </h6>

            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaDiscos"
                    name="marcaDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaDiscos"
                  />
                  <label>MARCA</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloDiscos"
                    name="modeloDiscos{{ i }}"
                  />
                  <label>MODELO</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaDiscos"
                    name="referenciaDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaDiscos"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Diámetro"
                    [(ngModel)]="mod.diametroDiscos"
                    name="diametroDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.diametroDiscos"
                  />
                  <label>DIÁMETRO (mm)</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Espesor"
                    [(ngModel)]="mod.espesorDiscos"
                    name="espesorDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.espesorDiscos"
                  />
                  <label>ESPESOR (mm)</label>
                </div>
              </div>
            </div>
            } @if (mod.ubicacionDiscos === 'ambos' && !mod.sonIguales) {
            <div class="mt-4">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                DATOS EJE TRASERO
              </h6>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca Trasera"
                      [(ngModel)]="mod.marcaDiscoTrasero"
                      name="marcaDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaDiscoTrasero
                      "
                    />
                    <label>MARCA (TRAS)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Modelo Trasero"
                      [(ngModel)]="mod.modeloDiscoTrasero"
                      name="modeloDiscoTrasero{{ i }}"
                    />
                    <label>MODELO (TRAS)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia Trasera"
                      [(ngModel)]="mod.referenciaDiscoTrasero"
                      name="referenciaDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaDiscoTrasero
                      "
                    />
                    <label>REFERENCIA (TRAS)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Diámetro Trasero"
                      [(ngModel)]="mod.diametroDiscoTrasero"
                      name="diametroDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.diametroDiscoTrasero
                      "
                    />
                    <label>DIÁMETRO TRASERO (mm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Espesor Trasero"
                      [(ngModel)]="mod.espesorDiscoTrasero"
                      name="espesorDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.espesorDiscoTrasero
                      "
                    />
                    <label>ESPESOR TRASERO (mm)</label>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      }

      <!-- ESTRIBOS LATERALES O TALONERAS -->
      @if (mod.nombre === 'ESTRIBOS LATERALES O TALONERAS' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card estribos-laterales">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Estribos Laterales o Taloneras</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcataloneras"
                      name="marcataloneras{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcataloneras"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-material-{{ i }}"
                      [(ngModel)]="mod.materialEstribos"
                      name="materialEstribos{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.materialEstribos
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option value="acero">Acero</option>
                      <option value="plástico">Plástico</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Dimensiones"
                      [(ngModel)]="mod.dimensionesTaloneras"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'dimensionesTaloneras',
                          'anchuraMEstribos',
                          'alturaMEstribos'
                        )
                      "
                      name="dimensionesTaloneras{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.dimensionesTaloneras
                      "
                    />
                    <label>DIMENSIONES (ej: 150x600mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgEstribos"
                      name="pesoPiezaKgEstribos{{ i }}"
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraMEstribos"
                      name="anchuraMEstribos{{ i }}"
                      readonly
                    />
                    <label>ANCHURA (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaMEstribos"
                      name="alturaMEstribos{{ i }}"
                      readonly
                    />
                    <label>ALTURA (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.coefAerodinamicoEstribos"
                      name="coefAerodinamicoEstribos{{ i }}"
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-metricaTalonera-{{ i }}"
                      [(ngModel)]="mod.metricaTalonera"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaTalonera{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaTalonera == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosEstribos"
                      name="nTornillosEstribos"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.nTornillosEstribos
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloEstribos"
                      name="calidadTornilloEstribos{{ i }}"
                      readonly
                    />
                    <label>CALIDAD TORNILLO</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsEstribos"
                      name="seccionResistenteAsEstribos{{ i }}"
                    />
                    <label>As (SECCIÓN RESISTENTE)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Estribos"
                      name="resTraccionMinTornillo88Kgmm2Estribos{{ i }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Cálculo Resistencia (Presión Aire)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3Estribos"
                      name="densidadAireKgM3Estribos{{ i }}"
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msEstribos"
                      name="velocidadAireV2msEstribos{{ i }}"
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="1"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaREstribos"
                      name="radioCurvaREstribos{{ i }}"
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.1"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKEstribos"
                      name="coefSeguridadKEstribos{{ i }}"
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- MOTOS -->
      <!-- REDUCCIÓN MMA Y MMTA -->
      @if (mod.nombre === 'REDUCCIÓN MMA Y MMTA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card reduccion-mma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Reducción MMA y MMTA</h4>
            <span class="mod-card__hint"
              >Modificación de masas técnicas (Motos)</span
            >
          </div>

          <div class="row g-4">
            @if (mod.ejeDelantero) {
            <div class="col-12 col-md-6">
              <div class="p-3 border bg-light h-100">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Reducción en Eje Delantero
                </h6>
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    placeholder="Kg"
                    [(ngModel)]="mod.kgReduccionEjeDelantero"
                    name="kgReduccionEjeDelantero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.kgReduccionEjeDelantero
                    "
                  />
                  <label>KG TOTALES</label>
                </div>
              </div>
            </div>
            } @if (mod.ejeTotal) {
            <div class="col-12 col-md-6">
              <div class="p-3 border bg-light h-100">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Reducción Total
                </h6>
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    placeholder="Kg"
                    [(ngModel)]="mod.kgReduccionTotal"
                    name="kgReduccionTotal{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.kgReduccionTotal"
                  />
                  <label>KG TOTALES</label>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      }
      <!-- LLANTAS Y NEUMÁTICOS -->
      @if (mod.nombre === 'LLANTAS Y NEUMÁTICOS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card llantas-moto">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Llantas y Neumáticos</h4>
            <span class="mod-card__hint"
              >Configuración de ejes para motocicletas</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.neumaticosMoto"
                  name="neumaticosMoto{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.neumaticosMoto"
                >
                  <option value="delantero">Delantero</option>
                  <option value="trasero">Trasero</option>
                  <option value="delantero y trasero">
                    Delantero y trasero
                  </option>
                </select>
                <label>CONFIGURACIÓN DE EJES</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep my-1" /></div>

            @if (mod.neumaticosMoto === 'delantero' || mod.neumaticosMoto ===
            'delantero y trasero') {
            <div class="col-12 col-md-6">
              <div class="p-3 border h-100 bg-light">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Eje Delantero
                </h6>

                <div class="form-floating mb-3">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Neumático"
                    [(ngModel)]="mod.neumaticoDelantero"
                    name="neumaticoDelantero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.neumaticoDelantero
                    "
                  />
                  <label>NEUMÁTICO</label>
                </div>

                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Medidas Llanta"
                    [(ngModel)]="mod.medidasLlantaDelantero"
                    name="medidasLlantaDelantero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidasLlantaDelantero
                    "
                  />
                  <label>MEDIDAS LLANTA</label>
                </div>
              </div>
            </div>
            } @if (mod.neumaticosMoto === 'trasero' || mod.neumaticosMoto ===
            'delantero y trasero') {
            <div class="col-12 col-md-6">
              <div class="p-3 border h-100 bg-light">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Eje Trasero
                </h6>

                <div class="form-floating mb-3">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Neumático"
                    [(ngModel)]="mod.neumaticoTrasero"
                    name="neumaticoTrasero{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.neumaticoTrasero"
                  />
                  <label>NEUMÁTICO</label>
                </div>

                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Medidas Llanta"
                    [(ngModel)]="mod.medidasLlantaTrasero"
                    name="medidasLlantaTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidasLlantaTrasero
                    "
                  />
                  <label>MEDIDAS LLANTA</label>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SOPORTE MATRÍCULA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-soporte-matricula">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Soporte de Matrícula</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Acero)"
                    [(ngModel)]="mod.materialSoporteMatricula"
                    name="materialSoporteMatricula{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.materialSoporteMatricula
                    "
                  />
                  <label>MATERIAL</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Ancho (mm)"
                    [(ngModel)]="mod.medidaAnchoSoporteMatricula"
                    name="medidaAnchoSoporteMatricula{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaAnchoSoporteMatricula
                    "
                  />
                  <label>ANCHO (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto (mm)"
                    [(ngModel)]="mod.medidaAltoSoporteMatricula"
                    name="medidaAltoSoporteMatricula{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaAltoSoporteMatricula
                    "
                  />
                  <label>ALTO (mm)</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div
                  class="alert alert-info d-flex align-items-center p-2 mb-0"
                  role="alert"
                >
                  <small>
                    <i class="bi bi-info-circle me-2"></i>
                    Recuerde que el soporte debe garantizar la visibilidad y los
                    ángulos reglamentarios de la matrícula e iluminación.
                  </small>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'ESTRIBERAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-estriberas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Estriberas</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaEstriberas"
                    name="marcaEstriberas{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaEstriberas"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >REFERENCIAS</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ref. Soporte"
                    [(ngModel)]="mod.refSoporteEstriberas"
                    name="refSoporteEstriberas{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.refSoporteEstriberas
                    "
                  />
                  <label>REFERENCIA SOPORTE</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ref. Estriberas"
                    [(ngModel)]="mod.refPisanteEstriberas"
                    name="refPisanteEstriberas{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.refPisanteEstriberas
                    "
                  />
                  <label>REFERENCIA ESTRIBERAS</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="cumpleSalientesEstriberas{{ i }}"
                    [(ngModel)]="mod.cumpleSalientesEstriberas"
                    name="cumpleSalientesEstriberas{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.cumpleSalientesEstriberas
                    "
                  />
                  <label
                    class="form-check-label small"
                    for="cumpleSalientesEstriberas{{ i }}"
                  >
                    Se garantiza que se cumple en todo caso con normativa de
                    salientes exteriores.
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE DEPÓSITO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-deposito">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Sustitución de Depósito de Combustible
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca Procedencia / Fabricante"
                    [(ngModel)]="mod.marcaDeposito"
                    name="marcaDeposito{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaDeposito"
                  />
                  <label>MARCA / PROCEDENCIA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo Procedencia"
                    [(ngModel)]="mod.modeloDeposito"
                    name="modeloDeposito{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloDeposito"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Contraseña Homologación"
                    [(ngModel)]="mod.contrasenaDeposito"
                    name="contrasenaDeposito{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.contrasenaDeposito
                    "
                  />
                  <label>CONTRASEÑA HOMOLOGACIÓN</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.1"
                    class="form-control"
                    placeholder="Capacidad (Litros)"
                    [(ngModel)]="mod.capacidadDeposito"
                    name="capacidadDeposito{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.capacidadDeposito"
                  />
                  <label>CAPACIDAD (Litros)</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body p-3">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="anclajesOriginalesDeposito{{ i }}"
                        [(ngModel)]="mod.anclajesOriginalesDeposito"
                        name="anclajesOriginalesDeposito{{ i }}"
                      />
                      <label
                        class="form-check-label"
                        for="anclajesOriginalesDeposito{{ i }}"
                      >
                        Ubicado sobre anclajes originales
                      </label>
                    </div>

                    @if (!mod.anclajesOriginalesDeposito) {
                    <div class="form-floating mt-3 bg-white">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Descripción ubicación / soportes"
                        [(ngModel)]="mod.descripcionUbicacionDeposito"
                        name="descripcionUbicacionDeposito{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted &&
                          !mod.anclajesOriginalesDeposito &&
                          !mod.descripcionUbicacionDeposito
                        "
                      />
                      <label>DESCRIPCIÓN UBICACIÓN / SOPORTES</label>
                    </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE BOMBA DE FRENO' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card sustitucion-bomba-freno">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Bomba de Freno</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label text-muted small fw-bold"
                  >UBICACIÓN A SUSTITUIR</label
                >
                <div class="d-flex gap-3 mb-2">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionBombaFreno{{ i }}"
                      id="ubiBombaDelantera{{ i }}"
                      value="delantera"
                      [(ngModel)]="mod.ubicacionBombaFreno"
                    />
                    <label
                      class="form-check-label"
                      for="ubiBombaDelantera{{ i }}"
                    >
                      Delantera
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionBombaFreno{{ i }}"
                      id="ubiBombaTrasera{{ i }}"
                      value="trasera"
                      [(ngModel)]="mod.ubicacionBombaFreno"
                    />
                    <label
                      class="form-check-label"
                      for="ubiBombaTrasera{{ i }}"
                    >
                      Trasera
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionBombaFreno{{ i }}"
                      id="ubiBombaAmbas{{ i }}"
                      value="ambas"
                      [(ngModel)]="mod.ubicacionBombaFreno"
                    />
                    <label class="form-check-label" for="ubiBombaAmbas{{ i }}">
                      Ambas (Delantera y Trasera)
                    </label>
                  </div>
                </div>
                @if (formSubmitted && !mod.ubicacionBombaFreno) {
                <div class="text-danger small">Seleccione una ubicación.</div>
                }
              </div>

              @if (mod.ubicacionBombaFreno === 'delantera' ||
              mod.ubicacionBombaFreno === 'ambas') {
              <div class="col-12 mt-3">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  DATOS BOMBA DELANTERA
                </h6>
                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca Delantera"
                        [(ngModel)]="mod.marcaBombaFrenoDel"
                        name="marcaBombaFrenoDel{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaBombaFrenoDel
                        "
                      />
                      <label>MARCA</label>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Referencia Delantera"
                        [(ngModel)]="mod.referenciaBombaFrenoDel"
                        name="referenciaBombaFrenoDel{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaBombaFrenoDel
                        "
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="pistonIgualDel{{ i }}"
                        [(ngModel)]="mod.pistonIgualOriginalBombaFrenoDel"
                        name="pistonIgualOriginalBombaFrenoDel{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.pistonIgualOriginalBombaFrenoDel
                        "
                      />
                      <label
                        class="form-check-label small"
                        for="pistonIgualDel{{ i }}"
                      >
                        El pistón tiene igual diámetro y longitud que el
                        original
                      </label>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="luzFrenoOperativaDel{{ i }}"
                        [(ngModel)]="mod.luzFrenoOperativaBombaFrenoDel"
                        name="luzFrenoOperativaBombaFrenoDel{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.luzFrenoOperativaBombaFrenoDel
                        "
                      />
                      <label
                        class="form-check-label small"
                        for="luzFrenoOperativaDel{{ i }}"
                      >
                        La luz de freno delantera sigue operativa
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              } @if (mod.ubicacionBombaFreno === 'trasera' ||
              mod.ubicacionBombaFreno === 'ambas') {
              <div class="col-12 mt-4">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  DATOS BOMBA TRASERA
                </h6>
                <div class="row g-3">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca Trasera"
                        [(ngModel)]="mod.marcaBombaFrenoTras"
                        name="marcaBombaFrenoTras{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaBombaFrenoTras
                        "
                      />
                      <label>MARCA</label>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Referencia Trasera"
                        [(ngModel)]="mod.referenciaBombaFrenoTras"
                        name="referenciaBombaFrenoTras{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaBombaFrenoTras
                        "
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="pistonIgualTras{{ i }}"
                        [(ngModel)]="mod.pistonIgualOriginalBombaFrenoTras"
                        name="pistonIgualOriginalBombaFrenoTras{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted &&
                          !mod.pistonIgualOriginalBombaFrenoTras
                        "
                      />
                      <label
                        class="form-check-label small"
                        for="pistonIgualTras{{ i }}"
                      >
                        El pistón tiene igual diámetro y longitud que el
                        original
                      </label>
                    </div>
                  </div>

                  <div class="col-12">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="luzFrenoOperativaTras{{ i }}"
                        [(ngModel)]="mod.luzFrenoOperativaBombaFrenoTras"
                        name="luzFrenoOperativaBombaFrenoTras{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.luzFrenoOperativaBombaFrenoTras
                        "
                      />
                      <label
                        class="form-check-label small"
                        for="luzFrenoOperativaTras{{ i }}"
                      >
                        La luz de freno trasera sigue operativa
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SOPORTES DESPLAZADOS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-soportes-desplazados">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Soportes Desplazados / Mandos Avanzados
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaSoportesDesplazados"
                    name="marcaSoportesDesplazados{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.marcaSoportesDesplazados
                    "
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaSoportesDesplazados"
                    name="referenciaSoportesDesplazados{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.referenciaSoportesDesplazados
                    "
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
                <label class="form-label text-muted small fw-bold"
                  >REUBICACIÓN DE MANDOS</label
                >
              </div>

              <div class="col-md-6">
                <div class="card h-100 bg-light border-0">
                  <div class="card-body">
                    <h6 class="card-title small text-primary fw-bold mb-3">
                      LATERAL DERECHO
                    </h6>
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="reubicaFreno{{ i }}"
                        [(ngModel)]="mod.reubicaFrenoSoportesDesplazados"
                        name="reubicaFrenoSoportesDesplazados{{ i }}"
                      />
                      <label
                        class="form-check-label small"
                        for="reubicaFreno{{ i }}"
                      >
                        Reubica pedal y bomba de freno posterior
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <div class="card h-100 bg-light border-0">
                  <div class="card-body">
                    <h6 class="card-title small text-primary fw-bold mb-3">
                      LATERAL IZQUIERDO
                    </h6>
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="reubicaCambio{{ i }}"
                        [(ngModel)]="mod.reubicaCambioSoportesDesplazados"
                        name="reubicaCambioSoportesDesplazados{{ i }}"
                      />
                      <label
                        class="form-check-label small"
                        for="reubicaCambio{{ i }}"
                      >
                        Reubica palanca de cambios
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="alert alert-warning mb-0">
                  <h6 class="alert-heading small fw-bold mb-2">
                    DECLARACIONES TÉCNICAS
                  </h6>

                  <div class="form-check mb-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="garantiaFrenado{{ i }}"
                      [(ngModel)]="mod.garantiaFrenadoSoportesDesplazados"
                      name="garantiaFrenadoSoportesDesplazados{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.garantiaFrenadoSoportesDesplazados
                      "
                    />
                    <label
                      class="form-check-label small"
                      for="garantiaFrenado{{ i }}"
                    >
                      No afecta a las características de frenado originales del
                      vehículo
                    </label>
                  </div>

                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="garantiaMuelle{{ i }}"
                      [(ngModel)]="mod.garantiaMuelleSoportesDesplazados"
                      name="garantiaMuelleSoportesDesplazados{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.garantiaMuelleSoportesDesplazados
                      "
                    />
                    <label
                      class="form-check-label small"
                      for="garantiaMuelle{{ i }}"
                    >
                      Equipados con muelle que garantiza el retorno a la
                      posición original
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'VELOCÍMETRO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-velocimetro">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Velocímetro</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca / Procedencia"
                    [(ngModel)]="mod.marcaVelocimetro"
                    name="marcaVelocimetro{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaVelocimetro"
                  />
                  <label>MARCA / PROCEDENCIA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloVelocimetro"
                    name="modeloVelocimetro{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloVelocimetro"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <select
                    class="form-select"
                    [(ngModel)]="mod.tipoVelocimetro"
                    name="tipoVelocimetro{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.tipoVelocimetro"
                  >
                    <option value="" disabled selected>
                      -- Seleccionar --
                    </option>
                    <option value="analógico">Analógico</option>
                    <option value="digital">Digital</option>
                  </select>
                  <label>TIPO</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="reubicadoVelocimetro{{ i }}"
                    [(ngModel)]="mod.esReubicadoVelocimetro"
                    name="esReubicadoVelocimetro{{ i }}"
                  />
                  <label
                    class="form-check-label"
                    for="reubicadoVelocimetro{{ i }}"
                  >
                    Se modifica la ubicación original (Reubicación)
                  </label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >TESTIGOS E INDICADORES</label
                >
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Lista de testigos (ej. Neutro, Aceite, Intermitentes...)"
                    style="height: 80px"
                    [(ngModel)]="mod.listaTestigosVelocimetro"
                    name="listaTestigosVelocimetro{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.listaTestigosVelocimetro
                    "
                  ></textarea>
                  <label>LISTA DE TESTIGOS QUE INCORPORA</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Observaciones funcionamiento (ej. Función parpadeo desactivada)"
                    [(ngModel)]="mod.observacionesTestigosVelocimetro"
                    name="observacionesTestigosVelocimetro{{ i }}"
                  />
                  <label>OBSERVACIONES FUNCIONAMIENTO (Opcional)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DATOS TÉCNICOS</label
                >
              </div>

              <div class="col-md-6 d-flex align-items-center">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="calibradoVelocimetro{{ i }}"
                    [(ngModel)]="mod.estaCalibradoVelocimetro"
                    name="estaCalibradoVelocimetro{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.estaCalibradoVelocimetro
                    "
                  />
                  <label
                    class="form-check-label fw-bold"
                    for="calibradoVelocimetro{{ i }}"
                  >
                    Se ha procedido al calibrado para el vehículo
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'RECORTE SUBCHASIS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card modificacion-subchasis">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Modificación / Recorte de Subchasis</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Tipo de modificación (ej. Reducción de longitud de espada)"
                    [(ngModel)]="mod.tipoModificacionSubchasis"
                    name="tipoModificacionSubchasis{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.tipoModificacionSubchasis
                    "
                  />
                  <label>TIPO DE MODIFICACIÓN</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Descripción del punto de corte (ej. hasta la última unión...)"
                    style="height: 100px"
                    [(ngModel)]="mod.descripcionCorteSubchasis"
                    name="descripcionCorteSubchasis{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.descripcionCorteSubchasis
                    "
                  ></textarea>
                  <label>DESCRIPCIÓN DEL PUNTO DE CORTE / LÍMITE</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <h6 class="card-title small text-muted fw-bold mb-3">
                      IMPLICACIONES
                    </h6>

                    <div class="form-check form-switch mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="anulaPlazasSubchasis{{ i }}"
                        [(ngModel)]="mod.anulaPlazasTraserasSubchasis"
                        name="anulaPlazasTraserasSubchasis{{ i }}"
                      />
                      <label
                        class="form-check-label"
                        for="anulaPlazasSubchasis{{ i }}"
                      >
                        El recorte implica la eliminación de la plaza trasera
                        (Monoplaza)
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'TORRETAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-torretas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Torretas de Manillar</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaTorretas"
                    name="marcaTorretas{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaTorretas"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES (mm)</label
                >
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.medidaLargoTorretas"
                    name="medidaLargoTorretas{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaLargoTorretas
                    "
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Ancho (mm)"
                    [(ngModel)]="mod.medidaAnchoTorretas"
                    name="medidaAnchoTorretas{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaAnchoTorretas
                    "
                  />
                  <label>ANCHO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto (mm)"
                    [(ngModel)]="mod.medidaAltoTorretas"
                    name="medidaAltoTorretas{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.medidaAltoTorretas
                    "
                  />
                  <label>ALTO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'MANDO ACELERADOR' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-acelerador">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Mando de Acelerador</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAcelerador"
                    name="marcaAcelerador{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaAcelerador"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloAcelerador"
                    name="modeloAcelerador{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloAcelerador"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="alert alert-warning mb-0">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="retornoAutomatico{{ i }}"
                      [(ngModel)]="mod.retornoAutomaticoAcelerador"
                      name="retornoAutomaticoAcelerador{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.retornoAutomaticoAcelerador
                      "
                    />
                    <label
                      class="form-check-label small fw-bold"
                      for="retornoAutomatico{{ i }}"
                    >
                      El mando dispone de un retorno automático a la posición de
                      reposo (Comprobación obligatoria)
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'MANDOS LUCES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-mandos">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Mandos / Botoneras</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaMandoLuces"
                    name="marcaMandoLuces{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaMandoLuces"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloMandoLuces"
                    name="modeloMandoLuces{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloMandoLuces"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >FUNCIONES INCORPORADAS</label
                >
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Funciones Izquierda (ej. Ráfaga, intermitencia...)"
                    style="height: 120px"
                    [(ngModel)]="mod.funcionesIzquierdoMandoLuces"
                    name="funcionesIzquierdoMandoLuces{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.funcionesIzquierdoMandoLuces
                    "
                  ></textarea>
                  <label>MANDO IZQUIERDO (Funciones)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <textarea
                    class="form-control"
                    placeholder="Funciones Derecha (ej. Arranque, paro...)"
                    style="height: 120px"
                    [(ngModel)]="mod.funcionesDerechoMandoLuces"
                    name="funcionesDerechoMandoLuces{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.funcionesDerechoMandoLuces
                    "
                  ></textarea>
                  <label>MANDO DERECHO (Funciones)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'AUMENTO DE PLAZAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card reduccion-plazas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Reducción de Plazas de Asiento</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Plazas Antes"
                    [(ngModel)]="mod.plazasAntesReduccion"
                    name="plazasAntesReduccion{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="
                      formSubmitted && !mod.plazasAntesReduccion
                    "
                  />
                  <label>Nº PLAZAS ANTES</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Plazas Después"
                    [(ngModel)]="mod.plazasDespuesReduccion"
                    name="plazasDespuesReduccion{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="
                      formSubmitted && !mod.plazasDespuesReduccion
                    "
                  />
                  <label>Nº PLAZAS DESPUÉS</label>
                </div>
              </div>

              @if (mod.plazasDespuesReduccion == 1) {
              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <h6 class="card-title small text-muted fw-bold mb-3">
                      ADAPTACIÓN A MONOPLAZA (Obligatorio)
                    </h6>

                    <div class="form-check form-switch mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="desinstalacionAsidero{{ i }}"
                        [(ngModel)]="mod.desinstalacionAsideroReduccion"
                        name="desinstalacionAsideroReduccion{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.desinstalacionAsideroReduccion
                        "
                      />
                      <label
                        class="form-check-label"
                        for="desinstalacionAsidero{{ i }}"
                      >
                        Desinstalación del asidero / sistema de sujeción del
                        pasajero
                      </label>
                    </div>

                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="desinstalacionEstriberas{{ i }}"
                        [(ngModel)]="mod.desinstalacionEstriberasReduccion"
                        name="desinstalacionEstriberasReduccion{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted &&
                          !mod.desinstalacionEstriberasReduccion
                        "
                      />
                      <label
                        class="form-check-label"
                        for="desinstalacionEstriberas{{ i }}"
                      >
                        Desinstalación de las estriberas del pasajero
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REDUCCIÓN DE PLAZAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card reduccion-plazas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Reducción de Plazas de Asiento</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Plazas Antes"
                    [(ngModel)]="mod.plazasAntesReduccion"
                    name="plazasAntesReduccion{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="
                      formSubmitted && !mod.plazasAntesReduccion
                    "
                  />
                  <label>Nº PLAZAS ANTES</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Plazas Después"
                    [(ngModel)]="mod.plazasDespuesReduccion"
                    name="plazasDespuesReduccion{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="
                      formSubmitted && !mod.plazasDespuesReduccion
                    "
                  />
                  <label>Nº PLAZAS DESPUÉS</label>
                </div>
              </div>

              @if (mod.plazasDespuesReduccion == 1) {
              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <h6 class="card-title small text-muted fw-bold mb-3">
                      ADAPTACIÓN A MONOPLAZA (Obligatorio)
                    </h6>

                    <div class="form-check form-switch mb-2">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="desinstalacionAsidero{{ i }}"
                        [(ngModel)]="mod.desinstalacionAsideroReduccion"
                        name="desinstalacionAsideroReduccion{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.desinstalacionAsideroReduccion
                        "
                      />
                      <label
                        class="form-check-label"
                        for="desinstalacionAsidero{{ i }}"
                      >
                        Desinstalación del asidero / sistema de sujeción del
                        pasajero
                      </label>
                    </div>

                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="desinstalacionEstriberas{{ i }}"
                        [(ngModel)]="mod.desinstalacionEstriberasReduccion"
                        name="desinstalacionEstriberasReduccion{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted &&
                          !mod.desinstalacionEstriberasReduccion
                        "
                      />
                      <label
                        class="form-check-label"
                        for="desinstalacionEstriberas{{ i }}"
                      >
                        Desinstalación de las estriberas del pasajero
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'ASIENTO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-asiento">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Asiento / Sillín</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label text-muted small fw-bold"
                  >PROCEDENCIA DEL ASIENTO</label
                >
                <div class="d-flex gap-4">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="tipoOrigenAsiento{{ i }}"
                      id="origenArtesanal{{ i }}"
                      value="artesanal"
                      [(ngModel)]="mod.tipoOrigenAsiento"
                    />
                    <label
                      class="form-check-label"
                      for="origenArtesanal{{ i }}"
                    >
                      Artesanal
                    </label>
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="tipoOrigenAsiento{{ i }}"
                      id="origenComercial{{ i }}"
                      value="comercial"
                      [(ngModel)]="mod.tipoOrigenAsiento"
                    />
                    <label
                      class="form-check-label"
                      for="origenComercial{{ i }}"
                    >
                      Marca y Referencia
                    </label>
                  </div>
                </div>
              </div>

              @if (mod.tipoOrigenAsiento === 'comercial') {
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAsiento"
                    name="marcaAsiento{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaAsiento"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaAsiento"
                    name="referenciaAsiento{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaAsiento"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
              }
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE BASCULANTE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-basculante">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Basculante</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca Procedencia"
                    [(ngModel)]="mod.marcaBasculante"
                    name="marcaBasculante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaBasculante"
                  />
                  <label>MARCA PROCEDENCIA</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Denominación Comercial"
                    [(ngModel)]="mod.modeloBasculante"
                    name="modeloBasculante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloBasculante"
                  />
                  <label>DENOMINACIÓN COMERCIAL</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Contraseña Homologación"
                    [(ngModel)]="mod.contrasenaBasculante"
                    name="contrasenaBasculante{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.contrasenaBasculante
                    "
                  />
                  <label>CONTRASEÑA HOMOLOGACIÓN</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="notaIntegridad{{ i }}"
                        [(ngModel)]="mod.incluirNotaIntegridadBasculante"
                        name="incluirNotaIntegridadBasculante{{ i }}"
                      />
                      <label
                        class="form-check-label fw-bold text-primary"
                        for="notaIntegridad{{ i }}"
                      >
                        Incluir nota de integridad estructural y compatibilidad
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- SUSPENSIÓN -->
      @if (mod.nombre === 'SUSPENSIÓN' && mod.seleccionado &&
      datosEntrada.tipoVehiculo === 'moto') {
      <div class="mb-3">
        <section class="mod-card suspension-moto">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Suspensión</h4>
            <span class="mod-card__hint"
              >Datos de identificación del componente</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marca"
                  name="marcaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referencia"
                  name="referenciaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                />
                <label>REFERENCIA</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- SUSTITUCIÓN GUARDABARROS -->
      @if (mod.nombre === 'SUSTITUCIÓN GUARDABARROS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-guardabarros">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Guardabarros</h4>
            <span class="mod-card__hint"
              >Especificaciones de guardabarros delantero y trasero</span
            >
          </div>

          @if (mod.guardabarrosDelantero) {
          <div class="p-3 border bg-light mb-4">
            <h6
              class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
            >
              Guardabarros Delantero
            </h6>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    [(ngModel)]="mod.tipoFabricacionGuardabarrosDelantero"
                    name="tipoFabricacionGuardabarrosDelantero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.tipoFabricacionGuardabarrosDelantero
                    "
                  >
                    <option value="" disabled selected>
                      -- SELECCIONAR --
                    </option>
                    <option value="comercial">Marca y Referencia</option>
                    <option value="artesanal">Fabricación Artesanal</option>
                  </select>
                  <label>TIPO DE FABRICACIÓN</label>
                </div>
              </div>

              @if (mod.tipoFabricacionGuardabarrosDelantero === 'comercial') {
              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaDelantero"
                    name="marcaDelantero{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaDelantero"
                  />
                  <label>MARCA</label>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ref"
                    [(ngModel)]="mod.referenciaDelantero"
                    name="referenciaDelantero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.referenciaDelantero
                    "
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
              }

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Dimensiones"
                    [(ngModel)]="mod.dimensionesDelantero"
                    name="dimensionesDelantero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.dimensionesDelantero
                    "
                  />
                  <label>DIMENSIONES (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    [(ngModel)]="mod.metrica"
                    name="metrica{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && mod.metrica == null"
                  >
                    <option [ngValue]="null" disabled selected>
                      -- SELECCIONAR --
                    </option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label>MÉTRICA TORNILLOS</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    placeholder="Curvatura"
                    [(ngModel)]="mod.curvaturaGuardaDelantMoto"
                    name="curvaturaGuardaDelantMoto{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.curvaturaGuardaDelantMoto == null
                    "
                  />
                  <label>RATIO CURVATURA MÍN.</label>
                </div>
              </div>
            </div>
          </div>
          } @if (mod.guardabarrosTrasero) {
          <div class="p-3 border bg-light">
            <h6
              class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
            >
              Guardabarros Trasero
            </h6>
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    [(ngModel)]="mod.tipoFabricacionGuardabarrosTrasero"
                    name="tipoFabricacionGuardabarrosTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.tipoFabricacionGuardabarrosTrasero
                    "
                  >
                    <option value="" disabled selected>
                      -- SELECCIONAR --
                    </option>
                    <option value="comercial">Marca y Referencia</option>
                    <option value="artesanal">Fabricación Artesanal</option>
                  </select>
                  <label>TIPO DE FABRICACIÓN</label>
                </div>
              </div>

              @if (mod.tipoFabricacionGuardabarrosTrasero === 'comercial') {
              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcatRasero"
                    name="marcatRasero{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcatRasero"
                  />
                  <label>MARCA</label>
                </div>
              </div>
              <div class="col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ref"
                    [(ngModel)]="mod.referenciaTrasero"
                    name="referenciaTrasero{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaTrasero"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
              }

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Dimensiones"
                    [(ngModel)]="mod.dimensionesTrasero"
                    name="dimensionesTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.dimensionesTrasero
                    "
                  />
                  <label>DIMENSIONES (mm)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    [(ngModel)]="mod.metrica"
                    name="metrica{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && mod.metrica == null"
                  >
                    <option [ngValue]="null" disabled selected>
                      -- SELECCIONAR --
                    </option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label>MÉTRICA TORNILLOS</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    placeholder="Curvatura"
                    [(ngModel)]="mod.curvaturaGuardaTrasMoto"
                    name="curvaturaGuardaTrasMoto{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.curvaturaGuardaTrasMoto == null
                    "
                  />
                  <label>RATIO CURVATURA MÍN.</label>
                </div>
              </div>
            </div>
          </div>
          }
        </section>
      </div>
      }
      <!-- MANILLAR -->
      @if (mod.nombre === 'MANILLAR' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card manillar">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Manillar</h4>
            <span class="mod-card__hint"
              >Especificaciones y dimensiones de dirección</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marca"
                  name="marcaManillar{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modelo"
                  name="modeloManillar{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modelo"
                />
                <label>MODELO</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medidas"
                  [(ngModel)]="mod.medidasManillar"
                  name="medidasManillar{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasManillar"
                />
                <label>MEDIDAS</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.01"
                  class="form-control"
                  placeholder="Curvatura"
                  id="curv-manillar-{{ i }}"
                  [(ngModel)]="mod.curvaturaManillar"
                  name="curvaturaManillar{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.curvaturaManillar == null
                  "
                />
                <label>RATIO CURVATURA MÍN.</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- LATIGUILLOS -->
      @if (mod.nombre === 'LATIGUILLOS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card latiguillos">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Latiguillos</h4>
            <span class="mod-card__hint"
              >Conductos de freno metálicos o blindados</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-6 border-end-md">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Eje Delantero
              </h6>
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaDelanteros"
                      name="marcaDelanteros{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaDelanteros"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaDelanteros"
                      name="referenciaDelanteros{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaDelanteros
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Eje Trasero
              </h6>
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaTraseros"
                      name="marcaTraseros{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaTraseros"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaTraseros"
                      name="referenciaTraseros{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaTraseros
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- RETROVISORES -->
      @if (mod.nombre === 'RETROVISORES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card retrovisores">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Retrovisores</h4>
            <span class="mod-card__hint"
              >Espejos y dispositivos de visión indirecta</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marca"
                  name="marcaRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modelo"
                  name="modeloRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modelo"
                />
                <label>MODELO</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marcaje"
                  [(ngModel)]="mod.marcaje"
                  name="marcajeRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaje"
                />
                <label>MARCAJE</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacion"
                  name="homologacionRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacion"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- HORQUILLA DELANTERA -->
      @if (mod.nombre === 'HORQUILLA DELANTERA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card horquilla-delantera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Horquilla Delantera</h4>
            <span class="mod-card__hint"
              >Datos de identificación y especificaciones</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marca"
                  name="marcaHorquilla{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                />
                <label>MARCA</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Tipo"
                  [(ngModel)]="mod.tipo"
                  name="tipoHorquilla{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.tipo"
                />
                <label>TIPO</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Variante"
                  [(ngModel)]="mod.variante"
                  name="varianteHorquilla{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.variante"
                />
                <label>VARIANTE</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Denominación"
                  [(ngModel)]="mod.denominacion"
                  name="denominacionHorquilla{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.denominacion"
                />
                <label>DENOMINACIÓN COMERCIAL</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- DISCO DE FRENO Y PINZA DE FRENO -->
      @if (mod.nombre === 'DISCO DE FRENO Y PINZA DE FRENO' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card frenos-disco">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sistema de Frenado</h4>
            <span class="mod-card__hint">Discos y pinzas de freno</span>
          </div>

          <div class="row g-4">
            <div class="col-12">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >¿QUÉ COMPONENTE SE HA MODIFICADO?</label
              >
              <div class="d-flex gap-4">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="tieneDisco{{ i }}"
                    [(ngModel)]="mod.tieneDisco"
                    name="tieneDisco{{ i }}"
                  />
                  <label class="form-check-label" for="tieneDisco{{ i }}"
                    >DISCO DE FRENO</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="tienePastilla{{ i }}"
                    [(ngModel)]="mod.tienePastilla"
                    name="tienePastilla{{ i }}"
                  />
                  <label class="form-check-label" for="tienePastilla{{ i }}"
                    >PINZA DE FRENO</label
                  >
                </div>
              </div>
              <div
                class="text-danger mt-2 small fw-bold"
                *ngIf="formSubmitted && !mod.tieneDisco && !mod.tienePastilla"
              >
                <i class="bi bi-exclamation-triangle"></i> Debes seleccionar al
                menos una opción.
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            @if (mod.tieneDisco) {
            <div class="col-12">
              <h5 class="mb-3 fw-bold text-uppercase">Disco de Freno</h5>

              <div class="d-flex gap-4 mb-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="discoDelantero{{ i }}"
                    [(ngModel)]="mod.discoDelantero"
                    name="discoDelantero{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.discoDelantero"
                  />
                  <label class="form-check-label" for="discoDelantero{{ i }}"
                    >DELANTERO</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="discoTrasero{{ i }}"
                    [(ngModel)]="mod.discoTrasero"
                    name="discoTrasero{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.discoTrasero"
                  />
                  <label class="form-check-label" for="discoTrasero{{ i }}"
                    >TRASERO</label
                  >
                </div>
              </div>

              <div class="row g-3">
                @if (mod.discoDelantero) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-light h-100">
                    <h6
                      class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                    >
                      Eje Delantero
                    </h6>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaDiscoDelantero"
                        name="marcaDiscoDelantero{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaDiscoDelantero
                        "
                      />
                      <label>MARCA</label>
                    </div>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Referencia"
                        [(ngModel)]="mod.referenciaDiscoDelantero"
                        name="referenciaDiscoDelantero{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaDiscoDelantero
                        "
                      />
                      <label>REFERENCIA</label>
                    </div>
                    <div class="form-floating">
                      <select
                        class="form-select"
                        [(ngModel)]="mod.metrica"
                        name="metrica{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && mod.metrica == null
                        "
                      >
                        <option [value]="null" disabled selected>
                          -- SELECCIONAR --
                        </option>
                        @for (num of metricasTornillos; track num) {
                        <option [value]="num">{{ num }}</option>
                        }
                      </select>
                      <label>MÉTRICA TORNILLOS</label>
                    </div>
                  </div>
                </div>
                } @if (mod.discoTrasero) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-light h-100">
                    <h6
                      class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                    >
                      Eje Trasero
                    </h6>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaDiscoTrasero"
                        name="marcaDiscoTrasero{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaDiscoTrasero
                        "
                      />
                      <label>MARCA</label>
                    </div>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Referencia"
                        [(ngModel)]="mod.referenciaDiscoTrasero"
                        name="referenciaDiscoTrasero{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaDiscoTrasero
                        "
                      />
                      <label>REFERENCIA</label>
                    </div>
                    <div class="form-floating">
                      <select
                        class="form-select"
                        [(ngModel)]="mod.metrica"
                        name="metrica{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && mod.metrica == null
                        "
                      >
                        <option [value]="null" disabled selected>
                          -- SELECCIONAR --
                        </option>
                        @for (num of metricasTornillos; track num) {
                        <option [value]="num">{{ num }}</option>
                        }
                      </select>
                      <label>MÉTRICA TORNILLOS</label>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
            }

            <div class="col-12"><hr class="mod-sep" /></div>

            @if (mod.tienePastilla) {
            <div class="col-12">
              <h5 class="mb-3 fw-bold text-uppercase">Pinza de Freno</h5>

              <div class="d-flex gap-4 mb-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="pastillaDelantera{{ i }}"
                    [(ngModel)]="mod.pastillaDelantera"
                    name="pastillaDelantera{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.pastillaDelantera"
                  />
                  <label class="form-check-label" for="pastillaDelantera{{ i }}"
                    >DELANTERO</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="pastillaTrasera{{ i }}"
                    [(ngModel)]="mod.pastillaTrasera"
                    name="pastillaTrasera{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.pastillaTrasera"
                  />
                  <label class="form-check-label" for="pastillaTrasera{{ i }}"
                    >TRASERO</label
                  >
                </div>
              </div>

              <div class="row g-3">
                @if (mod.pastillaDelantera) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-light h-100">
                    <h6
                      class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                    >
                      Eje Delantero
                    </h6>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaPastillaDelantera"
                        name="marcaPastillaDelantera{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaPastillaDelantera
                        "
                      />
                      <label>MARCA</label>
                    </div>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Referencia"
                        [(ngModel)]="mod.referenciaPastillaDelantera"
                        name="referenciaPastillaDelantera{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaPastillaDelantera
                        "
                      />
                      <label>REFERENCIA</label>
                    </div>
                    <div class="form-floating">
                      <select
                        class="form-select"
                        [(ngModel)]="mod.metrica"
                        name="metrica{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && mod.metrica == null
                        "
                      >
                        <option [value]="null" disabled selected>
                          -- SELECCIONAR --
                        </option>
                        @for (num of metricasTornillos; track num) {
                        <option [value]="num">{{ num }}</option>
                        }
                      </select>
                      <label>MÉTRICA TORNILLOS</label>
                    </div>
                  </div>
                </div>
                } @if (mod.pastillaTrasera) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-light h-100">
                    <h6
                      class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                    >
                      Eje Trasero
                    </h6>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaPastillaTrasera"
                        name="marcaPastillaTrasera{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaPastillaTrasera
                        "
                      />
                      <label>MARCA</label>
                    </div>
                    <div class="form-floating mb-2">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Referencia"
                        [(ngModel)]="mod.referenciaPastillaTrasera"
                        name="referenciaPastillaTrasera{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaPastillaTrasera
                        "
                      />
                      <label>REFERENCIA</label>
                    </div>
                    <div class="form-floating">
                      <select
                        class="form-select"
                        [(ngModel)]="mod.metrica"
                        name="metrica{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && mod.metrica == null
                        "
                      >
                        <option [value]="null" disabled selected>
                          -- SELECCIONAR --
                        </option>
                        @for (num of metricasTornillos; track num) {
                        <option [value]="num">{{ num }}</option>
                        }
                      </select>
                      <label>MÉTRICA TORNILLOS</label>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      }
      <!-- LUCES -->
      @if (mod.nombre === 'LUCES' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card luces-grupo">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sistema de Iluminación</h4>
            <span class="mod-card__hint"
              >Especificaciones de grupos ópticos</span
            >
          </div>

          <div class="row g-4">
            @if(mod.descripcionLuces.luzGrupoOptico){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Grupo Óptico Delantero
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaluzGrupoOptico"
                        name="marcaluzGrupoOptico{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Modelo"
                        [(ngModel)]="mod.modeloluzGrupoOptico"
                        name="modeloluzGrupoOptico{{ i }}"
                        required
                      />
                      <label>MODELO</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ref"
                        [(ngModel)]="mod.referencialuzGrupoOptico"
                        name="referencialuzGrupoOptico{{ i }}"
                        required
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marcajes"
                        [(ngModel)]="mod.marcajesluzGrupoOptico"
                        name="marcajesluzGrupoOptico{{ i }}"
                        required
                      />
                      <label>MARCAJES</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacionluzGrupoOptico"
                        name="homologacionluzGrupoOptico{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        placeholder="Curvatura"
                        [(ngModel)]="mod.curvaturaluzGrupoOptico"
                        name="curvaturaluzGrupoOptico{{ i }}"
                        required
                      />
                      <label>RATIO CURVATURA</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            } @if(mod.descripcionLuces.intermitenteDelantero){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Intermitentes Delanteros
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaintermitenteDelantero"
                        name="marcaintermitenteDelantero{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ref"
                        [(ngModel)]="mod.referenciaintermitenteDelantero"
                        name="referenciaintermitenteDelantero{{ i }}"
                        required
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marcajes"
                        [(ngModel)]="mod.marcajesintermitenteDelantero"
                        name="marcajesintermitenteDelantero{{ i }}"
                        required
                      />
                      <label>MARCAJES</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacionintermitenteDelantero"
                        name="homologacionintermitenteDelantero{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        placeholder="Curvatura"
                        [(ngModel)]="mod.curvaturaintermitenteDelantero"
                        name="curvaturaintermitenteDelantero{{ i }}"
                        required
                      />
                      <label>RATIO CURVATURA</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            } @if(mod.descripcionLuces.intermitenteTrasero){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Intermitentes Traseros
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaintermitenteTrasero"
                        name="marcaintermitenteTrasero{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ref"
                        [(ngModel)]="mod.referenciaintermitenteTrasero"
                        name="referenciaintermitenteTrasero{{ i }}"
                        required
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marcajes"
                        [(ngModel)]="mod.marcajesintermitenteTrasero"
                        name="marcajesintermitenteTrasero{{ i }}"
                        required
                      />
                      <label>MARCAJES</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacionintermitenteTrasero"
                        name="homologacionintermitenteTrasero{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        placeholder="Curvatura"
                        [(ngModel)]="mod.curvaturaintermitenteTrasero"
                        name="curvaturaintermitenteTrasero{{ i }}"
                        required
                      />
                      <label>RATIO CURVATURA</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            } @if(mod.descripcionLuces.catadioptrico){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Catadióptricos
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcacatadioptrico"
                        name="marcacatadioptrico{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ref"
                        [(ngModel)]="mod.referenciacatadioptrico"
                        name="referenciacatadioptrico{{ i }}"
                        required
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacioncatadioptrico"
                        name="homologacioncatadioptrico{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        placeholder="Curvatura"
                        [(ngModel)]="mod.curvaturacatadioptrico"
                        name="curvaturacatadioptrico{{ i }}"
                        required
                      />
                      <label>RATIO CURVATURA</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            } @if(mod.descripcionLuces.luzMatricula){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Luz de Matrícula
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaluzMatricula"
                        name="marcaluzMatricula{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ref"
                        [(ngModel)]="mod.referencialuzMatricula"
                        name="referencialuzMatricula{{ i }}"
                        required
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacionluzMatricula"
                        name="homologacionluzMatricula{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            } @if(mod.descripcionLuces.luzAntinieblas){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Luz Antiniebla Delantera
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaluzAntinieblas"
                        name="marcaluzAntinieblas{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marcajes"
                        [(ngModel)]="mod.marcajesluzAntinieblas"
                        name="marcajesluzAntinieblas{{ i }}"
                        required
                      />
                      <label>MARCAJES</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacionluzAntinieblas"
                        name="homologacionluzAntinieblas{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="number"
                        step="0.01"
                        class="form-control"
                        placeholder="Curvatura"
                        [(ngModel)]="mod.curvaturaluzAntinieblas"
                        name="curvaturaluzAntinieblas{{ i }}"
                        required
                      />
                      <label>RATIO CURVATURA</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            } @if(mod.descripcionLuces.luzFreno){
            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Luz de Freno
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaluzFreno"
                        name="marcaluzFreno{{ i }}"
                        required
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ref"
                        [(ngModel)]="mod.referencialuzFreno"
                        name="referencialuzFreno{{ i }}"
                        required
                      />
                      <label>REFERENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Homo"
                        [(ngModel)]="mod.homologacionluzFreno"
                        name="homologacionluzFreno{{ i }}"
                        required
                      />
                      <label>HOMOLOGACIÓN</label>
                    </div>
                  </div>
                  <div class="col-12">
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        [(ngModel)]="mod.luzMatriculaIntegradaLuzFreno"
                        name="luzMatriculaIntegradaLuzFreno{{ i }}"
                        id="luzMatriculaIntegradaLuzFreno{{ i }}"
                      />
                      <label
                        class="form-check-label"
                        for="luzMatriculaIntegradaLuzFreno{{ i }}"
                      >
                        Luz de matrícula integrada
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      }
      <!-- CAMPERS -->

      @if (mod.nombre === 'REDUCCIÓN DE MMA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card bajada-mma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Disminución de Masa Máxima Admisible (MMA)
            </h4>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="p-3 bg-light border d-flex align-items-center">
                <i class="bi bi-info-circle-fill text-primary me-3 fs-4"></i>
                <div>
                  <h6 class="text-uppercase fw-bold mb-1 small">
                    Nota Informativa
                  </h6>
                  <p class="mb-0 text-muted small">
                    La MMA antes y después será recogida en los siguientes pasos
                    del proceso.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REDUCCIÓN DE MMTA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card bajada-mma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Disminución de Masa Máxima Técnicamente Admisible (MMTA)
            </h4>
          </div>

          <div class="row">
            <div class="col-12">
              <div class="p-3 bg-light border d-flex align-items-center">
                <i class="bi bi-info-circle-fill text-primary me-3 fs-4"></i>
                <div>
                  <h6 class="text-uppercase fw-bold mb-1 small">
                    Nota Informativa
                  </h6>
                  <p class="mb-0 text-muted small">
                    La MMTA antes y después será recogida en los siguientes
                    pasos del proceso.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE VOLANTE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-ejes">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Volante</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaVolante"
                    name="marcaVolante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaVolante"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Diámetro (mm)"
                    [(ngModel)]="mod.diametroVolante"
                    name="diametroVolante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.diametroVolante"
                  />
                  <label>DIÁMETRO (mm)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-2" />
              </div>

              <div class="col-md-6 d-flex align-items-center">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="checkEspaciador{{ i }}"
                    [(ngModel)]="mod.llevaEspaciador"
                    name="llevaEspaciador{{ i }}"
                  />
                  <label class="form-check-label" for="checkEspaciador{{ i }}">
                    ¿Instala espaciador / piña?
                  </label>
                </div>
              </div>

              @if (mod.llevaEspaciador) {
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca espaciador"
                    [(ngModel)]="mod.marcaEspaciador"
                    name="marcaEspaciador{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.llevaEspaciador &&
                      !mod.marcaEspaciador
                    "
                  />
                  <label>MARCA ESPACIADOR</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Espesor espaciador"
                    [(ngModel)]="mod.espesorEspaciador"
                    name="espesorEspaciador{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.llevaEspaciador &&
                      !mod.espesorEspaciador
                    "
                  />
                  <label>ESPESOR ESPACIADOR (mm)</label>
                </div>
              </div>
              }

              <div class="col-12">
                <hr class="text-muted my-2" />
                <h6 class="text-muted mb-3 small">SISTEMA DE AIRBAG</h6>
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="airbagOriginal{{ i }}"
                    [(ngModel)]="mod.tieneAirbagOriginal"
                    name="tieneAirbagOriginal{{ i }}"
                  />
                  <label class="form-check-label" for="airbagOriginal{{ i }}">
                    El volante original tenía Airbag
                  </label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="airbagNuevo{{ i }}"
                    [(ngModel)]="mod.tieneAirbagNuevo"
                    name="tieneAirbagNuevo{{ i }}"
                  />
                  <label class="form-check-label" for="airbagNuevo{{ i }}">
                    El volante nuevo mantiene Airbag
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'PARAGOLPES TRASERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card paragolpes-trasero">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Paragolpes Trasero</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgt-fab-{{ i }}"
                      [(ngModel)]="mod.tipoFabricacionParagolpesTrasero"
                      name="tipoFabricacionParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.tipoFabricacionParagolpesTrasero
                      "
                    >
                      <option value="" disabled selected>
                        Seleccione una opción
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="artesanal">
                        Fabricado en acero de forma artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.tipoFabricacionParagolpesTrasero === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaParagolpesTrasero"
                      name="marcaParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaParagolpesTrasero
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaParagolpesTrasero"
                      name="referenciaParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaParagolpesTrasero
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                }

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasParagolpesTrasero"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'medidasParagolpesTrasero',
                          'anchuraMParagolpesTrasero',
                          'alturaMParagolpesTrasero'
                        )
                      "
                      name="medidasParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasParagolpesTrasero
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-metricaParaTrasero-{{ i }}"
                      [(ngModel)]="mod.metricaParaTrasero"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaParaTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaParaTrasero == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosParagolpesTrasero"
                      name="nTornillosParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.nTornillosParagolpesTrasero
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloParagolpesTrasero"
                      name="calidadTornilloParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.calidadTornilloParagolpesTrasero
                      "
                    />
                    <label>CALIDAD TORNILLO</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgParagolpesTrasero"
                      name="pesoPiezaKgParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.pesoPiezaKgParagolpesTrasero
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraMParagolpesTrasero"
                      name="anchuraMParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.anchuraMParagolpesTrasero
                      "
                    />
                    <label>ANCHURA (m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaMParagolpesTrasero"
                      name="alturaMParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.alturaMParagolpesTrasero
                      "
                    />
                    <label>ALTURA (m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsParagolpesTrasero"
                      name="seccionResistenteAsParagolpesTrasero{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.seccionResistenteAsParagolpesTrasero == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="
                        mod.resTraccionMinTornillo88Kgmm2ParagolpesTrasero
                      "
                      name="resTraccionMinTornillo88Kgmm2ParagolpesTrasero{{
                        i
                      }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      max="2"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.coefAerodinamicoParagolpesTrasero"
                      name="coefAerodinamicoParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefAerodinamicoParagolpesTrasero == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3ParagolpesTrasero"
                      name="densidadAireKgM3ParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.densidadAireKgM3ParagolpesTrasero == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msParagolpesTrasero"
                      name="velocidadAireV2msParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.velocidadAireV2msParagolpesTrasero == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="1"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRParagolpesTrasero"
                      name="radioCurvaRParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.radioCurvaRParagolpesTrasero == null
                      "
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.1"
                      min="1"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKParagolpesTrasero"
                      name="coefSeguridadKParagolpesTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefSeguridadKParagolpesTrasero == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'PARAGOLPES DELANTERO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card paragolpes-delantero">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Paragolpes Delantero</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-tipo-{{ i }}"
                      [(ngModel)]="mod.tipoFabricacionParagolpesDelantero"
                      name="tipoFabricacionParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.tipoFabricacionParagolpesDelantero
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="artesanal">
                        Fabricado en acero de forma artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.tipoFabricacionParagolpesDelantero === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaParagolpes"
                      name="marcaParagolpes{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaParagolpes"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaParagolpes"
                      name="referenciaParagolpes{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaParagolpes
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                }

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasParagolpesDelantero"
                      name="medidasParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasParagolpesDelantero
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="pgd-metricaParaDelantero-{{ i }}"
                      [(ngModel)]="mod.metricaParaDelantero"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaParaDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaParaDelantero == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.ntornillosParaDelantero"
                      name="ntornillosParaDelantero"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.ntornillosParaDelantero
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgParagolpesDelantero"
                      name="pesoPiezaKgParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.pesoPiezaKgParagolpesDelantero == null
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Superficie"
                      [(ngModel)]="mod.superficieFrontalM2ParagolpesDelantero"
                      name="superficieFrontalM2ParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.superficieFrontalM2ParagolpesDelantero == null
                      "
                    />
                    <label>SUPERFICIE (m²)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsParagolpesDelantero"
                      name="seccionResistenteAsParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.seccionResistenteAsParagolpesDelantero == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="
                        mod.resTraccionMinTornillo88Kgmm2ParagolpesDelantero
                      "
                      name="resTraccionMinTornillo88Kgmm2ParagolpesDelantero{{
                        i
                      }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN. (Kg/mm²)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.cwCoefAerodinamicoParagolpesDelantero"
                      name="cwCoefAerodinamicoParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.cwCoefAerodinamicoParagolpesDelantero == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3ParagolpesDelantero"
                      name="densidadAireKgM3ParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.densidadAireKgM3ParagolpesDelantero == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msParagolpesDelantero"
                      name="velocidadAireV2msParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.velocidadAireV2msParagolpesDelantero == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRParagolpesDelantero"
                      name="radioCurvaRParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.radioCurvaRParagolpesDelantero == null
                      "
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKParagolpesDelantero"
                      name="coefSeguridadKParagolpesDelantero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted &&
                        mod.coefSeguridadKParagolpesDelantero == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'ESTRIBOS LATERALES O TALONERAS' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card estribos-laterales">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Estribos Laterales o Taloneras</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcataloneras"
                      name="marcataloneras{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcataloneras"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-material-{{ i }}"
                      [(ngModel)]="mod.materialEstribos"
                      name="materialEstribos{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.materialEstribos
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option value="acero">Acero</option>
                      <option value="plástico">Plástico</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>

                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Dimensiones"
                      [(ngModel)]="mod.dimensionesTaloneras"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'dimensionesTaloneras',
                          'anchuraMEstribos',
                          'alturaMEstribos'
                        )
                      "
                      name="dimensionesTaloneras{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.dimensionesTaloneras
                      "
                    />
                    <label>DIMENSIONES (ej: 150x600mm)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgEstribos"
                      name="pesoPiezaKgEstribos{{ i }}"
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraMEstribos"
                      name="anchuraMEstribos{{ i }}"
                      readonly
                    />
                    <label>ANCHURA (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaMEstribos"
                      name="alturaMEstribos{{ i }}"
                      readonly
                    />
                    <label>ALTURA (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.coefAerodinamicoEstribos"
                      name="coefAerodinamicoEstribos{{ i }}"
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-metricaTalonera-{{ i }}"
                      [(ngModel)]="mod.metricaTalonera"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaTalonera{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaTalonera == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosEstribos"
                      name="nTornillosEstribos"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.nTornillosEstribos
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloEstribos"
                      name="calidadTornilloEstribos{{ i }}"
                      readonly
                    />
                    <label>CALIDAD TORNILLO</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsEstribos"
                      name="seccionResistenteAsEstribos{{ i }}"
                    />
                    <label>As (SECCIÓN RESISTENTE)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Estribos"
                      name="resTraccionMinTornillo88Kgmm2Estribos{{ i }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Cálculo Resistencia (Presión Aire)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3Estribos"
                      name="densidadAireKgM3Estribos{{ i }}"
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msEstribos"
                      name="velocidadAireV2msEstribos{{ i }}"
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="1"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaREstribos"
                      name="radioCurvaREstribos{{ i }}"
                    />
                    <label>R (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.1"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKEstribos"
                      name="coefSeguridadKEstribos{{ i }}"
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SOPORTE PARA RUEDA DE REPUESTO' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card rueda-repuesto">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Soporte para Rueda de Repuesto</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoFabricacionRuedaRepuesto"
                      name="tipoFabricacionRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.tipoFabricacionRuedaRepuesto
                      "
                    >
                      <option value="" disabled selected>
                        Seleccione una opción
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="artesanal">
                        Fabricado en acero de forma artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaRuedaRepuesto"
                      name="marcaRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaRuedaRepuesto
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaRuedaRepuesto"
                      name="referenciaRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaRuedaRepuesto
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                }

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasRuedaRepuesto"
                      name="medidasRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.medidasRuedaRepuesto
                      "
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Ratio"
                      [(ngModel)]="mod.curvaturaSoporteRuedaRepuesto"
                      name="curvaturaSoporteRuedaRepuesto{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.curvaturaSoporteRuedaRepuesto
                      "
                    />
                    <label>RATIO CURVATURA MÍN.</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metrica"
                      name="metrica{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && mod.metrica == null"
                    >
                      <option [value]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos"
                      required
                      [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'CABRESTANTE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card cabrestante">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Cabrestante</h4>
            <span class="mod-card__hint"
              >Datos de capacidad, material y unión al chasis</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaCabrestante"
                      name="marcaCabrestante{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaCabrestante
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="LB"
                      [(ngModel)]="mod.capacidadCabrestanteLb"
                      name="capacidadCabrestanteLb{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.capacidadCabrestanteLb == null
                      "
                    />
                    <label>CAPACIDAD ARRASTRE (LB)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Kg"
                      [(ngModel)]="mod.capacidadCabrestanteKg"
                      name="capacidadCabrestanteKg{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.capacidadCabrestanteKg == null
                      "
                    />
                    <label>CAPACIDAD ARRASTRE (Kg)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Elementos de Unión
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="cbr-metricaCabrestante-{{ i }}"
                      [(ngModel)]="mod.metricaCabrestante"
                      name="metricaCabrestante{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaCabrestante == null
                      "
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos"
                      required
                      [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Tiro Max"
                      [(ngModel)]="mod.tiroMaxCabrestanteKg"
                      name="tiroMaxCabrestanteKg{{ i }}"
                    />
                    <label>TIRO MÁX. (Kg)</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroPernoCmCabrestante"
                      name="diametroPernoCmCabrestante{{ i }}"
                    />
                    <label>DIÁMETRO PERNO (cm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Material"
                      [(ngModel)]="mod.materialPernoCabrestante"
                      name="materialPernoCabrestante{{ i }}"
                    />
                    <label>MATERIAL PERNO</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Tension"
                      [(ngModel)]="mod.tensionMinCortanteKgCm2Cabrestante"
                      name="tensionMinCortanteKgCm2Cabrestante{{ i }}"
                    />
                    <label>TENSIÓN CORTANTE (Kg/cm²)</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Unión al Chasis (Pernos)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº Pernos"
                      [(ngModel)]="mod.nPernosChasisCabrestante"
                      name="nPernosChasisCabrestante{{ i }}"
                    />
                    <label>Nº PERNOS</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroPernoChasisMmCabrestante"
                      name="diametroPernoChasisMmCabrestante{{ i }}"
                    />
                    <label>DIÁMETRO (mm)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Material"
                      [(ngModel)]="mod.materialPernoChasisCabrestante"
                      name="materialPernoChasisCabrestante{{ i }}"
                    />
                    <label>MATERIAL</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Tension"
                      [(ngModel)]="mod.tensionMinCortanteChasisKgCm2Cabrestante"
                      name="tensionMinCortanteChasisKgCm2Cabrestante{{ i }}"
                    />
                    <label>TENSIÓN (Kg/cm²)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'MATRÍCULA Y PORTAMATRÍCULA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card matricula">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Matrícula y Portamatrícula</h4>
            <span class="mod-card__hint"
              >Configuración de ubicación y soporte de placa</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                @if (mod.detalle.instalacionPorta) {
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Opción 1: Portamatrículas
                  </h6>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ubicacionPorta1"
                      name="ubicacionPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ubicacionPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="trasero">Trasero</option>
                      <option value="delantero">Delantero</option>
                    </select>
                    <label>UBICACIÓN</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ladoPorta1"
                      name="ladoPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ladoPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="derecho">Derecho</option>
                      <option value="izquierdo">Izquierdo</option>
                      <option value="centro">Centro</option>
                    </select>
                    <label>LADO</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.materialPorta1"
                      name="materialPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.materialPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="acero">Acero</option>
                      <option value="plástico">Plástico</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.fabricacionPorta1"
                      name="fabricacionPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.fabricacionPorta1 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="artesanal">Artesanal</option>
                      <option value="comprado">Comprado</option>
                    </select>
                    <label>FABRICACIÓN</label>
                  </div>
                </div>

                @if (mod.fabricacionPorta1 === 'comprado') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaPorta1"
                      name="marcaPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.marcaPorta1 === undefined
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Ref"
                      [(ngModel)]="mod.referenciaPorta1"
                      name="referenciaPorta1{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.referenciaPorta1 === undefined
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>
                } } @if (mod.detalle.instalacionPorta &&
                (mod.detalle.reubicacionTrasera ||
                mod.detalle.cambioUbicacionDelantera)) {
                <div class="col-12"><hr class="mod-sep" /></div>
                } @if (mod.detalle.reubicacionTrasera) {
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Opción 2: Reubicación Trasera
                  </h6>
                </div>

                <div class="col-md-8">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.portamatr2"
                      name="portamatr2{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.portamatr2 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="delantero">Delantero</option>
                      <option value="trasero">Trasero</option>
                    </select>
                    <label>PORTAMATRÍCULA</label>
                  </div>
                </div>
                <div class="col-md-4 d-flex align-items-center">
                  <div class="form-check mt-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.paragolpesNuevo2"
                      name="paragolpesNuevo2{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.paragolpesNuevo2 === undefined
                      "
                    />
                    <label class="form-check-label"
                      >¿ES NUEVO PARAGOLPES?</label
                    >
                  </div>
                </div>
                } @if ((mod.detalle.instalacionPorta ||
                mod.detalle.reubicacionTrasera) &&
                mod.detalle.cambioUbicacionDelantera) {
                <div class="col-12"><hr class="mod-sep" /></div>
                } @if (mod.detalle.cambioUbicacionDelantera) {
                <div class="col-12">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Opción 3: Cambio Ubicación Delantera
                  </h6>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ubicacionMat3"
                      name="ubicacionMat3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ubicacionMat3 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="delantera">Delantera</option>
                      <option value="trasera">Trasera</option>
                    </select>
                    <label>MATRÍCULA</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.materialMat3"
                      name="materialMat3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.materialMat3 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="Acrílica">Acrílica</option>
                      <option value="Metálica">Metálica</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasMat3"
                      name="medidasMat3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.medidasMat3 === undefined
                      "
                    />
                    <label>MEDIDAS</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.ubicacionBumper3"
                      name="ubicacionBumper3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.ubicacionBumper3 === undefined
                      "
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="derecho">Derecho</option>
                      <option value="izquierdo">Izquierdo</option>
                      <option value="centro">Centro</option>
                    </select>
                    <label>UBICACIÓN EN PARAGOLPES</label>
                  </div>
                </div>
                <div class="col-md-6 d-flex align-items-center">
                  <div class="form-check mt-2">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.paragolpesNuevo3"
                      name="paragolpesNuevo3{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.paragolpesNuevo3 === undefined
                      "
                    />
                    <label class="form-check-label"
                      >¿ES NUEVO PARAGOLPES?</label
                    >
                  </div>
                </div>
                }
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'NEUMÁTICOS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card neumaticos">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Neumáticos</h4>
            <span class="mod-card__hint"
              >Especificaciones de llantas y códigos de velocidad</span
            >
          </div>

          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medida"
                  [(ngModel)]="mod.medidas"
                  name="medidasNeumaticos{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidas"
                />
                <label>MEDIDA DE LAS LLANTAS</label>
              </div>
            </div>

            @if (mod.anotacion2) {
            <div class="col-12">
              <hr class="mod-sep" />
              <h6 class="text-muted fw-bold small text-uppercase mb-3">
                Cálculo de Índices de Velocidad
              </h6>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Vel Max Antes"
                  [(ngModel)]="mod.velocidadMaximaAntes"
                  name="velMaxAntes{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.velocidadMaximaAntes
                  "
                />
                <label>VELOCIDAD MÁX. VEHÍCULO</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Vel Max Despues"
                  [(ngModel)]="mod.velocidadMaximaDespues"
                  name="velMaxDespues{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.velocidadMaximaDespues
                  "
                />
                <label>VELOCIDAD MÁX. NEUMÁTICOS</label>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      }
      <!-- ALETINES Y SOBREALETINES -->
      @if (mod.nombre === 'ALETINES Y SOBREALETINES' && mod.seleccionado) {
      <div class="mb-3">
        @if (mod.detalle?.aletines) {
        <section class="mod-card aletines">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Aletines</h4>
            <span class="mod-card__hint"
              >Parámetros de instalación y dimensiones de aletines</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaAletines"
                      name="marcaAletines{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaAletines"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaAletines"
                      name="referenciaAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaAletines
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchoAletines"
                      name="anchoAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.anchoAletines == null
                      "
                    />
                    <label>ANCHO (mm)</label>
                  </div>
                </div>
                <div class="col-md-8">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metricaAletines"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaAletines == null
                      "
                    >
                      <option [ngValue]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.numTornillosAletines"
                      name="numTornillosAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.numTornillosAletines == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgAletines"
                      name="pesoPiezaKgAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.pesoPiezaKgAletines == null
                      "
                    />
                    <label>PESO PIEZA (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Superficie"
                      [(ngModel)]="mod.superficieFrontalM2Aletines"
                      name="superficieFrontalM2Aletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.superficieFrontalM2Aletines == null
                      "
                    />
                    <label>SUPERFICIE FRONTAL (m²)</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.coefAerodinamicoCwAletines"
                      name="coefAerodinamicoCwAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.coefAerodinamicoCwAletines == null
                      "
                    />
                    <label>Cw (COEF. AERODINÁMICO)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msAletines"
                      name="velocidadAireV2msAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.velocidadAireV2msAletines == null
                      "
                    />
                    <label>V₂ = 140 km/h (m/s)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3Aletines"
                      name="densidadAireKgM3Aletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.densidadAireKgM3Aletines == null
                      "
                    />
                    <label>p (DENSIDAD AIRE)</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control"
                      placeholder="R"
                      [(ngModel)]="mod.radioCurvaRAletines"
                      name="radioCurvaRAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.radioCurvaRAletines == null
                      "
                    />
                    <label>R (RADIO CURVA, m)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKAletines"
                      name="coefSeguridadKAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.coefSeguridadKAletines == null
                      "
                    />
                    <label>K (COEF. SEGURIDAD)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      id="estr-rest-{{ i }}"
                      [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Aletines"
                      name="resTraccionMinTornillo88Kgmm2Aletines{{ i }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RES. TRACCIÓN MÍN. (Kg/mm²)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsAletines"
                      name="seccionResistenteAsAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.seccionResistenteAsAletines == null
                      "
                    />
                    <label>As (SECCIÓN RESISTENTE)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detalle?.sobrealetines) {
        <section class="mod-card sobrealetines">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sobrealetines</h4>
            <span class="mod-card__hint"
              >Parámetros de instalación y dimensiones de sobrealetines</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-sb-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-sb-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-sb-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-sb-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-sb-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-sb-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaSobreletines"
                      name="marcaSobreletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaSobreletines
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaSobreletines"
                      name="referenciaSobreletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaSobreletines
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchoSobrealetines"
                      name="anchoSobrealetines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.anchoSobrealetines == null
                      "
                    />
                    <label>ANCHO (mm)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Curvatura"
                      [(ngModel)]="mod.curvaturaSobrealetines"
                      name="curvaturaSobrealetines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.curvaturaSobrealetines == null
                      "
                    />
                    <label>RATIO CURVATURA MÍN.</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metricaSobrealetines"
                      name="metricaSobrealetines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaSobrealetines == null
                      "
                    >
                      <option [ngValue]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillos"
                      name="nTornillos{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.nTornillos == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
        }
      </div>
      } @if (mod.nombre === 'SEPARADORES DE RUEDA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Separadores de Rueda</h4>
            <span class="mod-card__hint"
              >Especificaciones de ensanchamiento de vías</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaSeparadores"
                      name="marcaSeparadores{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaSeparadores
                      "
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referenciaSeparadores"
                      name="referenciaSeparadores{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaSeparadores
                      "
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Grosor"
                      [(ngModel)]="mod.grosorSeparadores"
                      name="grosorSeparadores{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.grosorSeparadores
                      "
                    />
                    <label>GROSOR (mm)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'TODA LA CASUÍSTICA DE MUELLES, BALLESTAS Y ' +
      'AMORTIGUADORES QUE SE PUEDEN DAR' && mod.seleccionado) {
      <div class="mb-5">
        <h3 class="mb-4">Casuística de Suspensión</h3>

        @if (mod.detallesMuelles?.muelleDelanteroConRef) {
        <section class="mod-card muelle-delantero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Delantero (Con Referencia)</h4>
            <span class="mod-card__hint">Datos técnicos del muelle</span>
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroConRef"
                  name="marcaMuelleDelanteroConRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleDelanteroConRef"
                  name="referenciaMuelleDelanteroConRef{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-12"><hr class="mod-sep" /></div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorDelanteroRef"
                  name="diametroExteriorDelanteroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreDelanteroRef"
                  name="longitudLibreDelanteroRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraDelanteroRef"
                  name="diametroEspiraDelanteroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasDelanteroRef"
                  name="numeroEspirasDelanteroRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.muelleDelanteroSinRef) {
        <section class="mod-card muelle-delantero-sinref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Delantero (Sin Referencia)</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>
          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroSinRef"
                  name="marcaMuelleDelanteroSinRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorDelanteroSinRef"
                  name="diametroExteriorDelanteroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreDelanteroSinRef"
                  name="longitudLibreDelanteroSinRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraDelanteroSinRef"
                  name="diametroEspiraDelanteroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasDelanteroSinRef"
                  name="numeroEspirasDelanteroSinRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.muelleTraseroConRef) {
        <section class="mod-card muelle-trasero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Trasero (Con Referencia)</h4>
            <span class="mod-card__hint"
              >Datos técnicos del muelle trasero</span
            >
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroConRef"
                  name="marcaMuelleTraseroConRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleTraseroConRef"
                  name="referenciaMuelleTraseroConRef{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-12"><hr class="mod-sep" /></div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorTraseroRef"
                  name="diametroExteriorTraseroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreTraseroRef"
                  name="longitudLibreTraseroRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraTraseroRef"
                  name="diametroEspiraTraseroRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasTraseroRef"
                  name="numeroEspirasTraseroRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.muelleTraseroSinRef) {
        <section class="mod-card muelle-trasero-sinref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle Trasero (Sin Referencia)</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>
          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroSinRef"
                  name="marcaMuelleTraseroSinRef{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Ext"
                  [(ngModel)]="mod.diametroExteriorTraseroSinRef"
                  name="diametroExteriorTraseroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO EXT. (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Long Libre"
                  [(ngModel)]="mod.longitudLibreTraseroSinRef"
                  name="longitudLibreTraseroSinRef{{ i }}"
                  required
                />
                <label>LONGITUD LIBRE (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diam Espira"
                  [(ngModel)]="mod.diametroEspiraTraseroSinRef"
                  name="diametroEspiraTraseroSinRef{{ i }}"
                  required
                />
                <label>DIÁMETRO ESPIRA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº Espiras"
                  [(ngModel)]="mod.numeroEspirasTraseroSinRef"
                  name="numeroEspirasTraseroSinRef{{ i }}"
                  required
                />
                <label>Nº ESPIRAS</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.ballestaDelantera) {
        <section class="mod-card ballesta-delantera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Ballesta Delantera</h4>
            <span class="mod-card__hint">Especificaciones de ballestas</span>
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaBallestaDelantera"
                  name="marcaBallestaDelantera{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaBallestaDelantera"
                  name="referenciaBallestaDelantera{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="1"
                  class="form-control"
                  placeholder="Nº Hojas"
                  [(ngModel)]="mod.numHojasBallestaDelantera"
                  name="numHojasBallestaDelantera{{ i }}"
                  required
                />
                <label>Nº HOJAS</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Ancho"
                  [(ngModel)]="mod.anchoHojaBallestaDelantera"
                  name="anchoHojaBallestaDelantera{{ i }}"
                  required
                />
                <label>ANCHO HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorHojaBallestaDelantera"
                  name="espesorHojaBallestaDelantera{{ i }}"
                  required
                />
                <label>ESPESOR HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Longitud"
                  [(ngModel)]="mod.longitudBallestaDelantera"
                  name="longitudBallestaDelantera{{ i }}"
                  required
                />
                <label>LONGITUD TOTAL (mm)</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.ballestaTrasera) {
        <section class="mod-card ballesta-trasera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Ballesta Trasera</h4>
            <span class="mod-card__hint"
              >Especificaciones de ballestas traseras</span
            >
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaBallestaTrasera"
                  name="marcaBallestaTrasera{{ i }}"
                  required
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaBallestaTrasera"
                  name="referenciaBallestaTrasera{{ i }}"
                  required
                />
                <label>REFERENCIA</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="1"
                  class="form-control"
                  placeholder="Nº Hojas"
                  [(ngModel)]="mod.numHojasBallestaTrasera"
                  name="numHojasBallestaTrasera{{ i }}"
                  required
                />
                <label>Nº HOJAS</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Ancho"
                  [(ngModel)]="mod.anchoHojaBallestaTrasera"
                  name="anchoHojaBallestaTrasera{{ i }}"
                  required
                />
                <label>ANCHO HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorHojaBallestaTrasera"
                  name="espesorHojaBallestaTrasera{{ i }}"
                  required
                />
                <label>ESPESOR HOJA (mm)</label>
              </div>
            </div>
            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Longitud"
                  [(ngModel)]="mod.longitudBallestaTrasera"
                  name="longitudBallestaTrasera{{ i }}"
                  required
                />
                <label>LONGITUD TOTAL (mm)</label>
              </div>
            </div>
          </div>
        </section>
        } @if (mod.detallesMuelles?.amortiguadorDelantero ||
        mod.detallesMuelles?.amortiguadorTrasero) {
        <section class="mod-card amortiguadores">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Amortiguadores</h4>
          </div>
          <div class="row g-4">
            @if (mod.detallesMuelles?.amortiguadorDelantero) {
            <div class="col-12 col-lg-6">
              <div class="p-3 border h-100">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Delantero
                </h6>
                <div class="form-floating mb-2">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAmortiguadorDelantero"
                    name="marcaAmortiguadorDelantero{{ i }}"
                    required
                  />
                  <label>MARCA</label>
                </div>
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaAmortiguadorDelantero"
                    name="referenciaAmortiguadorDelantero{{ i }}"
                    required
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
            </div>
            } @if (mod.detallesMuelles?.amortiguadorTrasero) {
            <div class="col-12 col-lg-6">
              <div class="p-3 border h-100">
                <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                  Trasero
                </h6>
                <div class="form-floating mb-2">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAmortiguadorTrasero"
                    name="marcaAmortiguadorTrasero{{ i }}"
                    required
                  />
                  <label>MARCA</label>
                </div>
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaAmortiguadorTrasero"
                    name="referenciaAmortiguadorTrasero{{ i }}"
                    required
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
        } @if (mod.detallesMuelles?.tacosDeGoma) {
        <section class="mod-card tacos-goma">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Tacos de Goma</h4>
          </div>
          <div class="row g-4">
            <div class="col-12 d-flex gap-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="tacosDelantero{{ i }}"
                  [(ngModel)]="mod.tacosDelantero"
                  name="tacosDelantero{{ i }}"
                />
                <label class="form-check-label" for="tacosDelantero{{ i }}"
                  >Tacos Delanteros</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="tacosTrasero{{ i }}"
                  [(ngModel)]="mod.tacosTrasero"
                  name="tacosTrasero{{ i }}"
                />
                <label class="form-check-label" for="tacosTrasero{{ i }}"
                  >Tacos Traseros</label
                >
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            @if (mod.tacosDelantero) {
            <div class="col-12 col-md-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Delantero
              </h6>
              <div class="form-floating mb-2">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diámetro"
                  [(ngModel)]="mod.diametroTacoDelantero"
                  name="diametroTacoDelantero{{ i }}"
                  required
                />
                <label>DIÁMETRO (mm)</label>
              </div>
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorTacoDelantero"
                  name="espesorTacoDelantero{{ i }}"
                  required
                />
                <label>ESPESOR (mm)</label>
              </div>
            </div>
            } @if (mod.tacosTrasero) {
            <div class="col-12 col-md-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Trasero
              </h6>
              <div class="form-floating mb-2">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Diámetro"
                  [(ngModel)]="mod.diametroTacoTrasero"
                  name="diametroTacoTrasero{{ i }}"
                  required
                />
                <label>DIÁMETRO (mm)</label>
              </div>
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Espesor"
                  [(ngModel)]="mod.espesorTacoTrasero"
                  name="espesorTacoTrasero{{ i }}"
                  required
                />
                <label>ESPESOR (mm)</label>
              </div>
            </div>
            }
          </div>
        </section>
        } @if (mod.detallesMuelles?.kitElevacion) {
        <section class="mod-card kit-elevacion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Kit de Elevación</h4>
          </div>
          <div class="row g-4">
            <div class="col-12 d-flex gap-4">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="kitElevacionDelantero{{ i }}"
                  [(ngModel)]="mod.detallesMuelles.kitElevacionDelantero"
                  name="kitElevacionDelantero{{ i }}"
                />
                <label
                  class="form-check-label"
                  for="kitElevacionDelantero{{ i }}"
                  >Muelles Delanteros</label
                >
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="kitElevacionTrasero{{ i }}"
                  [(ngModel)]="mod.detallesMuelles.kitElevacionTrasero"
                  name="kitElevacionTrasero{{ i }}"
                />
                <label class="form-check-label" for="kitElevacionTrasero{{ i }}"
                  >Ballestas Traseras</label
                >
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            @if (mod.detallesMuelles.kitElevacionDelantero) {
            <div class="col-12 col-lg-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Delantero
              </h6>
              <div class="row g-2">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaKitElevacionDelantera"
                      name="marcaKitElevacion{{ i }}"
                      required
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoSuspensionDelantera"
                      name="tipoSuspensionDelantera{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="muelles">Muelles</option>
                      <option value="ballestas">Ballestas</option>
                    </select>
                    <label>TIPO SUSPENSIÓN</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoTacoDelantero"
                      name="tipoTacoDelantero{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="circular">Circular</option>
                      <option value="rectangular">Rectangular</option>
                    </select>
                    <label>TIPO TACO</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroTacoDelantero"
                      name="diametroTacoDelantero{{ i }}"
                      required
                    />
                    <label>DIÁM. (mm)</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Espesor"
                      [(ngModel)]="mod.espesorTacoDelantero"
                      name="espesorTacoDelantero{{ i }}"
                      required
                    />
                    <label>ESPESOR (mm)</label>
                  </div>
                </div>
              </div>
            </div>
            } @if (mod.detallesMuelles.kitElevacionTrasero) {
            <div class="col-12 col-lg-6">
              <h6 class="text-uppercase text-muted fw-bold mb-2 small">
                Eje Trasero
              </h6>
              <div class="row g-2">
                <div class="col-12">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaKitElevacionTrasera"
                      name="marcaKitElevacionTrasera{{ i }}"
                      required
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoSuspensionTrasera"
                      name="tipoSuspensionTrasera{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="muelles">Muelles</option>
                      <option value="ballestas">Ballestas</option>
                    </select>
                    <label>TIPO SUSPENSIÓN</label>
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.tipoTacoTrasero"
                      name="tipoTacoTrasero{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="circular">Circular</option>
                      <option value="rectangular">Rectangular</option>
                    </select>
                    <label>TIPO TACO</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Diam"
                      [(ngModel)]="mod.diametroTacoTrasero"
                      name="diametroTacoTrasero{{ i }}"
                      required
                    />
                    <label>DIÁM. (mm)</label>
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Espesor"
                      [(ngModel)]="mod.espesorTacoTrasero"
                      name="espesorTacoTrasero{{ i }}"
                      required
                    />
                    <label>ESPESOR (mm)</label>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
        }
      </div>
      } @if (mod.nombre === 'SUSTITUCIÓN DE DISCOS DE FRENO' &&
      mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card sustitucion-frenos">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sustitución de Discos de Freno</h4>
          </div>

          <div class="card-body">
            <div class="row mb-4">
              <div class="col-12">
                <label class="form-label fw-bold mb-2"
                  >UBICACIÓN DE LOS DISCOS A SUSTITUIR</label
                >
                <div class="d-flex gap-3">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionDiscos{{ i }}"
                      id="ubiDel{{ i }}"
                      value="delanteros"
                      [(ngModel)]="mod.ubicacionDiscos"
                    />
                    <label class="form-check-label" for="ubiDel{{ i }}"
                      >Delanteros</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionDiscos{{ i }}"
                      id="ubiTras{{ i }}"
                      value="traseros"
                      [(ngModel)]="mod.ubicacionDiscos"
                    />
                    <label class="form-check-label" for="ubiTras{{ i }}"
                      >Traseros</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="radio"
                      name="ubicacionDiscos{{ i }}"
                      id="ubiAmbos{{ i }}"
                      value="ambos"
                      [(ngModel)]="mod.ubicacionDiscos"
                    />
                    <label class="form-check-label" for="ubiAmbos{{ i }}"
                      >Delanteros y Traseros</label
                    >
                  </div>
                </div>
              </div>

              @if (mod.ubicacionDiscos === 'ambos') {
              <div class="col-12 mt-3">
                <div class="form-check form-switch bg-light p-2 rounded">
                  <input
                    class="form-check-input ms-0 me-2"
                    type="checkbox"
                    id="discosIguales{{ i }}"
                    [(ngModel)]="mod.sonIguales"
                  />
                  <label
                    class="form-check-label fw-bold"
                    for="discosIguales{{ i }}"
                  >
                    ¿Los discos delanteros y traseros son idénticos (misma
                    marca/medidas)?
                  </label>
                </div>
              </div>
              }
            </div>

            @if (mod.ubicacionDiscos) {

            <h6 class="text-primary border-bottom pb-2 mb-3">
              @if (mod.ubicacionDiscos === 'ambos' && !mod.sonIguales) { DATOS
              EJE DELANTERO } @else if (mod.ubicacionDiscos === 'traseros') {
              DATOS EJE TRASERO } @else { DATOS GENERALES DEL DISCO }
            </h6>

            <div class="row g-3">
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaDiscos"
                    name="marcaDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaDiscos"
                  />
                  <label>MARCA</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloDiscos"
                    name="modeloDiscos{{ i }}"
                  />
                  <label>MODELO</label>
                </div>
              </div>
              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaDiscos"
                    name="referenciaDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaDiscos"
                  />
                  <label>REFERENCIA</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Diámetro"
                    [(ngModel)]="mod.diametroDiscos"
                    name="diametroDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.diametroDiscos"
                  />
                  <label>DIÁMETRO (mm)</label>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Espesor"
                    [(ngModel)]="mod.espesorDiscos"
                    name="espesorDiscos{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.espesorDiscos"
                  />
                  <label>ESPESOR (mm)</label>
                </div>
              </div>
            </div>
            } @if (mod.ubicacionDiscos === 'ambos' && !mod.sonIguales) {
            <div class="mt-4">
              <h6 class="text-primary border-bottom pb-2 mb-3">
                DATOS EJE TRASERO
              </h6>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca Trasera"
                      [(ngModel)]="mod.marcaDiscoTrasero"
                      name="marcaDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.marcaDiscoTrasero
                      "
                    />
                    <label>MARCA (TRAS)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Modelo Trasero"
                      [(ngModel)]="mod.modeloDiscoTrasero"
                      name="modeloDiscoTrasero{{ i }}"
                    />
                    <label>MODELO (TRAS)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia Trasera"
                      [(ngModel)]="mod.referenciaDiscoTrasero"
                      name="referenciaDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.referenciaDiscoTrasero
                      "
                    />
                    <label>REFERENCIA (TRAS)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Diámetro Trasero"
                      [(ngModel)]="mod.diametroDiscoTrasero"
                      name="diametroDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.diametroDiscoTrasero
                      "
                    />
                    <label>DIÁMETRO TRASERO (mm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="number"
                      class="form-control"
                      placeholder="Espesor Trasero"
                      [(ngModel)]="mod.espesorDiscoTrasero"
                      name="espesorDiscoTrasero{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.espesorDiscoTrasero
                      "
                    />
                    <label>ESPESOR TRASERO (mm)</label>
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'DEFENSA DELANTERA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card defensa-delantera">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Defensa Delantera</h4>
            <span class="mod-card__hint"
              >Datos técnicos, fabricación y sujeción</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Características de la Pieza
              </h6>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaDefensa"
                  name="marcaDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaDefensa"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modeloDefensa"
                  name="modeloDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloDefensa"
                />
                <label>MODELO</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Grosor"
                  [(ngModel)]="mod.grosorTuboDefensa"
                  name="grosorTuboDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.grosorTuboDefensa"
                />
                <label>GROSOR TUBO (mm)</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medidas"
                  [(ngModel)]="mod.medidasDefensa"
                  name="medidasDefensa{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasDefensa"
                />
                <label>MEDIDAS (mm)</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ratio"
                  [(ngModel)]="mod.curvaturaDefensaDelantera"
                  name="curvaturaDefensaDelantera{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.curvaturaDefensaDelantera
                  "
                />
                <label>RATIO CURVATURA MÍN.</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-12">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Sujeción
              </h6>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA TORNILLOS</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'LUCES DE LARGO ALCANCE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card largo-alcance">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Luces de Largo Alcance</h4>
            <span class="mod-card__hint">Faros adicionales de carretera</span>
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marca"
                      name="marcaLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marca"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Referencia"
                      [(ngModel)]="mod.referencia"
                      name="referenciaLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.referencia"
                    />
                    <label>REFERENCIA</label>
                  </div>
                </div>

                <div class="col-12"><hr class="mod-sep" /></div>

                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marcaje"
                      [(ngModel)]="mod.marcaje"
                      name="marcajeLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaje"
                    />
                    <label>MARCAJE</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Homologación"
                      [(ngModel)]="mod.homologacion"
                      name="homologacionLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.homologacion"
                    />
                    <label>CONTRASEÑA HOMOLOGACIÓN</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Índice"
                      [(ngModel)]="mod.indiceReferencia"
                      name="indiceLargoAlcance{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.indiceReferencia
                      "
                    />
                    <label>ÍNDICE REF. (pdl/ud)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REDUCCIÓN DE PLAZAS' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Reducción de Plazas</h4>
            <span class="mod-card__hint"
              >Configuración de asientos y variaciones de capacidad</span
            >
          </div>

          <div class="row g-3">
            <div class="col-12">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="enclaje-{{ i }}"
                  placeholder="Descripción"
                  [(ngModel)]="mod.enclaje"
                  name="enclajePlaza{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.enclaje"
                />
                <label for="enclaje-{{ i }}"
                  >¿QUÉ PLAZA SE ELIMINA? (SE ELIMINARÁ...)</label
                >
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="plazasAntes-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.plazasAntes"
                  name="plazasAntes{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasAntes"
                />
                <label for="plazasAntes-{{ i }}">NÚMERO DE PLAZAS ANTES</label>
              </div>
            </div>

            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  id="plazasDespues-{{ i }}"
                  placeholder="0"
                  [(ngModel)]="mod.plazasDespues"
                  name="plazasDespues{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasDespues"
                />
                <label for="plazasDespues-{{ i }}"
                  >PLAZAS DESPUÉS DE REFORMA</label
                >
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'SNORKEL' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card snorkel">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Snorkel</h4>
            <span class="mod-card__hint"
              >Toma de aire elevada - Cálculos de resistencia</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12 col-md-4 border-end">
              <label
                class="form-label d-block mb-2 fw-bold text-uppercase small"
                >Tipo de acción</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                <i class="bi bi-exclamation-circle"></i> Debe seleccionar al
                menos una acción.
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="row g-3">
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Marca"
                      [(ngModel)]="mod.marcaSnorkel"
                      name="marcaSnorkel{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.marcaSnorkel"
                    />
                    <label>MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.materialSnorkel"
                      name="materialSnorkel{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.materialSnorkel"
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option value="goma">Goma</option>
                      <option value="plástico ABS">Plástico ABS</option>
                    </select>
                    <label>MATERIAL</label>
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Medidas"
                      [(ngModel)]="mod.medidasSnorkel"
                      (ngModelChange)="
                        onDimensionesChange(
                          mod,
                          'medidasSnorkel',
                          'anchuraPiezaMSnorkel',
                          'alturaPiezaMSnorkel'
                        )
                      "
                      name="medidasSnorkel{{ i }}"
                      required
                      [class.is-invalid]="formSubmitted && !mod.medidasSnorkel"
                    />
                    <label>MEDIDAS (mm)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.metricaSnorkel"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.metricaSnorkel == null
                      "
                    >
                      <option [ngValue]="null" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                    <label>MÉTRICA TORNILLOS</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Características de la Pieza
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Peso"
                      [(ngModel)]="mod.pesoPiezaKgSnorkel"
                      name="pesoPiezaKgSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.pesoPiezaKgSnorkel == null
                      "
                    />
                    <label>PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Ancho"
                      [(ngModel)]="mod.anchuraPiezaMSnorkel"
                      name="anchuraPiezaMSnorkel{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted && mod.anchuraPiezaMSnorkel == null
                      "
                    />
                    <label>ANCHO (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Alto"
                      [(ngModel)]="mod.alturaPiezaMSnorkel"
                      name="alturaPiezaMSnorkel{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted && mod.alturaPiezaMSnorkel == null
                      "
                    />
                    <label>ALTO (m)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Curvatura"
                      [(ngModel)]="mod.curvaturaSnorkel"
                      name="curvaturaSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.curvaturaSnorkel == null
                      "
                    />
                    <label>RATIO CURVATURA</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Cálculo Resistencia (Presión Aire)
                  </h6>
                </div>

                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="Cw"
                      [(ngModel)]="mod.cwCoefAerodinamicoSnorkel"
                      name="cwCoefAerodinamicoSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.cwCoefAerodinamicoSnorkel == null
                      "
                    />
                    <label>Cw (COEF.)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.0001"
                      min="0"
                      class="form-control"
                      placeholder="Densidad"
                      [(ngModel)]="mod.densidadAireKgM3Snorkel"
                      name="densidadAireKgM3Snorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.densidadAireKgM3Snorkel == null
                      "
                    />
                    <label>p (DENSIDAD)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="V2"
                      [(ngModel)]="mod.velocidadAireV2msSnorkel"
                      name="velocidadAireV2msSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.velocidadAireV2msSnorkel == null
                      "
                    />
                    <label>V₂ (m/s)</label>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="K"
                      [(ngModel)]="mod.coefSeguridadKSnorkel"
                      name="coefSeguridadKSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.coefSeguridadKSnorkel == null
                      "
                    />
                    <label>K (SEGURIDAD)</label>
                  </div>
                </div>

                <div class="col-12 mt-4">
                  <h6
                    class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
                  >
                    Datos de Sujeción
                  </h6>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      min="0"
                      class="form-control"
                      placeholder="Nº"
                      [(ngModel)]="mod.nTornillosSnorkel"
                      name="nTornillosSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.nTornillosSnorkel == null
                      "
                    />
                    <label>Nº TORNILLOS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Calidad"
                      [(ngModel)]="mod.calidadTornilloSnorkel"
                      name="calidadTornilloSnorkel{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && !mod.calidadTornilloSnorkel
                      "
                    />
                    <label>CALIDAD TORNILLO</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control"
                      placeholder="As"
                      [(ngModel)]="mod.seccionResistenteAsSnorkel"
                      name="seccionResistenteAsSnorkel{{ i }}"
                      required
                      readonly
                      [class.is-invalid]="
                        formSubmitted && mod.seccionResistenteAsSnorkel == null
                      "
                    />
                    <label>As (SECCIÓN)</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mod.resTraccionMinTornillo88Kgmm2Snorkel"
                      name="resTraccionMinTornillo88Kgmm2Snorkel{{ i }}"
                      required
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      <option [ngValue]="80">80</option>
                      <option [ngValue]="25">25</option>
                    </select>
                    <label>RESISTENCIA TRACCIÓN MÍN. (Kg/mm²)</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- CAMBIO DE CLASIFICACIÓN -->
      @if (mod.nombre === 'CAMBIO DE CLASIFICACIÓN' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card cambio-clasificacion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Cambio de Clasificación</h4>
            <span class="mod-card__hint"
              >Reclasificación administrativa del vehículo</span
            >
          </div>

          <div class="row">
            <div class="col-12">
              <div class="p-3 bg-light border d-flex align-items-center">
                <i class="bi bi-info-circle-fill text-primary me-3 fs-4"></i>
                <div>
                  <h6 class="text-uppercase fw-bold mb-1 small">
                    Nota Informativa
                  </h6>
                  <p class="mb-0 text-muted small">
                    La clasificación antes y después será recogida en los
                    siguientes pasos del proceso.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- AUMENTO O DISMINUCIÓN DE PLAZAS -->
      @if (mod.nombre === 'AUMENTO O DISMINUCIÓN DE PLAZAS' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card plazas">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Aumento o Disminución de Plazas</h4>
            <span class="mod-card__hint"
              >Configuración de capacidad de pasajeros</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.tipoCambio"
                  name="tipoCambio{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.tipoCambio"
                >
                  <option value="" disabled selected>-- SELECCIONAR --</option>
                  <option value="aumento">Aumento</option>
                  <option value="disminucion">Disminución</option>
                </select>
                <label>TIPO DE CAMBIO</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Antes"
                  [(ngModel)]="mod.plazasAntes"
                  name="plazasAntes{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasAntes"
                />
                <label>PLAZAS ANTES</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Después"
                  [(ngModel)]="mod.plazasDespues"
                  name="plazasDespues{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasDespues"
                />
                <label>PLAZAS DESPUÉS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'TECHO ELEVABLE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-techo">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Techo Elevable</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaTecho"
                    name="marcaTecho{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaTecho"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Referencia / Modelo"
                    [(ngModel)]="mod.referenciaTecho"
                    name="referenciaTecho{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.referenciaTecho"
                  />
                  <label>REFERENCIA / MODELO</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
                <label class="form-label text-muted small mt-2"
                  >DIMENSIONES DEL TECHO (mm)</label
                >
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Ancho (mm)"
                    [(ngModel)]="mod.anchoTecho"
                    name="anchoTecho{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.anchoTecho"
                  />
                  <label>ANCHO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Largo (mm)"
                    [(ngModel)]="mod.largoTecho"
                    name="largoTecho{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.largoTecho"
                  />
                  <label>LARGO (mm)</label>
                </div>
              </div>

              <div class="col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Alto Cerrado (mm)"
                    [(ngModel)]="mod.altoTecho"
                    name="altoTecho{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.altoTecho"
                  />
                  <label>ALTO/ESPESOR (mm)</label>
                </div>
              </div>

              <div class="col-12">
                <hr class="text-muted my-1" />
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Descripción estructura (ej. Base reforzada PRFV...)"
                    [(ngModel)]="mod.materialEstructuraTecho"
                    name="materialEstructuraTecho{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.materialEstructuraTecho
                    "
                  />
                  <label>DESCRIPCIÓN ESTRUCTURA (Material)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Tipo accionamiento (ej. Manual)"
                    [(ngModel)]="mod.tipoAccionamientoTecho"
                    name="tipoAccionamientoTecho{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.tipoAccionamientoTecho
                    "
                  />
                  <label>TIPO ACCIONAMIENTO</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Distancia Asientos-Suelo (mm)"
                    [(ngModel)]="mod.distanciaAsientosSueloTecho"
                    name="distanciaAsientosSueloTecho{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.distanciaAsientosSueloTecho
                    "
                  />
                  <label>DISTANCIA ASIENTOS AL SUELO (mm)</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'REVESTIMIENTO INTERIOR' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card revestimiento-interior">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Revestimiento Interior y Suelo</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-12">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  AISLAMIENTO Y PANELADO
                </h6>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material Panelado (ej. Madera / Contrachapado)"
                    [(ngModel)]="mod.materialPaneladoRevestimiento"
                    name="materialPaneladoRevestimiento{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.materialPaneladoRevestimiento
                    "
                  />
                  <label>MATERIAL PANELADO (ej. Madera)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material Aislamiento (ej. Kaiflex)"
                    [(ngModel)]="mod.materialAislamientoRevestimiento"
                    name="materialAislamientoRevestimiento{{ i }}"
                  />
                  <label>MATERIAL AISLAMIENTO (Opcional)</label>
                </div>
              </div>

              <div class="col-12">
                <label class="form-label fw-bold small text-muted"
                  >UBICACIÓN DEL REVESTIMIENTO</label
                >
                <div class="d-flex gap-3 flex-wrap">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="checkTecho{{ i }}"
                      [(ngModel)]="mod.zonaTechoRevestimiento"
                      name="zonaTechoRevestimiento{{ i }}"
                    />
                    <label class="form-check-label" for="checkTecho{{ i }}"
                      >Techo</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="checkLaterales{{ i }}"
                      [(ngModel)]="mod.zonaLateralesRevestimiento"
                      name="zonaLateralesRevestimiento{{ i }}"
                    />
                    <label class="form-check-label" for="checkLaterales{{ i }}"
                      >Laterales</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      id="checkSuelo{{ i }}"
                      [(ngModel)]="mod.zonaSueloRevestimiento"
                      name="zonaSueloRevestimiento{{ i }}"
                    />
                    <label class="form-check-label" for="checkSuelo{{ i }}"
                      >Suelo (Base)</label
                    >
                  </div>
                </div>
                @if (formSubmitted && !mod.zonaTechoRevestimiento &&
                !mod.zonaLateralesRevestimiento && !mod.zonaSueloRevestimiento)
                {
                <div class="text-danger small mt-1">
                  Seleccione al menos una zona a revestir.
                </div>
                }
              </div>

              <div class="col-12 mt-4">
                <h6 class="text-primary border-bottom pb-2 mb-3">
                  SUELO / TARIMA
                </h6>

                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="instalaTarima{{ i }}"
                    [(ngModel)]="mod.instalaTarimaRevestimiento"
                    name="instalaTarimaRevestimiento{{ i }}"
                  />
                  <label
                    class="form-check-label fw-bold"
                    for="instalaTarima{{ i }}"
                  >
                    Instalación de tarima o suelo decorativo
                  </label>
                </div>
              </div>

              @if (mod.instalaTarimaRevestimiento) {
              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material Tarima (ej. Vinílico / Flotante)"
                    [(ngModel)]="mod.materialTarimaRevestimiento"
                    name="materialTarimaRevestimiento{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted &&
                      mod.instalaTarimaRevestimiento &&
                      !mod.materialTarimaRevestimiento
                    "
                  />
                  <label>MATERIAL TARIMA (ej. Suelo vinílico)</label>
                </div>
              </div>
              }
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'INSTALACIÓN DE TERMO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-termo">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Termo / Boiler</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaTermo"
                    name="marcaTermo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaTermo"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloTermo"
                    name="modeloTermo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloTermo"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Capacidad (Litros)"
                    [(ngModel)]="mod.capacidadTermo"
                    name="capacidadTermo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.capacidadTermo"
                  />
                  <label>CAPACIDAD (Litros)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ubicación (ej. Lateral izquierdo trasero)"
                    [(ngModel)]="mod.ubicacionTermo"
                    name="ubicacionTermo{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.ubicacionTermo"
                  />
                  <label>UBICACIÓN</label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'BANQUETA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-banqueta">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Instalación de Banqueta / Asiento Adicional
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaBanqueta"
                    name="marcaBanqueta{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaBanqueta"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloBanqueta"
                    name="modeloBanqueta{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloBanqueta"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Material (ej. Acero)"
                    [(ngModel)]="mod.materialBanqueta"
                    name="materialBanqueta{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.materialBanqueta"
                  />
                  <label>MATERIAL ESTRUCTURA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="Nº Plazas"
                    [(ngModel)]="mod.numeroPlazasBanqueta"
                    name="numeroPlazasBanqueta{{ i }}"
                    required
                    min="1"
                    [class.is-invalid]="
                      formSubmitted && !mod.numeroPlazasBanqueta
                    "
                  />
                  <label>Nº DE PLAZAS</label>
                </div>
              </div>

              <div class="col-12">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ubicación (ej. Delantera izquierda zona vivienda)"
                    [(ngModel)]="mod.ubicacionBanqueta"
                    name="ubicacionBanqueta{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.ubicacionBanqueta"
                  />
                  <label>UBICACIÓN</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="card bg-light border-0">
                  <div class="card-body">
                    <div class="form-check form-switch">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        id="usoEstacionario{{ i }}"
                        [(ngModel)]="mod.esUsoEstacionarioBanqueta"
                        name="esUsoEstacionarioBanqueta{{ i }}"
                      />
                      <label
                        class="form-check-label fw-bold"
                        for="usoEstacionario{{ i }}"
                      >
                        Habilitada únicamente para uso en estacionario
                      </label>
                    </div>

                    @if (mod.esUsoEstacionarioBanqueta) {
                    <div class="alert alert-warning mt-3 mb-0 p-2 small">
                      <i class="bi bi-exclamation-triangle me-2"></i>
                      Al seleccionar esta opción, se declara que la banqueta
                      <strong>no dispone de cinturones de seguridad</strong> y
                      no puede ser utilizada con el vehículo en marcha.
                    </div>
                    }
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'ENGANCHE REMOLQUE' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-enganche">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Enganche de Remolque</h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca (ej. ENGANCHES ARAGON)"
                    [(ngModel)]="mod.marcaEnganche"
                    name="marcaEnganche{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaEnganche"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Clase (ej. A50-X)"
                    [(ngModel)]="mod.claseEnganche"
                    name="claseEnganche{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.claseEnganche"
                  />
                  <label>CLASE (ej. A50-X)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Contraseña Homologación"
                    [(ngModel)]="mod.contrasenaEnganche"
                    name="contrasenaEnganche{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.contrasenaEnganche
                    "
                  />
                  <label>CONTRASEÑA HOMOLOGACIÓN</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    placeholder="MMR (Kg)"
                    [(ngModel)]="mod.mmrEnganche"
                    name="mmrEnganche{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.mmrEnganche"
                  />
                  <label>MMR (Kg)</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="emplazamientoOriginal{{ i }}"
                    [(ngModel)]="mod.enEmplazamientoOriginalEnganche"
                    name="enEmplazamientoOriginalEnganche{{ i }}"
                  />
                  <label
                    class="form-check-label"
                    for="emplazamientoOriginal{{ i }}"
                  >
                    Instalado en emplazamiento de homologación (Puntos
                    originales)
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      } @if (mod.nombre === 'ANTENA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-antena">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Instalación de Antena Parabólica / TV
            </h4>
          </div>

          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaAntena"
                    name="marcaAntena{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaAntena"
                  />
                  <label>MARCA</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Modelo"
                    [(ngModel)]="mod.modeloAntena"
                    name="modeloAntena{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.modeloAntena"
                  />
                  <label>MODELO</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Tipo (ej. Abatible automática)"
                    [(ngModel)]="mod.tipoAntena"
                    name="tipoAntena{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.tipoAntena"
                  />
                  <label>TIPO (ej. Abatible)</label>
                </div>
              </div>

              <div class="col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    placeholder="Ubicación (ej. Techo)"
                    [(ngModel)]="mod.ubicacionAntena"
                    name="ubicacionAntena{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.ubicacionAntena"
                  />
                  <label>UBICACIÓN</label>
                </div>
              </div>

              <div class="col-12 mt-3">
                <div class="form-check form-switch">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="sinAfectacionEstructural{{ i }}"
                    [(ngModel)]="mod.sinAfectacionEstructuralAntena"
                    name="sinAfectacionEstructuralAntena{{ i }}"
                  />
                  <label
                    class="form-check-label text-secondary"
                    for="sinAfectacionEstructural{{ i }}"
                  >
                    La instalación no afecta a la estructura del vehículo (sin
                    cortar travesaños/nervios)
                  </label>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>
      }

      <!-- SUSTITUCIÓN DE BANQUETA DE ASIENTOS POR ASIENTO INDIVIDUAL -->
      @if (mod.nombre === BANQUETA_INDIVIDUAL && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card banqueta-asiento">
          <div class="mod-card__header">
            <h4 class="mod-card__title">
              Sustitución de Banqueta por Asiento Individual
            </h4>
            <span class="mod-card__hint"
              >Datos del nuevo asiento y configuración de plazas</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaAsiento"
                  name="marcaAsiento{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaAsiento"
                />
                <label>MARCA DEL ASIENTO</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.contrasenaAsiento"
                  name="contrasenaAsiento{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.contrasenaAsiento"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Plazas"
                  [(ngModel)]="mod.plazasAsiento"
                  name="plazasAsiento{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.plazasAsiento"
                />
                <label>PLAZAS DE LA VARIANTE</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.posicionAsiento"
                  name="posicionAsiento{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.posicionAsiento"
                >
                  <option value="" disabled selected>-- SELECCIONAR --</option>
                  <option value="delanteras">Delanteras</option>
                  <option value="traseras">Traseras</option>
                </select>
                <label>POSICIÓN</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- INSTALACIÓN DE BASES GIRATORIAS -->
      @if (mod.nombre === 'INSTALACIÓN DE BASES GIRATORIAS' && mod.seleccionado)
      {
      <div class="mb-3">
        <section class="mod-card bases-giratorias">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación de Bases Giratorias</h4>
            <span class="mod-card__hint"
              >Datos de homologación y referencias</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaBaseGiratoria"
                  name="marcaBaseGiratoria{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaBaseGiratoria"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacionBase"
                  name="homologacionBase{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacionBase"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ref Conductor"
                  [(ngModel)]="mod.referenciaConductor"
                  name="referenciaConductor{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referenciaConductor"
                />
                <label>REFERENCIA (CONDUCTOR)</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ref Acompañante"
                  [(ngModel)]="mod.referenciaAcompanante"
                  name="referenciaAcompanante{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaAcompanante
                  "
                />
                <label>REFERENCIA (ACOMPAÑANTE)</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA TORNILLOS</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- CALEFACCIÓN ESTACIONARIA -->
      @if (mod.nombre === 'CALEFACCIÓN ESTACIONARIA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card calefaccion">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Calefacción Estacionaria</h4>
            <span class="mod-card__hint"
              >Equipo de calefacción independiente</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaCalefaccion"
                  name="marcaCalefaccion{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaCalefaccion"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modeloCalefaccion"
                  name="modeloCalefaccion{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloCalefaccion"
                />
                <label>MODELO</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacionCalefaccion"
                  name="homologacionCalefaccion{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.homologacionCalefaccion
                  "
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-12">
              <h6
                class="text-uppercase text-muted small fw-bold border-bottom pb-1 mb-3"
              >
                Detalles de Instalación
              </h6>
              <div class="form-floating">
                <textarea
                  class="form-control"
                  style="height: 150px"
                  [(ngModel)]="mod.descripcionCalefaccion"
                  name="descripcionCalefaccion{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.descripcionCalefaccion
                  "
                  placeholder="Descripción de la ubicación"
                ></textarea>
                <label>DESCRIPCIÓN (UBICACIÓN Y SALIDA DE GASES)</label>
              </div>
              <div class="form-text small text-muted mt-2">
                <i class="bi bi-info-circle me-1"></i> Ej: El calentador se
                sitúa en la parte delantera izquierda...
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- MOBILIARIO INTERIOR VEHÍCULO -->
      @if (mod.nombre === 'MOBILIARIO INTERIOR VEHÍCULO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card mobiliario">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Mobiliario Interior Vehículo</h4>
            <span class="mod-card__hint">Gestión de muebles y tornillería</span>
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="diametro-tornillo-{{ i }}"
                  [(ngModel)]="mod.diametroTornilloSeleccionado"
                  name="diametroTornilloSeleccionado{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                  @for (t of tornillosDB; track t.diametro) {
                  <option [ngValue]="t.diametro">{{ t.diametro }} mm</option>
                  }
                </select>
                <label for="diametro-tornillo-{{ i }}"
                  >DIÁMETRO DE TORNILLO</label
                >
              </div>
            </div>

            @if (mod.diametroTornilloSeleccionado) {
            <div class="col-md-6">
              <div
                class="p-3 bg-light border h-100 d-flex flex-column justify-content-center"
              >
                <div class="row text-muted small text-uppercase fw-bold">
                  <div class="col-4">
                    Tensión:
                    <span class="text-dark"
                      >{{ getTornilloActivo(mod)?.seccionTension }} mm²</span
                    >
                  </div>
                  <div class="col-4">
                    Par:
                    <span class="text-dark"
                      >{{ getTornilloActivo(mod)?.parAprete }} N·mm</span
                    >
                  </div>
                  <div class="col-4">
                    Carga:
                    <span class="text-dark"
                      >{{ getTornilloActivo(mod)?.cargaMax }} Kg</span
                    >
                  </div>
                </div>
              </div>
            </div>
            }
          </div>

          <div class="col-12"><hr class="mod-sep" /></div>

          @if (mod.opcionesMueble?.muebleBajo) {
          <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="text-uppercase text-muted fw-bold mb-0">
                Mueble Bajo
              </h6>
              <div>
                <button
                  type="button"
                  class="btn btn-success btn-sm"
                  (click)="anadirMueble(mod, 'bajo')"
                >
                  <i class="bi bi-plus-lg me-1"></i> AÑADIR
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm ms-2"
                  (click)="borrarUltimoMueble(mod, 'bajo')"
                >
                  <i class="bi bi-trash me-1"></i> BORRAR ÚLTIMO
                </button>
              </div>
            </div>

            @for (mueble of mod.mueblesBajo; track mueble; let j = $index) {
            <div class="p-3 border bg-light mb-3 position-relative">
              <span
                class="position-absolute top-0 end-0 badge bg-secondary rounded-0 m-2"
                >#{{ j + 1 }}</span
              >
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasBajo-{{ j }}"
                      [(ngModel)]="mueble.medidas"
                      name="medidas{{ j }}"
                      placeholder="Ej: 600x1420x900"
                    />
                    <label for="medidasBajo-{{ j }}">MEDIDAS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoBajo-{{ j }}"
                      [(ngModel)]="mueble.pesoMuebleBajo"
                      name="pesoMuebleBajo{{ j }}"
                      placeholder="Peso"
                    />
                    <label for="pesoBajo-{{ j }}">PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosBajo-{{ j }}"
                      [(ngModel)]="mueble.tornillosMuebleBajo"
                      name="tornillosMuebleBajo{{ j }}"
                      placeholder="Cantidad"
                    />
                    <label for="tornillosBajo-{{ j }}"
                      >CANTIDAD TORNILLOS</label
                    >
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mueble.tipoFabricacionMuebleBajo"
                      name="tipoFabricacionMuebleBajo{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="aceroArtesanal">
                        Fabricado en acero artesanal
                      </option>
                      <option value="maderaArtesanal">
                        Fabricado en madera artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mueble.tipoFabricacionMuebleBajo === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="marcaBajo-{{ j }}"
                      [(ngModel)]="mueble.marcaMuebleBajo"
                      name="marcaMuebleBajo{{ i }}"
                      placeholder="Marca"
                    />
                    <label for="marcaBajo-{{ j }}">MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="refBajo-{{ j }}"
                      [(ngModel)]="mueble.referenciaMuebleBajo"
                      name="referenciaMuebleBajo{{ i }}"
                      placeholder="Ref"
                    />
                    <label for="refBajo-{{ j }}">REFERENCIA</label>
                  </div>
                </div>
                }
              </div>
            </div>
            }
          </div>
          }

          <div class="col-12"><hr class="mod-sep" /></div>

          @if (mod.opcionesMueble?.muebleAlto) {
          <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="text-uppercase text-muted fw-bold mb-0">
                Mueble Alto
              </h6>
              <div>
                <button
                  type="button"
                  class="btn btn-success btn-sm"
                  (click)="anadirMueble(mod, 'alto')"
                >
                  <i class="bi bi-plus-lg me-1"></i> AÑADIR
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm ms-2"
                  (click)="borrarUltimoMueble(mod, 'alto')"
                >
                  <i class="bi bi-trash me-1"></i> BORRAR ÚLTIMO
                </button>
              </div>
            </div>

            @for (mueble of mod.mueblesAlto; track mueble; let j = $index) {
            <div class="p-3 border bg-light mb-3 position-relative">
              <span
                class="position-absolute top-0 end-0 badge bg-secondary rounded-0 m-2"
                >#{{ j + 1 }}</span
              >
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasAlto-{{ j }}"
                      [(ngModel)]="mueble.medidas"
                      name="medidasAlto{{ j }}"
                      placeholder="Ej: 1250x405x325"
                    />
                    <label for="medidasAlto-{{ j }}">MEDIDAS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoAlto-{{ j }}"
                      [(ngModel)]="mueble.pesoMuebleAlto"
                      name="pesoMuebleAlto{{ j }}"
                      placeholder="Peso"
                    />
                    <label for="pesoAlto-{{ j }}">PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosAlto-{{ j }}"
                      [(ngModel)]="mueble.tornillosMuebleAlto"
                      name="tornillosMuebleAlto{{ j }}"
                      placeholder="Cantidad"
                    />
                    <label for="tornillosAlto-{{ j }}"
                      >CANTIDAD TORNILLOS</label
                    >
                  </div>
                </div>
                <div class="col-md-12">
                  <div class="form-floating">
                    <select
                      class="form-select"
                      [(ngModel)]="mueble.tipoFabricacionMuebleAlto"
                      name="tipoFabricacionMuebleAlto{{ i }}"
                      required
                    >
                      <option value="" disabled selected>
                        -- SELECCIONAR --
                      </option>
                      <option value="comercial">Marca y Referencia</option>
                      <option value="aceroArtesanal">
                        Fabricado en acero artesanal
                      </option>
                      <option value="maderaArtesanal">
                        Fabricado en madera artesanal
                      </option>
                    </select>
                    <label>TIPO DE FABRICACIÓN</label>
                  </div>
                </div>

                @if (mueble.tipoFabricacionMuebleAlto === 'comercial') {
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="marcaAlto-{{ j }}"
                      [(ngModel)]="mueble.marcaMuebleAlto"
                      name="marcaMuebleAlto{{ i }}"
                      placeholder="Marca"
                    />
                    <label for="marcaAlto-{{ j }}">MARCA</label>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="refAlto-{{ j }}"
                      [(ngModel)]="mueble.referenciaMuebleAlto"
                      name="referenciaMuebleAlto{{ i }}"
                      placeholder="Ref"
                    />
                    <label for="refAlto-{{ j }}">REFERENCIA</label>
                  </div>
                </div>
                }
              </div>
            </div>
            }
          </div>
          }

          <div class="col-12"><hr class="mod-sep" /></div>

          @if (mod.opcionesMueble?.aseo) {
          <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h6 class="text-uppercase text-muted fw-bold mb-0">Aseo</h6>
              <div>
                <button
                  type="button"
                  class="btn btn-success btn-sm"
                  (click)="anadirMueble(mod, 'aseo')"
                >
                  <i class="bi bi-plus-lg me-1"></i> AÑADIR
                </button>
                <button
                  type="button"
                  class="btn btn-outline-danger btn-sm ms-2"
                  (click)="borrarUltimoMueble(mod, 'aseo')"
                >
                  <i class="bi bi-trash me-1"></i> BORRAR ÚLTIMO
                </button>
              </div>
            </div>

            @for (aseo of mod.mueblesAseo; track aseo; let j = $index) {
            <div class="p-3 border bg-light mb-3 position-relative">
              <span
                class="position-absolute top-0 end-0 badge bg-secondary rounded-0 m-2"
                >#{{ j + 1 }}</span
              >
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasAseo-{{ j }}"
                      [(ngModel)]="aseo.medidas"
                      name="medidasAseo{{ j }}"
                      placeholder="Medidas"
                      required
                    />
                    <label for="medidasAseo-{{ j }}">MEDIDAS</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoAseo-{{ j }}"
                      [(ngModel)]="aseo.pesoMuebleAseo"
                      name="pesoMuebleAseo{{ j }}"
                      placeholder="Peso"
                    />
                    <label for="pesoAseo-{{ j }}">PESO (Kg)</label>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosAseo-{{ j }}"
                      [(ngModel)]="aseo.tornillosMuebleAseo"
                      name="tornillosMuebleAseo{{ j }}"
                      placeholder="Cantidad"
                    />
                    <label for="tornillosAseo-{{ j }}"
                      >CANTIDAD TORNILLOS</label
                    >
                  </div>
                </div>
                <div class="col-12">
                  <div class="form-floating">
                    <textarea
                      class="form-control"
                      id="descripcionAseo-{{ j }}"
                      rows="3"
                      style="height: 100px"
                      [(ngModel)]="aseo.descripcion"
                      name="descripcionAseo{{ j }}"
                      placeholder="Descripción"
                      required
                    ></textarea>
                    <label for="descripcionAseo-{{ j }}"
                      >DESCRIPCIÓN INTERIOR</label
                    >
                  </div>
                </div>
              </div>
            </div>
            }
          </div>
          }
        </section>
      </div>
      }

      <!-- CLARABOYA -->
      @if (mod.nombre === 'CLARABOYA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card claraboya">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Claraboya</h4>
            <span class="mod-card__hint"
              >Elementos de ventilación e iluminación cenital</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Cantidad"
                  [(ngModel)]="mod.cantidadClaraboya"
                  name="cantidadClaraboya{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.cantidadClaraboya"
                />
                <label>CANTIDAD</label>
              </div>
            </div>
            <div class="col-md-8">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacionClaraboya"
                  name="homologacionClaraboya{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.homologacionClaraboya
                  "
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaClaraboya"
                  name="marcaClaraboya{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaClaraboya"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modeloClaraboya"
                  name="modeloClaraboya{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloClaraboya"
                />
                <label>MODELO</label>
              </div>
            </div>

            <div class="col-12">
              <div class="form-floating">
                <textarea
                  class="form-control"
                  style="height: 100px"
                  placeholder="Descripción"
                  [(ngModel)]="mod.descripcionClaraboya"
                  name="descripcionClaraboya{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.descripcionClaraboya
                  "
                ></textarea>
                <label>DESCRIPCIÓN TÉCNICA</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- VENTANA -->
      @if (mod.nombre === 'VENTANA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card ventana">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Ventana</h4>
            <span class="mod-card__hint">Aperturas laterales o traseras</span>
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Cantidad"
                  [(ngModel)]="mod.cantidadVentanas"
                  name="cantidadVentanas"
                  required
                  [class.is-invalid]="formSubmitted && !mod.cantidadVentanas"
                />
                <label>CANTIDAD</label>
              </div>
            </div>
            <div class="col-md-8">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Homologación"
                  [(ngModel)]="mod.homologacionVentana"
                  name="homologacionVentana"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacionVentana"
                />
                <label>CONTRASEÑA HOMOLOGACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaVentana"
                  name="marcaVentana"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaVentana"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modeloVentana"
                  name="modeloVentana"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloVentana"
                />
                <label>MODELO</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Dimensiones"
                  [(ngModel)]="mod.dimensionesVentana"
                  name="dimensionesVentana"
                  required
                  [class.is-invalid]="formSubmitted && !mod.dimensionesVentana"
                />
                <label>DIMENSIONES</label>
              </div>
            </div>

            <div class="col-12">
              <div class="form-floating">
                <textarea
                  class="form-control"
                  style="height: 100px"
                  placeholder="Descripción"
                  [(ngModel)]="mod.descripcionVentana"
                  name="descripcionVentana"
                  required
                  [class.is-invalid]="formSubmitted && !mod.descripcionVentana"
                ></textarea>
                <label>DESCRIPCIÓN TÉCNICA</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- DEPÓSITO DE AGUA SUCIA -->
      @if (mod.nombre === 'DEPÓSITO DE AGUA SUCIA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Depósito de Agua Sucia</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de litros:</label
          ><input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.litrosAguaSucia"
            name="litrosAguaSucia"
            required
            [class.is-invalid]="formSubmitted && !mod.litrosAguaSucia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor de la metrica de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- DEPÓSITO DE AGUA LIMPIA -->
      @if (mod.nombre === 'DEPÓSITO DE AGUA SUCIA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card deposito-agua-sucia">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Depósito de Agua Sucia</h4>
            <span class="mod-card__hint"
              >Capacidad y fijación del depósito</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Litros"
                  [(ngModel)]="mod.litrosAguaSucia"
                  name="litrosAguaSucia"
                  required
                  [class.is-invalid]="formSubmitted && !mod.litrosAguaSucia"
                />
                <label>CANTIDAD (Litros)</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA TORNILLOS</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- BOMBA DE AGUA -->
      @if (mod.nombre === 'BOMBA DE AGUA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card bomba-agua">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Bomba de Agua</h4>
            <span class="mod-card__hint"
              >Especificaciones del sistema de bombeo</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaBombaAgua"
                  name="marcaBombaAgua"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaBombaAgua"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Modelo"
                  [(ngModel)]="mod.modeloBombaAgua"
                  name="modeloBombaAgua"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloBombaAgua"
                />
                <label>MODELO</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.ubicacionBombaAgua"
                  name="ubicacionBombaAgua"
                  required
                  [class.is-invalid]="formSubmitted && !mod.ubicacionBombaAgua"
                />
                <label>UBICACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA TORNILLOS</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- REGISTRO DE LLENADO DE AGUA -->
      @if (mod.nombre === 'REGISTRO DE LLENADO DE AGUA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card registro-agua">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Registro de Llenado de Agua</h4>
            <span class="mod-card__hint"
              >Punto de acceso exterior para llenado</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.ubicacionRegistroAgua"
                  name="ubicacionRegistroAgua{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.ubicacionRegistroAgua
                  "
                />
                <label>UBICACIÓN</label>
              </div>
            </div>

            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Tamaño"
                  [(ngModel)]="mod.tamanoRegistroAgua"
                  name="tamanoRegistroAgua{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.tamanoRegistroAgua"
                />
                <label>TAMAÑO</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- TOMA EXTERIOR 230V -->
      @if (mod.nombre === 'TOMA EXTERIOR 230V' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card toma-exterior">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Toma Exterior 230V</h4>
            <span class="mod-card__hint"
              >Punto de conexión eléctrica externa</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Voltaje"
                  [(ngModel)]="mod.voltajeTomaExterior"
                  name="voltajeTomaExterior{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.voltajeTomaExterior"
                />
                <label>VOLTAJE</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.ubicacionTomaExterior"
                  name="ubicacionTomaExterior{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.ubicacionTomaExterior
                  "
                />
                <label>UBICACIÓN</label>
              </div>
            </div>

            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medidas"
                  [(ngModel)]="mod.medidasTomaExterior"
                  name="medidasTomaExterior{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasTomaExterior"
                />
                <label>MEDIDAS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- DUCHA EXTERIOR -->
      @if (mod.nombre === 'DUCHA EXTERIOR' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card ducha-exterior">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Ducha Exterior</h4>
            <span class="mod-card__hint"
              >Instalación de punto de agua externo</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.ubicacionDuchaExterior"
                  name="ubicacionDuchaExterior{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.ubicacionDuchaExterior
                  "
                />
                <label>UBICACIÓN</label>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA</label>
              </div>
            </div>

            <div class="col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- INSTALACIÓN ELÉCTRICA -->
      @if (mod.nombre === 'INSTALACIÓN ELÉCTRICA' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card instalacion-electrica">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Instalación Eléctrica</h4>
            <span class="mod-card__hint"
              >Sistema fotovoltaico y gestión de energía</span
            >
          </div>

          <div class="row g-4">
            <div class="col-12">
              <div
                class="d-flex justify-content-between align-items-center mb-3 border-bottom pb-2"
              >
                <h6 class="text-uppercase text-muted fw-bold mb-0">
                  Placas Solares
                </h6>
                <button
                  type="button"
                  class="btn btn-success btn-sm"
                  (click)="mod.placasSolares.push({})"
                >
                  <i class="bi bi-plus-lg me-1"></i> AÑADIR PLACA
                </button>
              </div>

              @for (placa of mod.placasSolares; track $index; let j = $index) {
              <div class="p-3 border bg-light mb-3 position-relative">
                <span
                  class="position-absolute top-0 end-0 badge bg-secondary rounded-0 m-2"
                  >#{{ j + 1 }}</span
                >
                <div class="row g-3 pt-4">
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="placa.marca"
                        name="placaMarca{{ i }}-{{ j }}"
                        [class.is-invalid]="
                          formSubmitted && !mod.ubicacionControlador
                        "
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Modelo"
                        [(ngModel)]="placa.modelo"
                        name="placaModelo{{ i }}-{{ j }}"
                        [class.is-invalid]="
                          formSubmitted && !mod.ubicacionControlador
                        "
                      />
                      <label>MODELO</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Potencia"
                        [(ngModel)]="placa.potencia"
                        name="placaPotencia{{ i }}-{{ j }}"
                        [class.is-invalid]="
                          formSubmitted && !mod.ubicacionControlador
                        "
                      />
                      <label>POTENCIA (W)</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Dimensiones"
                        [(ngModel)]="placa.dimensiones"
                        name="placaDimensiones{{ i }}-{{ j }}"
                        required
                      />
                      <label>DIMENSIONES (mm)</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ubicación"
                        [(ngModel)]="placa.ubicacion"
                        name="placaUbicacion{{ i }}-{{ j }}"
                        [class.is-invalid]="
                          formSubmitted && !mod.ubicacionControlador
                        "
                      />
                      <label>UBICACIÓN</label>
                    </div>
                  </div>
                  <div class="col-12 text-end">
                    <button
                      type="button"
                      class="btn btn-outline-danger btn-sm"
                      (click)="mod.placasSolares.splice(j, 1)"
                    >
                      <i class="bi bi-trash me-1"></i> ELIMINAR PLACA
                    </button>
                  </div>
                </div>
              </div>
              }
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Baterías Auxiliares
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="number"
                        min="0"
                        class="form-control"
                        placeholder="Cantidad"
                        [(ngModel)]="mod.cantidadBaterias"
                        name="cantidadBaterias{{ i }}"
                      />
                      <label>CANTIDAD</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Potencia"
                        [(ngModel)]="mod.potenciaBaterias"
                        name="potenciaBaterias{{ i }}"
                      />
                      <label>POTENCIA (W)</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ubicación"
                        [(ngModel)]="mod.ubicacionBaterias"
                        name="ubicacionBaterias{{ i }}"
                      />
                      <label>UBICACIÓN</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Inversor
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaInversor"
                        name="marcaInversor{{ i }}"
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Potencia"
                        [(ngModel)]="mod.potenciaInversor"
                        name="potenciaInversor{{ i }}"
                      />
                      <label>POTENCIA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ubicación"
                        [(ngModel)]="mod.ubicacionInversor"
                        name="ubicacionInversor{{ i }}"
                      />
                      <label>UBICACIÓN</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12">
              <div class="p-3 border bg-light">
                <h6
                  class="text-uppercase text-muted fw-bold mb-3 small border-bottom pb-2"
                >
                  Controlador de Carga
                </h6>
                <div class="row g-3">
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Marca"
                        [(ngModel)]="mod.marcaControlador"
                        name="marcaControlador{{ i }}"
                      />
                      <label>MARCA</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Modelo"
                        [(ngModel)]="mod.modeloControlador"
                        name="modeloControlador{{ i }}"
                      />
                      <label>MODELO</label>
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-floating">
                      <input
                        type="text"
                        class="form-control"
                        placeholder="Ubicación"
                        [(ngModel)]="mod.ubicacionControlador"
                        name="ubicacionControlador{{ i }}"
                      />
                      <label>UBICACIÓN</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-12">
              <h6 class="text-uppercase text-muted fw-bold mb-3 small">
                Instalaciones Secundarias
              </h6>
              <div class="form-floating">
                <textarea
                  class="form-control"
                  style="height: 120px"
                  placeholder="Descripción"
                  [(ngModel)]="mod.instalacionesSecundarias"
                  name="instalacionesSecundarias{{ i }}"
                ></textarea>
                <label>DESCRIPCIÓN ADICIONAL (Una por línea)</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
      <!-- TOLDO -->
      @if (mod.nombre === 'TOLDO' && mod.seleccionado) {
      <div class="mb-3">
        <section class="mod-card toldo">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Toldo</h4>
            <span class="mod-card__hint"
              >Estructura de protección solar exterior</span
            >
          </div>

          <div class="row g-3">
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaToldo"
                  name="marcaToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaToldo"
                />
                <label>MARCA</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Medidas"
                  [(ngModel)]="mod.medidasToldo"
                  name="medidasToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasToldo"
                />
                <label>MEDIDAS</label>
              </div>
            </div>
            <div class="col-md-4">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ubicación"
                  [(ngModel)]="mod.ubicacionToldo"
                  name="ubicacionToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.ubicacionToldo"
                />
                <label>UBICACIÓN</label>
              </div>
            </div>

            <div class="col-12"><hr class="mod-sep" /></div>

            <div class="col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label>MÉTRICA TORNILLOS</label>
              </div>
            </div>
            <div class="col-md-6">
              <div class="form-floating">
                <input
                  type="number"
                  min="0"
                  class="form-control"
                  placeholder="Nº"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
                <label>Nº TORNILLOS</label>
              </div>
            </div>
          </div>
        </section>
      </div>
      }
    </div>
    }

    <div class="ing-form-footer">
      <button type="button" class="btn btn-ing-back" (click)="onVolver()">
        <i class="bi bi-arrow-left"></i> VOLVER
      </button>

      <button type="submit" class="btn btn-ing-submit">
        CONTINUAR <i class="bi bi-arrow-right"></i>
      </button>
    </div>
  </form>
</div>
