<style>
  /* --- ESTILOS GENERALES (GENERICOS) --- */
  @import url("https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;600;800&family=Roboto:wght@300;400;500&display=swap");

  .ing-mods-scope {
    --font-tech: "JetBrains Mono", monospace;
    --font-reading: "Roboto", sans-serif;
    --color-accent: #0066ff;
    --color-border: #dee2e6;
    --color-bg-input: #f8f9fa;
  }

  .ing-mods-scope * {
    border-radius: 0 !important;
  }

  /* Títulos principales de modificación */
  .ing-mod-title {
    font-family: var(--font-tech);
    font-weight: 800;
    text-transform: uppercase;
    font-size: 1.1rem;
    border-bottom: 3px solid #000;
    padding-bottom: 0.5rem;
    margin-bottom: 1.5rem;
    margin-top: 1rem;
    color: #000;
  }

  /* Títulos secundarios (Sub-bloques como Aletines) */
  .ing-sub-title {
    font-family: var(--font-tech);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.95rem;
    color: var(--color-accent);
    margin-bottom: 1rem;
    border-left: 4px solid var(--color-accent);
    padding-left: 0.75rem;
    background-color: #f0f7ff;
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
  }

  /* Labels técnicos */
  .ing-label {
    font-family: var(--font-tech);
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.75rem;
    color: #6c757d;
    margin-bottom: 0.35rem;
    display: block;
    letter-spacing: -0.3px;
  }

  /* Inputs industriales */
  .ing-input,
  .ing-select {
    font-family: var(--font-reading);
    border: 1px solid #ced4da;
    background-color: var(--color-bg-input);
    padding: 0.6rem 0.75rem;
    font-size: 0.9rem;
    font-weight: 500;
    transition: all 0.2s ease;
  }

  .ing-input:focus,
  .ing-select:focus {
    background-color: #fff;
    border-color: #000;
    box-shadow: none;
    border-left: 4px solid var(--color-accent);
  }

  .ing-input.is-invalid,
  .ing-select.is-invalid {
    border-left: 4px solid #dc3545;
    background-color: #fff5f5;
  }

  /* Tarjetas anidadas para agrupar piezas */
  .ing-nested-card {
    border: 1px solid var(--color-border);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    background-color: #fff;
    position: relative;
  }

  /* Checkboxes personalizados */
  .form-check-input {
    border: 1px solid #adb5bd;
    width: 1.2em;
    height: 1.2em;
    margin-top: 0.2em;
  }
  .form-check-input:checked {
    background-color: var(--color-accent);
    border-color: var(--color-accent);
  }
  .ing-check-label {
    font-family: var(--font-reading);
    color: #212529;
    font-weight: 500;
    padding-left: 0.5rem;
  }

  /* Botones de acción */
  .btn-ing {
    font-family: var(--font-tech);
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.5px;
    padding: 0.7rem 1.5rem;
  }
  .btn-ing-primary {
    background-color: var(--color-accent);
    border: 1px solid var(--color-accent);
    color: #fff;
  }
  .btn-ing-primary:hover {
    background-color: #0052cc;
  }
  .btn-ing-outline {
    border: 2px solid #adb5bd;
    color: #6c757d;
    background: transparent;
  }
  .btn-ing-outline:hover {
    border-color: #000;
    color: #000;
  }
  .btn-ing-add {
    background-color: #198754;
    color: white;
    font-size: 0.7rem;
    padding: 0.3rem 0.8rem;
  }
  .btn-ing-del {
    border: 1px solid #dc3545;
    color: #dc3545;
    font-size: 0.7rem;
    padding: 0.3rem 0.8rem;
    background: white;
  }
</style>

<div class="ing-mods-scope container mt-4 mb-5">
  <form #form="ngForm" (ngSubmit)="onContinuar(form)" novalidate>
    @for (mod of modificacionesSeleccionadas; track mod; let i = $index) {
    <div class="mb-5">
      <!-- COCHES -->
      <!-- Enganche de remolque -->
      @if ( mod.nombre === 'Enganche de remolque' && mod.seleccionado ) {
      <div class="ing-nested-card shadow-sm">
        <h3 class="ing-mod-title">Enganche de remolque</h3>

        <div class="row g-4">
          <div class="col-12 col-md-4 bg-light p-3 border">
            <label class="ing-label mb-2 text-dark">Tipo de acción</label>
            <div class="d-flex flex-column gap-2">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label ing-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label ing-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label ing-check-label"
                  for="accion-desmontaje-{{ i }}"
                >
                  Desmontaje
                </label>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-8">
            <div class="row g-3">
              <div class="col-12">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaHomologado{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Diámetro tornillos</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.metrica"
                  name="metrica{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metrica == null"
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">
                    {{ num }}
                  </option>
                  }
                </select>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Nº de tornillos</label>
                <input
                  type="number"
                  min="0"
                  class="form-control ing-input"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillos"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Reducción de plazas -->
      @if (mod.nombre === 'Reducción de plazas de asiento' && mod.seleccionado)
      {
      <div class="ing-nested-card shadow-sm">
        <h3 class="ing-mod-title">Reducción de Plazas</h3>
        <div class="row g-3">
          <div class="col-12">
            <label class="ing-label">¿Qué plaza desea eliminar?</label>
            <input
              type="text"
              class="form-control ing-input"
              [(ngModel)]="mod.enclaje"
              name="enclajePlaza{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.enclaje"
              placeholder="Ej: Central trasera, Tercera fila completa..."
            />
          </div>
          <div class="col-md-6">
            <label class="ing-label">Nº Plazas ANTES</label>
            <input
              type="number"
              min="0"
              class="form-control ing-input bg-light"
              [(ngModel)]="mod.plazasAntes"
              name="plazasAntes{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.plazasAntes"
            />
          </div>
          <div class="col-md-6">
            <label class="ing-label text-primary fw-bold"
              >Nº Plazas DESPUÉS</label
            >
            <input
              type="number"
              min="0"
              class="form-control ing-input border-primary"
              [(ngModel)]="mod.plazasDespues"
              name="plazasDespues{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.plazasDespues"
            />
          </div>
        </div>
      </div>
      } @if (mod.nombre === 'Ruedas' && mod.seleccionado) {
      @if(mod.detalle.neumaticos) {
      <div class="ing-nested-card shadow-sm">
        <h3 class="ing-mod-title">Llantas y Neumáticos</h3>

        <div class="mb-4">
          <label class="ing-label">Seleccione Eje a Modificar</label>
          <select
            class="form-select ing-select"
            [(ngModel)]="mod.neumaticosCoche"
            name="neumaticosCoche{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticosCoche"
          >
            <option value="delantero">Eje Delantero</option>
            <option value="trasero">Eje Trasero</option>
            <option value="delantero y trasero">
              Ambos Ejes (Delantero + Trasero)
            </option>
          </select>
        </div>

        <div class="row g-4">
          @if ( mod.neumaticosCoche === 'delantero' || mod.neumaticosCoche ===
          'delantero y trasero' ) {
          <div class="col-12 col-lg-6">
            <div class="p-4 border bg-light h-100">
              <h6
                class="ing-sub-title mb-3 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
              >
                Eje Delantero
              </h6>
              <div class="mb-3">
                <label class="ing-label">Neumático Delantero</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.neumaticoDelantero"
                  name="neumaticoDelantero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.neumaticoDelantero"
                  placeholder="Ej: 205/55 R16 91V"
                />
              </div>
              <div>
                <label class="ing-label">Medidas Llanta Delantera</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.medidasLlantaDelantero"
                  name="medidasLlantaDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.medidasLlantaDelantero
                  "
                  placeholder="Ej: 7Jx16 ET45"
                />
              </div>
            </div>
          </div>
          } @if ( mod.neumaticosCoche === 'trasero' || mod.neumaticosCoche ===
          'delantero y trasero' ) {
          <div class="col-12 col-lg-6">
            <div class="p-4 border bg-light h-100">
              <h6
                class="ing-sub-title mb-3 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
              >
                Eje Trasero
              </h6>
              <div class="mb-3">
                <label class="ing-label">Neumático Trasero</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.neumaticoTrasero"
                  name="neumaticoTrasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.neumaticoTrasero"
                  placeholder="Ej: 225/50 R16 92W"
                />
              </div>
              <div>
                <label class="ing-label">Medidas Llanta Trasera</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.medidasLlantaTrasero"
                  name="medidasLlantaTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.medidasLlantaTrasero
                  "
                  placeholder="Ej: 7.5Jx16 ET40"
                />
              </div>
            </div>
          </div>
          }
        </div>
      </div>
      } @if(mod.detalle.separadoresDeRueda) {
      <div class="ing-nested-card shadow-sm mt-4">
        <h3 class="ing-mod-title">Separadores de Rueda</h3>

        <div class="row g-4">
          <div class="col-12 col-md-4 bg-light p-3 border">
            <label class="ing-label mb-2 text-dark">Tipo de acción</label>
            <div class="d-flex flex-column gap-2">
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-sep-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label ing-check-label"
                  for="accion-instalacion-sep-{{ i }}"
                >
                  Instalación
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-sep-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label ing-check-label"
                  for="accion-sustitucion-sep-{{ i }}"
                >
                  Sustitución
                </label>
              </div>
              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-sep-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label ing-check-label"
                  for="accion-desmontaje-sep-{{ i }}"
                >
                  Desmontaje
                </label>
              </div>
            </div>
          </div>

          <div class="col-12 col-md-8">
            <div class="row g-3">
              <div class="col-12">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaSeparadores"
                  name="marcaSeparadores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaSeparadores"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaSeparadores"
                  name="referenciaSeparadores{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaSeparadores
                  "
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Grosor (mm)</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.grosorSeparadores"
                    name="grosorSeparadores{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.grosorSeparadores"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >mm</span
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      } }
      <!-- Carrocería -->
      @if (mod.nombre === 'Carrocería' && mod.seleccionado) {
      <div class="ing-nested-card shadow-sm mt-4">
        @if (mod.detalle?.aletines) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Aletines</h3>

          <div class="row g-0">
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-aletines-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-aletines-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-aletines-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-aletines-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-aletines-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-aletines-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Datos de la Pieza
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaAletines"
                    name="marcaAletines{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Referencia</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.referenciaAletines"
                    name="referenciaAletines{{ i }}"
                    placeholder="Referencia de la pieza"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Ancho (mm)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.anchoAletines"
                      name="anchoAletines{{ i }}"
                      placeholder="0"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >mm</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Peso Pieza (Kg)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.pesoPiezaKgAletines"
                      name="pesoPiezaKgAletines{{ i }}"
                      required
                      [class.is-invalid]="
                        formSubmitted && mod.pesoPiezaKgAletines == null
                      "
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg</span
                    >
                  </div>
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaAletines"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaAletines{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.numTornillosAletines"
                    name="numTornillosAletines{{ i }}"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- ESTRIBOS LATERALES O TALONERAS -->
        @if (mod.detalle.talonerasEstribos) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Estribos laterales / Taloneras</h3>

          <div class="row g-0">
            <!-- COLUMNA IZQUIERDA: ACCIONES -->
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-estribos-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-estribos-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-estribos-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-estribos-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-estribos-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-estribos-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
            </div>

            <!-- COLUMNA DERECHA: DATOS TÉCNICOS -->
            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <!-- SUBTÍTULO: ESPECIFICACIONES -->
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Especificaciones de la Pieza
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcataloneras"
                    name="marcataloneras{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Material</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.materialEstribos"
                    name="materialEstribos{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    <option value="acero">Acero</option>
                    <option value="plástico">Plástico</option>
                    <option value="aluminio">Aluminio</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Anchura (m)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.anchuraMEstribos"
                      name="anchuraMEstribos{{ i }}"
                      placeholder="0.000"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >m</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Altura (m)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.alturaMEstribos"
                      name="alturaMEstribos{{ i }}"
                      placeholder="0.000"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >m</span
                    >
                  </div>
                </div>

                <!-- SUBTÍTULO: SUJECIÓN -->
                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción al Chasis
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaTalonera"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaTalonera{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaTalonera == null
                    "
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillosEstribos"
                    name="nTornillosEstribos"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.nTornillosEstribos
                    "
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- SNORKEL -->
        @if (mod.detalle.snorkel) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Snorkel</h3>

          <div class="row g-0">
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-snorkel-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-snorkel-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-snorkel-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-snorkel-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-snorkel-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-snorkel-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Datos Generales
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Material</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.materialSnorkel"
                    name="materialSnorkel{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    <option value="goma">Goma</option>
                    <option value="plástico ABS">Plástico ABS</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaSnorkel"
                    name="marcaSnorkel{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Ratio Curvatura Mín.</label>
                  <input
                    type="number"
                    step="0.01"
                    class="form-control ing-input"
                    [(ngModel)]="mod.curvaturaSnorkel"
                    name="curvaturaSnorkel{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.curvaturaSnorkel == null
                    "
                    placeholder="0.00"
                  />
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Dimensiones y Peso
                  </h6>
                </div>

                <div class="col-md-4">
                  <label class="ing-label">Peso (Kg)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.pesoPiezaKgSnorkel"
                      name="pesoPiezaKgSnorkel{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg</span
                    >
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="ing-label">Anchura (m)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.anchuraPiezaMSnorkel"
                      name="anchuraPiezaMSnorkel{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >m</span
                    >
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="ing-label">Altura (m)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.alturaPiezaMSnorkel"
                      name="alturaPiezaMSnorkel{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >m</span
                    >
                  </div>
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaSnorkel"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaSnorkel{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaSnorkel == null
                    "
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillosSnorkel"
                    name="nTornillosSnorkel{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.nTornillosSnorkel == null
                    "
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        } @if (mod.nombre === 'Carrocería' && mod.seleccionado) {
        <div class="ing-nested-card shadow-sm mb-4">
          @if (mod.detalle?.aletines) {
          <div class="ing-nested-card shadow-sm mb-4">
            <h3 class="ing-mod-title">Aletines</h3>

            <div class="row g-0">
              <div
                class="col-12 col-lg-4 bg-light p-4 border-end border-bottom"
              >
                <label class="ing-label mb-3 text-dark fw-bold fs-6"
                  >TIPO DE ACCIÓN</label
                >
                <div class="d-flex flex-column gap-3">
                  <div class="form-check p-2 bg-white border">
                    <input
                      class="form-check-input ms-1"
                      type="checkbox"
                      id="accion-instalacion-aletines-{{ i }}"
                      [checked]="mod.acciones?.includes('Instalacion')"
                      (change)="
                        toggleAccion(mod, 'Instalacion', $event.target.checked)
                      "
                    />
                    <label
                      class="form-check-label ing-check-label fw-bold ms-2"
                      for="accion-instalacion-aletines-{{ i }}"
                    >
                      Instalación
                    </label>
                  </div>

                  <div class="form-check p-2 bg-white border">
                    <input
                      class="form-check-input ms-1"
                      type="checkbox"
                      id="accion-sustitucion-aletines-{{ i }}"
                      [checked]="mod.acciones?.includes('Sustitucion')"
                      (change)="
                        toggleAccion(mod, 'Sustitucion', $event.target.checked)
                      "
                    />
                    <label
                      class="form-check-label ing-check-label fw-bold ms-2"
                      for="accion-sustitucion-aletines-{{ i }}"
                    >
                      Sustitución
                    </label>
                  </div>

                  <div class="form-check p-2 bg-white border">
                    <input
                      class="form-check-input ms-1"
                      type="checkbox"
                      id="accion-desmontaje-aletines-{{ i }}"
                      [checked]="mod.acciones?.includes('Desmontaje')"
                      (change)="
                        toggleAccion(mod, 'Desmontaje', $event.target.checked)
                      "
                    />
                    <label
                      class="form-check-label ing-check-label fw-bold ms-2"
                      for="accion-desmontaje-aletines-{{ i }}"
                    >
                      Desmontaje
                    </label>
                  </div>
                </div>
              </div>

              <div class="col-12 col-lg-8 p-4">
                <div class="row g-3">
                  <div class="col-12 mb-2">
                    <h6
                      class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                    >
                      Datos de la Pieza
                    </h6>
                  </div>

                  <div class="col-md-6">
                    <label class="ing-label">Marca</label>
                    <input
                      type="text"
                      class="form-control ing-input"
                      [(ngModel)]="mod.marcaAletines"
                      name="marcaAletines{{ i }}"
                      placeholder="Marca del fabricante"
                    />
                  </div>

                  <div class="col-md-6">
                    <label class="ing-label">Referencia</label>
                    <input
                      type="text"
                      class="form-control ing-input"
                      [(ngModel)]="mod.referenciaAletines"
                      name="referenciaAletines{{ i }}"
                      placeholder="Referencia de la pieza"
                    />
                  </div>

                  <div class="col-md-6">
                    <label class="ing-label">Ancho (mm)</label>
                    <div class="input-group">
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.anchoAletines"
                        name="anchoAletines{{ i }}"
                        placeholder="0"
                      />
                      <span
                        class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                        >mm</span
                      >
                    </div>
                  </div>

                  <div class="col-md-6">
                    <label class="ing-label">Peso Pieza (Kg)</label>
                    <div class="input-group">
                      <input
                        type="number"
                        step="0.01"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.pesoPiezaKgAletines"
                        name="pesoPiezaKgAletines{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && mod.pesoPiezaKgAletines == null
                        "
                        placeholder="0.00"
                      />
                      <span
                        class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                        >Kg</span
                      >
                    </div>
                  </div>

                  <div class="col-12 mt-4 mb-2">
                    <h6
                      class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                    >
                      Sujeción
                    </h6>
                  </div>

                  <div class="col-md-6">
                    <label class="ing-label">Diámetro Tornillos</label>
                    <select
                      class="form-select ing-select"
                      [(ngModel)]="mod.metricaAletines"
                      (ngModelChange)="onMetricaChange(mod)"
                      name="metricaAletines{{ i }}"
                    >
                      <option [ngValue]="null" disabled>
                        -- SELECCIONAR --
                      </option>
                      @for (num of metricasTornillos; track num) {
                      <option [value]="num">{{ num }}</option>
                      }
                    </select>
                  </div>

                  <div class="col-md-6">
                    <label class="ing-label">Nº de Tornillos</label>
                    <input
                      type="number"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.numTornillosAletines"
                      name="numTornillosAletines{{ i }}"
                      placeholder="0"
                    />
                  </div>
                </div>
              </div>
            </div>
          </div>
          } @if (mod.detalle.defensaDelantera) {
          <div class="ing-nested-card shadow-sm mb-4">
            <h3 class="ing-mod-title">Defensa Delantera</h3>

            <div class="p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Especificaciones Técnicas
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaDefensa"
                    name="marcaDefensa{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Modelo</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.modeloDefensa"
                    name="modeloDefensa{{ i }}"
                    placeholder="Modelo comercial"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Grosor del Tubo (mm)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.grosorTuboDefensa"
                      name="grosorTuboDefensa{{ i }}"
                      placeholder="0"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >mm</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Medidas Totales (mm)</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.medidasDefensa"
                    name="medidasDefensa{{ i }}"
                    placeholder="Ej: 1200 x 400 mm"
                  />
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaDefensa"
                    name="metricaDefensa{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillosDefensa"
                    name="nTornillosDefensa{{ i }}"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
          }
        </div>
        }

        <!-- PARAGOLPES DELANTERO -->
        @if (mod.detalle.paragolpesDelantero) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Paragolpes Delantero</h3>

          <div class="row g-0">
            <!-- COLUMNA IZQUIERDA: ACCIONES -->
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-paragolpes-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-paragolpes-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-paragolpes-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-paragolpes-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-paragolpes-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-paragolpes-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <!-- COLUMNA DERECHA: DATOS -->
            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Datos Generales
                  </h6>
                </div>

                <div class="col-12">
                  <label class="ing-label">Tipo de Fabricación</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.tipoFabricacionParagolpesDelantero"
                    name="tipoFabricacionParagolpesDelantero{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    <option value="comercial">
                      Comercial (Marca y Referencia)
                    </option>
                    <option value="artesanal">Artesanal (Acero)</option>
                  </select>
                </div>

                @if (mod.tipoFabricacionParagolpesDelantero === 'comercial') {
                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaParagolpes"
                    name="marcaParagolpes{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Referencia</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.referenciaParagolpes"
                    name="referenciaParagolpes{{ i }}"
                    placeholder="Ref. comercial"
                  />
                </div>
                }

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Dimensiones
                  </h6>
                </div>

                <div class="col-12">
                  <label class="ing-label">Medidas Totales (mm)</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.medidasParagolpesDelantero"
                    name="medidasParagolpesDelantero{{ i }}"
                    placeholder="Ej: 1600 x 450 mm"
                  />
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metrica"
                    name="metrica{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillos"
                    name="nTornillos"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- PARAGOLPES TRASERO -->
        @if (mod.detalle.paragolpesTrasero) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Paragolpes Trasero</h3>

          <div class="row g-0">
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-trasero-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-trasero-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-trasero-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-trasero-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-trasero-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-trasero-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Datos Generales
                  </h6>
                </div>

                <div class="col-12">
                  <label class="ing-label">Tipo de Fabricación</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.tipoFabricacionParagolpesTrasero"
                    name="tipoFabricacionParagolpesTrasero{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    <option value="comercial">Marca y Referencia</option>
                    <option value="artesanal">
                      Fabricado en acero de forma artesanal
                    </option>
                  </select>
                </div>

                @if (mod.tipoFabricacionParagolpesTrasero === 'comercial') {
                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaParagolpesTrasero"
                    name="marcaParagolpesTrasero{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Referencia</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.referenciaParagolpesTrasero"
                    name="referenciaParagolpesTrasero{{ i }}"
                    placeholder="Ref. comercial"
                  />
                </div>
                }

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Características Físicas
                  </h6>
                </div>

                <div class="col-md-4">
                  <label class="ing-label">Peso (Kg)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.pesoPiezaKgParagolpesTrasero"
                      name="pesoPiezaKgParagolpesTrasero{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg</span
                    >
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="ing-label">Anchura (m)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.anchuraMParagolpesTrasero"
                      name="anchuraMParagolpesTrasero{{ i }}"
                      placeholder="0.000"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >m</span
                    >
                  </div>
                </div>

                <div class="col-md-4">
                  <label class="ing-label">Altura (m)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.001"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.alturaMParagolpesTrasero"
                      name="alturaMParagolpesTrasero{{ i }}"
                      placeholder="0.000"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >m</span
                    >
                  </div>
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillosParagolpesTrasero"
                    name="nTornillosParagolpesTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.nTornillosParagolpesTrasero
                    "
                    placeholder="0"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaParaTrasero"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaParaTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaParaTrasero == null
                    "
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- ANTIEMPOTRAMIENTO -->
        @if (mod.detalle.barraAntiempotramiento) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Barra Antiempotramiento</h3>

          <div class="row g-0">
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-antiempotramiento-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-antiempotramiento-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-antiempotramiento-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-antiempotramiento-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-antiempotramiento-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-antiempotramiento-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Especificaciones Técnicas
                  </h6>
                </div>

                <div class="col-12">
                  <label class="ing-label">Medidas (mm)</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.medidasAntiempotramiento"
                    name="medidasAntiempotramiento{{ i }}"
                    placeholder="Ejemplo: 500x700"
                  />
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillos"
                    name="nTornillos"
                    required
                    [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- CABRESTANTE -->
        @if (mod.detalle.cabrestante) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Cabrestante</h3>

          <div class="row g-0">
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-cabrestante-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-cabrestante-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-cabrestante-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-cabrestante-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-cabrestante-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-cabrestante-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
              <div
                class="invalid-feedback d-block mt-2"
                *ngIf="
                  formSubmitted && (!mod.acciones || mod.acciones.length === 0)
                "
              >
                Debe seleccionar al menos una acción.
              </div>
            </div>

            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Datos Generales
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaCabrestante"
                    name="marcaCabrestante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaCabrestante"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Capacidad de Arrastre (Kg)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.capacidadCabrestanteKg"
                      name="capacidadCabrestanteKg{{ i }}"
                      placeholder="0"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos (General)</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaCabrestante"
                    name="metricaCabrestante{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaCabrestante == null
                    "
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos (General)</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillos"
                    name="nTornillos"
                    required
                    [class.is-invalid]="formSubmitted && !mod.nTornillos"
                    placeholder="0"
                  />
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Especificaciones del Perno y Material
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Tiro Máx. Cabrestante (Kg)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.tiroMaxCabrestanteKg"
                      name="tiroMaxCabrestanteKg{{ i }}"
                      placeholder="0"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Perno (cm)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.diametroPernoCmCabrestante"
                      name="diametroPernoCmCabrestante{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >cm</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Material del Perno</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.materialPernoCabrestante"
                    name="materialPernoCabrestante{{ i }}"
                    placeholder="Ej: Acero 8.8"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Tensión Mín. Cortante</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.tensionMinCortanteKgCm2Cabrestante"
                      name="tensionMinCortanteKgCm2Cabrestante{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg/cm²</span
                    >
                  </div>
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Unión al Chasis
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Número de Pernos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nPernosChasisCabrestante"
                    name="nPernosChasisCabrestante{{ i }}"
                    placeholder="0"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Perno (mm)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.diametroPernoChasisMmCabrestante"
                      name="diametroPernoChasisMmCabrestante{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >mm</span
                    >
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Material del Perno</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.materialPernoChasisCabrestante"
                    name="materialPernoChasisCabrestante{{ i }}"
                    placeholder="Ej: Acero 8.8"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Tensión Cortante Chasis</label>
                  <div class="input-group">
                    <input
                      type="number"
                      step="0.01"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.tensionMinCortanteChasisKgCm2Cabrestante"
                      name="tensionMinCortanteChasisKgCm2Cabrestante{{ i }}"
                      placeholder="0.00"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >Kg/cm²</span
                    >
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- SOPORTE PARA RUEDA DE REPUESTO -->
        @if ( mod.detalle.soporteRuedaRepuesto ) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Soporte para rueda de repuesto</h3>

          <div class="row g-0">
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-soporte-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-soporte-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-soporte-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-soporte-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-soporte-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-soporte-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
            </div>

            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Especificaciones Técnicas
                  </h6>
                </div>

                <div class="col-12">
                  <label class="ing-label">Tipo de Fabricación</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.tipoFabricacionRuedaRepuesto"
                    name="tipoFabricacionRuedaRepuesto{{ i }}"
                  >
                    <option value="" disabled selected>
                      -- SELECCIONAR --
                    </option>
                    <option value="comercial">
                      Comercial (Marca y Referencia)
                    </option>
                    <option value="artesanal">Artesanal (Acero)</option>
                  </select>
                </div>

                @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaRuedaRepuesto"
                    name="marcaRuedaRepuesto{{ i }}"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Referencia</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.referenciaRuedaRepuesto"
                    name="referenciaRuedaRepuesto{{ i }}"
                    placeholder="Referencia comercial"
                  />
                </div>
                }

                <div class="col-12">
                  <label class="ing-label">Medidas Totales</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.medidasRuedaRepuesto"
                    name="medidasRuedaRepuesto{{ i }}"
                    placeholder="Ej: 800 x 400 x 200 mm"
                  />
                </div>

                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción al Chasis
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metrica"
                    name="metrica{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillos"
                    name="nTornillos"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- Sobrealetines -->
        @if (mod.detalle?.sobrealetines) {
        <div class="ing-nested-card shadow-sm mb-4">
          <h3 class="ing-mod-title">Sobrealetines</h3>

          <div class="row g-0">
            <!-- COLUMNA IZQUIERDA: ACCIONES -->
            <div class="col-12 col-lg-4 bg-light p-4 border-end border-bottom">
              <label class="ing-label mb-3 text-dark fw-bold fs-6"
                >TIPO DE ACCIÓN</label
              >
              <div class="d-flex flex-column gap-3">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-sobrealetines-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-sobrealetines-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-sobrealetines-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-sobrealetines-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-sobrealetines-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-sobrealetines-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
            </div>

            <!-- COLUMNA DERECHA: DATOS TÉCNICOS -->
            <div class="col-12 col-lg-8 p-4">
              <div class="row g-3">
                <!-- GRUPO 1: DATOS GENERALES -->
                <div class="col-12 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Datos de la Pieza
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Marca</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.marcaSobreletines"
                    name="marcaSobreletines{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaSobreletines"
                    placeholder="Marca del fabricante"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Referencia</label>
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.referenciaSobreletines"
                    name="referenciaSobreletines{{ i }}"
                    placeholder="Referencia comercial"
                  />
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Ancho (mm)</label>
                  <div class="input-group">
                    <input
                      type="number"
                      min="0"
                      class="form-control ing-input"
                      [(ngModel)]="mod.anchoSobrealetines"
                      name="anchoSobrealetines{{ i }}"
                      placeholder="0"
                    />
                    <span
                      class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                      >mm</span
                    >
                  </div>
                </div>

                <!-- GRUPO 2: SUJECIÓN -->
                <div class="col-12 mt-4 mb-2">
                  <h6
                    class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Sujeción
                  </h6>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Diámetro Tornillos</label>
                  <select
                    class="form-select ing-select"
                    [(ngModel)]="mod.metricaSobrealetines"
                    name="metricaSobrealetines{{ i }}"
                  >
                    <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                </div>

                <div class="col-md-6">
                  <label class="ing-label">Nº de Tornillos</label>
                  <input
                    type="number"
                    min="0"
                    class="form-control ing-input"
                    [(ngModel)]="mod.nTornillos"
                    name="nTornillos{{ i }}"
                    placeholder="0"
                  />
                </div>
              </div>
            </div>
          </div>
        </div>
        }
      </div>
      }

      <!-- MUELLES, BALLESTAS Y AMORTIGUADORES -->
      <!-- ========================================== -->
      <!-- BLOQUE: SUSPENSIÓN -->
      <!-- ========================================== -->
      @if ( mod.nombre === 'Suspensión' && mod.seleccionado ) {
      <div class="mb-5">
        <div class="ing-nested-card shadow-sm">
          <h3 class="ing-mod-title">Componentes de Suspensión</h3>

          <!-- MUELLES HELICOIDALES -->
          @if (mod.detalle?.muelleDelantero || mod.detalle?.muelleTrasero) {
          <div class="mb-5">
            <h4
              class="ing-sub-title text-dark bg-transparent border-0 ps-0 mb-3 border-bottom pb-2"
            >
              <i class="bi bi-spring me-2"></i>Muelles Helicoidales
            </h4>

            <div class="row g-4">
              <!-- Muelle Delantero -->
              @if (mod.detalle?.muelleDelantero) {
              <div class="col-12 col-xl-6">
                <div class="p-3 bg-light border h-100">
                  <h6 class="fw-bold text-uppercase mb-3 text-primary">
                    Eje Delantero
                  </h6>
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaMuelleDelanteroConRef"
                        name="marcaMuelleDelanteroConRef{{ i }}"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaMuelleDelanteroConRef"
                        name="referenciaMuelleDelanteroConRef{{ i }}"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">D. Exterior</label>
                      <div class="input-group input-group-sm">
                        <input
                          type="number"
                          min="0"
                          class="form-control ing-input"
                          [(ngModel)]="mod.diametroExteriorDelanteroRef"
                          name="diametroExteriorDelanteroRef{{ i }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-white text-muted border-start-0"
                          >mm</span
                        >
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Long. Libre</label>
                      <div class="input-group input-group-sm">
                        <input
                          type="number"
                          min="0"
                          class="form-control ing-input"
                          [(ngModel)]="mod.longitudLibreDelanteroRef"
                          name="longitudLibreDelanteroRef{{ i }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-white text-muted border-start-0"
                          >mm</span
                        >
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">D. Espira</label>
                      <div class="input-group input-group-sm">
                        <input
                          type="number"
                          min="0"
                          class="form-control ing-input"
                          [(ngModel)]="mod.diametroEspiraDelanteroRef"
                          name="diametroEspiraDelanteroRef{{ i }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-white text-muted border-start-0"
                          >mm</span
                        >
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Nº Espiras</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input form-control-sm"
                        [(ngModel)]="mod.numeroEspirasDelanteroRef"
                        name="numeroEspirasDelanteroRef{{ i }}"
                        placeholder="0"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }

              <!-- Muelle Trasero -->
              @if (mod.detalle?.muelleTrasero) {
              <div class="col-12 col-xl-6">
                <div class="p-3 bg-light border h-100">
                  <h6 class="fw-bold text-uppercase mb-3 text-primary">
                    Eje Trasero
                  </h6>
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaMuelleTraseroConRef"
                        name="marcaMuelleTraseroConRef{{ i }}"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaMuelleTraseroConRef"
                        name="referenciaMuelleTraseroConRef{{ i }}"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">D. Exterior</label>
                      <div class="input-group input-group-sm">
                        <input
                          type="number"
                          min="0"
                          class="form-control ing-input"
                          [(ngModel)]="mod.diametroExteriorTraseroRef"
                          name="diametroExteriorTraseroRef{{ i }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-white text-muted border-start-0"
                          >mm</span
                        >
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Long. Libre</label>
                      <div class="input-group input-group-sm">
                        <input
                          type="number"
                          min="0"
                          class="form-control ing-input"
                          [(ngModel)]="mod.longitudLibreTraseroRef"
                          name="longitudLibreTraseroRef{{ i }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-white text-muted border-start-0"
                          >mm</span
                        >
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">D. Espira</label>
                      <div class="input-group input-group-sm">
                        <input
                          type="number"
                          min="0"
                          class="form-control ing-input"
                          [(ngModel)]="mod.diametroEspiraTraseroRef"
                          name="diametroEspiraTraseroRef{{ i }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-white text-muted border-start-0"
                          >mm</span
                        >
                      </div>
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Nº Espiras</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input form-control-sm"
                        [(ngModel)]="mod.numeroEspirasTraseroRef"
                        name="numeroEspirasTraseroRef{{ i }}"
                        placeholder="0"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }

          <!-- BALLESTAS -->
          @if (mod.detalle?.ballestaDelantera || mod.detalle?.ballestaTrasera) {
          <div class="mb-5">
            <h4
              class="ing-sub-title text-dark bg-transparent border-0 ps-0 mb-3 border-bottom pb-2"
            >
              <i class="bi bi-layers-half me-2"></i>Ballestas
            </h4>
            <div class="row g-4">
              <!-- Ballesta Delantera -->
              @if (mod.detalle?.ballestaDelantera) {
              <div class="col-12 col-xl-6">
                <div class="p-3 bg-light border h-100">
                  <h6 class="fw-bold text-uppercase mb-3 text-primary">
                    Eje Delantero
                  </h6>
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaBallestaDelantera"
                        name="marcaBallestaDelantera{{ i }}"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaBallestaDelantera"
                        name="referenciaBallestaDelantera{{ i }}"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Nº Hojas</label>
                      <input
                        type="number"
                        min="1"
                        class="form-control ing-input"
                        [(ngModel)]="mod.numHojasBallestaDelantera"
                        name="numHojasBallestaDelantera{{ i }}"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Ancho</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.anchoHojaBallestaDelantera"
                        name="anchoHojaBallestaDelantera{{ i }}"
                        placeholder="mm"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Espesor</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.espesorHojaBallestaDelantera"
                        name="espesorHojaBallestaDelantera{{ i }}"
                        placeholder="mm"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Longitud</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.longitudBallestaDelantera"
                        name="longitudBallestaDelantera{{ i }}"
                        placeholder="mm"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }

              <!-- Ballesta Trasera -->
              @if (mod.detalle?.ballestaTrasera) {
              <div class="col-12 col-xl-6">
                <div class="p-3 bg-light border h-100">
                  <h6 class="fw-bold text-uppercase mb-3 text-primary">
                    Eje Trasero
                  </h6>
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaBallestaTrasera"
                        name="marcaBallestaTrasera{{ i }}"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaBallestaTrasera"
                        name="referenciaBallestaTrasera{{ i }}"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Nº Hojas</label>
                      <input
                        type="number"
                        min="1"
                        class="form-control ing-input"
                        [(ngModel)]="mod.numHojasBallestaTrasera"
                        name="numHojasBallestaTrasera{{ i }}"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Ancho</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.anchoHojaBallestaTrasera"
                        name="anchoHojaBallestaTrasera{{ i }}"
                        placeholder="mm"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Espesor</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.espesorHojaBallestaTrasera"
                        name="espesorHojaBallestaTrasera{{ i }}"
                        placeholder="mm"
                      />
                    </div>
                    <div class="col-6 col-md-3">
                      <label class="ing-label">Longitud</label>
                      <input
                        type="number"
                        min="0"
                        class="form-control ing-input"
                        [(ngModel)]="mod.longitudBallestaTrasera"
                        name="longitudBallestaTrasera{{ i }}"
                        placeholder="mm"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }

          <!-- AMORTIGUADORES -->
          @if (mod.detalle?.amortiguadorDelantero ||
          mod.detalle?.amortiguadorTrasero) {
          <div class="mb-5">
            <h4
              class="ing-sub-title text-dark bg-transparent border-0 ps-0 mb-3 border-bottom pb-2"
            >
              <i class="bi bi-arrows-collapse me-2"></i>Amortiguadores
            </h4>
            <div class="row g-3">
              @if (mod.detalle?.amortiguadorDelantero) {
              <div class="col-12 col-md-6">
                <div class="p-3 border bg-white h-100">
                  <h6 class="fw-bold text-uppercase mb-2 small text-muted">
                    Delantero
                  </h6>
                  <div class="row g-2">
                    <div class="col-12">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaAmortiguadorDelantero"
                        name="marcaAmortiguadorDelantero{{ i }}"
                      />
                    </div>
                    <div class="col-12">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaAmortiguadorDelantero"
                        name="referenciaAmortiguadorDelantero{{ i }}"
                      />
                    </div>
                  </div>
                </div>
              </div>
              } @if (mod.detalle?.amortiguadorTrasero) {
              <div class="col-12 col-md-6">
                <div class="p-3 border bg-white h-100">
                  <h6 class="fw-bold text-uppercase mb-2 small text-muted">
                    Trasero
                  </h6>
                  <div class="row g-2">
                    <div class="col-12">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaAmortiguadorTrasero"
                        name="marcaAmortiguadorTrasero{{ i }}"
                      />
                    </div>
                    <div class="col-12">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaAmortiguadorTrasero"
                        name="referenciaAmortiguadorTrasero{{ i }}"
                      />
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }

          <!-- SUPLEMENTOS (TACOS) -->
          @if (mod.detalle.suplementoSusDelantero ||
          mod.detalle.suplementoSusTrasero) {
          <div class="mb-2">
            <h4
              class="ing-sub-title text-dark bg-transparent border-0 ps-0 mb-3 border-bottom pb-2"
            >
              <i class="bi bi-layers me-2"></i>Suplementos / Tacos
            </h4>
            <div class="row g-3">
              @if (mod.detalle.suplementoSusDelantero) {
              <div class="col-12 col-md-6">
                <div class="p-3 bg-light border h-100">
                  <h6 class="fw-bold text-uppercase mb-3 text-primary">
                    Eje Delantero
                  </h6>
                  <div class="mb-2">
                    <label class="ing-label">Diámetro Eje (mm)</label>
                    <input
                      type="number"
                      class="form-control ing-input"
                      [(ngModel)]="mod.diametroTacoDelantero"
                      name="diametroTacoDelantero{{ i }}"
                      placeholder="0"
                    />
                  </div>
                  <div>
                    <label class="ing-label">Espesor Taco (mm)</label>
                    <input
                      type="number"
                      class="form-control ing-input"
                      [(ngModel)]="mod.espesorTacoDelantero"
                      name="espesorTacoDelantero{{ i }}"
                      placeholder="0"
                    />
                  </div>
                </div>
              </div>
              } @if (mod.detalle.suplementoSusTrasero) {
              <div class="col-12 col-md-6">
                <div class="p-3 bg-light border h-100">
                  <h6 class="fw-bold text-uppercase mb-3 text-primary">
                    Eje Trasero
                  </h6>
                  <div class="mb-2">
                    <label class="ing-label">Diámetro Eje (mm)</label>
                    <input
                      type="number"
                      class="form-control ing-input"
                      [(ngModel)]="mod.diametroTacoTrasero"
                      name="diametroTacoTrasero{{ i }}"
                      placeholder="0"
                    />
                  </div>
                  <div>
                    <label class="ing-label">Espesor Taco (mm)</label>
                    <input
                      type="number"
                      class="form-control ing-input"
                      [(ngModel)]="mod.espesorTacoTrasero"
                      name="espesorTacoTrasero{{ i }}"
                      placeholder="0"
                    />
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }
        </div>
      </div>
      }

      <!-- ========================================== -->
      <!-- BLOQUE: DIRECCIÓN -->
      <!-- ========================================== -->
      @if (mod.nombre === 'Dirección' && mod.seleccionado) {
      <div class="mb-5">
        <div class="ing-nested-card shadow-sm">
          <h3 class="ing-mod-title">Sistema de Dirección</h3>

          @if(mod.detalle?.amortiguadorDeDireccion){
          <div class="row g-3 mb-4">
            <div class="col-12">
              <h4 class="ing-sub-title">Amortiguador de Dirección</h4>
            </div>
            <div class="col-md-6">
              <label class="ing-label">Marca</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.marcaAmortiguador"
                name="marcaAmortiguador{{ i }}"
              />
            </div>
            <div class="col-md-6">
              <label class="ing-label">Referencia</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.referenciaAmortiguador"
                name="referenciaAmortiguador{{ i }}"
              />
            </div>
          </div>
          } @if (mod.detalle.barraDeDireccion) {
          <div class="row g-0">
            <div class="col-12">
              <h4 class="ing-sub-title mb-3">Barra de Dirección</h4>
            </div>
            <!-- Acciones -->
            <div class="col-12 col-lg-4 bg-light p-4 border">
              <label class="ing-label mb-3 text-dark">ACCIÓN A REALIZAR</label>
              <div class="d-flex flex-column gap-2">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-barra-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label"
                    for="accion-instalacion-barra-{{ i }}"
                    >Instalación</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-barra-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label"
                    for="accion-sustitucion-barra-{{ i }}"
                    >Sustitución</label
                  >
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-barra-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label"
                    for="accion-desmontaje-barra-{{ i }}"
                    >Desmontaje</label
                  >
                </div>
              </div>
            </div>
            <!-- Datos -->
            <div class="col-12 col-lg-8 p-4 border border-start-0">
              <label class="ing-label">Marca</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.marcaBarraDireccion"
                name="marcaBarraDireccion{{ i }}"
              />
            </div>
          </div>
          }
        </div>
      </div>
      }

      <!-- ========================================== -->
      <!-- BLOQUE: SUSTITUCIÓN DE EJES -->
      <!-- ========================================== -->
      @if (mod.detalle?.sustitucionDeEjes) {
      <div class="mb-5">
        <div class="ing-nested-card shadow-sm">
          <h3 class="ing-mod-title">Sustitución de Ejes</h3>
          <div class="row g-3">
            <div class="col-12 mb-2">
              <div class="alert alert-info rounded-0 d-flex align-items-center">
                <i class="bi bi-info-circle-fill me-2"></i> Indique los datos
                del vehículo donante o eje nuevo.
              </div>
            </div>
            <div class="col-md-6">
              <label class="ing-label">Marca Procedente</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.marcaEje"
                name="marcaEje{{ i }}"
              />
            </div>
            <div class="col-md-6">
              <label class="ing-label">Denominación Comercial</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.denominacionEje"
                name="denominacionEje{{ i }}"
              />
            </div>
            <div class="col-12">
              <label class="ing-label">Contraseña de Homologación</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.contrasenaHomologacionEje"
                name="contrasenaHomologacionEje{{ i }}"
              />
            </div>
          </div>
        </div>
      </div>
      }

      <!-- Amortiguador de Dirección -->
      <!-- ========================================== -->
      <!-- BLOQUE: DIRECCIÓN -->
      <!-- ========================================== -->
      @if (mod.nombre === 'Dirección' && mod.seleccionado) {
      <div class="mb-5">
        <div class="ing-nested-card shadow-sm">
          <h3 class="ing-mod-title">Sistema de Dirección</h3>

          <!-- Amortiguador de Dirección -->
          @if(mod.detalle?.amortiguadorDeDireccion){
          <div class="p-4 border-bottom">
            <div class="row g-3">
              <div class="col-12">
                <h4
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark"
                >
                  Amortiguador de Dirección
                </h4>
              </div>
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaAmortiguador"
                  name="marcaAmortiguador{{ i }}"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaAmortiguador"
                  name="referenciaAmortiguador{{ i }}"
                  placeholder="Referencia comercial"
                />
              </div>
            </div>
          </div>
          }

          <!-- Barra de Dirección -->
          @if (mod.detalle.barraDeDireccion) {
          <div class="row g-0">
            <!-- Columna Izquierda: Acciones -->
            <div class="col-12 col-lg-4 bg-light p-4 border-end">
              <h4
                class="ing-sub-title mb-3 border-0 bg-transparent ps-0 text-dark"
              >
                Barra de Dirección
              </h4>
              <label class="ing-label mb-3 text-secondary"
                >ACCIÓN A REALIZAR</label
              >
              <div class="d-flex flex-column gap-2">
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-instalacion-barra-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-instalacion-barra-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-sustitucion-barra-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-sustitucion-barra-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>
                <div class="form-check p-2 bg-white border">
                  <input
                    class="form-check-input ms-1"
                    type="checkbox"
                    id="accion-desmontaje-barra-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold ms-2"
                    for="accion-desmontaje-barra-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>
            </div>

            <!-- Columna Derecha: Datos -->
            <div class="col-12 col-lg-8 p-4">
              <div class="mt-2">
                <label class="ing-label">Marca de la Barra</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaBarraDireccion"
                  name="marcaBarraDireccion{{ i }}"
                  placeholder="Marca del fabricante"
                />
              </div>
            </div>
          </div>
          }
        </div>
      </div>
      }

      <!-- ========================================== -->
      <!-- BLOQUE: SUSTITUCIÓN DE EJES -->
      <!-- ========================================== -->
      @if (mod.detalle?.sustitucionDeEjes) {
      <div class="mb-5">
        <div class="ing-nested-card shadow-sm">
          <h3 class="ing-mod-title">Sustitución de Ejes</h3>

          <div class="p-4">
            <div class="row g-3">
              <div class="col-12 mb-2">
                <div
                  class="alert alert-light border-start border-4 border-info rounded-0 d-flex align-items-center shadow-sm"
                >
                  <i class="bi bi-info-circle-fill text-info fs-4 me-3"></i>
                  <div>
                    <strong class="d-block text-uppercase small mb-1"
                      >Información Requerida</strong
                    >
                    <span class="small text-muted"
                      >Indique los datos técnicos del vehículo donante o del eje
                      nuevo instalado.</span
                    >
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Marca Procedente</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaEje"
                  name="marcaEje{{ i }}"
                  placeholder="Marca origen"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Denominación Comercial</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.denominacionEje"
                  name="denominacionEje{{ i }}"
                  placeholder="Modelo comercial"
                />
              </div>

              <div class="col-12">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.contrasenaHomologacionEje"
                  name="contrasenaHomologacionEje{{ i }}"
                  placeholder="Ej: e1*2001/116*0000*00"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      }
      <!-- Suspensión -->
      @if ( mod.nombre === 'Suspensión' && mod.seleccionado &&
      datosEntrada.tipoVehiculo === 'moto' ) {
      <div class="mb-5">
        @if (mod.detalle?.horquillaDelanteraMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Horquilla Delantera</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referencia"
                  name="referenciaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                  placeholder="Referencia de la pieza"
                />
              </div>
            </div>
          </div>
        </div>
        } @if (mod.detalle?.muelleDelanteroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Muelle Delantero</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referencia"
                  name="referenciaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                  placeholder="Referencia de la pieza"
                />
              </div>
            </div>
          </div>
        </div>
        } @if (mod.detalle?.muelleTraseroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Muelle Trasero</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referencia"
                  name="referenciaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                  placeholder="Referencia de la pieza"
                />
              </div>
            </div>
          </div>
        </div>
        } @if (mod.detalle?.amortiguadorDelanteroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Amortiguador Delantero</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referencia"
                  name="referenciaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                  placeholder="Referencia de la pieza"
                />
              </div>
            </div>
          </div>
        </div>
        } @if (mod.detalle?.amortiguadorTraseroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Amortiguador Trasero</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referencia"
                  name="referenciaSuspension{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                  placeholder="Referencia de la pieza"
                />
              </div>
            </div>
          </div>
        </div>
        }
      </div>
      }
      <!-- Carrocería -->
      @if (mod.nombre === 'Carrocería' && mod.seleccionado) {
      <div class="ing-nested-card shadow-sm mb-4">
        @if (mod.detalle?.guardabarrosDelanteroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Guardabarros Delantero</h3>

            <div class="row g-3">
              <!-- Tipo de Fabricación -->
              <div class="col-12">
                <label class="ing-label">Tipo de Fabricación</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.tipoFabricacionGuardabarrosDelantero"
                  name="tipoFabricacionGuardabarrosDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.tipoFabricacionGuardabarrosDelantero
                  "
                >
                  <option value="" disabled selected>-- SELECCIONAR --</option>
                  <option value="comercial">
                    Comercial (Marca y Referencia)
                  </option>
                  <option value="artesanal">
                    Artesanal (Fabricación propia)
                  </option>
                </select>
              </div>

              <!-- Datos Comerciales (Condicional) -->
              @if (mod.tipoFabricacionGuardabarrosDelantero === 'comercial') {
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaDelantero"
                  name="marcaDelantero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaDelantero"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaDelantero"
                  name="referenciaDelantero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referenciaDelantero"
                  placeholder="Ref. comercial"
                />
              </div>
              }

              <div class="col-12 my-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Especificaciones
                </h6>
              </div>

              <!-- Dimensiones -->
              <div class="col-md-6">
                <label class="ing-label">Dimensiones</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.dimensionesDelantero"
                  name="dimensionesDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.dimensionesDelantero
                  "
                  placeholder="Ej: 150x600 mm"
                />
              </div>

              <!-- Sujeción -->
              <div class="col-md-6">
                <label class="ing-label">Diámetro Tornillos</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.metricaGuardabarrosDelantero"
                  name="metricaGuardabarrosDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaGuardabarrosDelantero == null
                  "
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
              </div>
            </div>
          </div>
        </div>
        } @if (mod.detalle?.guardabarrosTraseroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Guardabarros Trasero</h3>

            <div class="row g-3">
              <div class="col-12">
                <label class="ing-label">Tipo de Fabricación</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.tipoFabricacionGuardabarrosTrasero"
                  name="tipoFabricacionGuardabarrosTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.tipoFabricacionGuardabarrosTrasero
                  "
                >
                  <option value="" disabled selected>-- SELECCIONAR --</option>
                  <option value="comercial">
                    Comercial (Marca y Referencia)
                  </option>
                  <option value="artesanal">
                    Artesanal (Fabricación propia)
                  </option>
                </select>
              </div>

              @if (mod.tipoFabricacionGuardabarrosTrasero === 'comercial') {
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcatRasero"
                  name="marcatRasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcatRasero"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaTrasero"
                  name="referenciaTrasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referenciaTrasero"
                  placeholder="Ref. comercial"
                />
              </div>
              }

              <div class="col-12 my-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Especificaciones
                </h6>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Dimensiones</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.dimensionesTrasero"
                  name="dimensionesTrasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.dimensionesTrasero"
                  placeholder="Ej: 150x600 mm"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Diámetro Tornillos</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.metricaGuardabarrosTrasero"
                  name="metricaGuardabarrosTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaGuardabarrosTrasero == null
                  "
                >
                  <option [value]="null" disabled selected>
                    -- SELECCIONAR --
                  </option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
              </div>
            </div>
          </div>
        </div>
        }
        <!-- VELOCÍMETRO -->
        @if (mod.detalle?.velocimetroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Velocímetro</h3>

            <div class="row g-3">
              <div class="col-12 mb-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Datos del Componente
                </h6>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaVelocimetro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referencia"
                  name="referenciaVelocimetro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.referencia"
                  placeholder="Referencia de la pieza"
                />
              </div>

              <div class="col-12">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.homologacion"
                  name="homologacionVelocimetro{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacion"
                  placeholder="Ej: E9*1234*00"
                />
              </div>

              <div class="col-12 mt-4 mb-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Sujeción
                </h6>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Diámetro Tornillos</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.metricaVelocimetro"
                  name="metricaVelocimetro{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.metricaVelocimetro == null
                  "
                >
                  <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Nº de Tornillos</label>
                <input
                  type="number"
                  min="0"
                  class="form-control ing-input"
                  [(ngModel)]="mod.nTornillosVelocimetro"
                  name="nTornillosVelocimetro{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.nTornillosVelocimetro
                  "
                  placeholder="0"
                />
              </div>
            </div>
          </div>
        </div>
        }

        <!-- RETROVISORES -->
        @if (mod.detalle?.retrovisoresMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Retrovisores</h3>

            <div class="row g-3">
              <div class="col-12 mb-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Datos del Componente
                </h6>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marca"
                  name="marcaRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marca"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modelo"
                  name="modeloRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modelo"
                  placeholder="Modelo comercial"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Marcaje</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaje"
                  name="marcajeRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaje"
                  placeholder="Ej: E9 001234"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.homologacion"
                  name="homologacionRetrovisores{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.homologacion"
                  placeholder="Ej: E9*2002/24*1234*00"
                />
              </div>
            </div>
          </div>
        </div>
        }
      </div>
      }

      <!-- Freno -->
      @if (mod.nombre === 'Freno' && mod.seleccionado) {
      <div class="mb-5">
        <!-- BLOQUE LATIGUILLOS -->
        @if(mod.detalle?.latiguillosMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Latiguillos de Freno</h3>

            <div class="row g-4">
              <!-- Eje Delantero -->
              <div class="col-12 col-lg-6">
                <div class="p-3 bg-light border h-100">
                  <h6
                    class="ing-sub-title mb-3 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Eje Delantero
                  </h6>
                  <div class="row g-2">
                    <div class="col-12">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaDelanteros"
                        name="marcaDelanteros{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.marcaDelanteros
                        "
                        placeholder="Marca latiguillos"
                      />
                    </div>
                    <div class="col-12">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaDelanteros"
                        name="referenciaDelanteros{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaDelanteros
                        "
                        placeholder="Ref. comercial"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Eje Trasero -->
              <div class="col-12 col-lg-6">
                <div class="p-3 bg-light border h-100">
                  <h6
                    class="ing-sub-title mb-3 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                  >
                    Eje Trasero
                  </h6>
                  <div class="row g-2">
                    <div class="col-12">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.marcaTraseros"
                        name="marcaTraseros{{ i }}"
                        required
                        [class.is-invalid]="formSubmitted && !mod.marcaTraseros"
                        placeholder="Marca latiguillos"
                      />
                    </div>
                    <div class="col-12">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mod.referenciaTraseros"
                        name="referenciaTraseros{{ i }}"
                        required
                        [class.is-invalid]="
                          formSubmitted && !mod.referenciaTraseros
                        "
                        placeholder="Ref. comercial"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        }

        <!-- BLOQUE DISCOS Y PINZAS -->
        @if ( mod.detalle?.discosPerforadosRayadosMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-3">Componentes de Fricción</h3>

            <!-- Selección de Componente -->
            <div class="mb-4 p-3 bg-light border">
              <label class="ing-label mb-2 text-dark fw-bold"
                >¿Qué elementos se han sustituido?</label
              >
              <div class="d-flex flex-wrap gap-3">
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [(ngModel)]="mod.tieneDisco"
                    id="tieneDisco{{ i }}"
                    name="tieneDisco{{ i }}"
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold"
                    for="tieneDisco{{ i }}"
                  >
                    Discos de Freno
                  </label>
                </div>
                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [(ngModel)]="mod.tienePastilla"
                    id="tienePastilla{{ i }}"
                    name="tienePastilla{{ i }}"
                  />
                  <label
                    class="form-check-label ing-check-label fw-bold"
                    for="tienePastilla{{ i }}"
                  >
                    Pinzas de Freno
                  </label>
                </div>
              </div>
              @if (formSubmitted && !mod.tieneDisco && !mod.tienePastilla) {
              <div class="text-danger mt-2 small fw-bold">
                <i class="bi bi-exclamation-circle me-1"></i> Selección
                requerida.
              </div>
              }
            </div>

            <!-- SECCIÓN DISCOS -->
            @if (mod.tieneDisco) {
            <div class="mb-5">
              <h4
                class="ing-sub-title border-start-0 ps-0 text-dark bg-transparent border-bottom pb-2"
              >
                <i class="bi bi-disc me-2"></i>Discos de Freno
              </h4>

              <div class="mb-3">
                <label class="ing-label">Ubicación de la reforma</label>
                <div class="d-flex gap-4">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.discoDelantero"
                      id="discoDelantero{{ i }}"
                      name="discoDelantero{{ i }}"
                    />
                    <label
                      class="form-check-label ing-check-label"
                      for="discoDelantero{{ i }}"
                      >Delantero</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.discoTrasero"
                      id="discoTrasero{{ i }}"
                      name="discoTrasero{{ i }}"
                    />
                    <label
                      class="form-check-label ing-check-label"
                      for="discoTrasero{{ i }}"
                      >Trasero</label
                    >
                  </div>
                </div>
                @if (formSubmitted && !mod.discoDelantero && !mod.discoTrasero)
                {
                <div class="text-danger mt-1 small">
                  Seleccione al menos un eje.
                </div>
                }
              </div>

              <div class="row g-4">
                <!-- Disco Delantero -->
                @if (mod.discoDelantero) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-white h-100">
                    <h6 class="text-uppercase fw-bold text-muted small mb-3">
                      Eje Delantero
                    </h6>
                    <div class="row g-2">
                      <div class="col-12">
                        <label class="ing-label">Marca</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.marcaDiscoDelantero"
                          name="marcaDiscoDelantero{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.marcaDiscoDelantero
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Referencia</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.referenciaDiscoDelantero"
                          name="referenciaDiscoDelantero{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.referenciaDiscoDelantero
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Diámetro Tornillos</label>
                        <select
                          class="form-select ing-select"
                          [(ngModel)]="mod.metrica"
                          name="metricaDiscoDelantero{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && mod.metrica == null
                          "
                        >
                          <option [value]="null" disabled selected>--</option>
                          @for (num of metricasTornillos; track num) {
                          <option [value]="num">{{ num }}</option>
                          }
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                }

                <!-- Disco Trasero -->
                @if (mod.discoTrasero) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-white h-100">
                    <h6 class="text-uppercase fw-bold text-muted small mb-3">
                      Eje Trasero
                    </h6>
                    <div class="row g-2">
                      <div class="col-12">
                        <label class="ing-label">Marca</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.marcaDiscoTrasero"
                          name="marcaDiscoTrasero{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.marcaDiscoTrasero
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Referencia</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.referenciaDiscoTrasero"
                          name="referenciaDiscoTrasero{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.referenciaDiscoTrasero
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Diámetro Tornillos</label>
                        <select
                          class="form-select ing-select"
                          [(ngModel)]="mod.metrica"
                          name="metricaDiscoTrasero{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && mod.metrica == null
                          "
                        >
                          <option [value]="null" disabled selected>--</option>
                          @for (num of metricasTornillos; track num) {
                          <option [value]="num">{{ num }}</option>
                          }
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
            }

            <!-- SECCIÓN PINZAS -->
            @if (mod.tienePastilla) {
            <div class="mb-2">
              <h4
                class="ing-sub-title border-start-0 ps-0 text-dark bg-transparent border-bottom pb-2"
              >
                <i class="bi bi-bounding-box me-2"></i>Pinzas de Freno
              </h4>

              <div class="mb-3">
                <label class="ing-label">Ubicación de la reforma</label>
                <div class="d-flex gap-4">
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.pastillaDelantera"
                      id="pastillaDelantera{{ i }}"
                      name="pastillaDelantera{{ i }}"
                    />
                    <label
                      class="form-check-label ing-check-label"
                      for="pastillaDelantera{{ i }}"
                      >Delantero</label
                    >
                  </div>
                  <div class="form-check">
                    <input
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="mod.pastillaTrasera"
                      id="pastillaTrasera{{ i }}"
                      name="pastillaTrasera{{ i }}"
                    />
                    <label
                      class="form-check-label ing-check-label"
                      for="pastillaTrasera{{ i }}"
                      >Trasero</label
                    >
                  </div>
                </div>
                @if (formSubmitted && !mod.pastillaDelantera &&
                !mod.pastillaTrasera) {
                <div class="text-danger mt-1 small">
                  Seleccione al menos un eje.
                </div>
                }
              </div>

              <div class="row g-4">
                <!-- Pinza Delantera -->
                @if (mod.pastillaDelantera) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-white h-100">
                    <h6 class="text-uppercase fw-bold text-muted small mb-3">
                      Eje Delantero
                    </h6>
                    <div class="row g-2">
                      <div class="col-12">
                        <label class="ing-label">Marca</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.marcaPastillaDelantera"
                          name="marcaPastillaDelantera{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.marcaPastillaDelantera
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Referencia</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.referenciaPastillaDelantera"
                          name="referenciaPastillaDelantera{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.referenciaPastillaDelantera
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Diámetro Tornillos</label>
                        <select
                          class="form-select ing-select"
                          [(ngModel)]="mod.metrica"
                          name="metricaPinzaDelantera{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && mod.metrica == null
                          "
                        >
                          <option [value]="null" disabled selected>--</option>
                          @for (num of metricasTornillos; track num) {
                          <option [value]="num">{{ num }}</option>
                          }
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                }

                <!-- Pinza Trasera -->
                @if (mod.pastillaTrasera) {
                <div class="col-12 col-lg-6">
                  <div class="p-3 border bg-white h-100">
                    <h6 class="text-uppercase fw-bold text-muted small mb-3">
                      Eje Trasero
                    </h6>
                    <div class="row g-2">
                      <div class="col-12">
                        <label class="ing-label">Marca</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.marcaPastillaTrasera"
                          name="marcaPastillaTrasera{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.marcaPastillaTrasera
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Referencia</label>
                        <input
                          class="form-control ing-input"
                          type="text"
                          [(ngModel)]="mod.referenciaPastillaTrasera"
                          name="referenciaPastillaTrasera{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && !mod.referenciaPastillaTrasera
                          "
                        />
                      </div>
                      <div class="col-12">
                        <label class="ing-label">Diámetro Tornillos</label>
                        <select
                          class="form-select ing-select"
                          [(ngModel)]="mod.metrica"
                          name="metricaPinzaTrasera{{ i }}"
                          required
                          [class.is-invalid]="
                            formSubmitted && mod.metrica == null
                          "
                        >
                          <option [value]="null" disabled selected>--</option>
                          @for (num of metricasTornillos; track num) {
                          <option [value]="num">{{ num }}</option>
                          }
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                }
              </div>
            </div>
            }
          </div>
        </div>
        }
      </div>
      }

      <!-- Luces -->
      @if (mod.nombre === 'Luces' && mod.seleccionado) {
      <div class="mb-5">
        @if(mod.detalle.faroDelanteroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Faro Delantero</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaFaroDelantero"
                  name="marcaFaroDelantero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaFaroDelantero"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloFaroDelantero"
                  name="modeloFaroDelantero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloFaroDelantero"
                  placeholder="Modelo comercial"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaFaroDelantero"
                  name="referenciaFaroDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaFaroDelantero
                  "
                  placeholder="Ref. en la tulipa"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Marcajes</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcajesFaroDelantero"
                  name="marcajesFaroDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.marcajesFaroDelantero
                  "
                  placeholder="Ej: HR PL 50R"
                />
              </div>
              <div class="col-12">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.homologacionFaroDelantero"
                  name="homologacionFaroDelantero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.homologacionFaroDelantero
                  "
                  placeholder="Ej: E9*113R00*2233*00"
                />
              </div>
            </div>
          </div>
        </div>
        } @if(mod.detalle.PilotoTraseroMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Piloto Trasero</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaPilotoTrasero"
                  name="marcaPilotoTrasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaPilotoTrasero"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloPilotoTrasero"
                  name="modeloPilotoTrasero{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloPilotoTrasero"
                  placeholder="Modelo comercial"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaPilotoTrasero"
                  name="referenciaPilotoTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaPilotoTrasero
                  "
                  placeholder="Ref. en la tulipa"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Marcajes</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcajesPilotoTrasero"
                  name="marcajesPilotoTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.marcajesPilotoTrasero
                  "
                  placeholder="Ej: 50R-001234"
                />
              </div>
              <div class="col-12">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.homologacionPilotoTrasero"
                  name="homologacionPilotoTrasero{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.homologacionPilotoTrasero
                  "
                  placeholder="Ej: E9*50R00*1234*00"
                />
              </div>
            </div>
          </div>
        </div>
        } @if(mod.detalle.luzDeMatriculaMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Luz de Matrícula</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaLuzMatricula"
                  name="marcaLuzMatricula{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaLuzMatricula"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloLuzMatricula"
                  name="modeloLuzMatricula{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloLuzMatricula"
                  placeholder="Modelo comercial"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaLuzMatricula"
                  name="referenciaLuzMatricula{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaLuzMatricula
                  "
                  placeholder="Ref. en la tulipa"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Marcajes</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcajesLuzMatricula"
                  name="marcajesLuzMatricula{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.marcajesLuzMatricula
                  "
                  placeholder="Ej: L-00"
                />
              </div>
              <div class="col-12">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.homologacionLuzMatricula"
                  name="homologacionLuzMatricula{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.homologacionLuzMatricula
                  "
                  placeholder="Ej: E9*50R00*5678*00"
                />
              </div>
            </div>
          </div>
        </div>
        } @if(mod.detalle.intermitentesMoto) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">Intermitentes</h3>
            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaIntermitentes"
                  name="marcaIntermitentes{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaIntermitentes"
                  placeholder="Marca del fabricante"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloIntermitentes"
                  name="modeloIntermitentes{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloIntermitentes"
                  placeholder="Modelo comercial"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Referencia</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.referenciaIntermitentes"
                  name="referenciaIntermitentes{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.referenciaIntermitentes
                  "
                  placeholder="Ref. en la tulipa"
                />
              </div>
              <div class="col-md-6">
                <label class="ing-label">Marcajes</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcajesIntermitentes"
                  name="marcajesIntermitentes{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.marcajesIntermitentes
                  "
                  placeholder="Ej: 11, 12"
                />
              </div>
              <div class="col-12">
                <label class="ing-label">Contraseña de Homologación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.homologacionIntermitentes"
                  name="homologacionIntermitentes{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.homologacionIntermitentes
                  "
                  placeholder="Ej: E9*50R00*9999*00"
                />
              </div>
            </div>
          </div>
        </div>
        }
      </div>
      }

      <!-- CAMPERS -->
      @if(mod.nombre === 'Modificaciones en el interior del vehículo' &&
      mod.seleccionado) { @if(mod.detalle.mobiliarioInterior){
      <!-- MOBILIARIO INTERIOR VEHÍCULO -->
      @if (mod.detalle.mobiliarioInterior) {
      <div class="ing-nested-card shadow-sm mb-4">
        <div class="p-4">
          <div
            class="d-flex justify-content-between align-items-end border-bottom pb-2 mb-4"
          >
            <h3 class="ing-mod-title mb-0 border-0 p-0 mt-0">
              Mobiliario Interior Vehículo
            </h3>
            <span
              class="text-muted small text-uppercase"
              style="font-family: var(--font-reading)"
            >
              Gestión de muebles y tornillería
            </span>
          </div>

          <!-- Selector global de tornillos -->
          <div class="row g-3">
            <div class="col-12 col-md-6">
              <label class="ing-label" for="diametro-tornillo-{{ i }}">
                Diámetro de Tornillo (Global)
              </label>
              <select
                class="form-select ing-select"
                id="diametro-tornillo-{{ i }}"
                [(ngModel)]="mod.diametroTornilloSeleccionado"
                name="diametroTornilloSeleccionado{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && mod.diametroTornilloSeleccionado == null
                "
              >
                <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                @for (t of tornillosDB; track t.diametro) {
                <option [ngValue]="t.diametro">{{ t.diametro }} mm</option>
                }
              </select>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Mueble Bajo -->
          @if (mod.mobiliarioInterior?.muebleBajo) {
          <div class="mb-5">
            <div
              class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
            >
              <h4
                class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark"
              >
                <i class="bi bi-box-seam me-2"></i>Mueble Bajo
              </h4>
              <div class="btn-group">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger rounded-0 fw-bold text-uppercase"
                  (click)="borrarUltimoMueble(mod, 'bajo')"
                >
                  <i class="bi bi-dash-lg"></i> Borrar
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-success rounded-0 fw-bold text-uppercase"
                  (click)="anadirMueble(mod, 'bajo')"
                >
                  <i class="bi bi-plus-lg"></i> Añadir
                </button>
              </div>
            </div>

            <div class="bg-light p-3 border">
              @if (mod.mueblesBajo.length === 0) {
              <p class="text-muted small text-center mb-0 fst-italic">
                // No hay muebles registrados
              </p>
              } @for (mueble of mod.mueblesBajo; track mueble; let j = $index) {
              <div class="card rounded-0 border shadow-sm mb-3">
                <div
                  class="card-header bg-white border-bottom fw-bold small text-uppercase text-muted"
                >
                  Ítem #{{ j + 1 }}
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="ing-label">Medidas (mm)</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.medidas"
                        name="medidasBajo{{ j }}"
                        placeholder="Ej: 600x1420x900"
                      />
                    </div>
                    <div class="col-md-4">
                      <label class="ing-label">Peso (Kg)</label>
                      <div class="input-group">
                        <input
                          type="text"
                          class="form-control ing-input"
                          [(ngModel)]="mueble.pesoMuebleBajo"
                          name="pesoMuebleBajo{{ j }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                          >Kg</span
                        >
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label class="ing-label">Nº Tornillos</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.tornillosMuebleBajo"
                        name="tornillosMuebleBajo{{ j }}"
                        placeholder="0"
                      />
                    </div>

                    <div class="col-12">
                      <label class="ing-label">Fabricación</label>
                      <select
                        class="form-select ing-select"
                        [(ngModel)]="mueble.tipoFabricacionMuebleBajo"
                        name="tipoFabricacionMuebleBajo{{ i }}_{{ j }}"
                        required
                      >
                        <option value="" disabled selected>
                          -- SELECCIONAR --
                        </option>
                        <option value="comercial">Marca y Referencia</option>
                        <option value="aceroArtesanal">Acero Artesanal</option>
                        <option value="maderaArtesanal">
                          Madera Artesanal
                        </option>
                      </select>
                    </div>

                    @if (mueble.tipoFabricacionMuebleBajo === 'comercial') {
                    <div class="col-md-6">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.marcaMuebleBajo"
                        name="marcaMuebleBajo{{ i }}_{{ j }}"
                        placeholder="Marca"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.referenciaMuebleBajo"
                        name="referenciaMuebleBajo{{ i }}_{{ j }}"
                        placeholder="Referencia"
                      />
                    </div>
                    }
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          } @if (mod.mobiliarioInterior?.muebleAlto) {
          <div class="mb-5">
            <div
              class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
            >
              <h4
                class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark"
              >
                <i class="bi bi-archive me-2"></i>Mueble Alto
              </h4>
              <div class="btn-group">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger rounded-0 fw-bold text-uppercase"
                  (click)="borrarUltimoMueble(mod, 'alto')"
                >
                  <i class="bi bi-dash-lg"></i> Borrar
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-success rounded-0 fw-bold text-uppercase"
                  (click)="anadirMueble(mod, 'alto')"
                >
                  <i class="bi bi-plus-lg"></i> Añadir
                </button>
              </div>
            </div>

            <div class="bg-light p-3 border">
              @if (mod.mueblesAlto.length === 0) {
              <p class="text-muted small text-center mb-0 fst-italic">
                // No hay muebles registrados
              </p>
              } @for (mueble of mod.mueblesAlto; track mueble; let j = $index) {
              <div class="card rounded-0 border shadow-sm mb-3">
                <div
                  class="card-header bg-white border-bottom fw-bold small text-uppercase text-muted"
                >
                  Ítem #{{ j + 1 }}
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="ing-label">Medidas (mm)</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.medidas"
                        name="medidasAlto{{ j }}"
                        placeholder="Ej: 1250x405x325"
                      />
                    </div>
                    <div class="col-md-4">
                      <label class="ing-label">Peso (Kg)</label>
                      <div class="input-group">
                        <input
                          type="text"
                          class="form-control ing-input"
                          [(ngModel)]="mueble.pesoMuebleAlto"
                          name="pesoMuebleAlto{{ j }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                          >Kg</span
                        >
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label class="ing-label">Nº Tornillos</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.tornillosMuebleAlto"
                        name="tornillosMuebleAlto{{ j }}"
                        placeholder="0"
                      />
                    </div>

                    <div class="col-12">
                      <label class="ing-label">Fabricación</label>
                      <select
                        class="form-select ing-select"
                        [(ngModel)]="mueble.tipoFabricacionMuebleAlto"
                        name="tipoFabricacionMuebleAlto{{ i }}_{{ j }}"
                        required
                      >
                        <option value="" disabled selected>
                          -- SELECCIONAR --
                        </option>
                        <option value="comercial">Marca y Referencia</option>
                        <option value="aceroArtesanal">Acero Artesanal</option>
                        <option value="maderaArtesanal">
                          Madera Artesanal
                        </option>
                      </select>
                    </div>

                    @if (mueble.tipoFabricacionMuebleAlto === 'comercial') {
                    <div class="col-md-6">
                      <label class="ing-label">Marca</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.marcaMuebleAlto"
                        name="marcaMuebleAlto{{ i }}_{{ j }}"
                        placeholder="Marca"
                      />
                    </div>
                    <div class="col-md-6">
                      <label class="ing-label">Referencia</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="mueble.referenciaMuebleAlto"
                        name="referenciaMuebleAlto{{ i }}_{{ j }}"
                        placeholder="Referencia"
                      />
                    </div>
                    }
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }

          <!-- Aseo -->
          @if (mod.mobiliarioInterior?.aseo) {
          <div class="mb-5">
            <div
              class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
            >
              <h4
                class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark"
              >
                <i class="bi bi-droplet me-2"></i>Aseo / Cabina
              </h4>
              <div class="btn-group">
                <button
                  type="button"
                  class="btn btn-sm btn-outline-danger rounded-0 fw-bold text-uppercase"
                  (click)="borrarUltimoMueble(mod, 'aseo')"
                >
                  <i class="bi bi-dash-lg"></i> Borrar
                </button>
                <button
                  type="button"
                  class="btn btn-sm btn-success rounded-0 fw-bold text-uppercase"
                  (click)="anadirMueble(mod, 'aseo')"
                >
                  <i class="bi bi-plus-lg"></i> Añadir
                </button>
              </div>
            </div>

            <div class="bg-light p-3 border">
              @if (mod.mueblesAseo.length === 0) {
              <p class="text-muted small text-center mb-0 fst-italic">
                // No hay módulos de aseo registrados
              </p>
              } @for (aseo of mod.mueblesAseo; track aseo; let j = $index) {
              <div class="card rounded-0 border shadow-sm mb-3">
                <div
                  class="card-header bg-white border-bottom fw-bold small text-uppercase text-muted"
                >
                  Módulo #{{ j + 1 }}
                </div>
                <div class="card-body">
                  <div class="row g-3">
                    <div class="col-md-4">
                      <label class="ing-label">Medidas (mm)</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="aseo.medidas"
                        name="medidasAseo{{ j }}"
                        placeholder="Ej: 1030x2100x590"
                        required
                      />
                    </div>
                    <div class="col-md-4">
                      <label class="ing-label">Peso (Kg)</label>
                      <div class="input-group">
                        <input
                          type="text"
                          class="form-control ing-input"
                          [(ngModel)]="aseo.pesoMuebleAseo"
                          name="pesoMuebleAseo{{ j }}"
                          placeholder="0"
                        />
                        <span
                          class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                          >Kg</span
                        >
                      </div>
                    </div>
                    <div class="col-md-4">
                      <label class="ing-label">Nº Tornillos</label>
                      <input
                        type="text"
                        class="form-control ing-input"
                        [(ngModel)]="aseo.tornillosMuebleAseo"
                        name="tornillosMuebleAseo{{ j }}"
                        placeholder="0"
                      />
                    </div>
                    <div class="col-12">
                      <label class="ing-label">Descripción Interior</label>
                      <textarea
                        class="form-control ing-input"
                        rows="3"
                        [(ngModel)]="aseo.descripcion"
                        name="descripcionAseo{{ j }}"
                        placeholder="Detalle equipamiento interior (ducha, WC, lavabo...)"
                        required
                      ></textarea>
                    </div>
                  </div>
                </div>
              </div>
              }
            </div>
          </div>
          }
        </div>
      </div>
      }
      <!-- CLARABOYA -->
      @if (mod.mobiliarioInterior?.claraboyas) {
      <div class="mb-5">
        <div
          class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
        >
          <h4 class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark">
            <i class="bi bi-window me-2"></i>Claraboya
          </h4>
        </div>

        <div class="bg-light p-4 border">
          <div class="row g-3">
            <div class="col-md-2">
              <label class="ing-label">Cantidad</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.cantidadClaraboya"
                name="cantidadClaraboya{{ i }}"
                placeholder="0"
              />
            </div>
            <div class="col-md-5">
              <label class="ing-label">Marca</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.marcaClaraboya"
                name="marcaClaraboya{{ i }}"
                placeholder="Marca del fabricante"
              />
            </div>
            <div class="col-md-5">
              <label class="ing-label">Modelo</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.modeloClaraboya"
                name="modeloClaraboya{{ i }}"
                placeholder="Modelo comercial"
              />
            </div>

            <div class="col-12">
              <label class="ing-label">Contraseña de Homologación</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.homologacionClaraboya"
                name="homologacionClaraboya{{ i }}"
                placeholder="Ej: E1 43R-001234"
              />
            </div>

            <div class="col-12">
              <label class="ing-label">Descripción Técnica</label>
              <textarea
                class="form-control ing-input"
                rows="2"
                [(ngModel)]="mod.descripcionClaraboya"
                name="descripcionClaraboya{{ i }}"
                placeholder="Detalles de instalación, dimensiones de corte..."
              ></textarea>
            </div>
          </div>
        </div>
      </div>
      }
      <!-- VENTANA -->
      @if (mod.mobiliarioInterior?.ventanas) {
      <div class="mb-5">
        <div
          class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
        >
          <h4 class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark">
            <i class="bi bi-aspect-ratio me-2"></i>Ventana
          </h4>
        </div>

        <div class="bg-light p-4 border">
          <div class="row g-3">
            <div class="col-md-2">
              <label class="ing-label">Cantidad</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.cantidadVentanas"
                name="cantidadVentanas{{ i }}"
                placeholder="0"
              />
            </div>
            <div class="col-md-5">
              <label class="ing-label">Marca</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.marcaVentana"
                name="marcaVentana{{ i }}"
                placeholder="Marca del fabricante"
              />
            </div>
            <div class="col-md-5">
              <label class="ing-label">Modelo</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.modeloVentana"
                name="modeloVentana{{ i }}"
                placeholder="Modelo comercial"
              />
            </div>

            <div class="col-md-6">
              <label class="ing-label">Dimensiones</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.dimensionesVentana"
                name="dimensionesVentana{{ i }}"
                placeholder="Ej: 900x450 mm"
              />
            </div>

            <div class="col-md-6">
              <label class="ing-label">Contraseña de Homologación</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.homologacionVentana"
                name="homologacionVentana{{ i }}"
                placeholder="Ej: 43R-001234"
              />
            </div>

            <div class="col-12">
              <label class="ing-label">Descripción Técnica</label>
              <textarea
                class="form-control ing-input"
                rows="2"
                [(ngModel)]="mod.descripcionVentana"
                name="descripcionVentana{{ i }}"
                placeholder="Ubicación, tipo de apertura, material..."
              ></textarea>
            </div>
          </div>
        </div>
      </div>
      } } @if(mod.detalle.fontaneria){
      <!-- DEPÓSITO DE AGUA SUCIA -->
      @if (mod.fontaneria?.depositoAguaSucia) {
      <div class="mb-5">
        <div
          class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
        >
          <h4 class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark">
            <i class="bi bi-trash3 me-2"></i>Depósito de Agua Sucia
          </h4>
        </div>

        <div class="bg-light p-4 border">
          <div class="row g-3">
            <div class="col-md-4">
              <label class="ing-label">Capacidad</label>
              <div class="input-group">
                <input
                  type="number"
                  min="0"
                  class="form-control ing-input"
                  [(ngModel)]="mod.litrosAguaSucia"
                  name="litrosAguaSucia{{ i }}"
                  placeholder="0"
                />
                <span
                  class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                  >L</span
                >
              </div>
            </div>

            <div class="col-md-4">
              <label class="ing-label">Diámetro Tornillos</label>
              <select
                class="form-select ing-select"
                [(ngModel)]="mod.metricaDepositoSucia"
                name="metricaDepositoSucia{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && mod.metricaDepositoSucia == null
                "
              >
                <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">{{ num }}</option>
                }
              </select>
            </div>

            <div class="col-md-4">
              <label class="ing-label">Nº de Tornillos</label>
              <input
                type="number"
                min="0"
                class="form-control ing-input"
                [(ngModel)]="mod.nTornillosDepositoSucia"
                name="nTornillosDepositoSucia{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && !mod.nTornillosDepositoSucia
                "
                placeholder="0"
              />
            </div>
          </div>
        </div>
      </div>
      }
      <!-- DEPÓSITO DE AGUA LIMPIA -->
      @if (mod.fontaneria?.depositoAguaLimpia) {
      <div class="mb-5">
        <div
          class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
        >
          <h4 class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark">
            <i class="bi bi-droplet-half me-2"></i>Depósito de Agua Limpia
          </h4>
        </div>

        <div class="bg-light p-4 border">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="ing-label">Capacidad</label>
              <div class="input-group">
                <input
                  type="number"
                  min="0"
                  class="form-control ing-input"
                  [(ngModel)]="mod.litrosAguaLimpia"
                  name="litrosAguaLimpia{{ i }}"
                  placeholder="0"
                />
                <span
                  class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                  >L</span
                >
              </div>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Medidas (mm)</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.medidasAguaLimpia"
                name="medidasAguaLimpia{{ i }}"
                placeholder="Ej: 800x400x300"
              />
            </div>

            <div class="col-12 mt-2 mb-1">
              <h6
                class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                style="font-size: 0.8rem"
              >
                Sujeción
              </h6>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Diámetro Tornillos</label>
              <select
                class="form-select ing-select"
                [(ngModel)]="mod.metricaDepositoLimpia"
                name="metricaDepositoLimpia{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && mod.metricaDepositoLimpia == null
                "
              >
                <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">{{ num }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Nº de Tornillos</label>
              <input
                type="number"
                min="0"
                class="form-control ing-input"
                [(ngModel)]="mod.nTornillosDepositoLimpia"
                name="nTornillosDepositoLimpia{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && !mod.nTornillosDepositoLimpia
                "
                placeholder="0"
              />
            </div>
          </div>
        </div>
      </div>
      }
      <!-- BOMBA DE AGUA -->
      @if (mod.fontaneria?.bombaDeAgua) {
      <div class="mb-5">
        <div
          class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
        >
          <h4 class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark">
            <i class="bi bi-water me-2"></i>Bomba de Agua
          </h4>
        </div>

        <div class="bg-light p-4 border">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="ing-label">Marca</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.marcaBombaAgua"
                name="marcaBombaAgua{{ i }}"
                placeholder="Marca del fabricante"
              />
            </div>

            <div class="col-md-6">
              <label class="ing-label">Modelo</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.modeloBombaAgua"
                name="modeloBombaAgua{{ i }}"
                placeholder="Modelo comercial"
              />
            </div>

            <div class="col-12">
              <label class="ing-label">Ubicación</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.ubicacionBombaAgua"
                name="ubicacionBombaAgua{{ i }}"
                placeholder="Ej: Bajo el fregadero, arcón trasero..."
              />
            </div>

            <div class="col-12 mt-2 mb-1">
              <h6
                class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                style="font-size: 0.8rem"
              >
                Sujeción
              </h6>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Diámetro Tornillos</label>
              <select
                class="form-select ing-select"
                [(ngModel)]="mod.metricaBombaAgua"
                name="metricaBombaAgua{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && mod.metricaBombaAgua == null
                "
              >
                <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">{{ num }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Nº de Tornillos</label>
              <input
                type="number"
                min="0"
                class="form-control ing-input"
                [(ngModel)]="mod.nTornillosBombaAgua"
                name="nTornillosBombaAgua{{ i }}"
                required
                [class.is-invalid]="formSubmitted && !mod.nTornillosBombaAgua"
                placeholder="0"
              />
            </div>
          </div>
        </div>
      </div>
      }
      <!-- DUCHA EXTERIOR -->
      @if (mod.fontaneria?.duchaExterior) {
      <div class="mb-5">
        <div
          class="d-flex justify-content-between align-items-end mb-3 border-bottom pb-2"
        >
          <h4 class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark">
            <i class="bi bi-shower me-2"></i>Ducha Exterior
          </h4>
        </div>

        <div class="bg-light p-4 border">
          <div class="row g-3">
            <div class="col-12">
              <label class="ing-label">Ubicación</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.ubicacionDuchaExterior"
                name="ubicacionDuchaExterior{{ i }}"
                placeholder="Ej: Lateral derecho trasero, accesible desde portón..."
              />
            </div>

            <div class="col-12 mt-2 mb-1">
              <h6
                class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                style="font-size: 0.8rem"
              >
                Sujeción
              </h6>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Diámetro Tornillos</label>
              <select
                class="form-select ing-select"
                [(ngModel)]="mod.metricaDuchaExterior"
                name="metricaDuchaExterior{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && mod.metricaDuchaExterior == null
                "
              >
                <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">{{ num }}</option>
                }
              </select>
            </div>

            <div class="col-md-6">
              <label class="ing-label">Nº de Tornillos</label>
              <input
                type="number"
                min="0"
                class="form-control ing-input"
                [(ngModel)]="mod.nTornillosDuchaExterior"
                name="nTornillosDuchaExterior{{ i }}"
                required
                [class.is-invalid]="
                  formSubmitted && !mod.nTornillosDuchaExterior
                "
                placeholder="0"
              />
            </div>
          </div>
        </div>
      </div>
      } } } @if (mod.nombre === 'Instalación eléctrica' && mod.seleccionado) {
      <!-- TOMA EXTERIOR 230V -->
      @if (mod.detalle.tomaCorrienteInterior) {
      <div class="ing-nested-card shadow-sm mb-4">
        <div class="p-4">
          <h3 class="ing-mod-title mb-4">
            <i class="bi bi-plug-fill me-2"></i>Toma Exterior 230V
          </h3>

          <div class="row g-3">
            <div class="col-md-4">
              <label class="ing-label">Voltaje</label>
              <div class="input-group">
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.voltajeTomaExterior"
                  name="voltajeTomaExterior{{ i }}"
                  placeholder="230"
                />
                <span
                  class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                  >V</span
                >
              </div>
            </div>

            <div class="col-md-8">
              <label class="ing-label">Medidas (mm)</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.medidasTomaExterior"
                name="medidasTomaExterior{{ i }}"
                placeholder="Ej: 100x100 mm"
              />
            </div>

            <div class="col-12">
              <label class="ing-label">Ubicación</label>
              <input
                type="text"
                class="form-control ing-input"
                [(ngModel)]="mod.ubicacionTomaExterior"
                name="ubicacionTomaExterior{{ i }}"
                placeholder="Ej: Lateral derecho, zona trasera"
              />
            </div>
          </div>
        </div>
      </div>
      } }

      <!-- INSTALACIÓN ELÉCTRICA -->
      @if (mod.nombre === 'Instalación eléctrica' && mod.seleccionado) {
      <div class="ing-nested-card shadow-sm mb-4">
        <h3 class="ing-mod-title mb-4">Instalación Eléctrica</h3>
        @if(mod.detalle.bateriaAuxiliar) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-battery-charging me-2"></i>Baterías Auxiliares
            </h3>

            <div class="row g-3">
              <div class="col-md-4">
                <label class="ing-label">Cantidad</label>
                <input
                  type="number"
                  min="0"
                  class="form-control ing-input"
                  [(ngModel)]="mod.cantidadBaterias"
                  name="cantidadBaterias{{ i }}"
                  placeholder="0"
                />
              </div>

              <div class="col-md-8">
                <label class="ing-label">Potencia / Capacidad</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.potenciaBaterias"
                  name="potenciaBaterias{{ i }}"
                  placeholder="Ej: 100Ah AGM / 1200Wh"
                />
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionBaterias"
                  name="ubicacionBaterias{{ i }}"
                  placeholder="Ej: Bajo asiento piloto, arcón trasero..."
                />
              </div>
            </div>
          </div>
        </div>
        } @if(mod.detalle.cargadorDeBateria) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-lightning-charge-fill me-2"></i>Cargador de
              Batería
            </h3>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaCargadorDeBateria"
                  name="marcaCargadorDeBateria{{ i }}"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloCarcadorDeBaretia"
                  name="modeloCarcadorDeBaretia{{ i }}"
                  placeholder="Modelo comercial"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Potencia</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.potenciaCargadorDeBateria"
                    name="potenciaCargadorDeBateria{{ i }}"
                    placeholder="Ej: 20A / 300W"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >W/A</span
                  >
                </div>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Dimensiones</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.dimensionesCargadorDeBateria"
                    name="dimensionesCargadorDeBateria{{ i }}"
                    placeholder="Ej: 200x150x50"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >mm</span
                  >
                </div>
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionCargadorDeBateria"
                  name="ubicacionCargadorDeBateria{{ i }}"
                  placeholder="Ej: Bajo asiento copiloto, armario técnico..."
                />
              </div>
            </div>
          </div>
        </div>
        }@if(mod.detalle.iluminacionExterior) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-lightbulb-fill me-2"></i>Iluminación Exterior
            </h3>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaIlumincionExterior"
                  name="marcaIluminacionExterior{{ i }}"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloIlumincionExterior"
                  name="modeloIlumincionExterior{{ i }}"
                  placeholder="Modelo comercial"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Potencia</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.potenciaIlumincionExterior"
                    name="potenciaIlumincionExterior{{ i }}"
                    placeholder="Ej: 12W"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >W</span
                  >
                </div>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Dimensiones</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.dimensionesIlumincionExterior"
                    name="dimensionesIlumincionExterior{{ i }}"
                    placeholder="Ej: 500x50"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >mm</span
                  >
                </div>
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionIlumincionExterior"
                  name="ubicacionIlumincionExterior{{ i }}"
                  placeholder="Ej: Lateral derecho, sobre puerta corredera..."
                />
              </div>
            </div>
          </div>
        </div>
        }@if(mod.detalle.inversor) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-lightning-fill me-2"></i>Inversor de Corriente
            </h3>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaInversor"
                  name="marcaInversor{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaInversor"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Potencia</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.potenciaInversor"
                    name="potenciaInversor{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.potenciaInversor"
                    placeholder="Ej: 1500"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >W</span
                  >
                </div>
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionInversor"
                  name="ubicacionInversor{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.ubicacionInversor"
                  placeholder="Ej: Bajo el asiento del conductor, armario técnico..."
                />
              </div>
            </div>
          </div>
        </div>
        }@if(mod.detalle.placaSolar) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-sun-fill me-2"></i>Placa Solar
            </h3>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaPlacaSolar"
                  name="marcaPlacaSolar{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaPlacaSolar"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloPlacaSolar"
                  name="modeloPlacaSolar{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloPlacaSolar"
                  placeholder="Modelo comercial"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Potencia</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.potenciaPlacaSolar"
                    name="potenciaPlacaSolar{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.potenciaPlacaSolar
                    "
                    placeholder="Ej: 150"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >W</span
                  >
                </div>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Dimensiones</label>
                <div class="input-group">
                  <input
                    type="text"
                    class="form-control ing-input"
                    [(ngModel)]="mod.dimensionesPlacaSolar"
                    name="dimensionesPlacaSolar{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.dimensionesPlacaSolar
                    "
                    placeholder="Ej: 1200x600"
                  />
                  <span
                    class="input-group-text bg-light border-start-0 font-monospace text-muted small"
                    >mm</span
                  >
                </div>
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionPlacaSolar"
                  name="ubicacionPlacaSolar{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.ubicacionPlacaSolar"
                  placeholder="Ej: Techo del vehículo, zona central..."
                />
              </div>
            </div>
          </div>
        </div>
        }@if(mod.detalle.reguladorSolar) {
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-cpu-fill me-2"></i>Controlador de Carga
            </h3>

            <div class="row g-3">
              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaControlador"
                  name="marcaControlador{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaControlador"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Modelo</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.modeloControlador"
                  name="modeloControlador{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.modeloControlador"
                  placeholder="Modelo comercial"
                />
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionControlador"
                  name="ubicacionControlador{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && !mod.ubicacionControlador
                  "
                  placeholder="Ej: Junto a batería auxiliar, pared lateral..."
                />
              </div>
            </div>
          </div>
        </div>
        }
      </div>
      }
      <!-- TOLDO -->
      @if (mod.nombre === 'Toldo' && mod.seleccionado) {
      <div class="mb-5">
        <div class="ing-nested-card shadow-sm mb-4">
          <div class="p-4">
            <h3 class="ing-mod-title mb-4">
              <i class="bi bi-umbrella-fill me-2"></i>Toldo
            </h3>

            <div class="row g-3">
              <div class="col-12 mb-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Datos Generales
                </h6>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Marca</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.marcaToldo"
                  name="marcaToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaToldo"
                  placeholder="Marca del fabricante"
                />
              </div>

              <div class="col-md-6">
                <label class="ing-label">Medidas</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.medidasToldo"
                  name="medidasToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.medidasToldo"
                  placeholder="Ej: 300x250 cm"
                />
              </div>

              <div class="col-12">
                <label class="ing-label">Ubicación</label>
                <input
                  type="text"
                  class="form-control ing-input"
                  [(ngModel)]="mod.ubicacionToldo"
                  name="ubicacionToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.ubicacionToldo"
                  placeholder="Ej: Lateral derecho, anclado a vierteaguas..."
                />
              </div>

              <div class="col-12 mt-4 mb-2">
                <h6
                  class="ing-sub-title mb-0 border-0 bg-transparent ps-0 text-dark border-bottom pb-2"
                >
                  Sujeción
                </h6>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Diámetro Tornillos</label>
                <select
                  class="form-select ing-select"
                  [(ngModel)]="mod.metricaToldo"
                  name="metricaToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && mod.metricaToldo == null"
                >
                  <option [ngValue]="null" disabled>-- SELECCIONAR --</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
              </div>

              <div class="col-md-6">
                <label class="ing-label">Nº de Tornillos</label>
                <input
                  type="number"
                  min="0"
                  class="form-control ing-input"
                  [(ngModel)]="mod.nTornillosToldo"
                  name="nTornillosToldo{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.nTornillosToldo"
                  placeholder="0"
                />
              </div>
            </div>
          </div>
        </div>
      </div>
      }
      <!-- Añadir más bloques según las modificaciones necesarias -->
    </div>
    }

    <div
      class="d-flex justify-content-between align-items-center mt-5 pt-4 border-top"
    >
      <button
        type="button"
        class="btn btn-ing btn-ing-outline px-4 py-2"
        (click)="onVolver()"
      >
        <i class="bi bi-arrow-left me-2"></i> VOLVER
      </button>

      <button
        type="submit"
        class="btn btn-ing btn-ing-primary px-4 py-2 shadow-sm"
      >
        CONTINUAR <i class="bi bi-arrow-right ms-2"></i>
      </button>
    </div>
  </form>
</div>
