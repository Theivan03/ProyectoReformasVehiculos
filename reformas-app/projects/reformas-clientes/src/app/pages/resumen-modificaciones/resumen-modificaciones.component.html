<div class="container mt-3">
  <form #form="ngForm" (ngSubmit)="onContinuar(form)" novalidate>
    @for (mod of modificacionesSeleccionadas; track mod; let i = $index) {
    <div>
      <!-- COCHES -->
      <!-- Enganche de remolque -->
      @if ( mod.nombre === 'Enganche de remolque' && mod.seleccionado ) {
      <div class="mb-3">
        <h3>Enganche de remolque</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaHomologado{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>

        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }

      <!-- Reducción de plazas -->
      @if (mod.nombre === 'Reducción de plazas de asiento' && mod.seleccionado)
      {
      <div class="mb-3">
        <h3>Reducción de Plazas</h3>
        <div class="mb-2">
          <label class="form-label">Que plaza desea eliminar?:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.enclaje"
            name="enclajePlaza{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.enclaje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Número de plazas antes:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasAntes"
            name="plazasAntes{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasAntes"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Plazas después de la reforma:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.plazasDespues"
            name="plazasDespues{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.plazasDespues"
          />
        </div>
      </div>
      }
      <!-- Ruedas -->
      @if (mod.nombre === 'Ruedas' && mod.seleccionado) {
      @if(mod.detalle.llantas || mod.detalle.neumaticos) {
      <div class="mb-3">
        <h3>Neumáticos</h3>
        <div class="mb-2">
          <label class="form-label">Medida del neumático y de la llanta:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidas"
            name="medidasNeumaticos{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidas"
          />
        </div>
      </div>
      } @if(mod.detalle.separadoresDeRueda) {
      <div class="mb-3">
        <h3>Separadores de Rueda</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaSeparadores"
            name="marcaSeparadores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaSeparadores"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaSeparadores"
            name="referenciaSeparadores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaSeparadores"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Grosor:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.grosorSeparadores"
            name="grosorSeparadores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.grosorSeparadores"
          />
        </div>
      </div>
      } }
      <!-- Carrocería -->
      @if (mod.nombre === 'Carrocería' && mod.seleccionado) {
      <div class="mb-3">
        <!-- Aletines -->
        @if (mod.detalle?.aletines) {
        <h3>Aletines</h3>
        <section class="mod-card aletines">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Aletines</h4>
            <span class="mod-card__hint"
              >Datos de pieza y parámetros de cálculo</span
            >
          </div>

          <!-- Bloque inicial (2 por fila) -->
          <div class="row g-3">
            <!-- Tipo de acción -->

            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaAletines-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaAletines"
                  name="marcaAletines{{ i }}"
                />
                <label for="marcaAletines-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="referenciaAletines-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaAletines"
                  name="referenciaAletines{{ i }}"
                />
                <label for="referenciaAletines-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Ancho (mm) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="anchoAletines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.anchoAletines"
                  name="anchoAletines{{ i }}"
                />
                <label for="anchoAletines-{{ i }}">Ancho (mm)</label>
              </div>
            </div>

            <!-- Díametro tornillos -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="metricaAletines-{{ i }}"
                  [(ngModel)]="mod.metricaAletines"
                  (ngModelChange)="onMetricaChange(mod)"
                  name="metricaAletines{{ i }}"
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="metricaAletines-{{ i }}"
                  >Díametro de tornillos</label
                >
              </div>
            </div>
          </div>

          <!-- Separador visual -->
          <hr class="mod-sep" />

          <!-- A partir de aquí: 3 por fila -->
          <div class="row g-3">
            <!-- Número de tornillos -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numTornillosAletines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numTornillosAletines"
                  name="numTornillosAletines{{ i }}"
                />
                <label for="numTornillosAletines-{{ i }}"
                  >Número de tornillos</label
                >
              </div>
            </div>

            <!-- Peso pieza (Kg) -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="pesoPiezaKgAletines-{{ i }}"
                  placeholder="0"
                  step="0.01"
                  min="0"
                  [(ngModel)]="mod.pesoPiezaKgAletines"
                  name="pesoPiezaKgAletines{{ i }}"
                  required
                  [class.is-invalid]="
                    formSubmitted && mod.pesoPiezaKgAletines == null
                  "
                />
                <label for="pesoPiezaKgAletines-{{ i }}"
                  >Peso de la pieza (Kg)</label
                >
              </div>
            </div>
          </div>
        </section>
        }

        <!-- ESTRIBOS LATERALES O TALONERAS -->
        @if (mod.detalle.talonerasEstribos) {
        <div class="mb-3">
          <section class="mod-card estribos-laterales">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Estribos laterales o taloneras</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <!-- Datos generales -->
            <div class="row g-3">
              <!-- Tipo de acción -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block mb-1">Tipo de acción</label>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>

              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="estr-marca-{{ i }}"
                    [(ngModel)]="mod.marcataloneras"
                    name="marcataloneras{{ i }}"
                    placeholder="Marca"
                  />
                  <label for="estr-marca-{{ i }}">Marca</label>
                </div>
              </div>

              <!-- Material -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="estr-material-{{ i }}"
                    [(ngModel)]="mod.materialEstribos"
                    name="materialEstribos{{ i }}"
                  >
                    <option [ngValue]="null" disabled>Seleccione...</option>
                    <option value="acero">Acero</option>
                    <option value="plástico">Plástico</option>
                  </select>
                  <label for="estr-material-{{ i }}">Material</label>
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- Características de la pieza -->
            <h6 class="text-muted fw-semibold">Características de la pieza</h6>

            <!-- Anchura -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="estr-ancho-{{ i }}"
                  [(ngModel)]="mod.anchuraMEstribos"
                  name="anchuraMEstribos{{ i }}"
                  placeholder="Anchura (m)"
                />
                <label for="estr-ancho-{{ i }}">Anchura (m)</label>
              </div>
            </div>

            <!-- Altura -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  step="0.001"
                  min="0"
                  class="form-control"
                  id="estr-altura-{{ i }}"
                  [(ngModel)]="mod.alturaMEstribos"
                  name="alturaMEstribos{{ i }}"
                  placeholder="Altura (m)"
                />
                <label for="estr-altura-{{ i }}">Altura (m)</label>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- Sujeción -->
            <h6 class="text-muted fw-semibold">Sujeción</h6>
            <div class="row g-3">
              <!-- Díametro -->
              <div class="col-12 col-md-4">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="estr-metricaTalonera-{{ i }}"
                    [(ngModel)]="mod.metricaTalonera"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaTalonera{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaTalonera == null
                    "
                  >
                    <option [ngValue]="null" disabled>Seleccione...</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label for="estr-metricaTalonera-{{ i }}"
                    >Díametro de los tornillos</label
                  >
                </div>
              </div>

              <!-- Nº de tornillos -->
              <div class="col-12 col-md-4">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="estr-nTornillosEstribos-{{ i }}"
                    [(ngModel)]="mod.nTornillosEstribos"
                    name="nTornillosEstribos"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.nTornillosEstribos
                    "
                    placeholder="Nº tornillos"
                  />
                  <label for="estr-nTornillosEstribos-{{ i }}"
                    >Nº de tornillos</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- SNORKEL -->
        @if (mod.detalle.snorkel) {
        <div class="mb-3">
          <section class="mod-card snorkel">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Snorkel</h4>
              <span class="mod-card__hint">Datos generales</span>
            </div>

            <!-- Datos generales -->
            <div class="row g-3">
              <!-- Tipo de acción -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block mb-1">Tipo de acción</label>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>

                <div
                  class="invalid-feedback d-block"
                  *ngIf="
                    formSubmitted &&
                    (!mod.acciones || mod.acciones.length === 0)
                  "
                >
                  Debe seleccionar al menos una acción.
                </div>
              </div>

              <!-- Material -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="snk-material-{{ i }}"
                    [(ngModel)]="mod.materialSnorkel"
                    name="materialSnorkel{{ i }}"
                  >
                    <option [ngValue]="null" disabled>
                      Seleccione una opción
                    </option>
                    <option value="goma">Goma</option>
                    <option value="plástico ABS">Plástico ABS</option>
                  </select>
                  <label for="snk-material-{{ i }}">Material</label>
                </div>
              </div>

              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="snk-marca-{{ i }}"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaSnorkel"
                    name="marcaSnorkel{{ i }}"
                  />
                  <label for="snk-marca-{{ i }}">Marca</label>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="metricaSnorkel-{{ i }}"
                    [(ngModel)]="mod.metricaSnorkel"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaSnorkel{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaSnorkel == null
                    "
                  >
                    <option [ngValue]="null" disabled>Seleccione...</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label for="metricaSnorkel-{{ i }}"
                    >Díametro de tornillos</label
                  >
                </div>
              </div>

              <!-- Ratio de curvatura mínimo -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    class="form-control"
                    id="snk-curvatura-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.curvaturaSnorkel"
                    name="curvaturaSnorkel{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.curvaturaSnorkel == null
                    "
                  />
                  <label for="snk-curvatura-{{ i }}"
                    >Ratio curvatura mín.</label
                  >
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- 1) CARACTERÍSTICAS DE LA PIEZA -->
            <h6 class="text-muted fw-semibold">Características de la pieza</h6>
            <div class="row g-3">
              <!-- 1/13 Peso de la pieza en Kg -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="snk-peso-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.pesoPiezaKgSnorkel"
                    name="pesoPiezaKgSnorkel{{ i }}"
                  />
                  <label for="snk-peso-{{ i }}">Peso de la pieza (Kg)</label>
                </div>
              </div>

              <!-- 2/13 Anchura de la pieza en m -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="snk-anchura-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.anchuraPiezaMSnorkel"
                    name="anchuraPiezaMSnorkel{{ i }}"
                  />
                  <label for="snk-anchura-{{ i }}">Anchura pieza (m)</label>
                </div>
              </div>

              <!-- 3/13 Altura de la pieza en m -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="snk-altura-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.alturaPiezaMSnorkel"
                    name="alturaPiezaMSnorkel{{ i }}"
                  />
                  <label for="snk-altura-{{ i }}">Altura pieza (m)</label>
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- 2) SUJECIÓN -->
            <h6 class="text-muted fw-semibold">Sujeción</h6>
            <div class="row g-3">
              <!-- 5/13 Nº tornillos -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="snk-nTornillosSnorkel-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.nTornillosSnorkel"
                    name="nTornillosSnorkel{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.nTornillosSnorkel == null
                    "
                  />
                  <label for="snk-nTornillosSnorkel-{{ i }}"
                    >Nº de tornillos</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- Defensa Delantera -->
        @if (mod.detalle.defensaDelantera) {
        <div class="mb-4">
          <h3>Defensa Delantera</h3>
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaDefensa"
              name="marcaDefensa{{ i }}"
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Modelo:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.modeloDefensa"
              name="modeloDefensa{{ i }}"
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Grosor del tubo (mm):</label>
            <input
              type="number"
              min="0"
              min="0"
              class="form-control"
              [(ngModel)]="mod.grosorTuboDefensa"
              name="grosorTuboDefensa{{ i }}"
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Medidas (ej: XXX x XXX mm):</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.medidasDefensa"
              name="medidasDefensa{{ i }}"
            />
          </div>

          <div class="mb-2">
            <label class="form-label"
              >Selecciona valor díametro de los tornillos:</label
            >
            <select
              class="form-select"
              [(ngModel)]="mod.metrica"
              name="metrica{{ i }}"
            >
              <option [value]="null" disabled selected>Seleccione...</option>
              @for (num of metricasTornillos; track num) {
              <option [value]="num">
                {{ num }}
              </option>
              }
            </select>
          </div>
          <label class="form-label">Nº de tornillos:</label>
          <input
            type="number"
            min="0"
            class="form-control"
            [(ngModel)]="mod.nTornillos"
            name="nTornillos"
          />
        </div>
        }

        <!-- PARAGOLPES DELANTERO -->
        @if (mod.detalle.paragolpesDelantero) {
        <div class="mb-3">
          <section class="mod-card paragolpes-delantero">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Paragolpes delantero</h4>
              <span class="mod-card__hint">Datos generales</span>
            </div>

            <!-- Datos generales -->
            <div class="row g-3">
              <!-- Tipo de acción -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block mb-1">Tipo de acción</label>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>

                <div
                  class="invalid-feedback d-block"
                  *ngIf="
                    formSubmitted &&
                    (!mod.acciones || mod.acciones.length === 0)
                  "
                >
                  Debe seleccionar al menos una acción.
                </div>
              </div>

              <!-- Tipo de fabricación -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="pgd-tipo-{{ i }}"
                    [(ngModel)]="mod.tipoFabricacionParagolpesDelantero"
                    name="tipoFabricacionParagolpesDelantero{{ i }}"
                  >
                    <option [ngValue]="null" disabled>
                      Seleccione una opción
                    </option>
                    <option value="comercial">Marca y Referencia</option>
                    <option value="artesanal">
                      Fabricado en acero de forma artesanal
                    </option>
                  </select>
                  <label for="pgd-tipo-{{ i }}">Tipo de fabricación</label>
                </div>
              </div>
            </div>

            <!-- Marca / Referencia sólo si es comercial -->
            @if (mod.tipoFabricacionParagolpesDelantero === 'comercial') {
            <div class="row g-3 mt-0">
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="pgd-marca-{{ i }}"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaParagolpes"
                    name="marcaParagolpes{{ i }}"
                  />
                  <label for="pgd-marca-{{ i }}">Marca</label>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="pgd-ref-{{ i }}"
                    placeholder="Referencia"
                    [(ngModel)]="mod.referenciaParagolpes"
                    name="referenciaParagolpes{{ i }}"
                  />
                  <label for="pgd-ref-{{ i }}">Referencia</label>
                </div>
              </div>
            </div>
            }

            <!-- Medidas y curvatura -->
            <div class="row g-3 mt-0">
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="pgd-medidas-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.medidasParagolpesDelantero"
                    name="medidasParagolpesDelantero{{ i }}"
                  />
                  <label for="pgd-medidas-{{ i }}">Medidas (mm)</label>
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- Sujeción -->
            <h6 class="text-muted fw-semibold">Sujeción</h6>
            <div class="row g-3">
              <!-- Díametro -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="pgd-metricaParaDelantero-{{ i }}"
                    [(ngModel)]="mod.metricaParaDelantero"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaParaDelantero{{ i }}"
                  >
                    <option [ngValue]="null" disabled>Seleccione...</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label for="pgd-metricaParaDelantero-{{ i }}"
                    >Diametro de los tornillos</label
                  >
                </div>
              </div>

              <!-- Nº de tornillos -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="pgd-ntornillosParaDelantero-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.ntornillosParaDelantero"
                    name="ntornillosParaDelantero"
                  />
                  <label for="pgd-ntornillosParaDelantero-{{ i }}"
                    >Nº de tornillos</label
                  >
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- Características de la pieza -->
            <h6 class="text-muted fw-semibold">Características de la pieza</h6>
            <div class="row g-3">
              <!-- Peso de la pieza (Kg) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="pgd-peso-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.pesoPiezaKgParagolpesDelantero"
                    name="pesoPiezaKgParagolpesDelantero{{ i }}"
                  />
                  <label for="pgd-peso-{{ i }}">Peso de la pieza (Kg)</label>
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- PARAGOLPES TRASERO -->
        @if (mod.detalle.paragolpesTrasero) {
        <div class="mb-3">
          <section class="mod-card paragolpes-trasero">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Paragolpes trasero</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <!-- Datos generales -->
            <div class="row g-3">
              <!-- Tipo de acción -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block mb-1">Tipo de acción</label>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>

                <div
                  class="invalid-feedback d-block"
                  *ngIf="
                    formSubmitted &&
                    (!mod.acciones || mod.acciones.length === 0)
                  "
                >
                  Debe seleccionar al menos una acción.
                </div>
              </div>

              <!-- Tipo de fabricación -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="pgt-fab-{{ i }}"
                    [(ngModel)]="mod.tipoFabricacionParagolpesTrasero"
                    name="tipoFabricacionParagolpesTrasero{{ i }}"
                  >
                    <option value="" disabled>Seleccione una opción</option>
                    <option value="comercial">Marca y Referencia</option>
                    <option value="artesanal">
                      Fabricado en acero de forma artesanal
                    </option>
                  </select>
                  <label for="pgt-fab-{{ i }}">Tipo de fabricación</label>
                </div>
              </div>

              <!-- Marca / Referencia (solo si comercial) -->
              @if (mod.tipoFabricacionParagolpesTrasero === 'comercial') {
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="pgt-marca-{{ i }}"
                    [(ngModel)]="mod.marcaParagolpesTrasero"
                    name="marcaParagolpesTrasero{{ i }}"
                    placeholder="Marca"
                  />
                  <label for="pgt-marca-{{ i }}">Marca</label>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="pgt-ref-{{ i }}"
                    [(ngModel)]="mod.referenciaParagolpesTrasero"
                    name="referenciaParagolpesTrasero{{ i }}"
                    placeholder="Referencia"
                  />
                  <label for="pgt-ref-{{ i }}">Referencia</label>
                </div>
              </div>
              }
            </div>

            <!-- Características de la pieza -->
            <div class="mod-card__header mt-3">
              <h5 class="mod-card__title mb-0">Características de la pieza</h5>
            </div>

            <div class="row g-3">
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="pgt-peso-{{ i }}"
                    [(ngModel)]="mod.pesoPiezaKgParagolpesTrasero"
                    name="pesoPiezaKgParagolpesTrasero{{ i }}"
                    placeholder="Peso (kg)"
                  />
                  <label for="pgt-peso-{{ i }}">Peso (kg)</label>
                </div>
              </div>

              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.001"
                    min="0"
                    class="form-control"
                    id="pgt-ancho-{{ i }}"
                    [(ngModel)]="mod.anchuraMParagolpesTrasero"
                    name="anchuraMParagolpesTrasero{{ i }}"
                    placeholder="Anchura (m)"
                  />
                  <label for="pgt-ancho-{{ i }}">Anchura (m)</label>
                </div>
              </div>

              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.001"
                    min="0"
                    class="form-control"
                    id="pgt-alto-{{ i }}"
                    [(ngModel)]="mod.alturaMParagolpesTrasero"
                    name="alturaMParagolpesTrasero{{ i }}"
                    placeholder="Altura (m)"
                  />
                  <label for="pgt-alto-{{ i }}">Altura (m)</label>
                </div>
              </div>
            </div>

            <!-- Sujeción -->
            <div class="mod-card__header mt-3">
              <h5 class="mod-card__title mb-0">Sujeción</h5>
            </div>

            <div class="row g-3">
              <!-- Nº de tornillos -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="pgt-ntorn-{{ i }}"
                    [(ngModel)]="mod.nTornillosParagolpesTrasero"
                    name="nTornillosParagolpesTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && !mod.nTornillosParagolpesTrasero
                    "
                    placeholder="Nº de tornillos"
                  />
                  <label for="pgt-ntorn-{{ i }}">Nº de tornillos</label>
                </div>
              </div>

              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="pgd-metricaParaTrasero-{{ i }}"
                    [(ngModel)]="mod.metricaParaTrasero"
                    (ngModelChange)="onMetricaChange(mod)"
                    name="metricaParaTrasero{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaParaTrasero == null
                    "
                  >
                    <option [ngValue]="null" disabled>Seleccione...</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label for="pgd-metricaParaTrasero-{{ i }}"
                    >Díametro de los tornillos</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- ANTIEMPOTRAMIENTO -->
        @if (mod.detalle.barraAntiempotramiento) {
        <div class="mb-3">
          <h3>Antiempotramiento</h3>
          <div class="col-12 col-md-6">
            <label class="form-label d-block mb-1">Tipo de acción</label>

            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="accion-instalacion-{{ i }}"
                [checked]="mod.acciones?.includes('Instalacion')"
                (change)="
                  toggleAccion(mod, 'Instalacion', $event.target.checked)
                "
              />
              <label class="form-check-label" for="accion-instalacion-{{ i }}">
                Instalación
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="accion-sustitucion-{{ i }}"
                [checked]="mod.acciones?.includes('Sustitucion')"
                (change)="
                  toggleAccion(mod, 'Sustitucion', $event.target.checked)
                "
              />
              <label class="form-check-label" for="accion-sustitucion-{{ i }}">
                Sustitución
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="accion-desmontaje-{{ i }}"
                [checked]="mod.acciones?.includes('Desmontaje')"
                (change)="
                  toggleAccion(mod, 'Desmontaje', $event.target.checked)
                "
              />
              <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                Desmontaje
              </label>
            </div>
          </div>
          <div class="mb-2">
            <label class="form-label">Medidas en mm (Ejemplo: 500x700):</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.medidasAntiempotramiento"
              name="medidasAntiempotramiento{{ i }}"
            />
          </div>

          <label class="form-label">Nº de tornillos:</label>
          <input
            type="number"
            min="0"
            class="form-control"
            [(ngModel)]="mod.nTornillos"
            name="nTornillos"
            required
            [class.is-invalid]="formSubmitted && !mod.nTornillos"
          />
        </div>
        }

        <!-- CABRESTANTE -->
        @if (mod.detalle.cabrestante) {
        <div class="mb-3">
          <section class="mod-card cabrestante">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Cabrestante</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <!-- Datos generales (reusa exactamente tus bindings) -->
            <div class="row g-3">
              <!-- Tipo de acción -->
              <div class="col-12 col-md-6">
                <label class="form-label d-block mb-1">Tipo de acción</label>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-instalacion-{{ i }}"
                    [checked]="mod.acciones?.includes('Instalacion')"
                    (change)="
                      toggleAccion(mod, 'Instalacion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-instalacion-{{ i }}"
                  >
                    Instalación
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-sustitucion-{{ i }}"
                    [checked]="mod.acciones?.includes('Sustitucion')"
                    (change)="
                      toggleAccion(mod, 'Sustitucion', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-sustitucion-{{ i }}"
                  >
                    Sustitución
                  </label>
                </div>

                <div class="form-check">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    id="accion-desmontaje-{{ i }}"
                    [checked]="mod.acciones?.includes('Desmontaje')"
                    (change)="
                      toggleAccion(mod, 'Desmontaje', $event.target.checked)
                    "
                  />
                  <label
                    class="form-check-label"
                    for="accion-desmontaje-{{ i }}"
                  >
                    Desmontaje
                  </label>
                </div>
              </div>

              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="cbr-marca-{{ i }}"
                    placeholder="Marca"
                    [(ngModel)]="mod.marcaCabrestante"
                    name="marcaCabrestante{{ i }}"
                    required
                    [class.is-invalid]="formSubmitted && !mod.marcaCabrestante"
                  />
                  <label for="cbr-marca-{{ i }}">Marca</label>
                </div>
              </div>

              <!-- Capacidad (Kg) -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    id="cbr-capkg-{{ i }}"
                    placeholder="0"
                    min="0"
                    [(ngModel)]="mod.capacidadCabrestanteKg"
                    name="capacidadCabrestanteKg{{ i }}"
                  />
                  <label for="cbr-capkg-{{ i }}"
                    >Capacidad de arrastre (Kg)</label
                  >
                </div>
              </div>

              <!-- Díametro de tornillos (con tus bindings) -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <select
                    class="form-select"
                    id="cbr-metricaCabrestante-{{ i }}"
                    [(ngModel)]="mod.metricaCabrestante"
                    name="metricaCabrestante{{ i }}"
                    required
                    [class.is-invalid]="
                      formSubmitted && mod.metricaCabrestante == null
                    "
                  >
                    <option [ngValue]="null" disabled>Seleccione...</option>
                    @for (num of metricasTornillos; track num) {
                    <option [value]="num">{{ num }}</option>
                    }
                  </select>
                  <label for="cbr-metricaCabrestante-{{ i }}"
                    >Díametro de los tornillos</label
                  >
                </div>
              </div>

              <!-- Nº de tornillos (reusa exactamente tu binding y name original) -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    id="cbr-ntornillos-{{ i }}"
                    placeholder="0"
                    min="0"
                    [(ngModel)]="mod.nTornillos"
                    name="nTornillos"
                    required
                    [class.is-invalid]="formSubmitted && !mod.nTornillos"
                  />
                  <label for="cbr-ntornillos-{{ i }}">Nº de tornillos</label>
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- 1) Características del material y elementos de unión empleados -->
            <h6 class="text-muted fw-semibold">
              Características del material y elementos de unión empleados
            </h6>
            <div class="row g-3">
              <!-- Tiro máx. del cabrestante (Kg) — si quieres, puede ser igual a capacidad (Kg) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    class="form-control"
                    id="cbr-tiro-{{ i }}"
                    placeholder="0"
                    min="0"
                    [(ngModel)]="mod.tiroMaxCabrestanteKg"
                    name="tiroMaxCabrestanteKg{{ i }}"
                  />
                  <label for="cbr-tiro-{{ i }}"
                    >Tiro máx. del cabrestante (Kg)</label
                  >
                </div>
              </div>

              <!-- Diámetro de cada perno (cm) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="cbr-diam-perno-cm-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.diametroPernoCmCabrestante"
                    name="diametroPernoCmCabrestante{{ i }}"
                  />
                  <label for="cbr-diam-perno-cm-{{ i }}"
                    >Diámetro de cada perno (cm)</label
                  >
                </div>
              </div>

              <!-- Material del perno -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="cbr-mat-perno-{{ i }}"
                    placeholder="Acero 8.8"
                    [(ngModel)]="mod.materialPernoCabrestante"
                    name="materialPernoCabrestante{{ i }}"
                  />
                  <label for="cbr-mat-perno-{{ i }}">Material del perno</label>
                </div>
              </div>

              <!-- Tensión mín., rotura cortante (Kg/cm²) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="cbr-tension-cortante-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.tensionMinCortanteKgCm2Cabrestante"
                    name="tensionMinCortanteKgCm2Cabrestante{{ i }}"
                  />
                  <label for="cbr-tension-cortante-{{ i }}"
                    >Tensión mín. cortante (Kg/cm²)</label
                  >
                </div>
              </div>
            </div>

            <hr class="mod-sep" />

            <!-- 2) Tensión cortante soportada por los pernos de unión al chasis -->
            <h6 class="text-muted fw-semibold">
              Tensión cortante soportada por los pernos de unión al chasis
            </h6>
            <div class="row g-3">
              <!-- Número de pernos (puedes reutilizar nTornillos si te interesa que coincidan) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="cbr-npernos-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.nPernosChasisCabrestante"
                    name="nPernosChasisCabrestante{{ i }}"
                  />
                  <label for="cbr-npernos-{{ i }}">Número de pernos</label>
                </div>
              </div>

              <!-- Diámetro de cada perno (mm) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="cbr-diam-perno-mm-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.diametroPernoChasisMmCabrestante"
                    name="diametroPernoChasisMmCabrestante{{ i }}"
                  />
                  <label for="cbr-diam-perno-mm-{{ i }}"
                    >Diámetro de cada perno (mm)</label
                  >
                </div>
              </div>

              <!-- Material del perno (chasis) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="cbr-mat-perno-chasis-{{ i }}"
                    placeholder="Acero 8.8"
                    [(ngModel)]="mod.materialPernoChasisCabrestante"
                    name="materialPernoChasisCabrestante{{ i }}"
                  />
                  <label for="cbr-mat-perno-chasis-{{ i }}"
                    >Material del perno</label
                  >
                </div>
              </div>

              <!-- Tensión mín., rotura cortante (Kg/cm²) -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    step="0.01"
                    min="0"
                    class="form-control"
                    id="cbr-tension-cortante-chasis-{{ i }}"
                    placeholder="0"
                    [(ngModel)]="mod.tensionMinCortanteChasisKgCm2Cabrestante"
                    name="tensionMinCortanteChasisKgCm2Cabrestante{{ i }}"
                  />
                  <label for="cbr-tension-cortante-chasis-{{ i }}"
                    >Tensión mín. cortante (Kg/cm²)</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- SOPORTE PARA RUEDA DE REPUESTO -->
        @if ( mod.detalle.soporteRuedaRepuesto ) {
        <div class="mb-3">
          <h3>Soporte para rueda de repuesto</h3>
          <div class="col-12 col-md-6">
            <label class="form-label d-block mb-1">Tipo de acción</label>

            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="accion-instalacion-{{ i }}"
                [checked]="mod.acciones?.includes('Instalacion')"
                (change)="
                  toggleAccion(mod, 'Instalacion', $event.target.checked)
                "
              />
              <label class="form-check-label" for="accion-instalacion-{{ i }}">
                Instalación
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="accion-sustitucion-{{ i }}"
                [checked]="mod.acciones?.includes('Sustitucion')"
                (change)="
                  toggleAccion(mod, 'Sustitucion', $event.target.checked)
                "
              />
              <label class="form-check-label" for="accion-sustitucion-{{ i }}">
                Sustitución
              </label>
            </div>

            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="accion-desmontaje-{{ i }}"
                [checked]="mod.acciones?.includes('Desmontaje')"
                (change)="
                  toggleAccion(mod, 'Desmontaje', $event.target.checked)
                "
              />
              <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                Desmontaje
              </label>
            </div>
          </div>
          <div class="mb-2">
            <label class="form-label">Tipo de fabricación:</label>
            <select
              class="form-select"
              [(ngModel)]="mod.tipoFabricacionRuedaRepuesto"
              name="tipoFabricacionRuedaRepuesto{{ i }}"
            >
              <option value="" disabled selected>Seleccione una opción</option>
              <option value="comercial">Marca y Referencia</option>
              <option value="artesanal">
                Fabricado en acero de forma artesanal
              </option>
            </select>
          </div>
          @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaRuedaRepuesto"
              name="marcaRuedaRepuesto{{ i }}"
            />
          </div>
          } @if (mod.tipoFabricacionRuedaRepuesto === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaRuedaRepuesto"
              name="referenciaRuedaRepuesto{{ i }}"
            />
          </div>
          }
          <div class="mb-2">
            <label class="form-label">Medidas (ej: XXX x XXX mm):</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.medidasRuedaRepuesto"
              name="medidasRuedaRepuesto{{ i }}"
            />
          </div>

          <div class="mb-2">
            <label class="form-label"
              >Selecciona valor díametro de los tornillos:</label
            >
            <select
              class="form-select"
              [(ngModel)]="mod.metrica"
              name="metrica{{ i }}"
            >
              <option [value]="null" disabled selected>Seleccione...</option>
              @for (num of metricasTornillos; track num) {
              <option [value]="num">
                {{ num }}
              </option>
              }
            </select>
          </div>
          <label class="form-label">Nº de tornillos:</label>
          <input
            type="number"
            min="0"
            class="form-control"
            [(ngModel)]="mod.nTornillos"
            name="nTornillos"
          />
        </div>
        }

        <!-- Sobrealetines -->
        @if (mod.detalle?.sobrealetines) {
        <h3>Sobrealetines</h3>
        <section class="mod-card sobrealetines">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Sobrealetines</h4>
            <span class="mod-card__hint"
              >Datos de pieza y parámetros de cálculo</span
            >
          </div>

          <!-- Bloque inicial (2 por fila) -->
          <div class="row g-3">
            <!-- Tipo de acción -->
            <div class="col-12 col-md-6">
              <label class="form-label d-block mb-1">Tipo de acción</label>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-instalacion-{{ i }}"
                  [checked]="mod.acciones?.includes('Instalacion')"
                  (change)="
                    toggleAccion(mod, 'Instalacion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-instalacion-{{ i }}"
                >
                  Instalación
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-sustitucion-{{ i }}"
                  [checked]="mod.acciones?.includes('Sustitucion')"
                  (change)="
                    toggleAccion(mod, 'Sustitucion', $event.target.checked)
                  "
                />
                <label
                  class="form-check-label"
                  for="accion-sustitucion-{{ i }}"
                >
                  Sustitución
                </label>
              </div>

              <div class="form-check">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="accion-desmontaje-{{ i }}"
                  [checked]="mod.acciones?.includes('Desmontaje')"
                  (change)="
                    toggleAccion(mod, 'Desmontaje', $event.target.checked)
                  "
                />
                <label class="form-check-label" for="accion-desmontaje-{{ i }}">
                  Desmontaje
                </label>
              </div>
            </div>

            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marca-sobrealetines-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaSobreletines"
                  name="marcaSobreletines{{ i }}"
                  required
                  [class.is-invalid]="formSubmitted && !mod.marcaSobreletines"
                />
                <label for="marca-sobrealetines-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="ref-sobrealetines-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaSobreletines"
                  name="referenciaSobreletines{{ i }}"
                />
                <label for="ref-sobrealetines-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Ancho (mm) -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="ancho-sobrealetines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.anchoSobrealetines"
                  name="anchoSobrealetines{{ i }}"
                />
                <label for="ancho-sobrealetines-{{ i }}">Ancho (mm)</label>
              </div>
            </div>

            <!-- Díametro tornillos -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="metrica-sobrealetines-{{ i }}"
                  [(ngModel)]="mod.metricaSobrealetines"
                  name="metricaSobrealetines{{ i }}"
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (num of metricasTornillos; track num) {
                  <option [value]="num">{{ num }}</option>
                  }
                </select>
                <label for="metrica-sobrealetines-{{ i }}"
                  >Díametro de tornillos</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- 3 por fila -->
          <div class="row g-3">
            <!-- Nº de tornillos -->
            <div class="col-12 col-md-4">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="ntornillos-sobrealetines-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.nTornillos"
                  name="nTornillos{{ i }}"
                />
                <label for="ntornillos-sobrealetines-{{ i }}"
                  >Nº de tornillos</label
                >
              </div>
            </div>
            <!-- deja libres las otras dos columnas si no añades más campos ahora -->
          </div>
        </section>
        }
      </div>
      }

      <!-- MUELLES, BALLESTAS Y AMORTIGUADORES -->
      @if ( mod.nombre === 'Suspensión' && mod.seleccionado ) {
      <div class="mb-3">
        <h3>Casuística de Muelles, Ballestas y Amortiguadores</h3>
        <!-- Muelle delantero con referencia -->
        @if (mod.detalle?.muelleDelantero) {
        <section class="mod-card muelle-delantero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle delantero</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>

          <div class="row g-3">
            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaMuelleDelanteroConRef-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleDelanteroConRef"
                  name="marcaMuelleDelanteroConRef{{ i }}"
                />
                <label for="marcaMuelleDelanteroConRef-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="refMuelleDelanteroConRef-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleDelanteroConRef"
                  name="referenciaMuelleDelanteroConRef{{ i }}"
                />
                <label for="refMuelleDelanteroConRef-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Diámetro exterior -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamExteriorDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroExteriorDelanteroRef"
                  name="diametroExteriorDelanteroRef{{ i }}"
                />
                <label for="diamExteriorDelanteroRef-{{ i }}"
                  >Diámetro exterior (mm)</label
                >
              </div>
            </div>

            <!-- Longitud libre -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="longLibreDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.longitudLibreDelanteroRef"
                  name="longitudLibreDelanteroRef{{ i }}"
                />
                <label for="longLibreDelanteroRef-{{ i }}"
                  >Longitud libre (mm)</label
                >
              </div>
            </div>

            <!-- Diámetro de espira -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamEspiraDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroEspiraDelanteroRef"
                  name="diametroEspiraDelanteroRef{{ i }}"
                />
                <label for="diamEspiraDelanteroRef-{{ i }}"
                  >Diámetro de espira (mm)</label
                >
              </div>
            </div>

            <!-- Número de espiras -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numEspirasDelanteroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numeroEspirasDelanteroRef"
                  name="numeroEspirasDelanteroRef{{ i }}"
                />
                <label for="numEspirasDelanteroRef-{{ i }}"
                  >Nº de espiras</label
                >
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Muelle trasero con referencia -->
        @if (mod.detalle?.muelleTrasero) {
        <section class="mod-card muelle-trasero-ref">
          <div class="mod-card__header">
            <h4 class="mod-card__title">Muelle trasero</h4>
            <span class="mod-card__hint">Datos generales y dimensiones</span>
          </div>

          <div class="row g-3">
            <!-- Marca -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="marcaMuelleTraseroConRef-{{ i }}"
                  placeholder="Marca"
                  [(ngModel)]="mod.marcaMuelleTraseroConRef"
                  name="marcaMuelleTraseroConRef{{ i }}"
                />
                <label for="marcaMuelleTraseroConRef-{{ i }}">Marca</label>
              </div>
            </div>

            <!-- Referencia -->
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <input
                  type="text"
                  class="form-control"
                  id="refMuelleTraseroConRef-{{ i }}"
                  placeholder="Referencia"
                  [(ngModel)]="mod.referenciaMuelleTraseroConRef"
                  name="referenciaMuelleTraseroConRef{{ i }}"
                />
                <label for="refMuelleTraseroConRef-{{ i }}">Referencia</label>
              </div>
            </div>

            <!-- Diámetro exterior -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamExteriorTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroExteriorTraseroRef"
                  name="diametroExteriorTraseroRef{{ i }}"
                />
                <label for="diamExteriorTraseroRef-{{ i }}"
                  >Diámetro exterior (mm)</label
                >
              </div>
            </div>

            <!-- Longitud libre -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="longLibreTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.longitudLibreTraseroRef"
                  name="longitudLibreTraseroRef{{ i }}"
                />
                <label for="longLibreTraseroRef-{{ i }}"
                  >Longitud libre (mm)</label
                >
              </div>
            </div>

            <!-- Diámetro de espira -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="diamEspiraTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.diametroEspiraTraseroRef"
                  name="diametroEspiraTraseroRef{{ i }}"
                />
                <label for="diamEspiraTraseroRef-{{ i }}"
                  >Diámetro de espira (mm)</label
                >
              </div>
            </div>

            <!-- Número de espiras -->
            <div class="col-12 col-md-3">
              <div class="form-floating">
                <input
                  type="number"
                  class="form-control"
                  id="numEspirasTraseroRef-{{ i }}"
                  placeholder="0"
                  min="0"
                  [(ngModel)]="mod.numeroEspirasTraseroRef"
                  name="numeroEspirasTraseroRef{{ i }}"
                />
                <label for="numEspirasTraseroRef-{{ i }}">Nº de espiras</label>
              </div>
            </div>
          </div>
        </section>
        }

        <!-- Ballesta delantera -->
        @if (mod.detalle?.ballestaDelantera) {
        <div class="mb-3">
          <section class="mod-card ballesta-delantera">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Ballesta Delantera</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <div class="row g-3">
              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="marcaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.marcaBallestaDelantera"
                    name="marcaBallestaDelantera{{ i }}"
                    placeholder="Marca"
                  />
                  <label for="marcaBallestaDelantera-{{ i }}">Marca</label>
                </div>
              </div>

              <!-- Referencia -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="referenciaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.referenciaBallestaDelantera"
                    name="referenciaBallestaDelantera{{ i }}"
                    placeholder="Referencia"
                  />
                  <label for="referenciaBallestaDelantera-{{ i }}"
                    >Referencia</label
                  >
                </div>
              </div>

              <!-- Número de hojas -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="1"
                    class="form-control"
                    id="numHojasBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.numHojasBallestaDelantera"
                    name="numHojasBallestaDelantera{{ i }}"
                    placeholder="Número de hojas"
                  />
                  <label for="numHojasBallestaDelantera-{{ i }}"
                    >Nº de hojas</label
                  >
                </div>
              </div>

              <!-- Ancho de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="anchoHojaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.anchoHojaBallestaDelantera"
                    name="anchoHojaBallestaDelantera{{ i }}"
                    placeholder="Ancho (mm)"
                  />
                  <label for="anchoHojaBallestaDelantera-{{ i }}"
                    >Ancho hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Espesor de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="espesorHojaBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.espesorHojaBallestaDelantera"
                    name="espesorHojaBallestaDelantera{{ i }}"
                    placeholder="Espesor (mm)"
                  />
                  <label for="espesorHojaBallestaDelantera-{{ i }}"
                    >Espesor hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Longitud total -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="longitudBallestaDelantera-{{ i }}"
                    [(ngModel)]="mod.longitudBallestaDelantera"
                    name="longitudBallestaDelantera{{ i }}"
                    placeholder="Longitud total (mm)"
                  />
                  <label for="longitudBallestaDelantera-{{ i }}"
                    >Longitud total (2L) (mm)</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- Ballesta trasera -->
        @if (mod.detalle?.ballestaTrasera) {
        <div class="mb-3">
          <section class="mod-card ballesta-trasera">
            <!-- Cabecera -->
            <div class="mod-card__header">
              <h4 class="mod-card__title">Ballesta Trasera</h4>
              <span class="mod-card__hint">Datos generales y de cálculo</span>
            </div>

            <div class="row g-3">
              <!-- Marca -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="marcaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.marcaBallestaTrasera"
                    name="marcaBallestaTrasera{{ i }}"
                    placeholder="Marca"
                  />
                  <label for="marcaBallestaTrasera-{{ i }}">Marca</label>
                </div>
              </div>

              <!-- Referencia -->
              <div class="col-12 col-md-6">
                <div class="form-floating">
                  <input
                    type="text"
                    class="form-control"
                    id="referenciaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.referenciaBallestaTrasera"
                    name="referenciaBallestaTrasera{{ i }}"
                    placeholder="Referencia"
                  />
                  <label for="referenciaBallestaTrasera-{{ i }}"
                    >Referencia</label
                  >
                </div>
              </div>

              <!-- Número de hojas -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="1"
                    class="form-control"
                    id="numHojasBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.numHojasBallestaTrasera"
                    name="numHojasBallestaTrasera{{ i }}"
                    placeholder="Número de hojas"
                  />
                  <label for="numHojasBallestaTrasera-{{ i }}"
                    >Nº de hojas</label
                  >
                </div>
              </div>

              <!-- Ancho de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="anchoHojaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.anchoHojaBallestaTrasera"
                    name="anchoHojaBallestaTrasera{{ i }}"
                    placeholder="Ancho (mm)"
                  />
                  <label for="anchoHojaBallestaTrasera-{{ i }}"
                    >Ancho hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Espesor de la hoja -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="espesorHojaBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.espesorHojaBallestaTrasera"
                    name="espesorHojaBallestaTrasera{{ i }}"
                    placeholder="Espesor (mm)"
                  />
                  <label for="espesorHojaBallestaTrasera-{{ i }}"
                    >Espesor hoja (mm)</label
                  >
                </div>
              </div>

              <!-- Longitud total -->
              <div class="col-12 col-md-3">
                <div class="form-floating">
                  <input
                    type="number"
                    min="0"
                    class="form-control"
                    id="longitudBallestaTrasera-{{ i }}"
                    [(ngModel)]="mod.longitudBallestaTrasera"
                    name="longitudBallestaTrasera{{ i }}"
                    placeholder="Longitud total (mm)"
                  />
                  <label for="longitudBallestaTrasera-{{ i }}"
                    >Longitud total (2L) (mm)</label
                  >
                </div>
              </div>
            </div>
          </section>
        </div>
        }

        <!-- Amortiguador delantero -->
        @if (mod.detalle?.amortiguadorDelantero) {
        <div>
          <h4>Amortiguador Delantero</h4>
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaAmortiguadorDelantero"
              name="marcaAmortiguadorDelantero{{ i }}"
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaAmortiguadorDelantero"
              name="referenciaAmortiguadorDelantero{{ i }}"
            />
          </div>
        </div>
        }
        <!-- Amortiguador trasero -->
        @if (mod.detalle?.amortiguadorTrasero) {
        <div>
          <h4>Amortiguador Trasero</h4>
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaAmortiguadorTrasero"
              name="marcaAmortiguadorTrasero{{ i }}"
            />
          </div>
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaAmortiguadorTrasero"
              name="referenciaAmortiguadorTrasero{{ i }}"
            />
          </div>
        </div>

        } @if (mod.detalle.suplementoSusDelantero) {
        <h4>Suplemento suspensión delantera</h4>
        <div class="col-12 col-md-6">
          <div class="form-floating mb-2">
            <input
              type="number"
              class="form-control"
              id="diametroTacoDelantero-{{ i }}"
              [(ngModel)]="mod.diametroTacoDelantero"
              name="diametroTacoDelantero{{ i }}"
              placeholder="Diámetro del eje delantero"
            />
            <label for="diametroTacoDelantero-{{ i }}">
              Diámetro del eje delantero (mm)
            </label>
          </div>

          <div class="form-floating">
            <input
              type="number"
              class="form-control"
              id="espesorTacoDelantero-{{ i }}"
              [(ngModel)]="mod.espesorTacoDelantero"
              name="espesorTacoDelantero{{ i }}"
              placeholder="Espesor del eje delantero"
            />
            <label for="espesorTacoDelantero-{{ i }}">
              Espesor del eje delantero (mm)
            </label>
          </div>
        </div>
        }

        <!-- Campos Traseros a la derecha -->
        @if (mod.detalle.suplementoSusTrasero) {
        <h4>Suplemento suspensión trasera</h4>
        <div class="col-12 col-md-6">
          <div class="form-floating mb-2">
            <input
              type="number"
              class="form-control"
              id="diametroTacoTrasero-{{ i }}"
              [(ngModel)]="mod.diametroTacoTrasero"
              name="diametroTacoTrasero{{ i }}"
              placeholder="Diámetro del eje trasero"
            />
            <label for="diametroTacoTrasero-{{ i }}">
              Diámetro del eje trasero (mm)
            </label>
          </div>

          <div class="form-floating">
            <input
              type="number"
              class="form-control"
              id="espesorTacoTrasero-{{ i }}"
              [(ngModel)]="mod.espesorTacoTrasero"
              name="espesorTacoTrasero{{ i }}"
              placeholder="Espesor del eje trasero"
            />
            <label for="espesorTacoTrasero-{{ i }}">
              Espesor del eje trasero (mm)
            </label>
          </div>
        </div>
        }
      </div>
      }

      <!-- Amortiguador de Dirección -->
      @if (mod.nombre === 'Dirección' && mod.seleccionado) {
      @if(mod.detalle?.amortiguadorDeDireccion){
      <div class="mb-4">
        <h3>Amortiguador de Dirección</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaAmortiguador"
            name="marcaAmortiguador{{ i }}"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaAmortiguador"
            name="referenciaAmortiguador{{ i }}"
          />
        </div>
      </div>
      }
      <!-- Barra de Dirección -->
      @if (mod.detalle.barraDeDireccion) {
      <div class="mb-4">
        <h3>Barra de Dirección</h3>
        <div class="col-12 col-md-6">
          <label class="form-label d-block mb-1">Tipo de acción</label>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-instalacion-{{ i }}"
              [checked]="mod.acciones?.includes('Instalacion')"
              (change)="toggleAccion(mod, 'Instalacion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-instalacion-{{ i }}">
              Instalación
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-sustitucion-{{ i }}"
              [checked]="mod.acciones?.includes('Sustitucion')"
              (change)="toggleAccion(mod, 'Sustitucion', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-sustitucion-{{ i }}">
              Sustitución
            </label>
          </div>

          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="accion-desmontaje-{{ i }}"
              [checked]="mod.acciones?.includes('Desmontaje')"
              (change)="toggleAccion(mod, 'Desmontaje', $event.target.checked)"
            />
            <label class="form-check-label" for="accion-desmontaje-{{ i }}">
              Desmontaje
            </label>
          </div>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBarraDireccion"
            name="marcaBarraDireccion{{ i }}"
          />
        </div>
      </div>
      }

      <!-- SUSTITUCIÓN DE EJES -->
      @if (mod.detalle?.sustitucionDeEjes) {
      <div class="mb-4">
        <h3>Sustitución de ejes</h3>
        <div class="mb-2">
          <label class="form-label">Marca procedente:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaEje"
            name="marcaEje{{ i }}"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Denominación comercial procedente:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.denominacionEje"
            name="denominacionEje{{ i }}"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.contrasenaHomologacionEje"
            name="contrasenaHomologacionEje{{ i }}"
          />
        </div>
      </div>
      } }

      <!-- MOTOS -->
      <!-- REDUCCIÓN MMA Y MMTA -->
      @if (mod.nombre === 'REDUCCIÓN MMA Y MMTA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Reducción MMA y MMTA</h3>
        @if (mod.ejeDelantero) {
        <div>
          <h4>Reducción en eje delantero</h4>
          <label class="form-label">Kg totales:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.kgReduccionEjeDelantero"
            name="kgReduccionEjeDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.kgReduccionEjeDelantero"
          />
        </div>
        } @if (mod.ejeTotal) {
        <div>
          <h4>Reducción total</h4>
          <label class="form-label">Kg totales:</label>
          <input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.kgReduccionTotal"
            name="kgReduccionTotal{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.kgReduccionTotal"
          />
        </div>
        }
      </div>
      }
      <!-- LLANTAS Y NEUMÁTICOS -->
      @if (mod.nombre === 'LLANTAS Y NEUMÁTICOS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Llantas y Neumáticos</h3>
        <div class="mb-2">
          <label>Cual de los dos neumaticos?:</label>
          <select
            class="form-select"
            [(ngModel)]="mod.neumaticosMoto"
            name="neumaticosMoto{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticosMoto"
          >
            <option value="delantero">Delantero</option>
            <option value="trasero">Trasero</option>
            <option value="delantero y trasero">Delantero y trasero</option>
          </select>
        </div>
        @if ( mod.neumaticosMoto === 'delantero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label">Neumático delantero:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.neumaticoDelantero"
            name="neumaticoDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticoDelantero"
          />
        </div>
        } @if ( mod.neumaticosMoto === 'delantero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label"
            >Medidas de llanta neumático delantero:</label
          >
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasLlantaDelantero"
            name="medidasLlantaDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasLlantaDelantero"
          />
        </div>
        } @if ( mod.neumaticosMoto === 'trasero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label">Neumático trasero:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.neumaticoTrasero"
            name="neumaticoTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.neumaticoTrasero"
          />
        </div>
        } @if ( mod.neumaticosMoto === 'trasero' || mod.neumaticosMoto ===
        'delantero y trasero' ) {
        <div class="mb-2">
          <label class="form-label">Medidas de llanta neumático trasero:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasLlantaTrasero"
            name="medidasLlantaTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasLlantaTrasero"
          />
        </div>
        }
      </div>
      }
      <!-- SUSPENSIÓN -->
      @if ( mod.nombre === 'SUSPENSIÓN' && mod.seleccionado &&
      datosEntrada.tipoVehiculo === 'moto' ) {
      <div class="mb-4">
        <h3>Suspensión</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaSuspension{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencia"
            name="referenciaSuspension{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referencia"
          />
        </div>
      </div>
      }
      <!-- SUSTITUCIÓN GUARDABARROS -->
      @if (mod.nombre === 'SUSTITUCIÓN GUARDABARROS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Sustitución de Guardabarros</h3>
        @if (mod.guardabarrosDelantero) {
        <div>
          <h4>Guardabarros delantero</h4>
          <div class="mb-2">
            <label class="form-label">Tipo de fabricación:</label>
            <select
              class="form-select"
              [(ngModel)]="mod.tipoFabricacionGuardabarrosDelantero"
              name="tipoFabricacionGuardabarrosDelantero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.tipoFabricacionGuardabarrosDelantero
              "
            >
              <option value="" disabled selected>Seleccione una opción</option>
              <option value="comercial">Marca y Referencia</option>
              <option value="artesanal">
                Fabricado en acero de forma artesanal
              </option>
            </select>
          </div>
          <!-- Solo mostrar marca y referencia si la opción es 'comercial' -->
          @if (mod.tipoFabricacionGuardabarrosDelantero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcaDelantero"
              name="marcaDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaDelantero"
            />
          </div>
          } @if (mod.tipoFabricacionGuardabarrosDelantero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaDelantero"
              name="referenciaDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.referenciaDelantero"
            />
          </div>
          }
          <label class="form-label mt-2">Dimensiones (ej: 150x600mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesDelantero"
            name="dimensionesDelantero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.dimensionesDelantero"
          />
          <div class="mb-2">
            <label class="form-label"
              >Selecciona valor díametro de los tornillos:</label
            >
            <select
              class="form-select"
              [(ngModel)]="mod.metrica"
              name="metrica{{ i }}"
              required
              [class.is-invalid]="formSubmitted && mod.metrica == null"
            >
              <option [value]="null" disabled selected>Seleccione...</option>
              @for (num of metricasTornillos; track num) {
              <option [value]="num">
                {{ num }}
              </option>
              }
            </select>
          </div>
        </div>
        } @if (mod.guardabarrosTrasero) {
        <div>
          <h4>Guardabarros trasero</h4>
          <div class="mb-2">
            <label class="form-label">Tipo de fabricación:</label>
            <select
              class="form-select"
              [(ngModel)]="mod.tipoFabricacionGuardabarrosTrasero"
              name="tipoFabricacionGuardabarrosTrasero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.tipoFabricacionGuardabarrosTrasero
              "
            >
              <option value="" disabled selected>Seleccione una opción</option>
              <option value="comercial">Marca y Referencia</option>
              <option value="artesanal">
                Fabricado en acero de forma artesanal
              </option>
            </select>
          </div>
          <!-- Solo mostrar marca y referencia si la opción es 'comercial' -->
          @if (mod.tipoFabricacionGuardabarrosTrasero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Marca:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.marcatRasero"
              name="marcatRasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcatRasero"
            />
          </div>
          } @if (mod.tipoFabricacionGuardabarrosTrasero === 'comercial') {
          <div class="mb-2">
            <label class="form-label">Referencia:</label>
            <input
              type="text"
              class="form-control"
              [(ngModel)]="mod.referenciaTrasero"
              name="referenciaTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.referenciaTrasero"
            />
          </div>
          }
          <label class="form-label">Dimensiones (ej: 150x600mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesTrasero"
            name="dimensionesTrasero{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.dimensionesTrasero"
          />
          <div class="mb-2">
            <label class="form-label"
              >Selecciona valor díametro de los tornillos:</label
            >
            <select
              class="form-select"
              [(ngModel)]="mod.metrica"
              name="metrica{{ i }}"
              required
              [class.is-invalid]="formSubmitted && mod.metrica == null"
            >
              <option [value]="null" disabled selected>Seleccione...</option>
              @for (num of metricasTornillos; track num) {
              <option [value]="num">
                {{ num }}
              </option>
              }
            </select>
          </div>
        </div>
        }
      </div>
      }
      <!-- MANILLAR -->
      @if (mod.nombre === 'MANILLAR' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Manillar</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaManillar{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
          <label class="form-label mt-2">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modelo"
            name="modeloManillar{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modelo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- VELOCÍMETRO -->
      @if (mod.nombre === 'VELOCÍMETRO' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Velocímetro</h3>
        <label class="form-label">Marca:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="mod.marca"
          name="marcaVelocimetro{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.marca"
        />
        <label class="form-label mt-2">Referencia:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="mod.referencia"
          name="referenciaVelocimetro{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.referencia"
        />
        <label class="form-label mt-2">Contraseña de homologación:</label>
        <input
          type="text"
          class="form-control"
          [(ngModel)]="mod.homologacion"
          name="homologacionVelocimetro{{ i }}"
          required
          [class.is-invalid]="formSubmitted && !mod.homologacion"
        />
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- LATIGUILLOS -->
      @if (mod.nombre === 'LATIGUILLOS' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Latiguillos</h3>
        <div class="mb-2">
          <label class="form-label">Marca delanteros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaDelanteros"
            name="marcaDelanteros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaDelanteros"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia delanteros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaDelanteros"
            name="referenciaDelanteros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaDelanteros"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca traseros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaTraseros"
            name="marcaTraseros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaTraseros"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia traseros:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referenciaTraseros"
            name="referenciaTraseros{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.referenciaTraseros"
          />
        </div>
      </div>
      }
      <!-- RETROVISORES -->
      @if (mod.nombre === 'RETROVISORES' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Retrovisores</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modelo"
            name="modeloRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modelo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaje"
            name="marcajeRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaje"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacionRetrovisores{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
      </div>
      }
      <!-- HORQUILLA DELANTERA -->
      @if (mod.nombre === 'HORQUILLA DELANTERA' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Horquilla Delantera</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marcaHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Tipo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.tipo"
            name="tipoHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.tipo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Variante:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.variante"
            name="varianteHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.variante"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Denominación comercial:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.denominacion"
            name="denominacionHorquilla{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.denominacion"
          />
        </div>
      </div>
      }
      <!-- DISCO DE FRENO Y PINZA DE FRENO -->
      @if ( mod.nombre === 'DISCO DE FRENO Y PINZA DE FRENO' && mod.seleccionado
      ) {
      <div class="mb-4">
        <h3>Disco de Freno y Pinza de Freno</h3>
        <!-- Disco de freno -->
        <div class="mb-3">
          <label class="form-label fw-bold"
            >¿Qué componente de freno se ha modificado?</label
          >
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.tieneDisco"
              id="tieneDisco{{ i }}"
              name="tieneDisco{{ i }}"
            />
            <label class="form-check-label" for="tieneDisco{{ i }}"
              >Disco de freno</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.tienePastilla"
              id="tienePastilla{{ i }}"
              name="tienePastilla{{ i }}"
            />
            <label class="form-check-label" for="tienePastilla{{ i }}"
              >Pinza de freno</label
            >
          </div>
          @if (formSubmitted && !mod.tieneDisco && !mod.tienePastilla) {
          <div class="text-danger mt-1">
            Debes seleccionar al menos una opción: disco o pastilla de freno.
          </div>
          }
        </div>
        <!-- Disco de freno -->
        @if (mod.tieneDisco) {
        <div>
          <h4>Disco de Freno</h4>
          <label class="form-label">¿Qué frenos se han modificado?</label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.discoDelantero"
              id="discoDelantero{{ i }}"
              name="discoDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.discoDelantero"
            />
            <label class="form-check-label" for="discoDelantero{{ i }}"
              >Delantero</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.discoTrasero"
              id="discoTrasero{{ i }}"
              name="discoTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.discoTrasero"
            />
            <label class="form-check-label" for="discoTrasero{{ i }}"
              >Trasero</label
            >
          </div>
          <!-- Campos Disco Delantero -->
          @if (mod.discoDelantero) {
          <div class="mt-2">
            <label class="form-label">Marca freno delantero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaDiscoDelantero"
              name="marcaDiscoDelantero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaDiscoDelantero"
            />
            <label class="form-label mt-2">Referencia freno delantero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaDiscoDelantero"
              name="referenciaDiscoDelantero{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaDiscoDelantero
              "
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor díametro de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
          <!-- Campos Disco Trasero -->
          @if (mod.discoTrasero) {
          <div class="mt-2">
            <label class="form-label">Marca freno trasero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaDiscoTrasero"
              name="marcaDiscoTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaDiscoTrasero"
            />
            <label class="form-label mt-2">Referencia freno trasero:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaDiscoTrasero"
              name="referenciaDiscoTrasero{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.referenciaDiscoTrasero"
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor díametro de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
        </div>
        }
        <!-- Pastilla de freno -->
        @if (mod.tienePastilla) {
        <div class="mt-4">
          <h4>Pinza de Freno</h4>
          <label class="form-label">¿Qué frenos se han modificado?</label>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.pastillaDelantera"
              id="pastillaDelantera{{ i }}"
              name="pastillaDelantera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.pastillaDelantera"
            />
            <label class="form-check-label" for="pastillaDelantera{{ i }}"
              >Delantero</label
            >
          </div>
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              [(ngModel)]="mod.pastillaTrasera"
              id="pastillaTrasera{{ i }}"
              name="pastillaTrasera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.pastillaTrasera"
            />
            <label class="form-check-label" for="pastillaTrasera{{ i }}"
              >Trasero</label
            >
          </div>
          <!-- Campos Pastilla Delantera -->
          @if (mod.pastillaDelantera) {
          <div class="mt-2">
            <label class="form-label">Marca pinza delantera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaPastillaDelantera"
              name="marcaPastillaDelantera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaPastillaDelantera"
            />
            <label class="form-label mt-2">Referencia pinza delantera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaPastillaDelantera"
              name="referenciaPastillaDelantera{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaPastillaDelantera
              "
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor díametro de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
          <!-- Campos Pastilla Trasera -->
          @if (mod.pastillaTrasera) {
          <div class="mt-2">
            <label class="form-label">Marca pinza trasera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.marcaPastillaTrasera"
              name="marcaPastillaTrasera{{ i }}"
              required
              [class.is-invalid]="formSubmitted && !mod.marcaPastillaTrasera"
            />
            <label class="form-label mt-2">Referencia pinza trasera:</label>
            <input
              class="form-control"
              type="text"
              [(ngModel)]="mod.referenciaPastillaTrasera"
              name="referenciaPastillaTrasera{{ i }}"
              required
              [class.is-invalid]="
                formSubmitted && !mod.referenciaPastillaTrasera
              "
            />
            <div class="mb-2">
              <label class="form-label"
                >Selecciona valor díametro de los tornillos:</label
              >
              <select
                class="form-select"
                [(ngModel)]="mod.metrica"
                name="metrica{{ i }}"
                required
                [class.is-invalid]="formSubmitted && mod.metrica == null"
              >
                <option [value]="null" disabled selected>Seleccione...</option>
                @for (num of metricasTornillos; track num) {
                <option [value]="num">
                  {{ num }}
                </option>
                }
              </select>
            </div>
          </div>
          }
        </div>
        }
      </div>
      }
      <!-- LUCES -->
      @if (mod.nombre === 'LUCES' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Luces</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marca"
            name="marca{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modelo"
            name="modelo{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.modelo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Referencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.referencia"
            name="referencia{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marca"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marcajes:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcajes"
            name="marcajes{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.marcajes"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacion"
            name="homologacion{{ i }}"
            required
            [class.is-invalid]="formSubmitted && !mod.homologacion"
          />
        </div>
      </div>
      }
      <!-- CAMPERS -->
      @if(mod.nombre === 'Modificaciones en el interior del vehículo' &&
      mod.seleccionado) { @if(mod.detalle.mobiliarioInterior){
      <!-- MOBILIARIO INTERIOR VEHÍCULO -->
      @if (mod.detalle.mobiliarioInterior) {
      <div class="mb-4">
        <section class="mod-card mobiliario">
          <!-- Cabecera -->
          <div class="mod-card__header">
            <h4 class="mod-card__title">Mobiliario Interior Vehículo</h4>
            <span class="mod-card__hint">Gestión de muebles y tornillería</span>
          </div>

          <!-- Selector global de tornillos -->
          <div class="row g-3 mb-3">
            <div class="col-12 col-md-6">
              <div class="form-floating">
                <select
                  class="form-select"
                  id="diametro-tornillo-{{ i }}"
                  [(ngModel)]="mod.diametroTornilloSeleccionado"
                  name="diametroTornilloSeleccionado{{ i }}"
                  required
                >
                  <option [ngValue]="null" disabled>Seleccione...</option>
                  @for (t of tornillosDB; track t.diametro) {
                  <option [ngValue]="t.diametro">{{ t.diametro }} mm</option>
                  }
                </select>
                <label for="diametro-tornillo-{{ i }}"
                  >Diámetro de tornillo</label
                >
              </div>
            </div>
          </div>

          <hr class="mod-sep" />

          <!-- Mueble Bajo -->
          @if (mod.mobiliarioInterior?.muebleBajo) {
          <div>
            <h4>
              Mueble Bajo
              <button
                class="btn btn-success btn-sm ms-2"
                (click)="anadirMueble(mod, 'bajo')"
              >
                + Añadir
              </button>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm ms-2"
                (click)="borrarUltimoMueble(mod, 'bajo')"
              >
                ↺ Borrar último
              </button>
            </h4>

            @for (mueble of mod.mueblesBajo; track mueble; let j = $index) {
            <div class="border rounded p-2 mb-2">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasBajo-{{ j }}"
                      [(ngModel)]="mueble.medidas"
                      name="medidas{{ j }}"
                      placeholder="Ej: 600x1420x900"
                    />
                    <label for="medidasBajo-{{ j }}">Medidas</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoBajo-{{ j }}"
                      [(ngModel)]="mueble.pesoMuebleBajo"
                      name="pesoMuebleBajo{{ j }}"
                      placeholder="Peso en Kg"
                    />
                    <label for="pesoBajo-{{ j }}">Peso en Kg</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosBajo-{{ j }}"
                      [(ngModel)]="mueble.tornillosMuebleBajo"
                      name="tornillosMuebleBajo{{ j }}"
                      placeholder="Cantidad de tornillos"
                    />
                    <label for="tornillosBajo-{{ j }}"
                      >Cantidad de tornillos</label
                    >
                  </div>
                </div>
              </div>

              <div class="form-floating mt-2">
                <select
                  class="form-select"
                  [(ngModel)]="mueble.tipoFabricacionMuebleBajo"
                  name="tipoFabricacionMuebleBajo{{ i }}"
                  required
                >
                  <option value="" disabled selected>Seleccione...</option>
                  <option value="comercial">Marca y Referencia</option>
                  <option value="aceroArtesanal">
                    Fabricado en acero artesanal
                  </option>
                  <option value="maderaArtesanal">
                    Fabricado en madera artesanal
                  </option>
                </select>
                <label>*Tipo de fabricación</label>
              </div>

              @if (mueble.tipoFabricacionMuebleBajo === 'comercial') {
              <div class="row g-3 mt-1">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="marcaBajo-{{ j }}"
                      [(ngModel)]="mueble.marcaMuebleBajo"
                      name="marcaMuebleBajo{{ i }}"
                      placeholder="Marca"
                    />
                    <label for="marcaBajo-{{ j }}">Marca</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="refBajo-{{ j }}"
                      [(ngModel)]="mueble.referenciaMuebleBajo"
                      name="referenciaMuebleBajo{{ i }}"
                      placeholder="Referencia"
                    />
                    <label for="refBajo-{{ j }}">Referencia</label>
                  </div>
                </div>
              </div>
              }
            </div>
            }
          </div>
          }

          <!-- Mueble Alto -->
          @if (mod.mobiliarioInterior?.muebleAlto) {
          <div>
            <h4>
              Mueble Alto
              <button
                class="btn btn-success btn-sm ms-2"
                (click)="anadirMueble(mod, 'alto')"
              >
                + Añadir
              </button>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm ms-2"
                (click)="borrarUltimoMueble(mod, 'alto')"
              >
                ↺ Borrar último
              </button>
            </h4>

            @for (mueble of mod.mueblesAlto; track mueble; let j = $index) {
            <div class="border rounded p-2 mb-2">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasAlto-{{ j }}"
                      [(ngModel)]="mueble.medidas"
                      name="medidasAlto{{ j }}"
                      placeholder="Ej: 1250x405x325"
                    />
                    <label for="medidasAlto-{{ j }}">Medidas</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoAlto-{{ j }}"
                      [(ngModel)]="mueble.pesoMuebleAlto"
                      name="pesoMuebleAlto{{ j }}"
                      placeholder="Peso en Kg"
                    />
                    <label for="pesoAlto-{{ j }}">Peso en Kg</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosAlto-{{ j }}"
                      [(ngModel)]="mueble.tornillosMuebleAlto"
                      name="tornillosMuebleAlto{{ j }}"
                      placeholder="Cantidad de tornillos"
                    />
                    <label for="tornillosAlto-{{ j }}"
                      >Cantidad de tornillos</label
                    >
                  </div>
                </div>
              </div>

              <div class="form-floating mt-2">
                <select
                  class="form-select"
                  [(ngModel)]="mueble.tipoFabricacionMuebleAlto"
                  name="tipoFabricacionMuebleAlto{{ i }}"
                  required
                >
                  <option value="" disabled selected>Seleccione...</option>
                  <option value="comercial">Marca y Referencia</option>
                  <option value="aceroArtesanal">
                    Fabricado en acero artesanal
                  </option>
                  <option value="maderaArtesanal">
                    Fabricado en madera artesanal
                  </option>
                </select>
                <label>*Tipo de fabricación</label>
              </div>

              @if (mueble.tipoFabricacionMuebleAlto === 'comercial') {
              <div class="row g-3 mt-1">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="marcaAlto-{{ j }}"
                      [(ngModel)]="mueble.marcaMuebleAlto"
                      name="marcaMuebleAlto{{ i }}"
                      placeholder="Marca"
                    />
                    <label for="marcaAlto-{{ j }}">Marca</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="refAlto-{{ j }}"
                      [(ngModel)]="mueble.referenciaMuebleAlto"
                      name="referenciaMuebleAlto{{ i }}"
                      placeholder="Referencia"
                    />
                    <label for="refAlto-{{ j }}">Referencia</label>
                  </div>
                </div>
              </div>
              }
            </div>
            }
          </div>
          }

          <!-- Aseo -->
          @if (mod.mobiliarioInterior?.aseo) {
          <div>
            <h4>
              Aseo
              <button
                type="button"
                class="btn btn-success btn-sm ms-2"
                (click)="anadirMueble(mod, 'aseo')"
              >
                + Añadir
              </button>
              <button
                type="button"
                class="btn btn-outline-danger btn-sm ms-2"
                (click)="borrarUltimoMueble(mod, 'aseo')"
              >
                ↺ Borrar último
              </button>
            </h4>

            @for (aseo of mod.mueblesAseo; track aseo; let j = $index) {
            <div class="border rounded p-2 mb-2">
              <div class="row g-3">
                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="medidasAseo-{{ j }}"
                      [(ngModel)]="aseo.medidas"
                      name="medidasAseo{{ j }}"
                      placeholder="Ej: 1030x2100x590"
                      required
                    />
                    <label for="medidasAseo-{{ j }}">Medidas</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="pesoAseo-{{ j }}"
                      [(ngModel)]="aseo.pesoMuebleAseo"
                      name="pesoMuebleAseo{{ j }}"
                      placeholder="Peso en Kg"
                    />
                    <label for="pesoAseo-{{ j }}">Peso en Kg</label>
                  </div>
                </div>

                <div class="col-12 col-md-6">
                  <div class="form-floating">
                    <input
                      type="text"
                      class="form-control"
                      id="tornillosAseo-{{ j }}"
                      [(ngModel)]="aseo.tornillosMuebleAseo"
                      name="tornillosMuebleAseo{{ j }}"
                      placeholder="Cantidad de tornillos"
                    />
                    <label for="tornillosAseo-{{ j }}"
                      >Cantidad de tornillos</label
                    >
                  </div>
                </div>
              </div>

              <div class="form-floating mt-2">
                <textarea
                  class="form-control"
                  id="descripcionAseo-{{ j }}"
                  rows="3"
                  [(ngModel)]="aseo.descripcion"
                  name="descripcionAseo{{ j }}"
                  placeholder="Descripción interior"
                  required
                ></textarea>
                <label for="descripcionAseo-{{ j }}"
                  >Descripción interior</label
                >
              </div>
            </div>
            }
          </div>
          }
        </section>
      </div>
      }
      <!-- CLARABOYA -->
      @if (mod.mobiliarioInterior?.claraboyas) {
      <div class="mb-4">
        <h3>Claraboya</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de claraboyas:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.cantidadClaraboya"
            name="cantidadClaraboya"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaClaraboya"
            name="marcaClaraboya"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloClaraboya"
            name="modeloClaraboya"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Descripción:</label
          ><textarea
            class="form-control"
            rows="2"
            [(ngModel)]="mod.descripcionClaraboya"
            name="descripcionClaraboya"
          ></textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionClaraboya"
            name="homologacionClaraboya"
          />
        </div>
      </div>
      }
      <!-- VENTANA -->
      @if (mod.mobiliarioInterior?.ventanas) {
      <div class="mb-4">
        <h3>Ventana</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de ventanas:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.cantidadVentanas"
            name="cantidadVentanas"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Descripción:</label
          ><textarea
            class="form-control"
            rows="2"
            [(ngModel)]="mod.descripcionVentana"
            name="descripcionVentana"
          ></textarea>
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaVentana"
            name="marcaVentana"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloVentana"
            name="modeloVentana"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Dimensiones:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesVentana"
            name="dimensionesVentana"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Contraseña de homologación:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.homologacionVentana"
            name="homologacionVentana"
          />
        </div>
      </div>
      } } @if(mod.detalle.fontaneria){
      <!-- DEPÓSITO DE AGUA SUCIA -->
      @if (mod.fontaneria?.depositoAguaSucia) {
      <div class="mb-4">
        <h3>Depósito de Agua Sucia</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de litros:</label
          ><input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.litrosAguaSucia"
            name="litrosAguaSucia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
        />
      </div>
      }
      <!-- DEPÓSITO DE AGUA LIMPIA -->
      @if (mod.fontaneria?.depositoAguaLimpia) {
      <div class="mb-4">
        <h3>Depósito de Agua Limpia</h3>
        <div class="mb-2">
          <label class="form-label">Cantidad de litros:</label
          ><input
            type="number"
            min="0"
            min="0"
            class="form-control"
            [(ngModel)]="mod.litrosAguaLimpia"
            name="litrosAguaLimpia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasAguaLimpia"
            name="medidasAguaLimpia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
        />
      </div>
      }
      <!-- BOMBA DE AGUA -->
      @if (mod.fontaneria?.bombaDeAgua) {
      <div class="mb-4">
        <h3>Bomba de Agua</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaBombaAgua"
            name="marcaBombaAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloBombaAgua"
            name="modeloBombaAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label
          ><input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionBombaAgua"
            name="ubicacionBombaAgua"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
        />
      </div>
      }
      <!-- DUCHA EXTERIOR -->
      @if (mod.fontaneria?.duchaExterior) {
      <div class="mb-4">
        <h3>Ducha exterior</h3>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionDuchaExterior"
            name="ubicacionDuchaExterior{{ i }}"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
        />
      </div>
      } } } @if (mod.nombre === 'Instalación eléctrica' && mod.seleccionado) {
      <!-- TOMA EXTERIOR 230V -->
      @if (mod.detalle.tomaCorrienteInterior) {
      <div class="mb-4">
        <h3>Toma exterior 230V</h3>
        <div class="mb-2">
          <label class="form-label">Voltaje:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.voltajeTomaExterior"
            name="voltajeTomaExterior{{ i }}"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionTomaExterior"
            name="ubicacionTomaExterior{{ i }}"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasTomaExterior"
            name="medidasTomaExterior{{ i }}"
          />
        </div>
      </div>
      } }

      <!-- INSTALACIÓN ELÉCTRICA -->
      @if (mod.nombre === 'Instalación eléctrica' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Instalación Eléctrica</h3>
        @if(mod.detalle.bateriaAuxiliar) {
        <!-- Baterías auxiliares -->
        <h4>Baterías Auxiliares</h4>
        <div class="mb-2">
          <label class="form-label">Cantidad:</label>
          <input
            type="number"
            min="0"
            class="form-control"
            [(ngModel)]="mod.cantidadBaterias"
            name="cantidadBaterias"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Potencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaBaterias"
            name="potenciaBaterias"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionBaterias"
            name="ubicacionBaterias"
          />
        </div>
        } @if(mod.detalle.cargadorDeBateria) {
        <h4>Placa Solar</h4>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaCargadorDeBateria"
            name="marcaCargadorDeBateria"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloCarcadorDeBaretia"
            name="modeloCarcadorDeBaretia"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Potencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaCargadorDeBateria"
            name="potenciaCargadorDeBateria"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Dimensiones (mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesCargadorDeBateria"
            name="dimensionesCargadorDeBateria"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionCargadorDeBateria"
            name="ubicacionCargadorDeBateria"
          />
        </div>
        } @if(mod.detalle.iluminacionExterior) {
        <h4>Placa Solar</h4>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaIlumincionExterior"
            name="marcaIluminacionExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloIlumincionExterior"
            name="modeloIlumincionExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Potencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaIlumincionExterior"
            name="potenciaIlumincionExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Dimensiones (mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesIlumincionExterior"
            name="dimensionesIlumincionExterior"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionIlumincionExterior"
            name="ubicacionIlumincionExterior"
          />
        </div>
        } @if(mod.detalle.inversor) {
        <!-- Inversor -->
        <h4>Inversor</h4>
        <div class="mb-2">
          <label class="form-label">Potencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaInversor"
            name="potenciaInversor"
            required
            [class.is-invalid]="formSubmitted && !mod.potenciaInversor"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaInversor"
            name="marcaInversor"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaInversor"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionInversor"
            name="ubicacionInversor"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionInversor"
          />
        </div>
        } @if(mod.detalle.placaSolar) {
        <!-- Placa solar -->
        <h4>Placa Solar</h4>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaPlacaSolar"
            name="marcaPlacaSolar"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaPlacaSolar"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloPlacaSolar"
            name="modeloPlacaSolar"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloPlacaSolar"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Potencia:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.potenciaPlacaSolar"
            name="potenciaPlacaSolar"
            required
            [class.is-invalid]="formSubmitted && !mod.potenciaPlacaSolar"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Dimensiones (mm):</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.dimensionesPlacaSolar"
            name="dimensionesPlacaSolar"
            required
            [class.is-invalid]="formSubmitted && !mod.dimensionesPlacaSolar"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionPlacaSolar"
            name="ubicacionPlacaSolar"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionPlacaSolar"
          />
        </div>
        } @if(mod.detalle.reguladorSolar) {
        <!-- Controlador de carga -->
        <h4>Controlador de Carga</h4>
        <div class="mb-2">
          <label class="form-label">Modelo:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.modeloControlador"
            name="modeloControlador"
            required
            [class.is-invalid]="formSubmitted && !mod.modeloControlador"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaControlador"
            name="marcaControlador"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaControlador"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionControlador"
            name="ubicacionControlador"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionControlador"
          />
        </div>

        } @if(mod.detalle.tomaCorrienteInterior) { }
        @if(mod.detalle.tomaCorrienteexterior) { }
      </div>
      }
      <!-- TOLDO -->
      @if (mod.nombre === 'Toldo' && mod.seleccionado) {
      <div class="mb-4">
        <h3>Toldo</h3>
        <div class="mb-2">
          <label class="form-label">Marca:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.marcaToldo"
            name="marcaToldo"
            required
            [class.is-invalid]="formSubmitted && !mod.marcaToldo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Medidas:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.medidasToldo"
            name="medidasToldo"
            required
            [class.is-invalid]="formSubmitted && !mod.medidasToldo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label">Ubicación:</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="mod.ubicacionToldo"
            name="ubicacionToldo"
            required
            [class.is-invalid]="formSubmitted && !mod.ubicacionToldo"
          />
        </div>
        <div class="mb-2">
          <label class="form-label"
            >Selecciona valor díametro de los tornillos:</label
          >
          <select
            class="form-select"
            [(ngModel)]="mod.metrica"
            name="metrica{{ i }}"
            required
            [class.is-invalid]="formSubmitted && mod.metrica == null"
          >
            <option [value]="null" disabled selected>Seleccione...</option>
            @for (num of metricasTornillos; track num) {
            <option [value]="num">
              {{ num }}
            </option>
            }
          </select>
        </div>
        <label class="form-label">Nº de tornillos:</label>
        <input
          type="number"
          min="0"
          class="form-control"
          [(ngModel)]="mod.nTornillos"
          name="nTornillos"
          required
          [class.is-invalid]="formSubmitted && !mod.nTornillos"
        />
      </div>
      }
      <!-- Añadir más bloques según las modificaciones necesarias -->
    </div>
    }

    <div class="d-flex justify-content-between mt-3">
      <button
        type="button"
        class="btn btn-outline-secondary"
        (click)="onVolver()"
      >
        ← Volver
      </button>
      <button type="submit" class="btn btn-primary">Continuar →</button>
    </div>
  </form>
</div>
