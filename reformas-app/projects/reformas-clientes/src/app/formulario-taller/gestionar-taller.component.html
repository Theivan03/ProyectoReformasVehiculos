<div class="container mt-4">
  <!-- Pantalla inicial -->
  @if (!accion && !guardado) {
    <div class="text-center">
      <h4 class="mb-4">¬øQu√© desea hacer?</h4>
      <button
        class="btn btn-outline-primary me-3"
        (click)="seleccionarAccion('crear')"
        >
        A√±adir nuevo taller
      </button>
      <button
        class="btn btn-outline-secondary"
        (click)="seleccionarAccion('editar')"
        >
        Modificar taller existente
      </button>
    </div>
  }

  <!-- Bot√≥n de volver atr√°s -->
  @if (accion && !guardado) {
    <div class="mb-3">
      <button class="btn btn-outline-secondary" (click)="volverAlInicio()">
        ‚Üê Volver
      </button>
    </div>
  }

  <!-- Selector de taller -->
  @if (accion === 'editar' && !guardado) {
    <div class="mb-3">
      <label class="form-label">Seleccione el taller a modificar:</label>
      <select
        class="form-select"
        [(ngModel)]="tallerSeleccionadoNombre"
        (change)="cargarTaller()"
        >
        <option [ngValue]="null" disabled selected>-- Seleccionar --</option>
        @for (t of talleres; track t) {
          <option [ngValue]="t.nombre">
            {{ t.nombre }}
          </option>
        }
      </select>
    </div>
  }

  <!-- Formulario -->
  @if (accion && !guardado) {
    <form
      #form="ngForm"
      (ngSubmit)="form.valid && guardarTaller()"
      novalidate
      class="card p-4 shadow-sm mt-3"
      >
      <h5 class="mb-3">
        {{ accion === "crear" ? "Nuevo Taller" : "Editar Taller" }}
      </h5>
      @for (
        campo of [
        'nombre',
        'direccion',
        'poblacion',
        'provincia',
        'registroIndustrial',
        'registroEspecial',
        'responsable',
        'telefono',
        'especialidad'
        ]
        ; track
        campo) {
        <div
          class="mb-3"
          >
          <label class="form-label">{{ formatLabel(campo) }}</label>
          <input
            type="text"
            class="form-control"
            [(ngModel)]="formularioTaller[campo]"
            [name]="campo"
            required
            #ctrl="ngModel"
            />
            @if (ctrl.invalid && ctrl.touched) {
              <div class="text-danger small">
                Este campo es obligatorio.
              </div>
            }
          </div>
        }
        <!-- Botones (guardar + borrar en editar) -->
        @if (accion === 'editar') {
          <div class="d-flex gap-2 mt-4">
            <button
              type="submit"
              class="btn btn-success flex-grow-1"
              style="flex-basis: 75%"
              >
              Guardar cambios
            </button>
            <button
              type="button"
              class="btn btn-danger"
              style="flex-basis: 25%"
              (click)="eliminarTaller()"
              >
              üóëÔ∏è Borrar
            </button>
          </div>
        }
        <!-- Bot√≥n guardar √∫nico en modo crear -->
        @if (accion === 'crear') {
          <div class="mt-4">
            <button type="submit" class="btn btn-success w-100">
              Guardar taller
            </button>
          </div>
        }
      </form>
    }
  </div>
